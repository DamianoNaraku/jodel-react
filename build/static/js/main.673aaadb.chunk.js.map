{"version":3,"sources":["common/libraries/prj_json2xml.js","common/libraries/prj_xml2json.js","joiner/types.ts","graph/graphElement/sharedTypes/sharedTypes.tsx","joiner/classes.ts","joiner/proxy.ts","common/DV.tsx","common/Geom.ts","common/UX.tsx","model/classes/D.ts","model/classes/L.ts","redux/store.tsx","redux/reducer/reducer.ts","redux/createStore.ts","ocl/ocl.tsx","joiner/ExecuteOnRead.ts","joiner/index.ts","../node_modules/jstransform/node_modules/source-map/lib/source-map sync","graph/graphElement/graphElement.tsx","model/logicWrapper/LModelElement.ts","api/data.ts","redux/selectors/selectors.ts","model/dataStructure/GraphDataElements.ts","redux/action/action.ts","components/forEndUser/TextArea.tsx","components/forEndUser/Select.tsx","components/forEndUser/Image.tsx","components/forEndUser/Edge.tsx","components/logger/DataOutput.tsx","components/logger/loggerComponent.tsx","components/abstract/MyInput.tsx","components/forEndUser/Overlap.tsx","components/colorScheme/colorScheme.tsx","graph/graph/graph.tsx","graph/vertex/Vertex.tsx","graph/defaultNode/DefaultNode.tsx","graph/graph/graphContainer.tsx","graph/edge/Edge.tsx","graph/edge/Edges.tsx","joiner/components.tsx","graph/vertex/RootVertex.tsx","components/forEndUser/Input.tsx","view/viewPoint/viewpoint.ts","common/U.ts","view/viewElement/view.ts","components/rightbar/structureEditor/editors/Value.tsx","components/rightbar/structureEditor/Structure.tsx","components/rightbar/structureEditor/StructureEditor.tsx","components/rightbar/treeEditor/treeEditor.tsx","components/rightbar/viewsEditor/Views.tsx","components/rightbar/oclEditor/OclEditor.tsx","components/rightbar/jsxEditor/JsxEditor.tsx","components/rightbar/viewsEditor/View.tsx","components/rightbar/viewsEditor/ViewsEditor.tsx","components/rightbar/styleEditor/StyleEditor.tsx","components/rightbar/edgeEditor/EdgeEditor.tsx","components/rightbar/viewpointsEditor/ViewpointsEditor.tsx","components/rightbar/console/Console.tsx","components/toolbar/ToolBarItem.tsx","components/toolbar/ToolBar.tsx","graph/edge/PendingEdge.tsx","components/toolbar/ContextMenu.tsx","graph/edges/ReferenceEdge.tsx","graph/edges/ExtendEdge.tsx","graph/edges/ValueEdge.tsx","graph/edges/EdgesManager.tsx","components/abstract/tabs/MetamodelTab.tsx","components/abstract/tabs/ModelTab.tsx","components/abstract/tabs/InfoTab.tsx","api/api.ts","components/abstract/tabs/PersistanceTab.tsx","components/abstract/DockLayout.tsx","static/img/splash.png","components/topbar/SaveManager.ts","graph/damedges/damedge.tsx","components/topbar/Topbar.tsx","App.tsx","index.tsx"],"names":["json2xml","o","tab","toXml","v","name","ind","xml","Array","i","n","length","hasChild","m","charAt","substr","toString","replace","X","toObj","nodeType","attributes","nodeName","nodeValue","firstChild","textChild","cdataChild","hasElementChild","nextSibling","match","removeWhite","escape","innerXml","documentElement","alert","toJson","json","join","arr","node","s","innerHTML","asXml","c","txt","e","normalize","nxt","removeChild","xml2json","xml2jsonobj","EdgeBendingMode","windoww","window","GraphElementStatee","GraphElementReduxStateProps","view","views","data","preRenderFunc","evalContext","template","graph","GraphElementDispatchProps","GraphElementOwnProps","children","style","key","parentnodeid","nodeid","graphid","parentViewId","console","warn","AbstractMixedClass","logic","structure","singleton","RuntimeAccessibleClass","className","currentlevel","this","ret","push","__proto__","log","prototype","joinOriginal","separator","separators","isArray","extendPrototypes","Object","values","annotatedClasses","gclass","statickey","annotated","keys","classes","baseObjInLookup","path","canThrow","state","map","d","DPointerTargetable","wrap","__isProxy","store","getState","idlookup","Log","exx","error","Error","Proxy","TargetableProxyHandler","MapProxyHandler","thiss","dclassname","superClassName","returnIfEqual","superclass","get","thisclass","Leaf","constructor","Node","Abstract","Instantiable","instanceConstructor","RuntimeAccessible","staticClassName","outerthis","classnameFixedConstructorDoNotRenameWithoutSearchStrings","args","obj","classNameFromAnnotation","initBase","canFireActions","Constructors","t","father","persist","fatherType","callbacks","hasOwnProperty","SetFieldAction","new","PointedBy","fromID","id","BEGIN","simpledatacallback","setTimeout","cb","END","CreateElementAction","defaultValue","_DClass","DClass","_DValue","DValue","targets","fromPointer","alreadyParsed","nextTargets","target","extendedBy","ext","pointer","instances","instance","undefined","instanceoff","LPointerTargetable","instanceof","val","isMirage","edges","source","details","det","isUser","DUser","current","maxID","Date","getTime","substring","type","uri","prefix","isMetamodel","packages","SetRootFieldAction","exceptions","implementation","exc","isInterface","isAbstract","isPrimitive","partial","partialdefaultname","interface","abstract","value","literal","midnodes","model","parentNodeID","parentgraphID","nodeID","subElements","jsxString","defaultVSize","usageDeclarations","constants","appliableToClasses","priority","subViews","oclApplyCondition","explicitApplicationPriority","GraphSize","draggable","resizable","adaptWidth","display","width","height","adaptHeight","DGraph_makeID","zoom","GraphPoint","graphSize","_subMaps","x","y","w","h","modelid","DGraph_maxID","fakearg_detectwrongcalls","_storePath","pointedBy","startingPrefix","metaptr","lfather","from","childrenNames","U","increaseEndingNumber","newname","indexOf","condition","__raw","ptr","p","a","l","defaultComponent","subclasses","_extends","Pointers","filter","pointerval","includes","PendingPointedByPaths","to","solveAttempts","stackTrace","action","getStackTrace","canBeResolved","resolve","arrayRemoveAll","all","Action","parse","create","maxSolveAttempts","ex","oldState","pendingPointedBy","pb","followPath","attemptResolve","lastIndexOf","split","field","modifier","oldValue","casee","oldtarget","index","actionpath","splice","newtargetptr","newtarget","saveForLater","list","__serialize","inspect","clonedCounter","__random","__info_of__id","str","msg","wrongAccessMessage","context","cannotSet","DeleteElementAction","_delete","extends","wrapAll","WPointerTargetable","fromD","cursorPositionX","cursorPositionY","__isUser","end","LUser","cursorPosition","MyError","message","proto","otherMsg","actualProto","setPrototypeOf","JsType","printableTypeName","check","isExclusiveType","getTypes","acceptables","Uarr","arrayIntersection","stopIfTypeIsNot","isFunction","getFunctionSignatureFromComments","isLambda","isNonLambdaFunction","fallbackReturn","isObject","isLambdaFunction","isSymbol","isBoolean","isNumber","isBigint","isString","isNull","isUndefined","isDate","isAnyOfTypes","object","function","array","invalidSuperClassError","scname","exDevv","MixinFakeConstructor","isMixinFakeConstructor","MixOnlyFuncs","c1","c2","c1noconstructor","c2noconstructor","Mixin","c1name","c2name","init_constructor","date","lambdaFunction","nonLambdaFunction","symbol","null","boolean","number","bigint","string","buildWrapSignature","maxdepth","onlyUnique","self","dep","depsorted","byLevels","loopdetecter","namelist","olddep","flatMap","table","lparam","epsorted","D","L","signature","LogicContext","proxyObject","write","MapLogicContext","proxy","subMaps","MyProxyHandler","g","proxyitself","getOwnPropertyNames","GetPathHandler","strbuilder","calls","targetObj","propKey","__asCalls","__asArray","arguments","Symbol","toPrimitive","__nested","additionalPath","lg","exDev","propKeyStr","asString","_index","isConcatenable","subKey","get0","canThrowErrors","String","JSON","stringify","Math","random","typeName","$$typeof","getterMethod","defaultGetter","lc","lchildren","concatenationTentative","concatenableHandler","getType","mapWrap","defaultSetter","proxyItself","set","arrayMergeInPlace","k","subMapKeys","submapkeys","getPath","beautify","require","html","ShortAttribETypes","DV","DefaultView","package","class","feature","enum","operation","operationm1","defaultPackage","publicmsg","debughiddenmsg","debuginfo","valuecolormap","EBoolean","EByte","EShort","EInt","ELong","EFloat","EDouble","EDate","EString","EChar","void","valuecolormap_str","IPoint","other","clone","p2","newInstance","p1","duplicate","p0","add","subtract","pt","scalar","isNaN","firstPt","secondPt","tolleranza","rectangle","Size","fromPoints","tolleranzaX","tolleranzaY","distanceFromLine","top","bot","abs","sqrt","startVertexSize","debug","tl","tr","bl","br","R","T","B","min","markg","pt2","getM","toRadians","directionVector","atan2","RadToDegree","getQ","dontmixwithPoint","Point","pageX","pageY","dontmixwithGPoint","ISize","makePoint","size","minSize","maxSize","startx","starty","endx","endy","max","intersection","size2","sizes","isOverlapping","dontMixWithGraphSize","element0","element","document","body","tmp","$element","$","tagName","sizeofvar","createElement","append","isOrphan","parentNode","ancestors","ancestorArray","displayStyles","getComputedStyle","offset","left","getBoundingClientRect","removeProperty","clear","minX","maxX","minY","$sizeofvar","dontMixWithSize","vertexGSize","prevPt","pt0","gridAlign","q","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","vicinanzaT","vicinanzaB","vicinanzaL","vicinanzaR","closest","closestX","farthestX","floorX","floor","ceilX","ceil","closestY","farthestY","floorY","ceilY","is","Geom","DegreeToRad","TanToDegree","isPositiveZero","isNegativeZero","atan","radians","PI","degree","UX","fn","innermap","child","React","isValidElement","props","cloneElement","recursiveMap","Children","parentComponent","gvidmap","re","ReactNodeAsElement","WrappedComponent","Components","GraphElementComponent","DefaultNodeComponent","GraphComponent","VertexComponent","injectProps","dataid","idbasename","lItem","MySwal","withReactContent","Swal","fire","title","showCancelButton","confirmButtonText","cancelButtonText","showLoaderOnConfirm","delete","text","statehistory","globalcanundostate","undoable","redoable","IStore","logs","models","currentUser","viewelements","stackViews","graphs","voidvertexs","vertexs","graphvertexs","edgepoints","extEdges","refEdges","classifiers","enumerators","primitiveTypes","enumliterals","references","classs","operations","parameters","returnTypes","isEdgePending","user","contextMenu","deleted","objects","_lastSelected","users","_edgeSettings","strokeWidth","color","zIndex","_edgesDisplayed","extend","referenceM2","referenceM1","viewpoint","viewpoints","m2models","m1models","graphDefaultViews","makeDefaultGraphViews","graphDefaultView","DViewPoint","primitiveType","dPrimitiveType","outElemArray","me","annotation","implements","namedElement","attribname","DAttribute","pkg","DPackage","attriburi","classifierref","DReference","pkgref","classe","m3","DModel","m3graph","DGraph","call","mview","DViewElement","modelView","pkgview","packageView","cview","classView","eview","enumeratorView","DEnumerator","aview","attributeView","rview","referenceView","oview","operationView","DOperation","literalView","DEnumLiteral","objectView","DObject","valueView","query","alldefaultViews","slice","_meta","deepCopyButOnlyFollowingPath","oldStateDoNotModify","prevAction","newVal","newRoot","gotChanged","alreadyPastDivergencePoint","pathArray","trim","prevActionPathKey","isArrayAppend","isArrayRemove","endsWith","isPointer","removedval","remove","oldpointerdestinations","difference","arrayDifference","removed","rem","added","CompositeActionReducer","actionBatch","actions","getSolveableActions","possibleInconsistencies","derivedActions","LoadAction","elem","statefoldername","toLowerCase","sort","a1","a2","stringCompare","newState","actiontype","count","executionCount","subType","SubType","vertexSubElements","updateRedundancies_OBSOLETE","initialState","storeLoaded","reducer","times","UndoAction","undo","pop","RedoAction","doreducer","delta","objectDelta","filterundoableactions","isundo","undonestate","undorecursive","deltalevel","statelevel","ca","forceinit","CompositeAction","jodelInit","fixStatics","dClasses","getAllNames","rc","lClasses","alld","alll","dname","tagless","sc","buildLSingletons","reduce","acc","curr","defaultContext","Selectors","getAllClassesDictionary","allClasses","fakeinit","createStore","Company","employee","manager","Persona","age","isUnemployed","OCL","obj0","oclexp","typeused","oclEngine","OclEngine","typeregister","registerTypes","addOclExpression","notEmpty","f","name0","evaluate","keepIndex","returnType","res","bool","getEvaluatedContexts","getResult","r","company","Person","Componentss","$$","prjson2xml","_pr_json2xml","prxml2json","_pr_xml2json","JSXT","jsxtt","info","webpackEmptyContext","req","code","module","exports","makeEvalContext","eval","setTemplateString","stateProps","ownProps","allProps","jsxCodeString","jsxparsedfunc","fromString","factory","eDevv","evalInContextAndScope","errormsg","otherargs","where","errorView","_isMounted","maxid","component","execInContextAndScope","rnode","getTemplate","rawRElement","fiximport","onDragTestInject","rn","injectProp","newid","forceUpdate","nextProps","nextState","nextContext","shallowEqual","dnode","viewScores","getAppliedViews","meid","dGraphElementDataClass","DGraphElement","isDGraph","dge","dGraphDataClass","startingobj","mapLModelStuff","mapLGraphElementStuff","mapViewStuff","reduxProps","objectMergeInPlace","forceupdate","dispatch","PureComponent","graphVertexID_counter","GraphElementConnected","connect","mapStateToProps","mapDispatchToProps","GraphElement","DModelElement","parent","annotations","DAnnotationDetail","LModelElement","__info_of__father","fatherList","nodes","subNodes","property","containers","loopdetectionobj","generateEcoreJson_impl","loopDetectionObj","cannotCall","DAnnotation","includingthis","$class","$subnodes","find","nodehtmlarr","toArray","nodeidarr","dataset","dnodes","loopdetection","get_father","fatherFieldName","getFatherFieldToDelete","reduxFieldName","getReduxFieldToDelete","fatherField","reduxField","selected","modelElement","superDelete","nodeElements","nodeId","lNode","get_until_parent","get_children_idlist","logicContext","ptrs","indexes","ee","get_addAttribute","get_addClass","get_addPackage","get_addReference","get_addEnumerator","get_addLiteral","get_addOperation","get_addParameter","get_addException","dOperation","dClass","params","exception","LAnnotation","__namee","EcoreParser","ECoreAnnotation","generateEcoreJson","deep","de","addAnnotation","ldet","le","we","lchild","LAnnotationDetail","DNamedElement","LNamedElement","namespace","fullname","get_containers","reverse","replaceAll","_autofix_name","DTypedElement","ordered","unique","lowerBound","upperBound","many","required","LTypedElement","classType","enumType","get_type","isClass","isEnum","typeEcoreString","typeString","t1","t2","ShortAttribSuperTypes","isExtending","DClassifier","instanceClassName","LClassifier","classTypePrefix","subpackages","dmodel","defaultname","setter","assign","LPackage","enums","allSubPackages","allSubEnums","allSubClasses","literals","classarr","enumarr","concat","ECorePackage","xmiversion","xmlnsxmi","xmlnsxsi","xmlnsecore","namee","nsURI","nsPrefix","eClassifiers","addPackage","isPartial","partialDefaultName","addEnumerator","dc","get_enumerators","get_allSubPackages","get_allSubEnumerators","tocheck","checked","newtocheck","dpackage","oldList","diff","pos","canBeDeleted","visibility","AccessModifier","private","LOperation","signatureImplementation","ECoreOperation","eParameters","par","eType","eexceptions","addOperation","DParameter","func","get_signatureImplementation","apply","typedComments","typedcommentpre","typedcommentpost","typeToShortString","b","superchildren","override","getFirstPrimitiveTypes","LParameter","addParameter","features","referencedBy","implementedBy","LClass","extendsChain","ownAttributes","ownReferences","ownOperations","ownChildren","inheritedAttributes","inheritedReferences","inheritedOperations","inheritedChildren","allAttributes","allReferences","allOperations","allChildren","superclasses","LAttribute","LReference","get_ownAttributes","get_ownReferences","get_ownOperations","fromArr","Set","get_extendsChain","superClass","get_inheritedAttributes","get_inheritedReferences","get_inheritedOperations","get_ownChildren","get_inheritedChildren","featurearr","operationsarr","att","ref","op","ECoreClass","xsitype","toBoolString","instanceTypeName","eSuperTypes","eStructuralFeatures","eOperations","addClass","finalVal","output","reason","allTargetSuperClasses","_canExtend","plusThis","visited","queue","SetMerge","j","superchild","_canOverride","_canPolymorph","_mark","orEqual","get_superclasses","force","out","newextends","newextendedBy","filteredPointedBy","DDataType","serializable","LDataType","DStructuralFeature","changeable","volatile","transient","unsettable","derived","LStructuralFeature","defaultValueLiteral","containment","container","resolveProxies","opposite","ECoreReference","lowerbound","upperbound","addReference","dclass","set_type","has_opposite","oppositename","obsolete_attribute","isID","ECoreAttribute","addAttribute","LEnumLiteral","ordinal","EcoreLiteral","impl_generateEcoreJsonM1","addLiteral","get_value","set_value","ordinals","sameOrdinalLit","LEnumerator","ECoreEnum","eLiterals","dliterals","currentOrdinal","dString","DModelM1","roots","LModelM1","dmodels","getAll","dmodelnames","LModel","allSubAnnotations","allSubObjects","packageArr","ECoreRoot","ecoreEPackage","ecoreRootName","get_objects","isRoot","namespacedclass","pkguri","classname","get_getPackageByUri","DFactory_useless_","ePackage","LFactory_useless_","EJavaObject","DMap","__isDMap","LMap","__isLMap","meta","LObject","allchildren","truechildren","deepSubObjects","subObjects","referenceFeatures","attributeFeatures","shapelessFeatures","childs","conformchildren","bymetaparent","vmeta","vmetaid","flat","get_uri","getPathArr","ref_features","get_referenceFeatures","shapeless_features","get_shapelessFeatures","alreadyparsed","get_subObjects","next","includeshapeless","matchedFeature","asEcoreRoot","_removeConformity","_forceConformity","lmeta","attrs","refs","idmap","addValue","get_children","lValue","dFather","lastvisited","get_fatherList","LValue","conformsTo","get_fromlfeature","iof","namedPointers","ecorePointers","shapeless","keepempties","withmetainfo","get_values","fitSize","maxlimit","dmeta","typestr","numbermax","numbermin","round","rawValue","hidden","mapperfunc","numbercasting","NaN","getFirstNumber","ecorePointer","forEach","struct","lit","filterfunc","lval","fromBoolString","limit","keepemptyquotes","valuestring_impl","havestrings","havechars","vall","valstr","info0","skipSettingUndefined","oldVal","oldTarget","isContainment","isPtr","success","lvale","lvalo","oldContainer","oldContainerValue","valarr","setValueAtPosition","metatype","_clearValueAtPosition","setMirage","modified","get_setValueAtPosition","the_loop","generateEcoreJsonM1","_toString","get_getValues","SavePack","vertexpos","LocalStorage","autosave","localStorage","getItem","serialize","modelNumber","modelname","KeyList","lastOpenedModel","lastOpenedView","lastOpenedPosition","setLastOpened","vertex","del","isOverwrite","deserialize","ecorejson","filename","parsedjson","temp","pause","parsedElements","parseM2Model","parseM1Model","LinkAllNamesToIDs","fixNamingConflicts","resume","newBatch","fixObjectPointers","tmpparse","tempfix_untilopennewtabisdone","dobjects","lobjects","m1pointermap","newvalues","idMap","nameMap","replacePrimitiveMap","d_Estring","getAllPrimitiveTypes","AttribETypes","shortkey","longkey","ecorename","dobj","replacekey","valtmp","DfromPtr","dval","getLiteral","ptrkey","updateSuperClasses","generated","ECoreNamed","dObject","getChildren","getAnnotations","parseDAnnotation","parseDPackage","allmodels","xmlns","XMLinlineMarker","ns","findns","outerloop","key0","val0","key1","ECoreObject","xmi_version","xmlns_xmi","expected","mmclass","getClassByNameSpace","roots_for_this_metaclass","rootjson","parseDObject","metaSuperClass","m2classes","parentType","getobjectmetaclass","metaname","metafeature","classmeta","parseDValue","jsonvalues","dValue","version","supportedEcoreVersions","read","parseDClass","parseDEnum","tmps","functions","parseDOperation","xsiType","parseDAttribute","parseDReference","parseDEnumLiteral","getEcoreTypeName","typekey","parseDParameter","eAnnotations","isEmptyObject","throwError","mod","cla","fun","valueIfNotFound","multiReplaceAll","ECoreDetail","ECoreParameter","xmlns_uri","XMIModel","ViewEClassMatch","metamodel","m2","m1","LViewPoint","dObjects","lObjects","dValues","lValues","edge","classList","dModels","resolvePointers","ArrayMerge0","vv","gv","ep","Classe","GClass","allIdByClassName","allDByClassName","allLByClassName","caseSensitive","getByField","dfield","IMPLICIT_MATCH","getViewpoint","constructors","getAllClasses","flag","EXACT_MATCH","MISMATCH","ThisClass","gotSubclassMatch","classtarget","ClassTarget","classIsExtending","INHERITANCE_MATCH","classTarget","acceptEquality","v1","hisnode","v1MatchingEClassScore","matchesMetaClassTarget","v1OclScore","matchesOclCondition","v1SubViewScore","selectedViewId","allViews","getAllViewElements","selectedView","parentView","sameViewPointSubViews","sortedPriority","Scored","scoreView","e1","e2","score","isOfSubclass","toObject","forGraph","asPointers","subelements","geid","ge","lPackage","lClass","lOperation","classifier","lClassifier","isSelected","graphID","LGraphElement","allSubNodes","position","htmlSize","htmlPosition","get_w","set_w","get_h","set_h","get_html","of","get_htmlSize","set_zIndex","isDeepStrictEqual","pointers","newsubelementid","subelement","oldsubelementid","modelElementId","subnode","dmp","$allnodes","matchedids","matchedidmap","objectFromArrayValues","allnodesarr","filternode","$matched","$notMatched","LGraph","rawgraph","zoomx","zoomy","defaultEPSize","DVoidVertex","LVoidVertex","trace","get_graph","gsize","boundary","equals","DEdgePoint","__isDEdgePoint","LEdgePoint","__isLEdgePoint","DVertex","__isDVertex","LVertex","__isLVertex","DGraphVertex","__isDGraph","__isDGraphVertex","LGraphVertex","__isLGraph","__isLGraphVertex","DVoidEdge","start","__isDVoidEdge","LVoidEdge","__isLVoidEdge","DEdge","__isDEdge","LEdge","__isLEdge","DExtEdge","__isDExtEdge","LExtEdge","__isLExtEdge","DRefEdge","__isDRefEdge","LRefEdge","__isLRefEdge","pendingActions","hasBegun","deepnessLevel","actionstoPrepend","FINAL_END","hasFired","consoleTargetSelector","src","stack","forceRelaunch","storee","parse1","fullpath","accessModifier","amount","notfire","act","CombineHistoryAction","launch","TextAreaConnected","label","jsxLabel","css","tooltip","spellCheck","readOnly","readonly","onChange","evt","TextArea","SelectConnected","primitives","returns","notify","toast","onClick","dismiss","hasReturn","hasPrimitive","hasClasses","hasEnumerators","primitive","enumerator","options","Select","ImageConnected","link","Image","EdgeConnected","labels","Edge","DataOutputComponent","collapsed","collapseStringsAfterLength","displayDataTypes","displayObjectSize","enableClipboard","groupArraysAfterLength","indentWidth","iconStyle","rootName","quotesOnKeys","shouldCollapse","sortKeys","theme","LoggerComponent","changeSearchTag","setState","searchTag","changeRegexpTag","searchTagAsRegExp","changeMinDate","minDate","changeMaxDate","maxDate","category","fullconcat","categoriesActive","messages","max_id","DDate","addYear","filters","tag","datafilter","loggers","registerLogger","cat","allCategories","activeCategories","isCatActive","allTags","arrayUnique","entries","parameter","MyInputComponent","childrenAlignment","Overlap","autosizex","cc","autosizey","defaultProps","ColorSchemeComponent","userColorSchemeCss","userMadeColorScheme","ColorScheme","GraphConnected","Graph","superclassGraphElementComponent","RootVertex","render","StateProps","lastSelected","VertexConnected","DGraphElementClass","isVertex","isGraph","superret","removeEmptyObjectKeys","Vertex","GraphVertex","Field","GraphVertexComponent","FieldComponent","skiparenderforloading","bugged","componentMap","components","dmodelMap","serializableProps","componentfunction","forceNodeType","DefaultNodeConnected","DefaultNode","GraphsContainerComponent","GraphsContainerConnected","mid","GraphsContainer","crypto","edgeSettings","showAnchor","sourceNode","targetNode","useStateIfMounted","middleAnchor","setMiddleAnchor","firstOptions","showHead","lastOptions","showTail","tailSize","tailShape","svgElem","rotate","fill","stroke","offsetForward","headSize","headColor","headShape","useEffectOnce","randomBytes","useEffect","middleware","cursor","drag","event","preventDefault","stopPropagation","onContextMenu","borderColor","EdgesConnected","lReference","lTarget","Edges","RootVertexComponent","rootProps","extendError","canBeExtend","canExtend","initialclasses","stateClasses","setClasses","currentClonedCounter","viewClonedCounter","setViewClonedCounter","viewIsChanged","select","forUser","clientX","clientY","onEnter","onLeave","htmlRef","useRef","onDragStart","stop","onDragEnd","onResizeStart","resize","onResizeEnd","viewStyle","onMouseEnter","onMouseLeave","RootVertexConnected","InputConnected","inputClassName","autosize","input","asLabel","Input","backdrop","showCloseButton","showConfirmButton","typeclassifier","toJSON","orderedChildren","Map","timestamp","base","patharr","chain","lastObject","lastkey","failedRemainingPath","lastval","kv","vals","searchText","replacement","objarr","endi","fname","starti","parcounter","parameterStr","returnstarti","returnendi","bodystarti","regexp","exec","defaultVal","typedesc","codeStr","scope","_ret","_eval","prefixDeclarations","postfixDeclarations","isStrict","Function","js","funcName","time","results","timeEnd","elseReturn","useEval","script","eDev","domelem","stopNode","includeSelf","containerTag","cost","levenshtein","names","lowest","Infinity","previous","distance","recursive","logger","namestr","suggestions","getClosestPropertyNames","file","callback","reader","FileReader","onload","result","readAsText","extensions","readContent","myFileReader","show","htmlNode","highestTimeoutId","clearTimeout","sliceCalls","stacksToSkip","caller","getCaller","gotcalledby","srcElement","prop","isContentEditable","attr","modifyFirst","iterables","iterable","item","arr1","arr2","arrtarget","arrays","arri","ArrayAdd","throwIfContained","param","s1","s2","suffix","suf","otherArrs","ignoreNonNumbers","allowDecimal","numberEnd","parseFloat","num","allowLastNonNumberChars","increaseWhile","regexpstr","matches","RegExp","objA","objB","keya","chainoutoutrecursive","currentRecursion","maxRecursion","cache","__allprototypes","getAllPrototypes","subconstructor","superconstructor","returnIfNull","returnIfUndefined","retIfArray","ifNotBoolean","allowNull","allowUndefined","starting","final","arraySubtract","old","neww","newwobj","oldobj","objdiff","changed","subold","subnew","removedprefix","pathseparator","pre","flattenObjectToRoot","maxkeylength","maxsubpaths","maxvallength","toolongreplacer","quotestrings","valueseparator","filterrow","rowpaths","flatten","halfpath","halfval","halfsubpaths","bestpathsize","best","filterbest","row","pathlength","fullstr","fullvalue","toFileName","htmla","blob","Blob","endings","blobUrl","URL","createObjectURL","href","download","appendChild","click","revokeObjectURL","formatted","lines","indent","lastType","transitions","ln","single","Boolean","closing","opening","fromTo","padding","replacer","space","tmpindex","allowDecimalDot","allowDecimalComma","valueifmismatch","commamode","floatregex","intregex","idPrefix","getID","idgenerator","inplace","setDate","getDate","setMonth","getMonth","setFullYear","getFullYear","fileTypes","onchange","readcontent","contentObj","fileLetti","files","fileReadContent","content","contentArr","setinfos","setAttribute","on","trigger","reset","inPlace","FocusHistoryEntry","SelectorOutput","jqselector","attrselector","attrRegex","resultSetAttr","resultSetElem","Keystrokes","ParseNumberOrBooleanOptions","nullValue","undefinedValue","allowedNan","nanValue","allowBooleans","trueValue","falseValue","triggerAt","loggerMapping","originalFunc","restArgs","lastError","firstParam","restAgs","FileReadTypeEnum","image","audio","video","AndManyOthersButThereAreTooMuch","OrJustPutFileExtension","bindVertexSizeToView","scalezoomx","scalezoomy","storeTemporaryPositions","bendingMode","LViewElement","subViewsPointers","set_generic_entry","DViewTransientProperties","_isDViewTransientProperties","LViewTransientProperties","_isLViewTransientProperties","Value","stepSize","maxLength","filteredvalues","getValues","changeDValue","inputvalue","select_options","isattr","isenum","isref","isshapeless","containerObjectsID","lm","validObjects","getObjects","freeObjects","boundObjects","getAllEnumerators","shapelessObjects","classmap","free","bound","cname","valueslist","step","placeholder","disabled","Structure","lModelElement","lModel","BaseEditor","lDataType","lEnum","DataTypeEditor","lTypedElement","lStructuralFeature","lAttribute","TypedElementEditor","StructuralFeatureEditor","lEnumLiteral","conform","forceConform","mm","getLastSelectedModel","debugmm","debugm","ModelEditor","PackageEditor","ClassEditor","AttributeEditor","ReferenceEditor","EnumEditor","EnumLiteralEditor","OperationEditor","ObjectEditor","ValueEditor","StructureEditorComponent","Editor","StructureEditorConnected","selectedid","StructureEditor","Child","TreeEditorConnected","TreeEditor","ViewsData","dView","option","OclEditorConnected","viewid","defaultLanguage","OclEditor","JsxEditorConnected","jsx","setJsx","marginTop","tabIndex","onBlur","JsxEditor","classesOptions","ViewData","ViewsEditorConnected","View","Views","ViewsEditor","StyleEditorConnected","StyleEditor","EdgeEditorConnected","edgesDisplayed","changeOptions","changeDisplayed","EdgeEditor","ViewpointsEditorConnected","dViewPoint","backgroundColor","editName","ViewpointsEditor","ansiConvert","ansiconvert","hiddenkeys","fixproxy","addLKeys","buildFunctionDocumentation","Lsingleton","comments","shortcuts","entryvalue","ConsoleComponent","change","expression","outstr","ashtml","util","tmpp","contextkeys","format","toHtml","commentKey","commentVal","objraw","whiteSpace","dangerouslySetInnerHTML","__html","ConsoleConnected","Console","ToolBarItem","items","reactNodes","addChild","ToolBarConnected","metamodelId","myDictValidator","addChildren","getItems","addObject","ToolBar","PendingEdgeConnected","mousePosition","setMousePosition","updateMousePosition","ev","addEventListener","removeEventListener","PendingEdge","ContextMenuConnected","mePointer","nodePointer","jsxList","close","addView","ContextMenu","ReferenceEdgeConnected","sourceID","targetID","ReferenceEdge","ExtendEdgeConnected","ExtendEdge","ValueEdgeConnected","ValueEdge","EdgesManagerConnected","_references","reference","_values","instanceOf","valuePointers","referenceEdge","extendEdge","valueEdge","EdgesManager","MetamodelTabConnected","marginLeft","margin","MetamodelTab","ModelTabConnected","metamodelid","ModelTab","InfoTabConnected","metamodels","InfoTab","API","axios","post","username","password","mail","then","response","catch","PersistanceTabConnected","PersistanceTab","TabDataMaker","group","closable","DockLayoutComponent","dock","dockPanel","dockContext","groups","floatable","maximizable","panelExtra","panelData","open","addMetamodel","addModel","persistance","structureEditor","treeEditor","viewsEditor","styleEditor","edgeEditor","viewpointEditor","moveOnStructure","moveOnViews","Promise","dockMove","tabs","newProps","newContext","oldProps","deltaM2","addedM2","removedM2","OPEN","CLOSE","deltaM1","addedM1","removedM1","prevProps","prevState","snapshot","getAllMetamodels","getAllModels","preConfirm","getElementById","isConfirmed","newName","mmid","modelNames","layout","dockbox","mode","infoTab","dockRef","defaultLayout","DockLayoutConnected","Dock","SaveManager","tmpsave","setItem","fullstatestr","toXML","toFile","lmodel","getActiveModel","exportEcore","formatXml","ism2","fromXML","fromfile","importEcore_click0","filestring","jsonstring","jsonobj","fileRead","fileContents","todoc","DOMParser","parseFromString","doctojson","doc","xmlDoc","importEcore","loopobj","jsonstr","loadOnModel","fromFile","groupingsize","Line","Bezier_quadratic","Bezier_cubic","Bezier_quadratic_mirrored","Bezier_cubic_mirrored","Elliptical_arc","EdgeComponent","svgletter","coords","mn","scoord","ecoord","TopBarConnected","save","load","exportEcore_click","importEcore_click","TopBar","App","splash","setSplash","SplashImage","wrapperStyle","justifyContent","wrapperClass","secondaryColor","ReactDOM"],"mappings":"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","file":"static/js/main.673aaadb.chunk.js","sourcesContent":["/*\tThis work is licensed under Creative Commons GNU LGPL License.\r\n\r\n\tLicense: http://creativecommons.org/licenses/LGPL/2.1/\r\n   Version: 0.9\r\n\tAuthor:  Stefan Goessner/2006\r\n\tWeb:     http://goessner.net/ \r\n*/\r\nexport function json2xml(o, tab/*string, string*/) {\r\n   var toXml = function(v, name, ind) {\r\n      var xml = \"\";\r\n      if (v instanceof Array) {\r\n         for (var i=0, n=v.length; i<n; i++)\r\n            xml += ind + toXml(v[i], name, ind+\"\\t\") + \"\\n\";\r\n      }\r\n      else if (typeof(v) == \"object\") {\r\n         var hasChild = false;\r\n         xml += ind + \"<\" + name;\r\n         for (var m in v) {\r\n            if (m.charAt(0) == \"@\")\r\n               xml += \" \" + m.substr(1) + \"=\\\"\" + v[m].toString() + \"\\\"\";\r\n            else\r\n               hasChild = true;\r\n         }\r\n         xml += hasChild ? \">\" : \"/>\";\r\n         if (hasChild) {\r\n            for (var m in v) {\r\n               if (m == \"#text\")\r\n                  xml += v[m];\r\n               else if (m == \"#cdata\")\r\n                  xml += \"<![CDATA[\" + v[m] + \"]]>\";\r\n               else if (m.charAt(0) != \"@\")\r\n                  xml += toXml(v[m], m, ind+\"\\t\");\r\n            }\r\n            xml += (xml.charAt(xml.length-1)==\"\\n\"?ind:\"\") + \"</\" + name + \">\";\r\n         }\r\n      }\r\n      else {\r\n         xml += ind + \"<\" + name + \">\" + v.toString() +  \"</\" + name + \">\";\r\n      }\r\n      return xml;\r\n   }, xml=\"\";\r\n   for (var m in o)\r\n      xml += toXml(o[m], m, \"\");\r\n   return tab ? xml.replace(/\\t/g, tab) : xml.replace(/\\t|\\n/g, \"\");\r\n}\r\n","/*\tThis work is licensed under Creative Commons GNU LGPL License.\r\n\r\n\tLicense: http://creativecommons.org/licenses/LGPL/2.1/\r\n   Version: 0.9\r\n\tAuthor:  Stefan Goessner/2006\r\n\tWeb:     http://goessner.net/\r\n*/\r\nvar X = {\r\n   toObj: function(xml) {\r\n      var o = {};\r\n      if (xml.nodeType==1) {   // element node ..\r\n         if (xml.attributes.length)   // element with attributes  ..\r\n            for (var i=0; i<xml.attributes.length; i++)\r\n               o[\"@\"+xml.attributes[i].nodeName] = (xml.attributes[i].nodeValue||\"\").toString(); // dam: qua parsa attribs\r\n         if (xml.firstChild) { // element has child nodes ..\r\n            var textChild=0, cdataChild=0, hasElementChild=false;\r\n            for (var n=xml.firstChild; n; n=n.nextSibling) {\r\n               if (n.nodeType==1) hasElementChild = true;\r\n               else if (n.nodeType==3 && n.nodeValue.match(/[^ \\f\\n\\r\\t\\v]/)) textChild++; // non-whitespace text\r\n               else if (n.nodeType==4) cdataChild++; // cdata section node\r\n            }\r\n            if (hasElementChild) {\r\n               if (textChild < 2 && cdataChild < 2) { // structured element with evtl. a single text or/and cdata node ..\r\n                  X.removeWhite(xml);\r\n                  for (var n=xml.firstChild; n; n=n.nextSibling) {\r\n                     if (n.nodeType == 3)  // text node\r\n                        o[\"#text\"] = X.escape(n.nodeValue);\r\n                     else if (n.nodeType == 4)  // cdata node\r\n                        o[\"#cdata\"] = X.escape(n.nodeValue);\r\n                     else if (o[n.nodeName]) {  // multiple occurence of element ..\r\n                        if (o[n.nodeName] instanceof Array)\r\n                           o[n.nodeName][o[n.nodeName].length] = X.toObj(n);\r\n                        else\r\n                           o[n.nodeName] = [o[n.nodeName], X.toObj(n)];\r\n                     }\r\n                     else  // first occurence of element..\r\n                        o[n.nodeName] = X.toObj(n); // damiano: qua parsa sottonodi\r\n                  }\r\n               }\r\n               else { // mixed content\r\n                  if (!xml.attributes.length)\r\n                     o = X.escape(X.innerXml(xml));\r\n                  else\r\n                     o[\"#text\"] = X.escape(X.innerXml(xml));\r\n               }\r\n            }\r\n            else if (textChild) { // pure text\r\n               if (!xml.attributes.length)\r\n                  o = X.escape(X.innerXml(xml));\r\n               else\r\n                  o[\"#text\"] = X.escape(X.innerXml(xml));\r\n            }\r\n            else if (cdataChild) { // cdata\r\n               if (cdataChild > 1)\r\n                  o = X.escape(X.innerXml(xml));\r\n               else\r\n                  for (var n=xml.firstChild; n; n=n.nextSibling)\r\n                     o[\"#cdata\"] = X.escape(n.nodeValue);\r\n            }\r\n         }\r\n         if (!xml.attributes.length && !xml.firstChild) o = null;\r\n      }\r\n      else if (xml.nodeType==9) { // document.node\r\n         o = X.toObj(xml.documentElement);\r\n      }\r\n      else alert(\"unhandled node type: \" + xml.nodeType);\r\n      return o;\r\n   },\r\n   toJson: function(o, name, ind) {\r\n      var json = name ? (\"\\\"\"+name+\"\\\"\") : \"\";\r\n      if (o instanceof Array) {\r\n         for (var i=0,n=o.length; i<n; i++)\r\n            o[i] = X.toJson(o[i], \"\", ind+\"\\t\");\r\n         json += (name?\":[\":\"[\") + (o.length > 1 ? (\"\\n\"+ind+\"\\t\"+o.join(\",\\n\"+ind+\"\\t\")+\"\\n\"+ind) : o.join(\"\")) + \"]\";\r\n      }\r\n      else if (o == null)\r\n         json += (name&&\":\") + \"null\";\r\n      else if (typeof(o) == \"object\") {\r\n         var arr = [];\r\n         for (var m in o)\r\n            arr[arr.length] = X.toJson(o[m], m, ind+\"\\t\");\r\n         json += (name?\":{\":\"{\") + (arr.length > 1 ? (\"\\n\"+ind+\"\\t\"+arr.join(\",\\n\"+ind+\"\\t\")+\"\\n\"+ind) : arr.join(\"\")) + \"}\";\r\n      }\r\n      else if (typeof(o) == \"string\")\r\n         json += (name&&\":\") + \"\\\"\" + o.toString() + \"\\\"\";\r\n      else\r\n         json += (name&&\":\") + o.toString();\r\n      return json;\r\n   },\r\n   innerXml: function(node) {\r\n      var s = \"\"\r\n      if (\"innerHTML\" in node)\r\n         s = node.innerHTML;\r\n      else {\r\n         var asXml = function(n) {\r\n            var s = \"\";\r\n            if (n.nodeType == 1) {\r\n               s += \"<\" + n.nodeName;\r\n               for (var i=0; i<n.attributes.length;i++)\r\n                  s += \" \" + n.attributes[i].nodeName + \"=\\\"\" + (n.attributes[i].nodeValue||\"\").toString() + \"\\\"\";\r\n               if (n.firstChild) {\r\n                  s += \">\";\r\n                  for (var c=n.firstChild; c; c=c.nextSibling)\r\n                     s += asXml(c);\r\n                  s += \"</\"+n.nodeName+\">\";\r\n               }\r\n               else\r\n                  s += \"/>\";\r\n            }\r\n            else if (n.nodeType == 3)\r\n               s += n.nodeValue;\r\n            else if (n.nodeType == 4)\r\n               s += \"<![CDATA[\" + n.nodeValue + \"]]>\";\r\n            return s;\r\n         };\r\n         for (var c=node.firstChild; c; c=c.nextSibling)\r\n            s += asXml(c);\r\n      }\r\n      return s;\r\n   },\r\n   escape: function(txt) {\r\n      return txt.replace(/[\\\\]/g, \"\\\\\\\\\")\r\n          .replace(/[\\\"]/g, '\\\\\"')\r\n          .replace(/[\\n]/g, '\\\\n')\r\n          .replace(/[\\r]/g, '\\\\r');\r\n   },\r\n   removeWhite: function(e) {\r\n      e.normalize();\r\n      for (var n = e.firstChild; n; ) {\r\n         if (n.nodeType == 3) {  // text node\r\n            if (!n.nodeValue.match(/[^ \\f\\n\\r\\t\\v]/)) { // pure whitespace text node\r\n               var nxt = n.nextSibling;\r\n               e.removeChild(n);\r\n               n = nxt;\r\n            }\r\n            else\r\n               n = n.nextSibling;\r\n         }\r\n         else if (n.nodeType == 1) {  // element node\r\n            X.removeWhite(n);\r\n            n = n.nextSibling;\r\n         }\r\n         else                      // any other node\r\n            n = n.nextSibling;\r\n      }\r\n      return e;\r\n   }\r\n};\r\nexport function xml2json(xml, tab = '    '/*XML_DOM, string*/) {\r\n   if (xml.nodeType == 9) // document node\r\n      xml = xml.documentElement;\r\n   var json = X.toJson(X.toObj(X.removeWhite(xml)), xml.nodeName, \"\\t\");\r\n   return \"{\\n\" + tab + (tab ? json.replace(/\\t/g, tab) : json.replace(/\\t|\\n/g, \"\")) + \"\\n}\";\r\n}\r\nexport function xml2jsonobj(xml, tab= '    '){\r\n   return X.toObj(X.removeWhite(xml));\r\n}\r\n// damiano: i needX.toObj(X.removeWhite(xml))\r\n","// export type Class = { new(...args: any[]): any; };\r\nimport type {NotAString, Pointer} from \"./classes\";\r\nimport type {DAttribute, DPackage} from \"../model/logicWrapper\";\r\n\r\nexport declare type Class<CtorArgs extends any[] = any[], InstanceType = {}, StaticType = {}, IsAbstract = false> = (abstract new (...args: any[]) => InstanceType) & StaticType;\r\nexport declare type CClass<CtorArgs extends any[] = any[], InstanceType = {}, StaticType = {}, IsAbstract = false> = (new (...args: any[]) => InstanceType) & StaticType;\r\ninterface Caller { caller: any; }\r\ninterface Bind { bind: any; }\r\ninterface Apply { apply: any; }\r\ninterface Call { call: any; }\r\nexport type Function =  Caller | Bind | Apply | Call;\r\nexport type Function2 =  (...a: any) => any;\r\nexport type Constructor<InstanceType = any> = (new (...a: any) => InstanceType) & {__proto__?: Constructor<InstanceType> & GObject};\r\nexport type AbstractConstructor<InstanceType = any> = (GObject | (new (...a: any) => InstanceType)) & {__proto__?: Constructor<InstanceType> & GObject};\r\nexport type Temporary = any;\r\nexport type Nullable<T> = T | null\r\nexport type UnixTimestamp = number;\r\ninterface NoCaller { caller?: never; }\r\ninterface NoBind { bind?: never; }\r\ninterface NoApply { apply?: never; }\r\ninterface NoCall { call?: never; }\r\n\r\n\r\nexport type orArr<T> = T | T[];\r\nexport type unArr<T extends any[] | any> = T extends any[] ? T[0] : T;\r\n\r\ntype primitiveType = string | number | boolean | symbol | null | undefined;\r\nexport type PrimitiveType = string | number | boolean | null;\r\ntype NotAFunction = NoCaller | NoBind | NoApply | NoCall;\r\ntype NotFunction = GObject & NotAFunction | primitiveType\r\n\r\n\r\nexport type Empty = any;\r\nexport type UObject = { [key: string]: unknown; }\r\nexport type GObject<DocSubType = ''> = DocSubType extends object ? { [key: string]: any; } & DocSubType : { [key: string]: any; };\r\nexport type RawObject = { [key: string]: NotFunction; };\r\n// Json<T> = oggetto con le chiavi di T senza le funzioni (post deserializzazione)\r\nexport type Json<T extends GObject = RawObject> =\r\n\r\n        {[key in keyof T]: T[key] extends Function ? never : (T[key] extends symbol ? \"symbol\" :\r\n            Exclude<T[key], symbol>); }\r\n        ;\r\n\r\n// export type Dictionary<K extends keyof any, T> = { [P in K]: T; };\r\nexport type Dictionary<K extends keyof GObject = any, V = any> = { [P in K]: V; } & { _subMaps?: V};\r\n// _subMaps type *actually just Dict<str, boolean> but if i set it as bool and access a random element of the map it will be typed as boolean | V*/\r\nexport type DocString<T, COMMENT = ''> = string;\r\nexport type NotFound = null;\r\nexport const NotFoundv = null as NotFound;\r\nexport type nstring = null | string;\r\nexport type nnumber = null | number;\r\nexport type nbool = null | boolean;\r\nexport type bool = boolean;\r\nexport type TODO<T = any> = any;\r\nexport type NonEmptyString = Exclude<string, ''>;\r\nexport enum EdgeBendingMode{\r\n    \"Line\"=\"L\", // end\r\n    \"Bezier_quadratic\"=\"Q\", // bending1, end\r\n    \"Bezier_cubic\"=\"C\", // bending1, bending2, end\r\n    \"Bezier_cubic_mirrored\"=\"S\", // bending1, end // when there are multiple bezier curves on a row, this takes a bendingpoint1 from the last bezier curves mirrored https://css-tricks.com/svg-path-syntax-illustrated-guide/\r\n    \"Bezier_quadratic_mirrored\"=\"T\", // end // when there are multiple bezier curves on a row, this takes a bendingpoint1 from the last bezier curves mirrored https://css-tricks.com/svg-path-syntax-illustrated-guide/\r\n    \"Elliptical_arc\" = \"A\",// x y, rot, arc sweep, x y super messy not only coords but degrees and booleans mixed with path coords\r\n}\r\n\r\n// export type Subtract<T, K> = {  [L in Exclude<keyof T, K>]: T[L] };\r\n// Or alternatively, and more concisely, as:\r\n\r\n// export type Subtract<T, K> = Pick<T, Exclude<keyof T, K>>;\r\nexport type Subtract<T, K> = Omit<T, keyof K>;\r\nexport type Overlap<T1, T2> =  Omit<T1, keyof T2> & T2;\r\n\r\n\r\n\r\n\r\n\r\n// tipo puramente documentazionale, è solo una stringa o array di stringhe\r\n/*export type Pointer<T extends DPointerTargetable = DPointerTargetable, lowerbound = number, upperbound = number | string, RET = LPointerTargetable> =\r\n    upperbound extends 'N' ? string[] : (\r\n    upperbound extends 0 ? never : (\r\n    lowerbound extends 0 ? (string | undefined | null) : string)); // & {[Symbol.iterator]: () => IterableIterator<string>};\r\n*/\r\ndeclare global  {\r\n    interface ProxyConstructor {\r\n        new <TS extends object, TT extends object = TS>(target: TS, handler: ProxyHandler<TS>): TT;\r\n        // official flawed definition: new <T extends object>(target: T, handler: ProxyHandler<T>): T;\r\n    }\r\n\r\n}\r\n\r\n\r\n// export type Proxyfied<T extends object> = T | GObject;// | T;\r\n\r\nexport type Proxyfied<T extends object> = UObject & T;\r\nexport const windoww: typeof window & GObject= window;\r\nexport type InOutParam<T> = T;\r\n\r\nexport type IsActually<T> = any; // for some reason typescript complains about circular type references? this is a workaround\r\n\r\ntype KeysnotOfType<T, TT> = { [P in keyof T as (T[P] extends TT ? never : P)]: T[P] };\r\ntype ObjectWithoutStrings<T> = {\r\n    [P in keyof T as (T[P] extends string ? never : (T[P] extends string[] ? never : P))]: T[P] // working on arr, keeps single ptrs\r\n};\r\ntype pureStringsNoPointers<T> = {\r\n    [P in keyof T as ( T[P] extends Pointer ? (Pointer extends T[P] ? P : (never)): never)]: T[P]\r\n};\r\nexport type ObjectWithoutPointers<T> = Omit<ObjectWithoutStrings<T> & pureStringsNoPointers<T>, 'pointedBy' | '_storePath'>\r\n\r\n\r\n\r\ntype refkeys = \"parent\" | \"father\" | \"parent\" | \"classifiers\" | \"children\" | \"classes\" | \"packages\" | \"subpackages\" | \"annotations\" | \"\"\r\n    | \"type\" | \"attributes\" | \"references\" | \"operations\" | \"parameters\" | \"..... much more\"\r\n","import React, {CSSProperties, ReactNode} from \"react\";\r\nimport type {\r\n    DGraph,\r\n    DGraphElement,\r\n    DModelElement,\r\n    DViewElement,\r\n    Json,\r\n    LGraph,\r\n    LGraphElement,\r\n    LModelElement,\r\n    LViewElement,\r\n    Pointer\r\n} from \"../../../joiner\";\r\n\r\nexport class GraphElementStatee {/*\r\n    constructor(preRenderFunc: string | undefined, evalContext: GObject, templatefunc: () => React.ReactNode) {\r\n        this.preRenderFunc = preRenderFunc;\r\n        this.evalContext = evalContext;\r\n        this.template = templatefunc;\r\n    }\r\n    preRenderFunc?: string;\r\n    evalContext: Json;\r\n    template: () => ReactNode;* /\r\n    nodeid: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    constructor(nodeid: Pointer<DGraphElement, 1, 1, LGraphElement>) {\r\n        this.nodeid = nodeid;\r\n    }*/\r\n    // displayPosition?: GraphSize; // used while dragging to prevent flood of redux events\r\n}\r\n\r\nexport class GraphElementReduxStateProps {\r\n    // userexample?: UserState; // todo: make and repace with proxy wrapper \"User\", or make a \"cached\" global variable synchronized with redux state for easier access\r\n    view!: LViewElement;\r\n    views!: LViewElement[]; // all applicable views\r\n    // graphID!: string;\r\n    data!: LModelElement;\r\n    // model?: LModel;\r\n    // [userMappedFromRedux: string]: any; // roba che l'utente ha dichiarato di voler prendere dallo stato e redux gli carica nelle props\r\n    preRenderFunc?: string;\r\n    evalContext!: Json;\r\n    template!: () => ReactNode;\r\n    node!: LGraphElement;\r\n    graph!: LGraph;\r\n}\r\n\r\nexport class GraphElementDispatchProps {\r\n}\r\n\r\nexport class GraphElementOwnProps {\r\n    data?: Pointer<DModelElement, 0, 1, LModelElement>;\r\n    view?:Pointer<DViewElement, 1, 1, LViewElement>; // | LViewElement\r\n    // generic props for every component that this component will need to extend joining user-specified values and component-specific built-in values\r\n    children?: any;\r\n    style?: CSSProperties;\r\n    'class'?: string | string[];\r\n    'className'?: string | string[];\r\n    key?: string;\r\n    parentnodeid?: Pointer<DGraphElement, 1, 1, LGraphElement>; // Injected\r\n    nodeid?: Pointer<DGraphElement, 1, 1, LGraphElement>; // Injected\r\n    graphid?: Pointer<DGraph, 1, 1, LGraph>; // injected\r\n    parentViewId?: Pointer<DViewElement, 1, 1, LViewElement>// injected\r\n}\r\n","import {Mixin} from \"ts-mixer\";\r\nimport type {\r\n    DEdge,\r\n    DEdgePoint,\r\n    DExtEdge,\r\n    DGraph,\r\n    DGraphElement,\r\n    DGraphVertex,\r\n    DRefEdge,\r\n    DVertex,\r\n    DVoidEdge,\r\n    DVoidVertex,\r\n    LEdge,\r\n    LEdgePoint,\r\n    LExtEdge,\r\n    LGraph,\r\n    LGraphElement,\r\n    LGraphVertex,\r\n    LRefEdge,\r\n    LVertex,\r\n    LVoidEdge,\r\n    LVoidVertex,\r\n    WEdge,\r\n    WEdgePoint,\r\n    WExtEdge,\r\n    WGraph,\r\n    WGraphElement,\r\n    WGraphVertex,\r\n    WRefEdge,\r\n    WVertex,\r\n    WVoidEdge,\r\n    WVoidVertex\r\n} from \"../model/dataStructure\";\r\nimport type {Class, Longest} from \"ts-mixer/dist/types/types\";\r\nimport type {\r\n    DAnnotation,\r\n    DAttribute,\r\n    DClass,\r\n    DClassifier,\r\n    DDataType,\r\n    DEnumerator,\r\n    DEnumLiteral,\r\n    DMap,\r\n    DModel,\r\n    DModelElement,\r\n    DNamedElement,\r\n    DObject,\r\n    DOperation,\r\n    DPackage,\r\n    DParameter,\r\n    DReference,\r\n    DStructuralFeature,\r\n    DTypedElement,\r\n    DValue,\r\n    LAnnotation,\r\n    LAttribute,\r\n    LClass,\r\n    LClassifier,\r\n    LDataType,\r\n    LEnumerator,\r\n    LEnumLiteral,\r\n    LMap,\r\n    LModel,\r\n    LModelElement,\r\n    LNamedElement,\r\n    LObject,\r\n    LOperation,\r\n    LPackage,\r\n    LParameter,\r\n    LReference,\r\n    LStructuralFeature,\r\n    LTypedElement,\r\n    LValue,\r\n    WAnnotation,\r\n    WAttribute,\r\n    WClass,\r\n    WClassifier,\r\n    WDataType,\r\n    WEnumerator,\r\n    WEnumLiteral,\r\n    WMap,\r\n    WModel,\r\n    WModelElement,\r\n    WNamedElement,\r\n    WObject,\r\n    WOperation,\r\n    WPackage,\r\n    WParameter,\r\n    WReference,\r\n    WStructuralFeature,\r\n    WTypedElement,\r\n    WValue\r\n} from \"../model/logicWrapper\";\r\n// import type {Pointer} from \"./typeconverter\";\r\nimport type {\r\n    CClass,\r\n    Constructor,\r\n    Dictionary,\r\n    DocString,\r\n    GObject,\r\n    orArr,\r\n    PrimitiveType,\r\n    Proxyfied,\r\n    unArr\r\n} from \"./types\";\r\nimport type {\r\n    DViewElement,\r\n    DViewTransientProperties,\r\n    LViewElement,\r\n    LViewTransientProperties,\r\n    WViewElement,\r\n    WViewTransientProperties\r\n} from \"../view/viewElement/view\";\r\nimport type {LogicContext} from \"./proxy\";\r\nimport type {IStore,} from \"./index\";\r\nimport {\r\n    Action, BEGIN, CreateElementAction,\r\n    DeleteElementAction, END,\r\n    GraphPoint,\r\n    GraphSize,\r\n    IPoint,\r\n    Log,\r\n    ParsedAction, Selectors, SetFieldAction,\r\n    SetRootFieldAction,\r\n    store,\r\n    U,\r\n} from \"./index\";\r\nimport {DViewPoint} from \"../view/viewPoint/viewpoint\";\r\nimport value from \"../components/rightbar/structureEditor/editors/Value\";\r\n\r\nvar windoww = window as any;\r\n// qui dichiarazioni di tipi che non sono importabili con \"import type\", ma che devono essere davvero importate a run-time (eg. per fare un \"extend\", chiamare un costruttore o usare un metodo statico)\r\n\r\n\r\nconsole.warn('ts loading classes');\r\n\r\n\r\n// annotation @RuntimeAccessible\r\n// import {store} from \"../redux/createStore\";\r\n\r\nabstract class AbstractMixedClass {\r\n    // superclass!: Dictionary<DocString<'parent class name', Class>>;\r\n    static logic: typeof LPointerTargetable;\r\n    static structure: typeof DPointerTargetable;\r\n    static singleton: LPointerTargetable;\r\n    // static [key: string]: any;\r\n    static init_constructor(...constructorArguments: any): void{}\r\n}\r\n\r\nexport abstract class RuntimeAccessibleClass extends AbstractMixedClass {\r\n    static extendPrototypes(){\r\n        (Array.prototype as any).joinOriginal = Array.prototype.join;\r\n        (Array.prototype as any).separator = function(...separators: any[]/*: orArr<(PrimitiveType | null | undefined | JSX.Element)[]>*/): (string|JSX.Element)[]{\r\n            if (Array.isArray(separators[0])) separators = separators[0]; // case .join([1,2,3])  --> .join(1, 2, 3)\r\n            console.log(\"joinn\", this, separators, this[0], typeof this[0]);\r\n            if (typeof this[0] !== \"object\") return (this as any).joinOriginal(separators);\r\n            // if JSX\r\n            // it handles empty cells like it handles '', but this is how native .join() handles them too: [emptyx5, \"a\", emptyx1, \"b\"].join(\",\") ->  ,,,,,a,,b\r\n            let ret/*:JSX.Element[]*/ = [];\r\n            for (let i = 0; i < this.length; i++){\r\n                if (i === 0) {ret.push(this[i]); continue;}\r\n                ret.push(...separators);\r\n                ret.push(this[i]);\r\n            }\r\n            return ret;\r\n        }\r\n    }\r\n    static fixStatics() {\r\n        this.extendPrototypes();\r\n        // problem: se lo statico è un valore primitivo ne genera una copia.\r\n        for (let classs of Object.values(RuntimeAccessibleClass.annotatedClasses)) {\r\n            let gclass = classs as GObject;\r\n            console.log('fix statics', {gclass, s: gclass.s});\r\n            for (let statickey in gclass.s) { gclass[statickey] = gclass.s[statickey]; }\r\n        }\r\n    }\r\n    // static allRuntimeClasses: string[] = [];\r\n    static classes: Dictionary<string, typeof RuntimeAccessibleClass> = {};\r\n    static annotatedClasses: Dictionary<string, typeof RuntimeAccessibleClass> = {};\r\n\r\n    static getAllNames(annotated = false): string[] {\r\n        return Object.keys(annotated ? RuntimeAccessibleClass.annotatedClasses : RuntimeAccessibleClass.classes); }\r\n    static getAllClasses(annotated = false): typeof RuntimeAccessibleClass[] {\r\n        return Object.values(annotated ? RuntimeAccessibleClass.annotatedClasses : RuntimeAccessibleClass.classes); }\r\n    static getAllClassesDictionary(annotated = false): Dictionary<string, typeof RuntimeAccessibleClass> {\r\n        return annotated ? RuntimeAccessibleClass.annotatedClasses : RuntimeAccessibleClass.classes; }\r\n\r\n    static wrapAll<D extends RuntimeAccessibleClass, L extends LPointerTargetable = LPointerTargetable, CAN_THROW extends boolean = false,\r\n        RET extends CAN_THROW extends true ? L[] : L[] = CAN_THROW extends true ? L[] : L[] >\r\n    (data: D[] | Pointer<DPointerTargetable, 0, 'N'>, baseObjInLookup?: DPointerTargetable, path: string = '', canThrow: CAN_THROW = false as CAN_THROW, state?: IStore): CAN_THROW extends true ? L[] : L[] {\r\n        if (!Array.isArray(data)) return [];\r\n        return data.map( d => DPointerTargetable.wrap(d, baseObjInLookup, path, canThrow, state)) as L[];\r\n    }\r\n\r\n    static wrap<D extends RuntimeAccessibleClass, L extends LPointerTargetable = LPointerTargetable, CAN_THROW extends boolean = false,\r\n        RET extends CAN_THROW extends true ? L : L | undefined = CAN_THROW extends true ? L : L | undefined>\r\n    (data: D | Pointer | undefined, baseObjInLookup?: DPointerTargetable, path: string = '', canThrow: CAN_THROW = false as CAN_THROW, state?: IStore): CAN_THROW extends true ? L : L | undefined{\r\n        if (!data || (data as any).__isProxy) return data as any;\r\n        if (typeof data === 'string') {\r\n            if (!state) state = windoww.store.getState() as IStore;\r\n            data = state.idlookup[data] as unknown as D;\r\n            if (!data) {\r\n                if (canThrow) return windoww.Log.exx('Cannot wrap:', {data, baseObjInLookup, path});\r\n                else return undefined as RET;\r\n            }\r\n        }\r\n        if (Array.isArray(data)) { console.error('use WrapAll instead for arrays', {data, baseObjInLookup, path, canThrow}); throw new Error(\"use WrapAll instead for arrays\"); }\r\n        if (!data) return data;\r\n        // console.log('ProxyWrapping:', {data, baseObjInLookup, path});\r\n        return new Proxy(data, new windoww.TargetableProxyHandler(data, baseObjInLookup, path)) as L;\r\n    }\r\n    /*\r\n        static mapWrap2<D extends DPointerTargetable, L extends LPointerTargetable>(map: RuntimeAccessibleClass, container: D, baseObjInLookup?: DPointerTargetable, path: string = ''): L{\r\n            if (!map || (map as any).__isProxy) return map as any;\r\n            if (typeof container === 'string') {\r\n                container = store.getState().idlookup[container] as unknown as D;\r\n                if (!container) { return Log.exx('Cannot wrap map:', {map, container, baseObjInLookup, path}); }\r\n            }\r\n            // console.log('ProxyWrapping:', {data, baseObjInLookup, path});\r\n            return new Proxy(map, new MapProxyHandler(map, baseObjInLookup, path));\r\n        }\r\n\r\n    */\r\n\r\n    static mapWrap(data: Dictionary, baseObjInLookup: DPointerTargetable, path: string, subMapKeys: string[] = []): Proxyfied<Dictionary> {\r\n        if (!data || (data as any).__isProxy) return data as any;\r\n        // console.error('GETMAP', {data, logicContext, path});\r\n        return new Proxy(data, new windoww.MapProxyHandler(data, baseObjInLookup, path));\r\n    }\r\n\r\n    className!: string;\r\n    protected constructor(...a:any) {\r\n        super();\r\n        // RuntimeAccessibleClass.init_constructor(this, ...a);\r\n        // this.className = this.constructor.name;\r\n        // nb: per i mixin questo settaggio viene sovrascritto. perchè il mixin crea le 2 classi ereditate separatamente con i loro costruttori e le incrocia. quindi devo settarlo dall'annotazione @ tramite prototype\r\n        // RuntimeAccessibleClass.allRuntimeClasses.push(this.className);\r\n    }\r\n\r\n    static init_constructor(thiss: any, ...args: any): void {\r\n\r\n        // this.className = this.constructor.name;\r\n        // let finalObject = this;\r\n        // if (finalObject.constructor.name === \"DVoidVertex\" || finalObject.constructor.name === \"DGraphElement\") { let breakp = true; }\r\n        // this.init0(...arguments);\r\n        // thiss.className = this.name;\r\n    }\r\n\r\n    public static get<T extends typeof RuntimeAccessibleClass = typeof RuntimeAccessibleClass>(dclassname: string, annotated = false)\r\n        : T & {logic?: typeof LPointerTargetable} { return (annotated ? RuntimeAccessibleClass.annotatedClasses : this.classes)[dclassname] as any; }\r\n\r\n    public static extends(className: string, superClassName: string, returnIfEqual: boolean = true): boolean {\r\n        let superclass = RuntimeAccessibleClass.get(superClassName);\r\n        const thisclass = RuntimeAccessibleClass.get(className);\r\n        if (superclass === thisclass) return returnIfEqual;\r\n        if (!superclass || !thisclass) return false;\r\n        return (thisclass instanceof superclass); // todo: check if works with constructors\r\n    }\r\n\r\n    getAllPrototypeSuperClasses(): GObject[] {\r\n        let currentlevel = this;\r\n        let ret: GObject[] = [];\r\n        while (true) {\r\n            if (!currentlevel) break;\r\n            ret.push(currentlevel);\r\n            // @ts-ignore\r\n            currentlevel = currentlevel.__proto__;\r\n        }\r\n        console.log('constructor chain:', ret);\r\n        return ret;\r\n    }\r\n    /*initBase(){\r\n        let superclasses = this.getAllPrototypeSuperClasses();\r\n        for (let sc of superclasses) {\r\n            if (!sc.hasOwnProperty('init0')) continue;\r\n            console.log('initbase calling ', {thiss: this, sc, init0: sc.init0, args:sc.constructorArguments});\r\n            sc.init0.apply(this, ...(sc.constructorArguments || []));\r\n        }\r\n    }*/\r\n    // protected abstract init(...constructorParameters: any): void;\r\n    // NB: per colpa della limitazione #3 di ts-mixer,\r\n    // DEVO chiamare init su ogni oggetto per settargli il corretto this.className, altrimenti prende quello dell'ultima superclasse\r\n    /*protected init0(...constructorParameters: any): void {\r\n        let a = this;\r\n        let finalObject = this;\r\n        console.log('creation of___ ', {thiss: this, finalObject});\r\n        if (finalObject.constructor.name === \"DVoidVertex\" || finalObject.constructor.name === \"DGraphElement\") {\r\n            let breakp = true; }\r\n\r\n        (window as any)[finalObject.constructor.name] =\r\n            RuntimeAccessibleClass.classes[finalObject.constructor.name] = finalObject.constructor as any;\r\n        // @ts-ignore\r\n        // delete this.className;\r\n        this.className = (finalObject as any).__proto__.className;\r\n    }*/\r\n\r\n}\r\nexport function Obsolete<T extends any>( constructor: T & GObject): T { return constructor; }\r\nexport function Leaf<T extends any>( constructor: T & GObject): T { return constructor; }\r\nexport function Node<T extends any>( constructor: T & GObject): T { return constructor; }\r\nexport function Abstract<T extends any>( constructor: T & GObject): T { return constructor; }\r\nexport function Instantiable<T extends any>(constructor: T & GObject, instanceConstructor?: Constructor): T { return constructor; } // for m2 cklasses that have m1 instances\r\nexport function RuntimeAccessible<T extends any>(constructor: T & GObject): T {\r\n    // console.log('DecoratorTest', {constructor, arguments});\r\n    // @ts-ignore\r\n    RuntimeAccessibleClass.classes[constructor.name] = constructor as any as typeof RuntimeAccessibleClass;\r\n    if (!window[constructor.name]) (window[constructor.name] as any) = constructor;\r\n    constructor.prototype.className = constructor.name;\r\n    //constructor.prototype.$$typeof = constructor.name;\r\n    //constructor.prototype.typeName = constructor.name;\r\n    (constructor as any).staticClassName = constructor.name;\r\n    // @ts-ignore\r\n    console.log('runtimeaccessible annotation:', {thiss:this, constructor});\r\n//    const classnameFixedConstructor = constructor; //  function (...args) { let obj = new constructor(...args); obj.init?.(); obj.init0?.(); return obj; }\r\n\r\n    // @ts-ignore\r\n    let outerthis = this;\r\n    // @ts-ignore\r\n    const classnameFixedConstructorDoNotRenameWithoutSearchStrings = function (...args) {\r\n        // @ts-ignore\r\n        console.log('runtimeaccessible annotation inner:', {thiss:this, outerthis, constructor});\r\n        // @ts-ignore\r\n        let obj = new constructor(...args);\r\n        obj.classNameFromAnnotation = constructor.name;\r\n        obj.className = constructor.name;\r\n        //obj.prototype.$$typeof = constructor.name;\r\n        // obj.prototype.typeName = constructor.name;\r\n        // obj.init?.();\r\n        // obj.init0?.();\r\n        obj.initBase?.();\r\n        // @ts-ignore\r\n        console.log('runtimeaccessible annotation inner end:', {thiss:this, outerthis, constructor, obj});\r\n        return obj; }\r\n    RuntimeAccessibleClass.annotatedClasses[constructor.name] = classnameFixedConstructorDoNotRenameWithoutSearchStrings as any as typeof RuntimeAccessibleClass;\r\n\r\n    for (let key in constructor) (classnameFixedConstructorDoNotRenameWithoutSearchStrings as GObject)[key] = constructor[key];\r\n    // constructor.constructor = classnameFixedConstructorDoNotRenameWithoutSearchStrings; return constructor;\r\n\r\n    // @ts-ignore\r\n    // for (let staticKey of constructor as GObject) { classnameFixedConstructorDoNotRenameWithoutSearchStrings[staticKey] = constructor[staticKey]; }\r\n    classnameFixedConstructorDoNotRenameWithoutSearchStrings.prototype = constructor.prototype;\r\n    classnameFixedConstructorDoNotRenameWithoutSearchStrings.prototype.constructor = constructor.prototype.constructor;\r\n\r\n    // required for inheriting static methods\r\n    classnameFixedConstructorDoNotRenameWithoutSearchStrings.__proto__ = constructor.__proto__;\r\n    classnameFixedConstructorDoNotRenameWithoutSearchStrings.s = constructor;\r\n    // return classnameFixedConstructorDoNotRenameWithoutSearchStrings as any;\r\n    return constructor;\r\n}\r\n\r\n\r\n(window as any).RuntimeAccessibleClass = RuntimeAccessibleClass;\r\n// todo: problema: per creare un PointerTargetable ho bisogno dell'userid, e devo generarlo prima che venga generato l'initialState... dovrebbe venir servito con la pagina dal server. o passato come navigation props dalla pagina di login\r\n\r\n\r\n\r\nexport type DtoL<DX extends GObject, LX = DX extends DEnumerator ? LEnumerator : (DX extends DAttribute ? LAttribute : (DX extends DReference ? LReference : (DX extends DRefEdge ? LRefEdge : (DX extends DExtEdge ? LExtEdge : (DX extends DDataType ? LDataType : (DX extends DClass ? LClass : (DX extends DStructuralFeature ? LStructuralFeature : (DX extends DParameter ? LParameter : (DX extends DOperation ? LOperation : (DX extends DEdge ? LEdge : (DX extends DEdgePoint ? LEdgePoint : (DX extends DGraphVertex ? LGraphVertex : (DX extends DModel ? LModel : (DX extends DValue ? LValue : (DX extends DObject ? LObject : (DX extends DEnumLiteral ? LEnumLiteral : (DX extends DPackage ? LPackage : (DX extends DClassifier ? LClassifier : (DX extends DTypedElement ? LTypedElement : (DX extends DVertex ? LVertex : (DX extends DVoidEdge ? LVoidEdge : (DX extends DVoidVertex ? LVoidVertex : (DX extends DGraph ? LGraph : (DX extends DNamedElement ? LNamedElement : (DX extends DAnnotation ? LAnnotation : (DX extends DGraphElement ? LGraphElement : (DX extends DMap ? LMap : (DX extends DModelElement ? LModelElement : (DX extends DUser ? LUser : (DX extends DPointerTargetable ? LPointerTargetable : (ERROR)))))))))))))))))))))))))))))))> = LX;\r\nexport type DtoW<DX extends GObject, WX = DX extends DEnumerator ? WEnumerator : (DX extends DAttribute ? WAttribute : (DX extends DReference ? WReference : (DX extends DRefEdge ? WRefEdge : (DX extends DExtEdge ? WExtEdge : (DX extends DDataType ? WDataType : (DX extends DClass ? WClass : (DX extends DStructuralFeature ? WStructuralFeature : (DX extends DParameter ? WParameter : (DX extends DOperation ? WOperation : (DX extends DEdge ? WEdge : (DX extends DEdgePoint ? WEdgePoint : (DX extends DGraphVertex ? WGraphVertex : (DX extends DModel ? WModel : (DX extends DValue ? WValue : (DX extends DObject ? WObject : (DX extends DEnumLiteral ? WEnumLiteral : (DX extends DPackage ? WPackage : (DX extends DClassifier ? WClassifier : (DX extends DTypedElement ? WTypedElement : (DX extends DVertex ? WVertex : (DX extends DVoidEdge ? WVoidEdge : (DX extends DVoidVertex ? WVoidVertex : (DX extends DGraph ? WGraph : (DX extends DNamedElement ? WNamedElement : (DX extends DAnnotation ? WAnnotation : (DX extends DGraphElement ? WGraphElement : (DX extends DMap ? WMap : (DX extends DModelElement ? WModelElement : (DX extends DUser ? WUser : (DX extends DPointerTargetable ? WPointerTargetable : (ERROR)))))))))))))))))))))))))))))))> = WX;\r\n// export type DtoW<DX extends GObject, WX = Omit<DtoW0<DX>, 'id'>> = WX;\r\nexport type LtoD<LX extends LPointerTargetable, DX = LX extends LEnumerator ? DEnumerator : (LX extends LAttribute ? DAttribute : (LX extends LReference ? DReference : (LX extends LRefEdge ? DRefEdge : (LX extends LExtEdge ? DExtEdge : (LX extends LDataType ? DDataType : (LX extends LClass ? DClass : (LX extends LStructuralFeature ? DStructuralFeature : (LX extends LParameter ? DParameter : (LX extends LOperation ? DOperation : (LX extends LEdge ? DEdge : (LX extends LEdgePoint ? DEdgePoint : (LX extends LGraphVertex ? DGraphVertex : (LX extends LModel ? DModel : (LX extends LValue ? DValue : (LX extends LObject ? DObject : (LX extends LEnumLiteral ? DEnumLiteral : (LX extends LPackage ? DPackage : (LX extends LClassifier ? DClassifier : (LX extends LTypedElement ? DTypedElement : (LX extends LVertex ? DVertex : (LX extends LVoidEdge ? DVoidEdge : (LX extends LVoidVertex ? DVoidVertex : (LX extends LGraph ? DGraph : (LX extends LNamedElement ? DNamedElement : (LX extends LAnnotation ? DAnnotation : (LX extends LGraphElement ? DGraphElement : (LX extends LMap ? DMap : (LX extends LModelElement ? DModelElement : (LX extends LUser ? DUser : (LX extends LPointerTargetable ? DPointerTargetable : (ERROR)))))))))))))))))))))))))))))))> = DX;\r\nexport type LtoW<LX extends LPointerTargetable, WX = LX extends LEnumerator ? WEnumerator : (LX extends LAttribute ? WAttribute : (LX extends LReference ? WReference : (LX extends LRefEdge ? WRefEdge : (LX extends LExtEdge ? WExtEdge : (LX extends LDataType ? WDataType : (LX extends LClass ? WClass : (LX extends LStructuralFeature ? WStructuralFeature : (LX extends LParameter ? WParameter : (LX extends LOperation ? WOperation : (LX extends LEdge ? WEdge : (LX extends LEdgePoint ? WEdgePoint : (LX extends LGraphVertex ? WGraphVertex : (LX extends LModel ? WModel : (LX extends LValue ? WValue : (LX extends LObject ? WObject : (LX extends LEnumLiteral ? WEnumLiteral : (LX extends LPackage ? WPackage : (LX extends LClassifier ? WClassifier : (LX extends LTypedElement ? WTypedElement : (LX extends LVertex ? WVertex : (LX extends LVoidEdge ? WVoidEdge : (LX extends LVoidVertex ? WVoidVertex : (LX extends LGraph ? WGraph : (LX extends LNamedElement ? WNamedElement : (LX extends LAnnotation ? WAnnotation : (LX extends LGraphElement ? WGraphElement : (LX extends LMap ? WMap : (LX extends LModelElement ? WModelElement : (LX extends LUser ? WUser : (LX extends LPointerTargetable ? WPointerTargetable : (ERROR)))))))))))))))))))))))))))))))> = WX;\r\nexport type WtoD<IN extends WPointerTargetable, OUT = IN extends WEnumerator ? DEnumerator : (IN extends WAttribute ? DAttribute : (IN extends WReference ? DReference : (IN extends WRefEdge ? DRefEdge : (IN extends WExtEdge ? DExtEdge : (IN extends WDataType ? DDataType : (IN extends WClass ? DClass : (IN extends WStructuralFeature ? DStructuralFeature : (IN extends WParameter ? DParameter : (IN extends WOperation ? DOperation : (IN extends WEdge ? DEdge : (IN extends WEdgePoint ? DEdgePoint : (IN extends WGraphVertex ? DGraphVertex : (IN extends WModel ? DModel : (IN extends WValue ? DValue : (IN extends WObject ? DObject : (IN extends WEnumLiteral ? DEnumLiteral : (IN extends WPackage ? DPackage : (IN extends WClassifier ? DClassifier : (IN extends WTypedElement ? DTypedElement : (IN extends WVertex ? DVertex : (IN extends WVoidEdge ? DVoidEdge : (IN extends WVoidVertex ? DVoidVertex : (IN extends WGraph ? DGraph : (IN extends WNamedElement ? DNamedElement : (IN extends WAnnotation ? DAnnotation : (IN extends WGraphElement ? DGraphElement : (IN extends WMap ? DMap : (IN extends WModelElement ? DModelElement : (IN extends WUser ? DUser : (IN extends WPointerTargetable ? DPointerTargetable : (IN extends WViewElement ? DViewElement : (IN extends WViewTransientProperties ? DViewTransientProperties : (ERROR)))))))))))))))))))))))))))))))))> = OUT;\r\nexport type WtoL<IN extends WPointerTargetable, OUT = IN extends WEnumerator ? LEnumerator : (IN extends WAttribute ? LAttribute : (IN extends WReference ? LReference : (IN extends WRefEdge ? LRefEdge : (IN extends WExtEdge ? LExtEdge : (IN extends WDataType ? LDataType : (IN extends WClass ? LClass : (IN extends WStructuralFeature ? LStructuralFeature : (IN extends WParameter ? LParameter : (IN extends WOperation ? LOperation : (IN extends WEdge ? LEdge : (IN extends WEdgePoint ? LEdgePoint : (IN extends WGraphVertex ? LGraphVertex : (IN extends WModel ? LModel : (IN extends WValue ? LValue : (IN extends WObject ? LObject : (IN extends WEnumLiteral ? LEnumLiteral : (IN extends WPackage ? LPackage : (IN extends WClassifier ? LClassifier : (IN extends WTypedElement ? LTypedElement : (IN extends WVertex ? LVertex : (IN extends WVoidEdge ? LVoidEdge : (IN extends WVoidVertex ? LVoidVertex : (IN extends WGraph ? LGraph : (IN extends WNamedElement ? LNamedElement : (IN extends WAnnotation ? LAnnotation : (IN extends WGraphElement ? LGraphElement : (IN extends WMap ? LMap : (IN extends WModelElement ? LModelElement : (IN extends WUser ? LUser : (IN extends WPointerTargetable ? LPointerTargetable : (IN extends WViewElement ? LViewElement : (IN extends WViewTransientProperties ? LViewTransientProperties : (ERROR)))))))))))))))))))))))))))))))))> = OUT;\r\n\r\nlet canFireActions: boolean = true;\r\n@RuntimeAccessible\r\nexport class Constructors<T extends DPointerTargetable>{\r\n    private thiss: T;\r\n    private persist: boolean;\r\n    private callbacks: Function[];\r\n    fatherType?: Constructor;\r\n    constructor(t:T, father?: Pointer, persist: boolean = true, fatherType?: Constructor) {\r\n        persist = persist && canFireActions;\r\n        this.thiss = t;\r\n        this.persist = persist;\r\n        this.callbacks = [];\r\n        if (this.thiss.hasOwnProperty(\"father\")) {\r\n            (this.thiss as any).father = father;\r\n            persist && father && SetFieldAction.new(father, \"pointedBy\", PointedBy.fromID(t.id, \"father\" as any), '+=');\r\n        }\r\n        this.fatherType = fatherType;\r\n        if (this.persist) BEGIN()\r\n    }\r\n\r\n    static pause(): void { canFireActions = false; }\r\n    static resume(): void { canFireActions = true; }\r\n    // start(thiss: any): this { this.thiss = thiss; return this; }\r\n    end(simpledatacallback?: (d:T) => void): T {\r\n        if (simpledatacallback) simpledatacallback(this.thiss); // callback for setting primitive types, not pointers not context-dependant values (name being potentially invalid / chosen according to parent)\r\n        if (!this.persist) return this.thiss;\r\n        setTimeout( () => { for (let cb of this.callbacks) cb(); }, 0);\r\n        END([CreateElementAction.new(this.thiss, true)]);\r\n        return this.thiss;\r\n    }\r\n    DModelElement(): this { return this; }\r\n    DClassifier(): this { return this; }\r\n    DParameter(defaultValue?: any): this {\r\n        let thiss: DParameter = this.thiss as any;\r\n        thiss.defaultValue = defaultValue;\r\n        this.persist && thiss.father && SetFieldAction.new(thiss.father, \"parameters\", thiss.id, '+=', true);\r\n        return this; }\r\n    DStructuralFeature(): this {\r\n        if (this.thiss.className === 'DOperation') return this;\r\n        if (!this.persist) return this;\r\n        let thiss: DAttribute|DReference = this.thiss as any;\r\n        const _DClass: typeof DClass = windoww.DClass;\r\n        const _DValue: typeof DValue = windoww.DValue;\r\n\r\n\r\n        let targets: DClass[] = [_DClass.fromPointer(thiss.father)];\r\n        let alreadyParsed: Dictionary<Pointer, DClass> = {};\r\n        while(targets.length) {\r\n            let nextTargets = [];\r\n            for (let target of targets) {\r\n                if (alreadyParsed[target.id]) continue;\r\n                alreadyParsed[target.id] = target;\r\n                for(let ext of target.extendedBy) nextTargets.push(_DClass.fromPointer(ext));\r\n            }\r\n            targets = nextTargets;\r\n        }\r\n        this.persist && this.callbacks.push(()=>{\r\n            for(let pointer in alreadyParsed) {\r\n                for (let instance of alreadyParsed[pointer].instances) {\r\n                    _DValue.new(thiss.name, thiss.id, undefined, instance);\r\n                }\r\n            }\r\n        });\r\n\r\n\r\n        return this;\r\n    }\r\n    DReference(): this {\r\n        let thiss: DReference = this.thiss as any;\r\n        // update father's collections (pointedby's here are set automatically)\r\n        this.persist && thiss.father && SetFieldAction.new(thiss.father, \"references\", thiss.id, '+=', true);\r\n        return this;\r\n    }\r\n    DAttribute(): this {\r\n        let thiss: DAttribute = this.thiss as any;\r\n        // update father's collections (pointedby's here are set automatically)\r\n        console.log('dattrmake', {persist:this.persist, father:thiss.father, thiss, id:thiss.id});\r\n        this.persist && thiss.father && SetFieldAction.new(thiss.father, \"attributes\", thiss.id, '+=', true);\r\n        return this; }\r\n    DDataType(): this { return this; }\r\n    DObject(instanceoff?: DObject[\"instanceof\"]): this {\r\n        let thiss: DObject = this.thiss as any;\r\n\r\n        if (this.persist && thiss.father) {\r\n            if (this.fatherType!.name === \"DModel\") {\r\n                this.persist && thiss.father && SetFieldAction.new(thiss.father as Pointer<DModel>, \"objects\", thiss.id, '+=', true);\r\n            }\r\n            else {\r\n                // object containing object is not in any direct child collection. access through values\r\n                // this.persist && thiss.father && SetFieldAction.new(thiss.father as Pointer<DObject>, \"subpackages\", thiss.id, '+=', true);\r\n            }\r\n        }\r\n\r\n        if (this.persist && instanceoff) this.callbacks.push( () => {\r\n            (LPointerTargetable.wrap(thiss) as LObject).instanceof = instanceoff as any;\r\n        })\r\n        else thiss.instanceof = instanceoff || null;\r\n         //old ver: this.persist && instanceoff && SetFieldAction.new(thiss.id, \"instanceof\", instanceoff, undefined, true);\r\n        // update father's collections (pointedby's here are set automatically)\r\n        // this.persist && instanceoff && SetFieldAction.new(instanceoff, \"instances\", thiss.id, '+=', true);\r\n\r\n        return this; }\r\n\r\n    DValue(instanceoff?: DValue[\"instanceof\"], val?: DValue[\"values\"], isMirage?: DValue[\"isMirage\"]): this {\r\n        let thiss: DValue = this.thiss as any; thiss.edges = [];\r\n        thiss.values = val || [];\r\n        thiss.instanceof = instanceoff;\r\n        thiss.isMirage = isMirage || false;\r\n\r\n        // update father's collections (pointedby's here are set automatically)\r\n        if (this.persist && instanceoff) {\r\n            SetFieldAction.new(thiss.id, \"instanceof\", instanceoff, undefined, true);\r\n            SetFieldAction.new(instanceoff as Pointer<DAttribute>, \"instances\", thiss.id, '+=', true);\r\n        }\r\n        else thiss.instanceof = instanceoff;\r\n        this.persist && thiss.father && SetFieldAction.new(thiss.father, \"features\", thiss.id, '+=', true);\r\n        return this; }\r\n\r\n    DAnnotation(source?: DAnnotation[\"source\"], details?: DAnnotation[\"details\"]): this {\r\n        const thiss: DAnnotation = this.thiss as any;\r\n        thiss.source = source || '';\r\n        thiss.details = details || [];\r\n        if (this.persist && details) {\r\n            BEGIN()\r\n            for (let det of details) SetFieldAction.new(det, \"pointedBy\", PointedBy.fromID(thiss.id, \"details\"), '+=');\r\n            // update father's collections (pointedby's here are set automatically)\r\n            this.persist && thiss.father && SetFieldAction.new(thiss.father, \"annotations\", thiss.id, '+=', true);\r\n            END()\r\n        }\r\n        return this; }\r\n\r\n    DPointerTargetable(isUser: boolean = false, id?: string): this {\r\n        const thiss: DPointerTargetable = this.thiss as any;\r\n        thiss.id = id || (isUser ? \"USER\" : DUser.current) + \"_\" + (DPointerTargetable.maxID++) + \"_\" + new Date().getTime();\r\n        thiss.className = thiss.constructor.name;\r\n        // this.className = thiss.className;\r\n        if (this.persist) {\r\n            // no pointedBy\r\n        }\r\n        return this; }\r\n\r\n    DUser(id?: DUser[\"id\"]): this {\r\n        const thiss: DPointerTargetable = this.thiss as any;\r\n        thiss.id = id ? id :  'USER_' + (DPointerTargetable.maxID++) + \"_\" + new Date().getTime();\r\n        if (this.persist) {\r\n            // no pointedBy\r\n        }\r\n        return this; }\r\n\r\n    DNamedElement(name?: DNamedElement[\"name\"]): this {\r\n        const thiss: DNamedElement = this.thiss as any;\r\n        thiss.name = (name !== undefined) ? name || '' : thiss.constructor.name.substring(1) + \" 1\";\r\n        if (this.persist) {\r\n            // no pointedBy\r\n        }\r\n        return this; }\r\n\r\n    DTypedElement(type?: DTypedElement[\"type\"]): this {\r\n        const thiss: DTypedElement = this.thiss as any;\r\n        thiss.type = type as Pointer<DClassifier, 1, 1, LClassifier>;\r\n        if (this.persist) {\r\n            type && SetFieldAction.new(type, \"pointedBy\", PointedBy.fromID(thiss.id, \"type\"), '+=');\r\n        }\r\n        return this; }\r\n\r\n    DPackage(uri?: DPackage[\"uri\"], prefix?: DPackage[\"prefix\"]): this {\r\n        const thiss: DPackage = this.thiss as any;\r\n        thiss.uri = uri || '';// || 'org.jodel-react.username';\r\n        thiss.prefix = prefix || '';\r\n        if (this.persist) {\r\n            // no pointedBy\r\n            // update father's collections (pointedby's here are set automatically)\r\n            if (this.persist && thiss.father) {\r\n                if (this.fatherType!.name === \"DModel\") {\r\n                    this.persist && thiss.father && SetFieldAction.new(thiss.father as Pointer<DModel>, \"packages\", thiss.id, '+=', true);\r\n                }\r\n                else {\r\n                    this.persist && thiss.father && SetFieldAction.new(thiss.father as Pointer<DPackage>, \"subpackages\", thiss.id, '+=', true);\r\n                }\r\n            }\r\n        }\r\n        return this; }\r\n\r\n    DModel(instanceoff?: DModel[\"instanceof\"], isMetamodel?: DModel[\"isMetamodel\"]): this {\r\n        const thiss: DModel = this.thiss as any;\r\n        thiss.packages = []; // packages;\r\n        thiss.instanceof = instanceoff || null;\r\n        thiss.isMetamodel = isMetamodel || false;\r\n        if (this.persist) {\r\n            if (instanceoff) SetFieldAction.new(instanceoff, \"pointedBy\", PointedBy.fromID(thiss.id, \"instanceof\"), '+=');\r\n            // instanceoff && SetFieldAction.new(instanceoff, 'models', thiss.id, '+=', true);\r\n            SetRootFieldAction.new(isMetamodel ? \"m2models\" : \"m1models\", thiss.id, \"+=\", true);\r\n        }\r\n\r\n        return this; }\r\n\r\n    DOperation(exceptions: DOperation[\"exceptions\"] = [], implementation?: string/*, parameters: DOperation[\"parameters\"] = []*/): this {\r\n        const thiss: DOperation = this.thiss as any;\r\n        // thiss.parameters = parameters;\r\n        thiss.implementation = implementation || 'return \"default placeholder function called\";'\r\n        thiss.exceptions = exceptions;\r\n        if (this.persist) {\r\n            BEGIN()\r\n            // if (parameters) for (let par of parameters) SetFieldAction.new(par, \"pointedBy\", PointedBy.fromID(thiss.id, \"parameters\"), '+=');\r\n            if (exceptions) for (let exc of exceptions) SetFieldAction.new(exc, \"pointedBy\", PointedBy.fromID(thiss.id, \"exceptions\"), '+=');\r\n            // update father's collections (pointedby's here are set automatically)\r\n            this.persist && thiss.father && SetFieldAction.new(thiss.father, \"operations\", thiss.id, '+=', true);\r\n            END()\r\n        }\r\n        return this; }\r\n\r\n    DClass(isInterface: DClass[\"interface\"] = false, isAbstract: DClass[\"abstract\"] = false, isPrimitive: LClassifier[\"isPrimitive\"] = false,\r\n           partial: DClass[\"partial\"] = false, partialdefaultname: DClass[\"partialdefaultname\"] = ''): this {\r\n        const thiss: DClass = this.thiss as any;\r\n        thiss.interface = isInterface;\r\n        thiss.abstract = isAbstract;\r\n        thiss.isPrimitive = isPrimitive;\r\n        thiss.partial = partial;\r\n        thiss.partialdefaultname = partialdefaultname;\r\n        // thiss.isClass = !isPrimitive;\r\n        // thiss.isEnum = false;\r\n\r\n        if (this.persist) {\r\n            // no pointedBy\r\n            // update father's collections (pointedby's here are set automatically)\r\n            this.persist && thiss.father && SetFieldAction.new(thiss.father, \"classifiers\", thiss.id, '+=', true);\r\n        }\r\n        return this; }\r\n\r\n    DEnumLiteral(value?: DEnumLiteral[\"value\"]): this { // vv4\r\n        const thiss: DEnumLiteral = this.thiss as any;\r\n        thiss.value = value as any; // undef is ok, handled in getter as automatic ordinal index\r\n        thiss.literal = thiss.name;\r\n        if (this.persist) {\r\n            // no pointedBy?\r\n            // update father's collections (pointedby's here are set automatically)\r\n            this.persist && thiss.father && SetFieldAction.new(thiss.father, \"literals\", thiss.id, '+=', true);\r\n        }\r\n        return this; }\r\n\r\n    DEnumerator(/*set it from DLiteral.new() instead literals: DEnumerator[\"literals\"] = []*/): this {\r\n        const thiss: DEnumerator = this.thiss as any;\r\n        // thiss.literals = literals;\r\n        // thiss.isClass = false;\r\n        // thiss.isEnum = true;\r\n        if (this.persist) {\r\n            // if (literals) for (let lit of literals) SetFieldAction.new(lit, \"pointedBy\", PointedBy.fromID(thiss.id, \"literals\"), '+=');\r\n            // update father's collections (pointedby's here are set automatically)\r\n            this.persist && thiss.father && SetFieldAction.new(thiss.father, \"classifiers\", thiss.id, '+=', true);\r\n        }\r\n        return this; }\r\n    DEdgePoint(): this { return this; }\r\n    DVoidEdge(): this {\r\n        let thiss: DVoidEdge = this.thiss as any;\r\n        (thiss).midnodes = [];\r\n        return this; }\r\n    DVertex(): this { return this; }\r\n    DEdge(): this {\r\n        return this; }\r\n    DExtEdge(): this { return this; }\r\n    DRefEdge(): this { return this; }\r\n\r\n    DGraphElement(model: DGraphElement[\"model\"], parentNodeID?: DGraphElement[\"father\"], parentgraphID?: DGraphElement[\"graph\"], nodeID?: DGraphElement[\"id\"]): this {\r\n        const thiss: DGraphElement = this.thiss as any;\r\n        if (parentNodeID) thiss.father = parentNodeID;\r\n        if (parentgraphID) thiss.graph = parentgraphID;\r\n        thiss.model = model;\r\n        thiss.subElements = [];\r\n        if (nodeID) thiss.id = nodeID;\r\n        if (this.persist) {\r\n            model && SetFieldAction.new(model, \"pointedBy\", PointedBy.fromID(thiss.id, \"model\"), '+=');\r\n            parentgraphID && SetFieldAction.new(parentgraphID, \"pointedBy\", PointedBy.fromID(thiss.id, \"graph\"), '+=');\r\n            parentNodeID && SetFieldAction.new(thiss.father, \"pointedBy\", PointedBy.fromID(thiss.id, \"father\"), '+=');\r\n            // update collections (pointedby's here are set automatically)\r\n            parentNodeID && SetFieldAction.new(thiss.father, \"subElements\", thiss.id, '+=', true);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    DViewElement(name: string, jsxString: string, defaultVSize?: GraphSize, usageDeclarations: string = '', constants: string = '',\r\n                 preRenderFunc: string = '', appliableToClasses: string[] = [], oclApplyCondition: string = '', priority: number = 1): this {\r\n        const thiss: DViewElement = this.thiss as any;\r\n        thiss.name = name;\r\n        thiss.appliableToClasses = appliableToClasses;\r\n        thiss.jsxString = jsxString;\r\n        thiss.usageDeclarations = usageDeclarations;\r\n        thiss.constants = constants;\r\n        thiss.preRenderFunc = preRenderFunc;\r\n        // thiss.__transient = new DViewTransientProperties();\r\n        thiss.subViews = [];\r\n        thiss.oclApplyCondition = '';\r\n        thiss.explicitApplicationPriority = priority;\r\n        thiss.defaultVSize = defaultVSize || new GraphSize(0, 0, 350, 200);\r\n        // thiss.adaptHeight = false;\r\n        // thiss.adaptWidth = false;\r\n\r\n\r\n        thiss.draggable = false;\r\n        thiss.resizable = false;\r\n        thiss.adaptWidth = true;\r\n        thiss.display = 'flex' as any;\r\n        thiss.width = 200;\r\n        thiss.height = 100;\r\n        thiss.adaptHeight = 'fit-content';\r\n\r\n        if (this.persist) {\r\n            // no pointedBy?\r\n        }\r\n        return this;\r\n    }\r\n\r\n    DViewPoint(name: string): this {\r\n        const thiss: DViewPoint = this.thiss as any;\r\n        thiss.name = name;\r\n        return this;\r\n    }\r\n\r\n    static DGraph_maxID: number = 0;\r\n    private static DGraph_makeID(modelid: DGraph[\"model\"]): Pointer<DGraph, 1, 1, LGraph> {\r\n        if (!modelid) {\r\n            throw new Error(\"graph without model, currently not supported.\");\r\n            return '_GraphWithoutModel_';\r\n        }\r\n        return modelid + '^graph' + Constructors.DGraph_maxID++;\r\n    }\r\n    DGraph(model: DGraph[\"model\"], id: string | undefined): this {\r\n        const thiss: DGraph = this.thiss as any;\r\n        thiss.id = id || Constructors.DGraph_makeID(model);\r\n        thiss.graph = thiss.id;\r\n        thiss.zoom = new GraphPoint(1, 1);\r\n        thiss.graphSize = new GraphSize(0, 0, 0, 0);  // GraphSize.apply(this, [0, 0, 0 ,0]);\r\n        thiss._subMaps = {zoom: true, graphSize: true}\r\n        if (this.persist) {\r\n            // no pointedBy?\r\n        }\r\n        return this; }\r\n\r\n    DVoidVertex(defaultVSize: GraphSize): this {\r\n        const thiss: DVoidVertex = this.thiss as any;\r\n        thiss.x = defaultVSize.x;\r\n        thiss.y = defaultVSize.y;\r\n        thiss.w = defaultVSize.w;\r\n        thiss.h = defaultVSize.h;\r\n        if (this.persist) {\r\n            // no pointedBy?\r\n        }\r\n        return this; }\r\n\r\n\r\n}\r\n// export const Constructors = new _Constructors();\r\n\r\n@RuntimeAccessible\r\nexport class DPointerTargetable extends RuntimeAccessibleClass {\r\n    static defaultComponent: (ownProps: GObject, children?: (string | React.Component)[]) => React.ReactElement;\r\n    public static maxID: number = 0;\r\n    public static logic: typeof LPointerTargetable;\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    _storePath?: string[];\r\n    _subMaps?: Dictionary<string, boolean>;\r\n    id!: Pointer<DPointerTargetable, 1, 1, LPointerTargetable>;\r\n    // pointedBy: DocString<'path in store'>[] = []; // NB: potrebbe contenere puntatori invalidi.\r\n    // se viene cancellato un intero oggetto A che contiene una lista di puntatori, gli oggetti che puntano ad A rimuovono A dai loro \"poitnedBy\",\r\n    // ma gli oggetti puntati da A tramite sotto-oggetti o attributi (subviews...) non vengono aggiornati in \"pointedby\"\r\n    pointedBy: PointedBy[] = [];\r\n    public className!: string;\r\n\r\n\r\n    static defaultname<L extends LModelElement = LModelElement>(startingPrefix: string | ((meta:L)=>string), father?: Pointer | DPointerTargetable | ((a:string)=>boolean), metaptr?: Pointer | null): string {\r\n        let lfather: LModelElement;\r\n        // startingPrefix = \"model_\", father = ((name: string) => !dmodelnames.includes(name))\r\n        if (father) {\r\n            if (typeof father === \"string\" || (father as any).className) { // Pointer or D\r\n                lfather = LPointerTargetable.wrap(father as DModelElement) as LModelElement;\r\n                if (!lfather) return (typeof startingPrefix === \"string\" ? startingPrefix : \"unnamed_elem\"); // can happen during parse when father ptr exist but it's not in store yet. not a prob\r\n                if (typeof startingPrefix !== \"string\") {\r\n                    let meta = LPointerTargetable.from(metaptr as Pointer);\r\n                    startingPrefix = startingPrefix(meta as L);\r\n                }\r\n                console.log({father, lfather});\r\n                const childrenNames: (string)[] = lfather.children.map(c => (c as LNamedElement).name);\r\n                return U.increaseEndingNumber(startingPrefix + '0', false, false, (newname) => childrenNames.indexOf(newname) >= 0);\r\n            }\r\n            else {\r\n                let condition: (a:string)=>boolean = father as any;\r\n                return U.increaseEndingNumber(startingPrefix + '0', false, false, condition);\r\n            }\r\n        }\r\n        return startingPrefix + \"1\"; }\r\n\r\n    public static new(...a:any): DPointerTargetable { //father?: Pointer, persist: boolean = false, fatherType?: Constructor, ...a:any): DPointerTargetable {\r\n        Log.exx(\"cannot instantiate abstract class DPointerTargetable\");\r\n        return null as any;\r\n        // return new Constructors(new DPointerTargetable('dwc'), father, persist, fatherType).DPointerTargetable().end();\r\n    }\r\n    constructor(fakearg_detectwrongcalls:'dwc') {\r\n        super();\r\n        if (!fakearg_detectwrongcalls) throw new Error( \"cannot build D-objects using new keyword, use the static D-Class.new method instead\");\r\n    }\r\n\r\n    static fromL<LX extends LPointerTargetable,\r\n        DX = LX extends LEnumerator ? LEnumerator : (LX extends LAttribute ? LAttribute : (LX extends LReference ? LReference : (LX extends LRefEdge ? LRefEdge : (LX extends LExtEdge ? LExtEdge : (LX extends LDataType ? LDataType : (LX extends LClass ? LClass : (LX extends LStructuralFeature ? LStructuralFeature : (LX extends LParameter ? LParameter : (LX extends LOperation ? LOperation : (LX extends LEdge ? LEdge : (LX extends LEdgePoint ? LEdgePoint : (LX extends LGraphVertex ? LGraphVertex : (LX extends LModel ? LModel : (LX extends LValue ? LValue : (LX extends LObject ? LObject : (LX extends LEnumLiteral ? LEnumLiteral : (LX extends LPackage ? LPackage : (LX extends LClassifier ? LClassifier : (LX extends LTypedElement ? LTypedElement : (LX extends LVertex ? LVertex : (LX extends LVoidEdge ? LVoidEdge : (LX extends LVoidVertex ? LVoidVertex : (LX extends LGraph ? LGraph : (LX extends LNamedElement ? LNamedElement : (LX extends LAnnotation ? LAnnotation : (LX extends LGraphElement ? LGraphElement : (LX extends LMap ? LMap : (LX extends LModelElement ? LModelElement : (LX extends LUser ? LUser : (LX extends LPointerTargetable ? LPointerTargetable : (ERROR)))))))))))))))))))))))))))))))\r\n        >(data: LX): DX {\r\n        return data.__raw as any;\r\n    }\r\n\r\n\r\n    static fromPointer<// LOW extends number, UPP extends number | 'N',\r\n        T extends Pointer | Pointer[], // <DPointerTargetable, 1, 'N', LPointerTargetable>,\r\n        DDD extends (T extends Pointer<infer D> ? D : 'undefined D'),\r\n        LOW extends (T extends Pointer<any, infer LO> ? LO : 'undefined_upp'),\r\n        UPP extends (T extends Pointer<any, number, infer UP> ? UP : 'undefined_low'),\r\n\r\n        DDDARR extends (T extends Pointer<infer D>[] ? D : 'undefined_DARR'),\r\n        LOWARR extends (T extends Pointer<any, infer LO>[] ? LO : 'undefined_uppARR'),\r\n        UPPARR extends (T extends Pointer<any, number, infer UP>[] ? 'UP_is_N' : 'undefined_lowARR'),\r\n\r\n        RET = UPPARR extends 'UP_is_N' ?\r\n            (DDDARR[]) : // 0...N\r\n            (UPP extends 1 ? (LOW extends 0 ? DDD | null : DDD) : // 0...1 && 1...1\r\n                (LOW extends 1 ? DDD : undefined)  //1...1\r\n                ),\r\n        INFERRED = {ret: RET, upp: UPP, low:LOW, ddd: DDD, dddARR: DDDARR, lowARR: LOWARR, uppARR: UPPARR},>(ptr: T, s?: IStore)\r\n        : RET {\r\n        s = s || store.getState();\r\n        if (Array.isArray(ptr)) {\r\n            return ptr.map( (p: Pointer) => DPointerTargetable.fromPointer(p, s)) as any;\r\n        }\r\n        if (typeof ptr !== \"string\") { ptr = (ptr as any)?.id; }\r\n        if (typeof ptr !== \"string\") { throw new Error(\"wrong parameter in DPointerTargetable.fromPointers()\"); }\r\n        return s.idlookup[ptr as string] as any;\r\n    }\r\n    static from<// LOW extends number, UPP extends number | 'N',\r\n        PTR extends Pointer | Pointer[], // <DPointerTargetable, 1, 'N', LPointerTargetable>,\r\n        DDD extends (PTR extends Pointer<infer D> ? D : 'undefined D'),\r\n        LOW extends (PTR extends Pointer<any, infer LO> ? LO : 'undefined_upp'),\r\n        UPP extends (PTR extends Pointer<any, number, infer UP> ? UP : 'undefined_low'),\r\n\r\n        DDDARR extends (PTR extends Pointer<infer D>[] ? D : 'undefined_DARR'),\r\n        LOWARR extends (PTR extends Pointer<any, infer LO>[] ? LO : 'undefined_uppARR'),\r\n        UPPARR extends (PTR extends Pointer<any, number, infer UP>[] ? 'UP_is_N' : 'undefined_lowARR'),\r\n\r\n        LX extends LPointerTargetable,\r\n\r\n        RETPTR = UPPARR extends 'UP_is_N' ?\r\n            (DDDARR[]) : // 0...N\r\n            (UPP extends 1 ? (LOW extends 0 ? DDD | null : DDD) : // 0...1 && 1...1\r\n                (LOW extends 1 ? DDD : undefined)  //1...1\r\n                ),\r\n\r\n\r\n        // DX = LX extends LEnumerator ? DEnumerator : (LX extends LAttribute ? DAttribute : (LX extends LReference ? DReference : (LX extends LDataType ? DDataType : (LX extends LClass ? DClass : (LX extends LStructuralFeature ? DStructuralFeature : (LX extends LParameter ? DParameter : (LX extends LOperation ? DOperation : (LX extends LModel ? DModel : (LX extends LValue ? DValue : (LX extends LObject ? DObject : (LX extends LEnumLiteral ? DEnumLiteral : (LX extends LPackage ? DPackage : (LX extends LClassifier ? DClassifier : (LX extends LTypedElement ? DTypedElement : (LX extends LNamedElement ? DNamedElement : (LX extends LAnnotation ? DAnnotation : ('ERROR'))))))))))))))))),\r\n        DX = LX extends LEnumerator ? DEnumerator : (LX extends LAttribute ? DAttribute : (LX extends LReference ? DReference : (LX extends LRefEdge ? DRefEdge : (LX extends LExtEdge ? DExtEdge : (LX extends LDataType ? DDataType : (LX extends LClass ? DClass : (LX extends LStructuralFeature ? DStructuralFeature : (LX extends LParameter ? DParameter : (LX extends LOperation ? DOperation : (LX extends LEdge ? DEdge : (LX extends LEdgePoint ? DEdgePoint : (LX extends LGraphVertex ? DGraphVertex : (LX extends LModel ? DModel : (LX extends LValue ? DValue : (LX extends LObject ? DObject : (LX extends LEnumLiteral ? DEnumLiteral : (LX extends LPackage ? DPackage : (LX extends LClassifier ? DClassifier : (LX extends LTypedElement ? DTypedElement : (LX extends LVertex ? DVertex : (LX extends LVoidEdge ? DVoidEdge : (LX extends LVoidVertex ? DVoidVertex : (LX extends LGraph ? DGraph : (LX extends LNamedElement ? DNamedElement : (LX extends LAnnotation ? DAnnotation : (LX extends LGraphElement ? DGraphElement : (LX extends LMap ? DMap : (LX extends LModelElement ? DModelElement : (LX extends LUser ? DUser : (LX extends LPointerTargetable ? DPointerTargetable : (ERROR))))))))))))))))))))))))))))))),\r\n        RET = DX extends 'ERROR' ? RETPTR : (RETPTR extends DX ? RETPTR : DX),\r\n        INFERRED = {ret: RET, RETPTR:RETPTR, upp: UPP, low:LOW, ddd: DDD, dddARR: DDDARR, lowARR: LOWARR, uppARR: UPPARR, LX:LX, DX:DX}>(ptr: PTR | LX, s?: IStore)\r\n        : RET {\r\n        s = s || store.getState();\r\n        return s.idlookup[ptr as string] as any;\r\n    }\r\n    static from0(a: any, ...aa: any): any { return null; }\r\n    static writeable<LX extends LPointerTargetable, WX = LtoW<LX>>(l: LX): WX { return l as any; }\r\n}\r\n/*\r\nlet d0: LClassifier = null as any;\r\nlet ptrr: Pointer<DPackage, 1, 'N', LPackage> = null as any;\r\nlet ptr1: Pointer<DPackage, 1, 1, LPackage> = null as any;\r\nlet dd = DPointerTargetable.from(d0.id);\r\n*/\r\n\r\n\r\n/*\r\ntype Pack1<D extends DPointerTargetable, L extends LPointerTargetable = DtoL<D>, P extends Pointer<D, 0, 1, L> = Pointer<D, 0, 1, L>, R = {D:D, L:L, P:P} > = P|D|L\r\ntype PackArr<D extends DPointerTargetable, L extends LPointerTargetable = DtoL<D>, P extends Pointer<D, 0, 1, L> = Pointer<D, 0, 1, L> , ARR = Pack1<D>> = (ARR)[];\r\ntype Pack<D extends DPointerTargetable, L extends LPointerTargetable = DtoL<D>, P extends Pointer<D, 0, 1, L> = Pointer<D, 0, 1, L> , ARR = Pack1<D>> = ARR | (ARR)[];*/\r\n\r\n\r\n\r\n@RuntimeAccessible\r\nexport class Pointers{\r\n    static filterValid<P extends (Pointer | Pointer[]) = any, RET = P extends Pointer[] ? P : P | null>\r\n    (p: P): P | null {\r\n        const pointerval: DPointerTargetable | DPointerTargetable[] = DPointerTargetable.from(p);\r\n        if (Array.isArray(pointerval)) return pointerval.filter( p => !!p).map( p => p.id) as P;\r\n        if (!pointerval) return null;\r\n        return pointerval.id as P; }\r\n\r\n    fromArr<D extends DPointerTargetable, L extends LPointerTargetable, P extends Pointer> (val: (P | D | L | null | undefined)[] |  (P | D | L | null | undefined)): P[] {\r\n        if (!val) val = [];\r\n        if (!Array.isArray(val)) { val = [val]; }\r\n        if (!val.length) { return []; }\r\n        if ((val[0] as any).id) { val = (val as any as (LModelElement | DModelElement)[]).filter(v => !!v).map( (v) => v.id) as any[]; }\r\n        return val.filter( v => !!v) as any[]; }\r\n\r\n    fromm<D extends DPointerTargetable, L extends LPointerTargetable, P extends Pointer> (val: (P | D | L)): P | null { return !val ? null : (val as any).id; }\r\n\r\n    from0<// LOW extends number, UPP extends number | 'N',\r\n        PTR extends Pointer | Pointer[], // <DPointerTargetable, 1, 'N', LPointerTargetable>,\r\n        // DDD extends (PTR extends Pointer<infer D> ? D : 'undefined_D'),\r\n        LOW extends (PTR extends Pointer<any, infer LO> ? LO : 'undefined_upp'),\r\n        UPP extends (PTR extends Pointer<any, number, infer UP> ? UP : 'undefined_low'),\r\n        DDD extends (PTR extends Pointer<any, number, any, infer LL> ? LL : 'undefined_L'),\r\n\r\n        LOWARR extends (PTR extends Pointer<any, infer LO>[] ? LO : 'undefined_uppARR'),\r\n        UPPARR extends (PTR extends Pointer<any, number, infer UP>[] ? 'UP_is_N' : 'undefined_lowARR'),\r\n        DDDARR extends (PTR extends Pointer<any, any, any, infer LL>[] ? LL : 'undefined_LARR'),\r\n\r\n        DX extends DPointerTargetable,\r\n        LX extends LPointerTargetable,\r\n        WX extends WPointerTargetable,\r\n        RETPTR = UPPARR extends 'UP_is_N' ?\r\n            (DDDARR[]) : // 0...N\r\n            (UPP extends 1 ? (LOW extends 0 ? DDD | null : DDD) : // 0...1 && 1...1\r\n                (LOW extends 1 ? DDD : undefined)  //1...1\r\n                ),\r\n\r\n\r\n        // DX = LX extends LEnumerator ? DEnumerator : (LX extends LAttribute ? DAttribute : (LX extends LReference ? DReference : (LX extends LDataType ? DDataType : (LX extends LClass ? DClass : (LX extends LStructuralFeature ? DStructuralFeature : (LX extends LParameter ? DParameter : (LX extends LOperation ? DOperation : (LX extends LModel ? DModel : (LX extends LValue ? DValue : (LX extends LObject ? DObject : (LX extends LEnumLiteral ? DEnumLiteral : (LX extends LPackage ? DPackage : (LX extends LClassifier ? DClassifier : (LX extends LTypedElement ? DTypedElement : (LX extends LNamedElement ? DNamedElement : (LX extends LAnnotation ? DAnnotation : ('ERROR'))))))))))))))))),\r\n        LXX = DtoL<DX>,\r\n        DXX = LtoD<LX>,\r\n        LXFinal = LXX extends 'ERROR' ? LX : LXX,\r\n        DXFinal = DXX extends 'ERROR' ? DX : DXX,\r\n        RET = {d: DXFinal, l:LXFinal}, // Pointer<DX, 0 | 1, 1 | 'N', LX>\r\n        INFERRED = {ret: RET, RETPTR: RETPTR, LXX: LXX, DXX: DXX, upp: UPP, low:LOW, ddd: DDD, dddARR: DDDARR, lowARR: LOWARR, uppARR: UPPARR, LX:LX, DX:DX}>(data: LX | DX | WX)\r\n        : INFERRED {\r\n        return null as any;\r\n    }\r\n\r\n\r\n    static from00<\r\n        // LOW extends number, UPP extends number | 'N',\r\n        // DDD extends (PTR extends Pointer<infer D> ? D : 'undefined_D'),\r\n        DWL extends {id: any},\r\n        // PCK extends (T extends Pack<infer PPP> ? PPP : never),\r\n        //ISARR extends (T extends any[] ? true : false),\r\n        // PCK1 extends (T extends any[] ? null : T extends Pack1<infer PPP> ? PPP : never), //         PCK1 extends (T extends any[] ? true : false),\r\n        // PCKA extends (T extends PackArr<infer PPP> ? PPP : 'undefined_arrpack'),\r\n        // PTR extends DWL[\"id\"], // <DPointerTargetable, 1, 'N', LPointerTargetable>,\r\n        // T extends DWL | DWL[] | null | undefined,\r\n        /*DX extends (PTR extends Pointer<infer D0> ? D0 : 'undefined_D'),\r\n        LOW extends (PTR extends Pointer<any, infer LO> ? LO : 'undefined_upp'),\r\n        UPP extends (PTR extends Pointer<any, number, infer UP> ? UP : 'undefined_low'),\r\n        LX extends (PTR extends Pointer<any, number, any, infer LL> ? LL : 'undefined_L'),\r\n\r\n        LOWARR extends (PTR extends Pointer<any, infer LO>[] ? LO : 'undefined_uppARR'),\r\n        UPPARR extends (PTR extends Pointer<any, number, infer UP>[] ? 'UP_is_N' : 'undefined_lowARR'),\r\n        DDDARR extends (PTR extends Pointer<any, any, any, infer LL>[] ? LL : 'undefined_LARR'),\r\n        RET = DX extends DPointerTargetable ? ( LOW extends number ? ( UPP extends number ? ( LX extends LPointerTargetable ? Pointer<DX, LOW, UPP, LX> : '_notret_L_') : '_notret_UPP_') : '_notret_LOW_') : '_notret_D_'\r\n        */\r\n        PTRPARAM = Pointer | Pointer[],\r\n        T = Exclude<DWL | DWL[] | PTRPARAM, unknown[]>,\r\n        // @ts-ignore\r\n        PTR = T extends null ? null : T extends undefined ? null : (T extends PTRPARAM ? T : (T extends any[] ? T[number]['id'][] : T['id'])),\r\n        // RET extends Pointer<DPointerTargetable, any, any, LPointerTargetable> = T extends DWL ? DWL[\"id\"] : (T extends DWL[] ? DWL[\"id\"] : null),\r\n        // INF = { PCK:PCK, ISARR: ISARR,  PTR: PTR, DWL: DWL, RET: RET}, // {DD:DD, LL: LL}//\r\n        >(data: T | T[] ): PTR { // RET | RET[] {\r\n        if (Array.isArray(data)) return data.filter(d => !!d).map(d => (typeof d === \"string\" ? d : (d as any as DWL).id)) as any;\r\n        else return (data ? (data as any).id : null);\r\n    } // stavolta fai infer so D|l.id\r\n\r\n\r\n    public static from<DX extends DPointerTargetable>(data:DX): DX[\"id\"]; // | {D:any};\r\n    public static from<DX extends DPointerTargetable>(data:DX[]): DX[\"id\"][]; // | {DD:any};\r\n    public static from<LX extends LPointerTargetable>(data:LX): LX[\"id\"]; // | {L:any};\r\n    public static from<LX extends LPointerTargetable>(data:LX[]): LX[\"id\"][]; // | {LL:any};\r\n    public static from<WX extends WPointerTargetable>(data:WX): WX[\"id\"]; // | {W:any};\r\n    public static from<WX extends WPointerTargetable>(data:WX[]): WX[\"id\"][]; // | {WW:any};\r\n    public static from<PTR extends Pointer<DPointerTargetable, 1, 1, LPointerTargetable>>(data:PTR): PTR; // | {P:any};\r\n    public static from<PTR extends Pointer<DPointerTargetable, 1, 1, LPointerTargetable>>(data:PTR[]): PTR[]; // | {PP:any};\r\n    public static from<T extends LPointerTargetable>(data:Pack1<T>): Pointer<LtoD<T>, 1, 1, T>; //{TEST1:any};\r\n    public static from<T extends LPointerTargetable>(data:Pack1<T>[]): Pointer<LtoD<T>, 1, 1, T>[]; //{TEST111:any};\r\n    public static from<T extends LPointerTargetable>(data:Pack<T>): Pointer<LtoD<T>, 1, 1, T>[]; //{TEST0:any};\r\n    public static from<P extends Pack<T> | undefined, T extends LPointerTargetable>(data: P): Pointer<LtoD<T>, 1, 1, T>[]; //{TEST0:any};\r\n    public static from<T extends LPointerTargetable>(data:PackArr<T>): Pointer<LtoD<T>, 1, 1, T>[]; //{TESTARR:any};\r\n    public static from<T extends LPointerTargetable>(data:Pack1<T[]>): Pointer<LtoD<T>, 1, 1, T>; //{TEST1:any};\r\n    public static from<T extends LPointerTargetable>(data:Pack1<T[]>[]): Pointer<LtoD<T>, 1, 1, T>[]; //{TEST111:any};\r\n    public static from<T extends LPointerTargetable>(data:Pack<T[]>): Pointer<LtoD<T>, 1, 1, T>[]; //{TEST0:any};\r\n    public static from<T extends LPointerTargetable>(data:PackArr<T[]>): Pointer<LtoD<T>, 1, 1, T>[]; //{TESTARR:any};\r\n\r\n    /*\r\n        public static from(data:undefined): undefined; // | {D:any};\r\n        public static from<DX extends DPointerTargetable | undefined | null>(data:DX): DX extends DPointerTargetable ? DX[\"id\"] : DX; // | {D:any};\r\n        public static from<DX extends DPointerTargetable | undefined | null>(data:DX[]): DX extends DPointerTargetable ? DX[\"id\"][] : DX; // | {DD:any};\r\n        public static from<LX extends LPointerTargetable | undefined | null>(data:LX): LX extends LPointerTargetable ? LX[\"id\"] : LX; // | {L:any};\r\n        public static from<LX extends LPointerTargetable | undefined | null>(data:LX[]): LX extends LPointerTargetable ? LX[\"id\"][] : LX; // | {LL:any};\r\n        public static from<WX extends WPointerTargetable | undefined | null>(data:WX): WX extends WPointerTargetable ? WX[\"id\"] : WX; // | {W:any};\r\n        public static from<WX extends WPointerTargetable | undefined | null>(data:WX[]): WX extends WPointerTargetable ? WX[\"id\"][] : WX; // | {WW:any};\r\n        public static from<PTR extends Pointer<DPointerTargetable, 1, 1, LPointerTargetable> | undefined | null>(data:PTR): PTR extends Pointer<DPointerTargetable, 1, 1, LPointerTargetable> ? PTR : PTR; // | {P:any};\r\n        public static from<PTR extends Pointer<DPointerTargetable, 1, 1, LPointerTargetable> | undefined | null>(data:PTR[]): PTR extends Pointer<DPointerTargetable, 1, 1, LPointerTargetable> ? PTR[] : PTR; // | {PP:any};\r\n        public static from<T extends LPointerTargetable | undefined | null>(data:Pack1<T>): T extends LPointerTargetable ? Pointer<LtoD<T>, 1, 1, T> : T; //{TEST1:any};\r\n        public static from<T extends LPointerTargetable | undefined | null>(data:Pack1<T>[]): T extends LPointerTargetable ? Pointer<LtoD<T>, 1, 1, T>[] : T; //{TEST111:any};\r\n        public static from<T extends LPointerTargetable | undefined | null>(data:Pack<T>): T extends LPointerTargetable ? Pointer<LtoD<T>, 1, 1, T>[] : T; //{TEST0:any};\r\n        public static from<T extends LPointerTargetable | undefined | null>(data:PackArr<T>): T extends LPointerTargetable ? Pointer<LtoD<T>, 1, 1, T>[] : T; //{TESTARR:any};\r\n        // public static from<T extends LPointerTargetable | undefined | null>(data:Pack1<T[]>): T extends LPointerTargetable ? Pointer<LtoD<T>, 1, 1, T> : T; //{TEST1:any};\r\n        // public static from<T extends LPointerTargetable | undefined | null>(data:Pack1<T[]>[]): T extends LPointerTargetable ? Pointer<LtoD<T>, 1, 1, T>[] : T; //{TEST111:any};\r\n        // DDD extends (T extends Pointer<infer D> ? D : 'undefined D'),*/\r\n    public static from<TT extends Pack<LPointerTargetable[]> | undefined | null,\r\n        // @ts-ignore\r\n        T extends (TT extends Pack<infer PTYPE> ? PTYPE : undefined)>(data:T): T extends null | undefined ? T : Pointer<LtoD<T>, 1, 1, T>[]; //{TEST0:any};\r\n    // @ts-ignore\r\n    public static from<T extends LPointerTargetable | undefined | null>(data: PackArr<T[]>): T extends null | undefined ? T : Pointer<LtoD<T>, 1, 1, T>[]; //{TESTARR:any};\r\n    public static from(data:null | undefined): null; // | {Dn:any};\r\n    public static from(data:(null | undefined)[]): []; // | {Dnn:any};\r\n    public static from(data:(null | undefined) | (null | undefined)[]): []; // | {Dn0:any};\r\n\r\n// function from<PTR extends Pointer<DPointerTargetable, 1, 1, LPointerTargetable>>(data:unknown | unknown[]): PTR | PTR[] | GObject {\r\n    public static from<T extends LClass, PTR extends Pointer<DPointerTargetable, 1, 1, LPointerTargetable>>(data:unknown | unknown[]): null | PTR | PTR[]{\r\n        if (!data) return null;\r\n        if (Array.isArray(data)) return data.filter(d => !!d).map(d => (typeof d === \"string\" ? d : (d as any).id)) as any;\r\n        return typeof data === \"string\" ? data : (data as any).id;\r\n    }\r\n\r\n    static isPointer(val: any): val is Pointer {\r\n        // todo: must refine this in a safer way\r\n        return val?.includes ? val.includes(\"Pointer\") : false;\r\n    }\r\n}\r\n/*\r\nexport type Pack1<L extends LPointerTargetable | undefined | null,\r\n    // L extends LPointerTargetable | undefined | null = LL extends LPointerTargetable[] ? LPointerTargetable : null | undefined,\r\n    D extends (L extends LPointerTargetable ? LtoD<L> : undefined | null) = (L extends LPointerTargetable ? LtoD<L> : undefined | null)> =\r\n    L extends LPointerTargetable ? ( D extends DPointerTargetable ? D | L /*| LtoW<L>* / | Pointer<D, 1, 1, L> : L) : undefined;\r\nexport type PackArr<LL extends orArr<LPointerTargetable> | undefined | null,\r\n    L extends LPointerTargetable | undefined | null = LL extends undefined | null ? undefined : unArr<LL>> = Pack1<L>[];\r\nexport type Pack<\r\n    LL extends orArr<LPointerTargetable> | undefined | null,\r\n    L extends unArr<LL> = unArr<LL>,\r\n    // L extends (LL extends orArr<LPointerTargetable> ? LPointerTargetable : undefined | null) = (LL extends orArr<LPointerTargetable> ? unArr<LL> : undefined)\r\n    >\r\n    = LL extends undefined ? undefined : Pack1<L> | PackArr<L>;\r\n*/\r\nexport type Pack1<LL extends orArr<LPointerTargetable> | undefined, L extends LPointerTargetable | undefined = unArr<LL>,\r\n    D extends (L extends LPointerTargetable ? LtoD<L> : undefined) = (L extends LPointerTargetable ? LtoD<L> : undefined)> =\r\n    L extends LPointerTargetable ? ( D extends DPointerTargetable ? D | L | Pointer<D, 1, 1, L> : undefined) : undefined;\r\nexport type PackArr<LL extends orArr<LPointerTargetable> | undefined, L extends LPointerTargetable | undefined = unArr<LL>> = Pack1<L>[];\r\nexport type Pack<LL extends orArr<LPointerTargetable> | undefined, L extends LPointerTargetable | undefined = unArr<LL>> = L extends undefined ? undefined : Pack1<L> | PackArr<L>;\r\n/*\r\nlet n: any = null;\r\nlet aa: DClass = n;\r\nlet ptrr = Pointers.from(aa.parent);\r\naa.parent = ptrr;*/\r\n\r\n@RuntimeAccessible\r\nexport class PendingPointedByPaths{\r\n    static all: PendingPointedByPaths[] = [];\r\n    // static pendingMoreThanTwice: ParsedAction[] = [];\r\n    static maxSolveAttempts: number = 20;\r\n    public solveAttempts: number = 1;\r\n    private stackTrace: string[];\r\n\r\n    // tmp fields, not sure what i need\r\n    public action!: ParsedAction; // todo: remove\r\n    static new(action: ParsedAction, oldState: IStore): PendingPointedByPaths {\r\n        const ptr: Pointer = action.value;\r\n        const target: DPointerTargetable | null = oldState.idlookup[ptr as string];\r\n        let pendingPointedBy = new PendingPointedByPaths(action.path, ptr);\r\n        pendingPointedBy.action = action;\r\n        return pendingPointedBy;\r\n    }\r\n\r\n    private constructor(\r\n        public from: DocString<\"full Path in store including field key\">,\r\n        // todo 6: how about actions that do not include index but just += -= [] ?\r\n        public to: Pointer){\r\n        this.stackTrace = U.getStackTrace();\r\n    }\r\n    static attemptimplementationdelete(pb: PointedBy) {\r\n        let state: IStore = store.getState();\r\n        let objectChain = U.followPath(state, pb.source);\r\n    }\r\n\r\n    public attemptResolve(state: IStore): ParsedAction | null {\r\n        if (this.canBeResolved(state)) return this.resolve();\r\n        return null;\r\n    }\r\n\r\n    private resolve(): ParsedAction{\r\n        U.arrayRemoveAll(PendingPointedByPaths.all, this);\r\n        return Action.parse(SetRootFieldAction.create(\"idlookup.\" + this.to + '.pointedBy', PointedBy.new(this.action.path), '+=', false));\r\n    }\r\n\r\n    public saveForLater(): void { PendingPointedByPaths.all.push(this); }\r\n    private canBeResolved(state: IStore): boolean {\r\n        this.solveAttempts++;\r\n        if (this.solveAttempts >= PendingPointedByPaths.maxSolveAttempts) Log.ex(\"pending PointedBy action is not revolved for too long, some pointer was wrongly set up.\", this.stackTrace, this, state);\r\n        return !!state.idlookup[this.to]; }\r\n\r\n    static getSolveableActions(oldState: IStore): ParsedAction[] {\r\n        let allClone = [...this.all]; // necessary because the array will remove some elements during iteration as they are solved.\r\n        return allClone.map( p => p.attemptResolve(oldState)).filter(p => (!!p)) as ParsedAction[];\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class PointedBy{\r\n    static list: string[] = [\"father\", \"parent\", \"annotations\", \"packages\", \"type\", \"subpackages\", \"classifiers\", \"exceptions\", \"parameters\", \"defaultValue\", \"instances\", \"operations\", \"features\", \"attributes\", \"references\", \"extends\", \"extendedBy\", \"implements\", \"implementedBy\", \"instanceof\", \"edges\", \"target\", \"opposite\", \"parameters\", \"exceptions\", \"literals\", \"values\"];\r\n    source: string; // elemento da cui parte il puntatore\r\n    // field: keyof DPointerTargetable;\r\n    // il bersaglio non c'è qui, perchè è l'oggetto che contiene questo dentro l'array pointedBy\r\n\r\n    /*private constructor(source: DPointerTargetable, field: any) {\r\n        this.source = source;\r\n        this.field = field;\r\n    }*/\r\n\r\n    static getPath(p: PointedBy) : string { return p.source.substring(0, p.source.lastIndexOf(\".\")); }\r\n    static getLastKey(p: PointedBy) : string { return p.source.substring(p.source.lastIndexOf(\".\")); }\r\n    static getPathArr(p: PointedBy) : string[] { return p.source.split('.'); }\r\n    private constructor(source: string) {\r\n        this.source = source;\r\n    }\r\n    static fromID<D extends DPointerTargetable>(ptr: Pointer<D>, field: keyof D) {\r\n        // Giordano: add ignore for webpack\r\n        //@ts-ignore\r\n        return PointedBy.new(\"idlookup.\" + ptr + \".\" + field);\r\n    }\r\n    static new(source: DocString<\"full path in store including key. like \\'idlookup.id.extends\\'\">, modifier: \"-=\" | \"+=\" | undefined = undefined, action?: ParsedAction): PointedBy {\r\n        // let source: DocString<\"full path in store including key\"> = action.path;\r\n        // if (source.includes(\"true\")) { console.error(this, action); throw new Error(\"mixed a bool\"); }\r\n        if (modifier) source = source.substring(0, source.length - (modifier?.length || 0));\r\n        return new PointedBy(source);\r\n    }\r\n    // static new0<D extends DPointerTargetable> (source: D, field: keyof D): PointedBy { return new PointedBy(source, field); }\r\n\r\n\r\n\r\n    public static remove(oldValue: Pointer | undefined, action: ParsedAction, state: IStore, casee: \"+=\" | \"-=\" | undefined = undefined): IStore {\r\n        if (!oldValue) return state;\r\n        let oldtarget: DPointerTargetable = state.idlookup[oldValue];// todo: if += -=\r\n        if (!oldtarget) return state;\r\n        let index = -1;\r\n        let actionpath: string = action.path.substring(0, action.path.length -(casee?.length || 0))\r\n        for (let i = 0; i < oldtarget.pointedBy.length; i++) { if (oldtarget.pointedBy[i].source === actionpath) {index = i; break; } }\r\n        if (index >= 0) {\r\n            state = {...state};\r\n            state.idlookup = {...state.idlookup};\r\n            state.idlookup[oldValue] =  {...oldtarget, pointedBy: [...oldtarget.pointedBy]} as any;\r\n            state.idlookup[oldValue].pointedBy.splice(index, 1) // in-place edit\r\n        }\r\n        // console.warn('pointedby remove:', {from: oldtarget.pointedBy, to: state.idlookup[oldValue].pointedBy, obj: state.idlookup[oldValue], index, oldValue, actionpath});\r\n        return state;\r\n    }\r\n\r\n    public static add(newtargetptr: Pointer | undefined, action: ParsedAction, state: IStore, casee: \"+=\" | \"-=\" | undefined = undefined): IStore {\r\n        if (!newtargetptr) return state;\r\n        // todo: if can't be done because newtarget doesn't exist, build an action from this and set it pending.\r\n        let newtarget: DPointerTargetable = state.idlookup[newtargetptr];\r\n        if (!newtarget) {\r\n            PendingPointedByPaths.new(action, state).saveForLater(); // {from: action.path, field: action.field, to: target});\r\n            return state;\r\n        }\r\n        let oldtarget = {...newtarget, pointedBy: [...newtarget.pointedBy]}\r\n        state = {...state};\r\n        state.idlookup = {...state.idlookup};\r\n        state.idlookup[newtargetptr] = {...newtarget, pointedBy:  [...newtarget.pointedBy, PointedBy.new(action.path, casee)]} as any;\r\n        // console.warn('pointedby add:', {from: oldtarget.pointedBy, to: state.idlookup[newtargetptr].pointedBy, obj: state.idlookup[newtargetptr]});\r\n        return state;\r\n    }\r\n}\r\n\r\ntype AnyPointer = Pointer<DPointerTargetable, number, number|'N', LPointerTargetable>;\r\n\r\n@RuntimeAccessible\r\nexport class LPointerTargetable<Context extends LogicContext<DPointerTargetable> = any, D extends DPointerTargetable = DPointerTargetable> extends DPointerTargetable {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public static structure: typeof DPointerTargetable;\r\n    public static singleton: LPointerTargetable;\r\n    public __raw!: D;\r\n    public pointedBy!: PointedBy[];\r\n\r\n    public __isProxy!: boolean;\r\n    public __serialize!: DocString<\"json\">;\r\n    private inspect!:D;\r\n    private clonedCounter!:number;\r\n    private __random!:number;\r\n\r\n    private __info_of__id = {type:\"Pointer&lt;this&gt;\", txt:\"<a href=\\\"https://github.com/DamianoNaraku/jodel-react/wiki/identifiers\\\"><span>Unique identifier, and value used to point this object.</span></a>\"};\r\n\r\n    protected wrongAccessMessage(str: string): any {\r\n        let msg = \"Method \"+str+\" should not be called directly, attempting to do so should trigger get_\"+str+\"(). This is only a signature for type checking.\";\r\n        Log.ex(msg);\r\n        throw new Error(msg); }\r\n\r\n    public toString(): string { throw this.wrongAccessMessage(\"toString\"); }\r\n    protected get_toString(context: Context): () => string {\r\n        const data = context.data as DNamedElement;\r\n        return () => ( data.name ? data.name : data.className.substring(0));\r\n        // return () => data.id;\r\n    }\r\n\r\n\r\n    protected cannotSet(field: string): boolean { return Log.exx('\"' + field + '\" field is read-only', this); }\r\n    protected get_id(context: Context): this[\"id\"] { return context.data.id; }\r\n    protected set_id(): boolean { return this.cannotSet('id'); }\r\n\r\n    protected _get_default< DD extends DPointerTargetable, T extends string & keyof (DD) & keyof (L), L extends LModelElement = LModelElement>(data: DD, key: T): L[T]{\r\n        // @ts-ignore\r\n        return LPointerTargetable.from(data[key]); }\r\n\r\n    public delete(): void { throw this.wrongAccessMessage(\"delete\"); }\r\n    public _delete(context: Context): void { new DeleteElementAction(context.data); }\r\n    protected get_delete(context: Context): () => void {\r\n        return () => {\r\n            alert(\"Delete in LPOINTER\")\r\n            this._delete(context);\r\n        }\r\n    }\r\n\r\n    public get__extends(superClassName: string, context: LogicContext<DPointerTargetable>): boolean {\r\n        return RuntimeAccessibleClass.extends(context.data.className, superClassName);\r\n    }\r\n\r\n    /*\r\n    public get_pointedBy(superClassName: string, context: LogicContext<DPointerTargetable>): LPointerTargetable[] {\r\n        let state: GObject = windoww.store.getState();\r\n        function getForemostObjectInPath(path: DocString<'storePath'>): undefined | LPointerTargetable {\r\n            let lastPointableObject: undefined | DPointerTargetable;\r\n            let pathArray = path.split('.');\r\n            for (let key of pathArray) {\r\n                let currentObj: GObject = state[key];\r\n                if (!currentObj) break;\r\n                if (currentObj && currentObj.id && state.idlookup[currentObj.id]) lastPointableObject = state.idlookup[currentObj.id];\r\n            }\r\n            return lastPointableObject && DPointerTargetable.wrap(lastPointableObject);\r\n        }\r\n        return (context.data.pointedBy || []).map(getForemostObjectInPath).filter( lobj => !!lobj) as LPointerTargetable[];\r\n    }*/\r\n\r\n    public set_pointedBy(val: never, context: LogicContext<DPointerTargetable>): boolean {\r\n        windoww.Log.exx('pointedBy field should never be directly edited.', {context, val});\r\n        return false;\r\n    }\r\n\r\n\r\n\r\n\r\n    static fromD<DX extends DPointerTargetable,\r\n        LX = DX extends DEnumerator ? LEnumerator : (DX extends DAttribute ? LAttribute : (DX extends DReference ? LReference : (DX extends DRefEdge ? LRefEdge : (DX extends DExtEdge ? LExtEdge : (DX extends DDataType ? LDataType : (DX extends DClass ? LClass : (DX extends DStructuralFeature ? LStructuralFeature : (DX extends DParameter ? LParameter : (DX extends DOperation ? LOperation : (DX extends DEdge ? LEdge : (DX extends DEdgePoint ? LEdgePoint : (DX extends DGraphVertex ? LGraphVertex : (DX extends DModel ? LModel : (DX extends DValue ? LValue : (DX extends DObject ? LObject : (DX extends DEnumLiteral ? LEnumLiteral : (DX extends DPackage ? LPackage : (DX extends DClassifier ? LClassifier : (DX extends DTypedElement ? LTypedElement : (DX extends DVertex ? LVertex : (DX extends DVoidEdge ? LVoidEdge : (DX extends DVoidVertex ? LVoidVertex : (DX extends DGraph ? LGraph : (DX extends DNamedElement ? LNamedElement : (DX extends DAnnotation ? LAnnotation : (DX extends DGraphElement ? LGraphElement : (DX extends DMap ? LMap : (DX extends DModelElement ? LModelElement : (DX extends DUser ? LUser : (DX extends DPointerTargetable ? LPointerTargetable : (ERROR))))))))))))))))))))))))))))))),\r\n        >(data: DX): LX {\r\n        // return null as any;\r\n        if (Array.isArray(data)) return LPointerTargetable.wrapAll(data) as any;\r\n        return LPointerTargetable.wrap(data) as any;\r\n    }\r\n\r\n\r\n    static fromPointer<\r\n        T extends AnyPointer | AnyPointer[], // <DPointerTargetable, 1, 'N', LPointerTargetable>,\r\n        DDD extends (T extends Pointer<any, any, any, infer D> ? D : 'undefined L'),\r\n        LOW extends (T extends Pointer<any, infer LO> ? LO : 'undefined_upp'),\r\n        UPP extends (T extends Pointer<any, number, infer UP> ? UP : 'undefined_low'),\r\n\r\n        DDDARR extends (T extends Pointer<any, any, any, infer D>[] ? D : 'undefined_DARR'),\r\n        LOWARR extends (T extends Pointer<any, infer LO>[] ? LO : 'undefined_uppARR'),\r\n        UPPARR extends (T extends Pointer<any, number, infer UP>[] ? 'UP_is_N' : 'undefined_lowARR'),\r\n\r\n        RET = UPPARR extends 'UP_is_N' ?\r\n            (DDDARR[]) : // 0...N\r\n            (UPP extends 1 ? (LOW extends 0 ? DDD | null : DDD) : // 0...1 && 1...1\r\n                (LOW extends 1 ? DDD : undefined)  //1...1\r\n                ),\r\n        INFERRED = {ret: RET, upp: UPP, low:LOW, ddd: DDD, dddARR: DDDARR, lowARR: LOWARR, uppARR: UPPARR},>(ptr: T | undefined, state?: IStore)\r\n        : RET {\r\n        // return null as any;\r\n        if (Array.isArray(ptr)) return LPointerTargetable.wrapAll(ptr as any, undefined, '', false, state) as any;\r\n        return LPointerTargetable.wrap(ptr) as any;\r\n    }\r\n    static fromArr<\r\n        PTR extends Pointer | Pointer[], // <DPointerTargetable, 1, 'N', LPointerTargetable>,\r\n        // DDD extends (PTR extends Pointer<infer D> ? D : 'undefined_D'),\r\n        LOW extends (PTR extends Pointer<any, infer LO> ? LO : 'undefined_upp'),\r\n        UPP extends (PTR extends Pointer<any, number, infer UP> ? UP : 'undefined_low'),\r\n        DDD extends (PTR extends Pointer<any, number, any, infer LL> ? LL : 'undefined_L'),\r\n\r\n        LOWARR extends (PTR extends Pointer<any, infer LO>[] ? LO : 'undefined_uppARR'),\r\n        UPPARR extends (PTR extends Pointer<any, number, infer UP>[] ? 'UP_is_N' : 'undefined_lowARR'),\r\n        DDDARR extends (PTR extends Pointer<any, any, any, infer LL>[] ? LL : 'undefined_LARR'),\r\n\r\n        DX extends DPointerTargetable,\r\n\r\n        RETPTR = UPPARR extends 'UP_is_N' ?\r\n            (DDDARR[]) : // 0...N\r\n            (UPP extends 1 ? (LOW extends 0 ? DDD | null : DDD) : // 0...1 && 1...1\r\n                (LOW extends 1 ? DDD : undefined)  //1...1\r\n                ),\r\n\r\n        // DX = LX extends LEnumerator ? DEnumerator : (LX extends LAttribute ? DAttribute : (LX extends LReference ? DReference : (LX extends LDataType ? DDataType : (LX extends LClass ? DClass : (LX extends LStructuralFeature ? DStructuralFeature : (LX extends LParameter ? DParameter : (LX extends LOperation ? DOperation : (LX extends LModel ? DModel : (LX extends LValue ? DValue : (LX extends LObject ? DObject : (LX extends LEnumLiteral ? DEnumLiteral : (LX extends LPackage ? DPackage : (LX extends LClassifier ? DClassifier : (LX extends LTypedElement ? DTypedElement : (LX extends LNamedElement ? DNamedElement : (LX extends LAnnotation ? DAnnotation : ('ERROR'))))))))))))))))),\r\n        LX = DX extends DEnumerator ? LEnumerator : (DX extends DAttribute ? LAttribute : (DX extends DReference ? LReference : (DX extends DRefEdge ? LRefEdge : (DX extends DExtEdge ? LExtEdge : (DX extends DDataType ? LDataType : (DX extends DClass ? LClass : (DX extends DStructuralFeature ? LStructuralFeature : (DX extends DParameter ? LParameter : (DX extends DOperation ? LOperation : (DX extends DEdge ? LEdge : (DX extends DEdgePoint ? LEdgePoint : (DX extends DGraphVertex ? LGraphVertex : (DX extends DModel ? LModel : (DX extends DValue ? LValue : (DX extends DObject ? LObject : (DX extends DEnumLiteral ? LEnumLiteral : (DX extends DPackage ? LPackage : (DX extends DClassifier ? LClassifier : (DX extends DTypedElement ? LTypedElement : (DX extends DVertex ? LVertex : (DX extends DVoidEdge ? LVoidEdge : (DX extends DVoidVertex ? LVoidVertex : (DX extends DGraph ? LGraph : (DX extends DNamedElement ? LNamedElement : (DX extends DAnnotation ? LAnnotation : (DX extends DGraphElement ? LGraphElement : (DX extends DMap ? LMap : (DX extends DModelElement ? LModelElement : (DX extends DUser ? LUser : (DX extends DPointerTargetable ? LPointerTargetable : (ERROR))))))))))))))))))))))))))))))),\r\n        RET = LX extends 'ERROR' ? RETPTR : (RETPTR extends LX ? RETPTR : LX),\r\n        INFERRED = {ret: RET, RETPTR: RETPTR, upp: UPP, low:LOW, ddd: DDD, dddARR: DDDARR, lowARR: LOWARR, uppARR: UPPARR, LX:LX, DX:DX}>(ptr: PTR[] | DX[])\r\n        : RET[] {\r\n        return LPointerTargetable.from(ptr as any); }\r\n\r\n    static from<// LOW extends number, UPP extends number | 'N',\r\n        PTR extends Pointer<DPointerTargetable, 0|1, 1|'N', LPointerTargetable> | Pointer[], // <DPointerTargetable, 1, 'N', LPointerTargetable>,\r\n        // DDD extends (PTR extends Pointer<infer D> ? D : 'undefined_D'),\r\n        LOW extends (PTR extends Pointer<any, infer LO> ? LO : 'undefined_upp'),\r\n        UPP extends (PTR extends Pointer<any, number, infer UP> ? UP : 'undefined_low'),\r\n        DDD extends (PTR extends Pointer<any, number, any, infer LL> ? LL : 'undefined_L'),\r\n\r\n        LOWARR extends (PTR extends Pointer<any, infer LO>[] ? LO : 'undefined_uppARR'),\r\n        UPPARR extends (PTR extends Pointer<any, number, infer UP>[] ? 'UP_is_N' : 'undefined_lowARR'),\r\n        DDDARR extends (PTR extends Pointer<any, any, any, infer LL>[] ? LL : 'undefined_LARR'),\r\n\r\n        DX extends DPointerTargetable,\r\n\r\n        RETPTR = UPPARR extends 'UP_is_N' ?\r\n            (DDDARR[]) : // 0...N\r\n            (UPP extends 1 ? (LOW extends 0 ? DDD | null : DDD) : // 0...1 && 1...1\r\n                (LOW extends 1 ? DDD : undefined)  //1...1\r\n                ),\r\n\r\n\r\n        // DX = LX extends LEnumerator ? DEnumerator : (LX extends LAttribute ? DAttribute : (LX extends LReference ? DReference : (LX extends LDataType ? DDataType : (LX extends LClass ? DClass : (LX extends LStructuralFeature ? DStructuralFeature : (LX extends LParameter ? DParameter : (LX extends LOperation ? DOperation : (LX extends LModel ? DModel : (LX extends LValue ? DValue : (LX extends LObject ? DObject : (LX extends LEnumLiteral ? DEnumLiteral : (LX extends LPackage ? DPackage : (LX extends LClassifier ? DClassifier : (LX extends LTypedElement ? DTypedElement : (LX extends LNamedElement ? DNamedElement : (LX extends LAnnotation ? DAnnotation : ('ERROR'))))))))))))))))),\r\n        LX = DX extends DEnumerator ? LEnumerator : (DX extends DAttribute ? LAttribute : (DX extends DReference ? LReference : (DX extends DRefEdge ? LRefEdge : (DX extends DExtEdge ? LExtEdge : (DX extends DDataType ? LDataType : (DX extends DClass ? LClass : (DX extends DStructuralFeature ? LStructuralFeature : (DX extends DParameter ? LParameter : (DX extends DOperation ? LOperation : (DX extends DEdge ? LEdge : (DX extends DEdgePoint ? LEdgePoint : (DX extends DGraphVertex ? LGraphVertex : (DX extends DModel ? LModel : (DX extends DValue ? LValue : (DX extends DObject ? LObject : (DX extends DEnumLiteral ? LEnumLiteral : (DX extends DPackage ? LPackage : (DX extends DClassifier ? LClassifier : (DX extends DTypedElement ? LTypedElement : (DX extends DVertex ? LVertex : (DX extends DVoidEdge ? LVoidEdge : (DX extends DVoidVertex ? LVoidVertex : (DX extends DGraph ? LGraph : (DX extends DNamedElement ? LNamedElement : (DX extends DAnnotation ? LAnnotation : (DX extends DGraphElement ? LGraphElement : (DX extends DMap ? LMap : (DX extends DModelElement ? LModelElement : (DX extends DUser ? LUser : (DX extends DPointerTargetable ? LPointerTargetable : (ERROR))))))))))))))))))))))))))))))),\r\n        RET = LX extends 'ERROR' ? RETPTR : (RETPTR extends LX ? RETPTR : LX),\r\n        INFERRED = {ret: RET, RETPTR: RETPTR, upp: UPP, low:LOW, ddd: DDD, dddARR: DDDARR, lowARR: LOWARR, uppARR: UPPARR, LX:LX, DX:DX}>(ptr: PTR | DX, s?: IStore)\r\n        : RET {\r\n        // return null as any;\r\n        if (Array.isArray(ptr)) return LPointerTargetable.wrapAll(ptr) as any;\r\n        return LPointerTargetable.wrap(ptr as any) as any;\r\n    }\r\n\r\n    // static from0(a: any, ...aa: any): any { return null; }\r\n}\r\n/*\r\nlet pttr: Pointer<DClassifier, 0, 1, LClassifier> = null as any;\r\nlet ptrany: Pointer<DClassifier, 0|1, 1|'N'>[] = null as any;\r\nlet ptrarr: Pointer<DClassifier>[] = null as any;\r\nlet ptrarr2: Pointer<DClassifier, 1, 'N'> = null as any;\r\nlet d: DClassifier = null as any;\r\nlet darr: DClassifier[] = null as any;\r\n\r\ntype VoidPtr = null | undefined | '';\r\nfunction dfrom<\r\n    PARAM extends orArr<AnyPointer | VoidPtr>,//orArr<WPointerTargetable | LPointerTargetable | DPointerTargetable | AnyPointer>,\r\n\r\n\r\n    DDD extends (PARAM extends Pointer<infer DD> ? DD : 'undefined_D'),\r\n    LOW extends (PARAM extends Pointer<any, infer LO> ? LO : 'undefined_low'),\r\n    LOW0 extends (PARAM extends Pointer<any, 0, any, any> ? 0 : never),\r\n    LOW1 extends (PARAM extends Pointer<any, 1, any, any> ? 1 : never),\r\n    LOW2 extends (VoidPtr extends PARAM ? 0 | 'first' : (PARAM extends VoidPtr ? 0 | 1 | 'second': 1|'third')),\r\n    UPP extends (PARAM extends Pointer<any, number, infer UP> ? UP : 'undefined_upp'),\r\n    LLL extends (PARAM extends Pointer<any, number, any, infer LL> ? LL : 'undefined_L'),\r\n\r\n\r\n\r\n    ISVOID extends PARAM extends VoidPtr  ? 'isvoid' : never,\r\n    ISARR extends PARAM extends [] ? true : false,\r\n    ISPTR extends (PARAM extends AnyPointer | VoidPtr ? 'ptr' : never),\r\n    ISPTRARR extends (PARAM extends (AnyPointer | VoidPtr)[] | Pointer<DPointerTargetable, 1|0, 'N', LPointerTargetable> ? 'ptr_arr' : never),\r\n    ISD extends (PARAM extends DPointerTargetable ? 'd' : never),\r\n    ISDARR extends (PARAM extends DPointerTargetable[] ? 'd_arr' : never),\r\n    ISL extends (PARAM extends LPointerTargetable ? 'l' : never),\r\n    ISLARR extends (PARAM extends LPointerTargetable[] ? 'l_arr' : never),\r\n    ISW extends (PARAM extends WPointerTargetable ? 'w' : never),\r\n    ISWARR extends (PARAM extends WPointerTargetable[] ? 'w_arr' : never),\r\n    // INFER = {LOW:LOW, UPP:UPP, DDD:DDD, LLL:LLL, LOW2:LOW2},\r\n    INFER = { LOW2:LOW2},\r\n    RET = ISVOID | ISPTR | ISPTRARR | ISD | ISDARR | ISL | ISLARR | ISW | ISWARR | INFER\r\n    >\r\n(ptr: PARAM): RET { return null as any; }\r\nlet Lptr = dfrom(pttr as Pointer<DClassifier, 0, 1, LClassifier> );\r\nlet Lptrany = dfrom(ptrany);\r\nlet Lptrarr = dfrom(ptrarr);\r\nlet Lptrarr2 = dfrom(ptrarr2);\r\nlet Ld = dfrom(d);\r\nlet Ldarr = dfrom(darr);*/\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n@RuntimeAccessible\r\nexport class WPointerTargetable extends DPointerTargetable{\r\n    id!: never;\r\n    _storePath!: never;\r\n    _subMaps!: never;\r\n    pointedBy!: never;\r\n    // todo: WfromD, WfromL, WfromPointer, Wfrom\r\n\r\n    static fromD<DX extends DPointerTargetable, WX extends DtoW<DX>>(data: DX): WX { return LPointerTargetable.fromD(data) as any; }\r\n}\r\nDPointerTargetable.subclasses.push(LPointerTargetable);\r\nDPointerTargetable.subclasses.push(WPointerTargetable);\r\n\r\nfunction fffff<DX, LX = DX extends DRefEdge ? LRefEdge : 'not'>( t: DX): LX { return null as any; }\r\nlet a: DGraphElement = null as any;\r\nlet bbb = LPointerTargetable.from(a);\r\nlet bb2 = fffff(a);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n@Leaf\r\n@RuntimeAccessible\r\nexport class DUser extends DPointerTargetable{\r\n    static current: DocString<Pointer<DUser, 1, 1>> = \"Pointer\"; // todo\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    cursorPositionX: number = 0;\r\n    cursorPositionY: number = 0;\r\n    // public static structure: typeof DPointerTargetable;\r\n    // public static singleton: LPointerTargetable;\r\n    id!: Pointer<DUser, 1, 1, LUser>;\r\n    __isUser: true = true; // necessary to trick duck typing to think this is NOT the superclass of anything that extends PointerTargetable.\r\n    public static new(id?: DUser[\"id\"], triggerActions: boolean = true): DUser {\r\n        return new Constructors(new DUser('dwc'), undefined, false).DPointerTargetable().DUser(id).end(); }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LUser extends LPointerTargetable { // MixOnlyFuncs(DUser, LPointerTargetable)\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // public static structure: typeof DPointerTargetable;\r\n    // public static singleton: LPointerTargetable;\r\n    public __raw!: DUser;\r\n    id!: Pointer<DUser, 1, 1, LUser>;\r\n    __isUser!: true;\r\n    cursorPosition!: IPoint; //todo\r\n}\r\nDPointerTargetable.subclasses.push(DUser);\r\nLPointerTargetable.subclasses.push(LUser);\r\n\r\nexport type WUser = getWParams<LUser, DUser>;\r\n\r\n@RuntimeAccessible\r\nexport class MyError extends Error {\r\n    constructor(message?: string, ...otherMsg: any[]) {\r\n        // 'Error' breaks prototype chain here\r\n        super(message);\r\n        const proto = (this as any).__proto__;\r\n\r\n        console.error(proto.constructor.name, message, ...otherMsg);\r\n        // restore prototype chain\r\n        const actualProto = new.target.prototype;\r\n\r\n        if (Object.setPrototypeOf) { Object.setPrototypeOf(this, actualProto); }\r\n        else { (this as any).__proto__ = actualProto; }\r\n        (this as any).className = this.constructor.name;\r\n    }\r\n}\r\n\r\n// @RuntimeAccessible\r\nexport class JsType{\r\n    public static all: JsType[] = [];\r\n    public static object: JsType = new JsType(\"object\", JsType.isObject, false);\r\n    public static function: JsType = new JsType(\"function\", JsType.isFunction, false);\r\n    public static array: JsType = new JsType(\"array\", JsType.isArray, false);\r\n    public static date: JsType = new JsType(\"Date\", JsType.isDate, false);\r\n\r\n    public static lambdaFunction: JsType = new JsType(\"lambda-function\", JsType.isLambdaFunction, true);\r\n    public static nonLambdaFunction: JsType = new JsType(\"non-lambda-function\", JsType.isNonLambdaFunction, true);\r\n    public static symbol: JsType = new JsType(\"symbol\", JsType.isSymbol, true);\r\n    public static undefined: JsType = new JsType(\"undefined\", JsType.isUndefined, true);\r\n    public static null: JsType = new JsType(\"null\", JsType.isNull, true);\r\n    public static boolean: JsType = new JsType(\"boolean\", JsType.isBoolean, true);\r\n    public static number: JsType = new JsType(\"number\", JsType.isNumber, true);\r\n    public static bigint: JsType = new JsType(\"bigint\", JsType.isBigint, true);\r\n    public static string: JsType = new JsType(\"string\", JsType.isString, true);\r\n\r\n    private constructor(public printableTypeName: string, public check: (data: any) => boolean, public isExclusiveType: boolean){\r\n        JsType.all.push(this);\r\n    }\r\n    public toString(): string { return this.printableTypeName; }\r\n    /*\r\n    * example: isObject but not Date, not function...\r\n    * */\r\n    public static isOnlyType(data: any, type: JsType): boolean { return !JsType.getTypes(data, type).length; }\r\n    public static isAnyOfTypes(data: any, ...acceptables: JsType[]): boolean { return !!windoww.Uarr.arrayIntersection(JsType.getTypes(data), acceptables).length; }\r\n    public static getTypes(data: any, stopIfTypeIsNot?: JsType): JsType[]{\r\n        const ret: JsType[] = [];\r\n        for (const type of JsType.all) {\r\n            if (type.check(data)) {\r\n                ret.push(data);\r\n                if (stopIfTypeIsNot !== type) { return []; }\r\n                if (type.isExclusiveType) return ret;\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    /// is...\r\n    public static isObject(data: GObject | any): boolean { return typeof data === \"object\"; }\r\n    public static isFunction(data: Function | any): boolean { return typeof data === \"function\"; }\r\n    public static isLambdaFunction(data: Function | any): boolean {\r\n        if (!JsType.isFunction(data)) return false;\r\n        return windoww.U.getFunctionSignatureFromComments(data).isLambda; }\r\n    public static isNonLambdaFunction(data: Function | any): boolean { return JsType.isFunction(data) && !JsType.isNonLambdaFunction(data); }\r\n    public static isArray(data: Array<any> | any): boolean { return Array.isArray(data); }\r\n    public static isSymbol(data: symbol | any): boolean { return typeof data === \"symbol\"; }\r\n    public static isBoolean(data: symbol | any): boolean { return !!data === data; }\r\n    public static isNumber(data: number | any): boolean { return typeof data === \"number\"; }\r\n    public static isBigint(data: bigint | any): boolean { return typeof data === \"bigint\"; }\r\n    public static isString(data: string | any): boolean { return typeof data === \"string\"; }\r\n    public static isNull(data: null | any): boolean { return data === null; }\r\n    public static isUndefined(data: undefined | any): boolean { return data === undefined; }\r\n    public static isDate(data: Date | any): boolean { return data instanceof Date; }\r\n\r\n    /// as...\r\n    public static asObject<T>(data: GObject | any, fallbackReturn: T): T | GObject { return JsType.isObject(data) ? data : fallbackReturn; }\r\n    public static asFunction<T>(data: Function | any, fallbackReturn: T): T | Function { return JsType.isFunction(data) ? data : fallbackReturn; }\r\n    public static asLambdaFunction<T>(data: Function | any, fallbackReturn: T): T | Function { return JsType.isLambdaFunction(data) ? data : fallbackReturn; }\r\n    public static asNonLambdaFunction<T>(data: Function | any, fallbackReturn: T): T | Function { return JsType.isNonLambdaFunction(data) ? data : fallbackReturn; }\r\n    public static asArray<T, A>(data: Array<A> | any, fallbackReturn: T): T | Array<A> { return JsType.isArray(data) ? data : fallbackReturn; }\r\n    public static asSymbol<T>(data: symbol | any, fallbackReturn: T): T | symbol { return JsType.isSymbol(data) ? data : fallbackReturn; }\r\n    public static asBoolean<T>(data: boolean | any, fallbackReturn: T): T | boolean { return JsType.isBoolean(data) ? data : fallbackReturn; }\r\n    public static asNumber<T>(data: number | any, fallbackReturn: T): T | number { return JsType.isNumber(data) ? data : fallbackReturn; }\r\n    public static asBigint<T>(data: bigint | any, fallbackReturn: T): T | bigint { return JsType.isBigint(data) ? data : fallbackReturn; }\r\n    public static asString<T>(data: string | any, fallbackReturn: T): T | string { return JsType.isString(data) ? data : fallbackReturn; }\r\n    public static asNull<T>(data: null | any, fallbackReturn: T): T | null { return JsType.isNull(data) ? data : fallbackReturn; }\r\n    public static asUndefined<T>(data: undefined | any, fallbackReturn: T): T | undefined { return JsType.isUndefined(data) ? data : fallbackReturn; }\r\n    public static asDate<T>(data: Date | any, fallbackReturn: T): T | Date { return JsType.isDate(data) ? data : fallbackReturn; }\r\n    public static isPrimitive(data: any) { return !JsType.isAnyOfTypes(data, JsType.object, JsType.function, JsType.array); }\r\n}\r\n\r\n\r\nfunction invalidSuperClassError(/*callee: Class,*/ scname: string, superclass: Class): (() => never) {\r\n    return () => { windoww.Log.exDevv('parent super class \"' + scname + '\" is not implementing init_constructor', {scname, superclass, }); throw new Error(); }\r\n}\r\n// @ts-ignore\r\nfunction MixinFakeConstructor() { this.isMixinFakeConstructor = true; }\r\nexport function MixOnlyFuncs<A1 extends any[], I1, S1, A2 extends any[], I2, S2>(c1: Class<A1, I1, S1> & typeof RuntimeAccessibleClass, c2: Class<A2, I2, S2> & typeof RuntimeAccessibleClass):\r\n    CClass<Longest<A1, A2>, I1 & I2\r\n        & {\r\n        // superclass: Dictionary<string, (/*thiss: I1 & I2,* / ...superConstructorParams:ConstructorParameters<Class<A1, I1, S1>> | ConstructorParameters<Class<A2, I2, S2>>) => void>,\r\n        superclass1: Dictionary<DocString<'constructor name to make sure the user knows what superclass constructor is calling'>,  (...superConstructor1Params:ConstructorParameters<Class<A1, I1, S1>>) => void>,\r\n        superclass2: Dictionary<DocString<'constructor name to make sure the user knows what superclass constructor is calling'>,  (...superConstructor2Params:ConstructorParameters<Class<A2, I2, S2>>) => void>,\r\n        // initt: Class<A1, I1, S1>\r\n    } & AbstractMixedClass\r\n        // , Omit<Omit<Omit<S1 & S2, 'init_constructor'>, 'logic'>, 'maxID'> & typeof AbstractMixedClass> {\r\n        , S1 & S2 & GObject & typeof AbstractMixedClass> {\r\n    // strategia: passo dei finti valori che copiano i prototipi delle classi sovrascrivendo i costruttori per evitare che chiami i costruttori delle superclassi\r\n    // ma che comunque erediti campi e funzioni\r\n    // @ts-ignore\r\n    let c1noconstructor: any = MixinFakeConstructor;\r\n    let c2noconstructor: any = MixinFakeConstructor;\r\n    c1noconstructor.prototype = c1.prototype;\r\n    c2noconstructor.prototype = c2.prototype;\r\n\r\n    let disableconstructor = false;\r\n    if (!disableconstructor) {\r\n        c1noconstructor = c1;\r\n        c2noconstructor = c2; }\r\n\r\n\r\n    let ret = Mixin(c1noconstructor, c2noconstructor);\r\n    let c1name = c1.name === 'classnameFixedConstructorDoNotRenameWithoutSearchStrings' ? c1.prototype.className : c1.name;\r\n    let c2name = c2.name === 'classnameFixedConstructorDoNotRenameWithoutSearchStrings' ? c2.prototype.className : c2.name;\r\n    //ret.prototype['superclass'] = {};\r\n    // ret.prototype['superclass'][c1name] = c1.prototype.init_constructor || invalidSuperClassError(c1name, c1);\r\n    // ret.prototype['superclass'][c2name] = c2.init_constructor || invalidSuperClassError(c2name, c2);\r\n    ret.prototype['superclass1'] = {};\r\n    ret.prototype['superclass2'] = {};\r\n    ret.prototype['superclass1'][c1name] = c1.init_constructor || invalidSuperClassError(c1name, c1);\r\n    ret.prototype['superclass2'][c2name] = c2.init_constructor || invalidSuperClassError(c2name, c2);\r\n    return ret;\r\n}\r\nconsole.warn('ts loaded classes');\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//*********************************************************************************************\r\n//*********************************************************************************************\r\n///////                              type juggling starts here                          ///////\r\n//*********************************************************************************************\r\n//*********************************************************************************************\r\n\r\n// export type NotAString<T extends any = 'uselessval'> = Omit<string, 'bold'> & {big: T};\r\n// export type NotAString<T extends any = 'uselessval'> = Omit<string, 'bold'>;\r\n// export type NotAString<T extends any = 'uselessval', T2 extends any = any, T3 extends any = any, T4 extends any = any> = string & Omit<string, 'bold'> & {bold: ()=>string};\r\nexport type NotAString<T extends any = 'uselessval', T2 extends any = any, T3 extends any = any, T4 extends any = any> = string & Omit<string, 'bold'> & {bolda?: T};\r\n// export type NotAString<T> = string;\r\n// type Pointer<T> = NotAString<T>;\r\nexport type Pointer<T extends DPointerTargetable = DPointerTargetable, lowerbound extends number = 1, upperbound extends number|'N' = 1,\r\n    RET extends LPointerTargetable = DtoL<T>> =\r\n    upperbound extends 'N' ? NotAString<T, lowerbound, upperbound, RET>[] : (\r\n        upperbound extends 0 ? never : (\r\n            lowerbound extends 0 ? (NotAString<T, lowerbound, upperbound, RET> | null) : NotAString<T, upperbound, lowerbound, RET>));\r\n\r\n\r\nexport type PtrString = any; // to convert Pointers to strings more explicitly then using as any\r\n// let ptr: Pointer<Object> = null as any;\r\n\r\nclass D extends DPointerTargetable{\r\n    parent!: Pointer<D>;\r\n    dattrib!: boolean;\r\n    juststring!: string;\r\n    nattrib!: number;\r\n    ddattrib!: Date\r\n}\r\n\r\nclass D2 extends D{\r\n    d2!: string;\r\n}\r\nclass D3 extends D{\r\n    d3!: string;\r\n}\r\n\r\n\r\n\r\ntype OverrideTypes<M, N> = { [P in keyof M]: P extends keyof N ? N[P] : M[P] }; // usage:  OverrideTypes<A, { x: number }>;\r\n\r\ninterface LFix {\r\n    parent: L;\r\n}\r\ninterface L { // no instances ever\r\n    parent: L;\r\n    lattrib: boolean;\r\n}\r\ninterface L2 extends L { // no instances ever\r\n    l2: string;\r\n}\r\ninterface L3 extends L{ // no instances ever\r\n    l3: string;\r\n}\r\n\r\nclass P { // singleton\r\n    get_parent(){}\r\n    set_parent(){}\r\n}\r\nclass P2 extends P { // singleton\r\n    get_d2() {}\r\n}\r\nclass P3 extends P { // singleton\r\n    get_d3() {}\r\n}\r\n\r\ntype ERROR = \"_TYPE_ERROR_\";\r\n// RegExp extends Animal ? number : string\r\n\r\n\r\nfunction buildWrapSignature(maxdepth = 100) {\r\n    let arr = windoww[\"DPointerTargetable\"].subclasses;\r\n    /*\r\n    let dict0 = arr.reduce((a, v) => ({ ...a, [v.name]: v}), {});\r\n    let dict = {}\r\n    for (let name in dict0) { let n = name.substring(1); dict[n] = {\"D\":dict0[\"D\"+n], \"L\":dict0[\"L\"+n]}; dict[\"D\"+n] = dict0[\"L\"+n]; dict[\"L\"+n] = dict0[\"D\"+n]; }\r\n    console.log(\"dict\", dict);\r\n    console.table(dict);\r\n    */\r\n    function onlyUnique(value: any, index: number, self: any) { return self.indexOf(value) === index; }\r\n\r\n    let dep = arr; // .map( (me) => { return {\"name\": me.name, \"me\": me, \"Derror\": (dict[me.name] || me).name, \"Lerror\": (dict[me.name] || me).name, \"subclasses\": [...me.subclasses]}});\r\n    let depsorted = [];\r\n\r\n    let byLevels = [];\r\n    let loopdetecter: any[] = [arr];\r\n    while (dep.length && maxdepth--) {\r\n        let namelist = dep.map((e: any) => e.name).filter(onlyUnique);\r\n        depsorted.push(...namelist);\r\n        byLevels.push([...namelist]);\r\n        let olddep = dep;\r\n        dep = dep.flatMap((d: any) => d.subclasses).filter(onlyUnique);\r\n        for (let d of dep) {\r\n            windoww.loopdetecter = loopdetecter;\r\n            windoww.dep = dep;\r\n            windoww.olddep = olddep;\r\n            windoww.byLevels = byLevels;\r\n            windoww.d = d;\r\n            if ( loopdetecter.includes(d.subclasses) ) throw new Error(\"class is not redefining subclasses static array: \" + d.name);\r\n            loopdetecter.push(d.subclasses);\r\n        }\r\n    }\r\n    console.log(\"byLevels\");\r\n    console.table(byLevels);\r\n\r\n    console.log(\"depsorted\", depsorted);\r\n\r\n// console.log(\"map\");\r\n// console.table(depsorted.map(dn => {let d = window[dn]; return !d ? \"\" :{name:d.name, scount: d.subclasses.length, subclasses:d.subclasses}}));\r\n\r\n\r\n    let goalSignature = \"function wrap<DX extends D, LX = DX extends D2 ? L2: (DX extends D3 ? L3: (DX extends D ? L : ERROR))>(data: DX): LX {\";\r\n    let lparam = \"ERROR\";\r\n    let epsorted = depsorted.map( e => e.substring(1)).filter(onlyUnique);\r\n    console.table(epsorted)\r\n    for (let e of epsorted) {\r\n        let D = \"D\" + e;\r\n        let L = \"L\" + e;\r\n        lparam = \"DX extends \" + D + \" ? \"  + L + \" : (\" + (lparam) + \")\";\r\n    }\r\n    let signature = \"function wrap<DX extends DPointerTargetable, LX = \" + lparam + \">(data: DX): LX {\";\r\n    return signature;\r\n}\r\nwindoww.buildWrapSignature = buildWrapSignature;\r\n// function wrap<DX extends D, LX = DX extends D2 ? L2: (DX extends D3 ? L3: (DX extends D ? L : ERROR))>(data: DX): LX {\r\n\r\n/*\r\n* NO    L -> D    /// l.__raw\r\n* NO    L -> Ptr  /// l.id\r\n*\r\n* NO    D -> Ptr   // d.id\r\n* YES   D -> L     // wrap\r\n*\r\n* NO    Ptr -> D\r\n* NO    Ptr -> L\r\n*\r\n*\r\n*\r\n*\r\n* DpointerTargetable.from( L or pointer )\r\n* LpointerTargetable.from( D or pointer )\r\n*\r\n* MyProxyHandler.wrap = LpointerTargetable.from;\r\n*\r\n* DpointerTargetable.toPointer( d );\r\n*\r\n* */\r\n\r\n\r\n\r\ntype subtract<P, C> = { [F in keyof P]: keyof C extends undefined ? undefined : P[F] };\r\ntype subtractDL = subtract<D, L>;\r\ntype Exclude3<T, U> = T & {[T in keyof U]: never};\r\ntype Override<A, B> = Omit<A, keyof B> & B; //////////////////////////////////////////// best solution so far\r\n\r\ntype Exclude2<Type, field> = {\r\n    [Property in keyof Type as Exclude<Property, keyof field>]: Type[Property]      /////////////////////////equally best solution\r\n};\r\n\r\n\r\ntype OnlyKeysOfTypeTmp<T, IncludeType> = ({[P in keyof T]: T[P] extends IncludeType ? P : never })[keyof T];\r\ntype OnlyKeysOfType<T, IncludeType> = Pick<T, OnlyKeysOfTypeTmp<T, IncludeType>>;\r\ntype RemoveKeysOfType<T, ExcludeType> = Exclude2<T, OnlyKeysOfType<T, ExcludeType>>;\r\n\r\n// todo: can't automatically convert D to L (generating the type instead of manual defining L) rules are: LClass <--- Pointer<LClass>, LClass[] <-- Pointer<LClass, 0, 'N'>, subobject = ? should not be there\r\n\r\n/**\r\n i have a documentation type that is actually a string, but it\\'s have a different purpose from the others, and i made a type to keep documentally separated.\r\n let's say it's\r\n type StringOf<P> = string; // regardless of P\r\n\r\n and i use it to define objects\r\n\r\n class C {\r\n   str: StringOf<Date>;\r\n   str2: StringOf<number>;\r\n   purestring: string;\r\n   num: number\r\n }\r\n now i want to crete a derivate type that excludes all properties of type StringOf from C\r\n\r\n\r\n\r\n type OnlyKeysOfTypeTmp<T, IncludeType> = ({[P in keyof T]: T[P] extends IncludeType ? P : never })[keyof T];\r\n type OnlyKeysOfType<T, IncludeType> = Pick<T, OnlyKeysOfTypeTmp<T, IncludeType>>;\r\n type RemoveKeysOfType<T, ExcludeType> = Exclude2<T, OnlyKeysOfType<T, string>>;\r\n\r\n type D = RemoveKeysOfType<C, StringOf<any>>\r\n due to duck typing, this removes all StringOf attributes, but also \"purestring\" attribute.\r\n how can i remove only StringOf attributes?\r\n\r\n\r\n */\r\n\r\n\r\n\r\nexport type getWParams<L extends LPointerTargetable, D extends Object> ={\r\n    // [Property in keyof ValidObj<L>]: L[Property] extends never ? never : L[Property]\r\n    [Property in keyof L]:/*\r\n    Property extends \"opposite\" ? LReference | DReference | Pointer<DReference> :\r\n    Property extends \"parent\" ? LModelElement | DModelElement | Pointer<DModelElement> :\r\n    Property extends \"annotations\" ? LAnnotation | DAnnotation | Pointer<DAnnotation> :*/\r\n    (Property extends string ? (\r\n        Property extends \"id\" ? 'id is read-only' :\r\n            //@ts-ignore\r\n            (L[`set_${Property}`] extends (a:any, b: any, ...b:any)=> any ? // at least 2 params: 1 for val and 1 for Context\r\n                // if a set_ first parameter is Context it means the set_ is ill-defined, need to change actual method signature.\r\n                //@ts-ignore\r\n                Parameters<L[`set_${Property}`]>[0] // if set_X function is defined, get first param\r\n                //@ts-ignore\r\n                : never ///D[Property] | `todo: should define set_${Property}` // default type if it's not assigned = type in the D version\r\n                )): never)\r\n} // & L\r\n","import type {DocString, DtoL, DtoW, GObject, Proxyfied, WPointerTargetable,} from \"../joiner\";\r\nimport {\r\n    Dictionary,\r\n    DModelElement,\r\n    DPointerTargetable,\r\n    JsType,\r\n    LModelElement,\r\n    Log,\r\n    LPointerTargetable,\r\n    Pointer,\r\n    RuntimeAccessible,\r\n    RuntimeAccessibleClass,\r\n    SetFieldAction,\r\n    SetRootFieldAction,\r\n    U\r\n} from \"../joiner\";\r\n\r\ntype NotAConcatenation = null;\r\ntype ERROR = \"_Type_Error_\";\r\n\r\n// (DX extends DUser ? LUser : (DX extends DPointerTargetable ? LPointerTargetable : (ERROR))\r\n// (DX extends DUser ? LUser : (DX extends DPointerTargetable ? LPointerTargetable : (           WViewElement\r\n//\r\n// (IN extends WViewElement ? LViewElement : (IN extends WViewTransientProperties ? LWiewTransientProperties : (ERROR)))\r\n// ))\r\n// type WtoL<WX extends WPointerTargetable> ='';\r\n\r\n@RuntimeAccessible\r\nexport class LogicContext<\r\n    DX extends GObject = DModelElement,\r\n    LX = DtoL<DX>,\r\n    // PF extends MyProxyHandler<DX> = MyProxyHandler<DX>,\r\n    WX = DtoW<DX>\r\n    > extends RuntimeAccessibleClass{\r\n    // public proxyfyFunction: PF;\r\n    public proxyObject: LX;\r\n    public data: DX;// & GObject;\r\n    public write: WX;\r\n    constructor(proxyObject: LX, data: DX) {\r\n        super();\r\n        this.className = this.constructor.name;\r\n        this.data = data;\r\n        this.proxyObject = proxyObject;\r\n        this.write = proxyObject as any;\r\n    }\r\n    /*\r\n        saveToRedux(propkey: \"keyof data\" | string, val: \"typeof data[path]\" | any): void { // todo: ask non stackoverflow\r\n            // todo, put data in redux store, path is \"obj1.obj2.obj3...\" might replace it with a path funciton that return the foremost nested object container\r\n            if (!propkey) {\r\n                // todo: set whole object instead of a property\r\n            }\r\n        }*/\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class MapLogicContext extends LogicContext<GObject, LPointerTargetable, WPointerTargetable> {\r\n    data: GObject;\r\n    path: string;\r\n    subMaps: string[];\r\n    constructor(proxy: LPointerTargetable, data: GObject, path: string, subMaps: string[] = []) {\r\n        super(proxy, data);\r\n        // this.proxyfyFunction = proxyfyFunction;\r\n        this.proxyObject = proxy;\r\n        this.data = data;\r\n        this.path = path;\r\n        this.subMaps = subMaps;\r\n        this.className = this.constructor.name;\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport abstract class MyProxyHandler<T extends GObject> extends RuntimeAccessibleClass implements ProxyHandler<T>{\r\n    s: string = 'set_';\r\n    g: string = 'get_';\r\n    /*get(target: T, p: string | number | symbol, proxyitself: Proxyfied<T>): boolean {\r\n        switch (p) {\r\n            case '_isProxy': return true;\r\n            case 'init': return (this as any).init;\r\n            case 'init0': return (this as any).init0;\r\n            default: throw new Error('proxy get must be overridden, called for key: ' + (p as string));\r\n        }}*/\r\n    set(target: T, p: string | number | symbol, value: any, proxyitself: Proxyfied<T>): boolean { throw new Error('proxy set must be overridden'); }\r\n    deleteProperty(target: T, p: string | symbol): boolean { throw new Error('proxy delete must be overridden'); }\r\n\r\n    ownKeys(target: T): ArrayLike<string | symbol>{ return Object.getOwnPropertyNames(target); }\r\n    static wrap<D extends RuntimeAccessibleClass, L extends LPointerTargetable = LPointerTargetable, CAN_THROW extends boolean = false,\r\n        RET extends CAN_THROW extends true ? L : L | undefined  = CAN_THROW extends true ? L : L>\r\n    (data: D | Pointer | undefined, baseObjInLookup?: DPointerTargetable, path: string = '', canThrow: CAN_THROW = false as CAN_THROW): RET{\r\n\r\n//    static wrap<D extends RuntimeAccessibleClass, L extends LPointerTargetable, RET extends boolean = false>\r\n//        (data: D | Pointer<DViewElement>, baseObjInLookup?: DPointerTargetable, path: string = '', canthrow: RET = false as RET): RET {\r\n        return DPointerTargetable.wrap(data, baseObjInLookup, path) as RET; }\r\n\r\n    static isProxy(data: GObject): boolean { return data?.__isProxy || false; }\r\n}\r\n\r\nexport type GetPath<T = GObject> = T;\r\n/*\r\n* handling proxy += and proxy -=\r\n*\r\n* will become var = var + add; which will call Symbol.getPrimitive\r\nconsole.log(+obj2);     // 10        — hint is \"number\"         NaN with +array with multiple vals, +array[0] with array of size 1, NaN with functions & objects\r\nconsole.log(`${obj2}`); // \"hello\"   — hint is \"string\"         array => array.join(','), object => \"[object Object]\", function => function.toString() whole func definition with body code\r\nconsole.log(obj2 + \"\"); // \"true\"    — hint is \"default\"        array, object, function => same as with hint \"string\"\r\n*\r\n* */\r\n\r\n// NB: lclass.extends += somepointer will become: lclass.extends = lclass.extends + somepointer;\r\n// array + string will cause getPrimitive(\"default\") to array, then .join(',') on it, and finally and toString() to be called on all array members.\r\n// so pointers cannot include \",\" char and toString() must return a pointer to keep lclass.extends += somepointer as a valid expression;\r\n// -= will call getPrimitive(\"number\") which will result in array -> NaN, so NaN = NaN - pointer and cannot be done.\r\n\r\n@RuntimeAccessible\r\nclass GetPathHandler<T extends GObject> extends MyProxyHandler<T>{\r\n    strbuilder: string = '';\r\n    array: (string | number | symbol)[] = [];\r\n    calls: (GObject<'parameters of get calls'>)[] = [];\r\n    public static __asCalls: boolean = false;\r\n    public static __asArray: boolean = false;\r\n    public static __nested: boolean = true;\r\n\r\n    public constructor() { super(); }\r\n\r\n    get(targetObj: T, propKey: keyof T | string, proxyitself: Proxyfied<T>): any {\r\n        // console.log('GetPathHandler', {targetObj, propKey, proxyitself});\r\n        if (propKey === \"start\") { this.strbuilder = ''; this.array = []; }\r\n        if (propKey === '$') {\r\n            const ret = GetPathHandler.__asCalls ? this.calls : (GetPathHandler.__asArray ? this.array : this.strbuilder);\r\n            this.array = [];\r\n            this.strbuilder = '';\r\n            return ret; }\r\n        this.array.push(propKey);\r\n        this.calls.push(arguments);\r\n        if (propKey === Symbol.toPrimitive) {\r\n            console.log(\"toprimitive\");\r\n            return (...a: any)=> {console.log(\"toprimitive called with parameters\", a); }\r\n        }\r\n        if (!GetPathHandler.__asArray && !GetPathHandler.__asCalls) {\r\n            if (typeof propKey === \"symbol\") { this.strbuilder += propKey.toString(); }\r\n            else {\r\n                // Giordano: add ignore for webpack\r\n                //@ts-ignore\r\n                this.strbuilder += (this.strbuilder ? '.' : '') + propKey;\r\n            }\r\n        }\r\n        return GetPathHandler.__nested ? proxyitself : {};\r\n    }\r\n\r\n    set(target: T, p: string | number | symbol, value: any, proxyitself: Proxyfied<T>): boolean {\r\n        switch(p){\r\n            case '__asArray':\r\n            case '__asCalls':\r\n            case '__nested':\r\n                (GetPathHandler as any)[p] = value;\r\n                return true;\r\n            default:\r\n                throw new Error('getPath proxy cannot be written');\r\n        }\r\n    }\r\n}\r\n\r\n\r\n@RuntimeAccessible\r\nexport class TargetableProxyHandler<ME extends GObject = DModelElement, LE extends LPointerTargetable = LModelElement> extends MyProxyHandler<ME> {\r\n// permette di fare cose tipo: user.name_surname che ritorna la concatenazione di nome e cognome anche se il campo name_surname non esiste.\r\n    lg: LE & GObject; // to disable type check easily and access 'set_' + varname dynamically\r\n    l: LE;\r\n    d: ME;\r\n    additionalPath: string;\r\n\r\n    public baseObjInLookup: DPointerTargetable;\r\n\r\n    constructor(d: ME, baseObjInLookup?: DPointerTargetable, additionalPath: string = '', l?: LE) {\r\n        super();\r\n        this.d = d;\r\n        if (!l) {\r\n            l = RuntimeAccessibleClass.get(d.className)?.logic?.singleton as LE;\r\n            Log.exDev(!l, 'Trying to wrap class without singleton or logic mapped', { object: d })\r\n        }\r\n        this.baseObjInLookup = baseObjInLookup || d as any;\r\n        this.additionalPath = additionalPath;\r\n        this.l = l as LE;\r\n        this.lg = this.l;\r\n        this.className = this.constructor.name;\r\n    }\r\n\r\n    // damiano todo: this does not work\r\n    private concatenableHandler(targetObj: ME, propKey: number | string | symbol, proxyitself: Proxyfied<ME>): NotAConcatenation | any[] | string {\r\n        console.log(\"concatenableHandler 1\", {targetObj, propKey, proxyitself});\r\n        if (propKey in targetObj)  return null as NotAConcatenation;\r\n        const propKeyStr: null | string = U.asString(propKey, null);\r\n        let _index: number = propKeyStr ? propKeyStr.indexOf('_') : -1;\r\n        console.log(\"concatenableHandler 2\", {targetObj, propKey, propKeyStr, proxyitself, _index});\r\n        if (_index < 0) return null as NotAConcatenation;\r\n\r\n        let isConcatenable = true;\r\n        let ret: any[] = (propKey as string).split('_').map( (subKey: string) => {\r\n            console.log(\"concatenableHandler 3.0\", {targetObj, subKey, propKeyStr, proxyitself});\r\n            // se trovo multipli ___ li tratto come spazi aggiuntivi invece che come proprietà '' che ritornano undefined, così posso fare name___surname --> \"damiano   di vincenzo\"\r\n            let val: any = subKey === '' ? ' ' : this.get(targetObj, subKey, proxyitself);\r\n            console.log(\"concatenableHandler 3.1\", {targetObj, subKey, val, propKeyStr, proxyitself, isConcatenable});\r\n            isConcatenable = isConcatenable && JsType.isPrimitive(val);\r\n            console.log(\"concatenableHandler 3.2\", {targetObj, subKey, val, propKeyStr, proxyitself, isConcatenable});\r\n            return val;\r\n        });\r\n        console.log(\"concatenableHandler 4\", {targetObj, propKey, propKeyStr, proxyitself, ret, isConcatenable});\r\n        return isConcatenable ? ret.join(' ') : ret; }\r\n\r\n    public get(targetObj: ME, propKey: string | symbol, proxyitself: Proxyfied<ME>): any {\r\n        let ret;\r\n        let isError = false;\r\n        // console.error('_proxy get PRE:', {targetObj, propKey, proxyitself, arguments});\r\n        try { ret = this.get0(targetObj, propKey, proxyitself); } catch(e) { ret = e; isError = true;}\r\n\r\n        // if (isError) throw ret;\r\n        // console.error('_proxy get POST:', {targetObj, propKey, ret, isError});\r\n        return ret;\r\n    }\r\n\r\n    public get0(targetObj: ME, propKey: string | symbol, proxyitself: Proxyfied<ME>): any {\r\n        // console.log('proxy keysearch', {propKey, targetObj, l: this.l, proxyitself, d: this.d});\r\n        let canThrowErrors = true;\r\n        if (propKey === \"__raw\") return targetObj;\r\n\r\n        if (typeof propKey === \"symbol\") {\r\n            switch(String(propKey)){\r\n                default: Log.exDevv('unexpected symbol:', propKey); break;\r\n                case \"Symbol(Symbol.toPrimitive)\": return (targetObj as any)[propKey];//  || typeof targetObj;\r\n            }\r\n        }\r\n//\r\n        switch(propKey){\r\n            case 'inspect': // node.js util\r\n            case '__Raw':\r\n            case '__raw': return targetObj;\r\n            case '__serialize': return JSON.stringify(targetObj);\r\n            case '__isproxy':\r\n            case '__isProxy': return true;\r\n            case '__random': return Math.random();\r\n            case 'editCount':\r\n            case 'clonedcounter':\r\n            case 'clonedCounter':\r\n                return targetObj.clonedCounter || 0;\r\n        }\r\n\r\n\r\n        const proxyacceptables = {typeName:'', $$typeof:''};\r\n        // check if exist directly in D.key, L.key or through a get_key\r\n        if (propKey in this.l || propKey in this.d || (this.l as GObject)[this.g + (propKey as string)] || propKey in proxyacceptables) {\r\n            // todo: il LogicContext passato come parametro risulta nell'autocompletion editor automaticamente generato, come passo un parametro senza passargli il parametro? uso arguments senza dichiararlo?\r\n            if (typeof propKey !== 'symbol' && this.g + propKey in this.lg) return this.lg[this.g + propKey](new LogicContext(proxyitself as any, targetObj));\r\n\r\n\r\n\r\n            if (typeof propKey !== 'symbol' && this.g + propKey in this.lg) {\r\n                let getterMethod: Function = this.lg[this.g + propKey]; // || this.defaultGetter;\r\n                return getterMethod ? getterMethod(new LogicContext(proxyitself as any, targetObj)) : this.defaultGetter(targetObj, propKey, proxyitself);\r\n\r\n            }\r\n\r\n\r\n            switch (propKey){\r\n                default:\r\n                    //constructor.prototype.typeName\r\n                    // se esiste la proprietà ma non esiste il getter, che fare? do errore?\r\n                    // Log.eDevv(\"dev error: property exist but getter does not: \", propKey, this);\r\n                    // console.error('proxy GET direct match', {targetObj, propKey, ret: this.d[propKey as keyof ME]});\r\n                    // console.error('proxy GET direct match', {l:this.l});\r\n                    return this.d[propKey as keyof ME];\r\n                case '$$typeof':\r\n                case \"typeName\":\r\n                    return this.d.className;\r\n            }\r\n        }\r\n\r\n        // if not exist check for children names\r\n\r\n        if (typeof propKey === \"string\" && propKey !== \"children\") {\r\n            let lchildren: LPointerTargetable[] = this.get(targetObj, 'children', proxyitself);\r\n            // let dchildren: DPointerTargetable[] = lchildren.map<DPointerTargetable>(l => l.__raw as any);\r\n            let lc: GObject;\r\n            if (propKey[0] === \"@\") { propKey = propKey.substring(1); canThrowErrors = false; }\r\n            for (lc of lchildren) {\r\n                if (lc.name === propKey) return lc;\r\n            }\r\n        }\r\n\r\n        // if property do not exist, try a concatenation\r\n        let concatenationTentative = null;\r\n        try {concatenationTentative = this.concatenableHandler(targetObj, propKey, proxyitself); } catch(e) {}\r\n        if (concatenationTentative !== null) return concatenationTentative;\r\n        Log.ex(canThrowErrors,'GET property \"'+ (propKey as any)+ '\" do not exist in object of type \"' + U.getType(this.l) + \" DType:\" +  U.getType(this.l), {logic: this.l, data: targetObj});\r\n        return undefined;\r\n        // todo: credo che con espressioni sui tipi siano tipizzabili tutti i return di proprietà note eccetto quelle ottenute per concatenazione.\r\n    }\r\n\r\n    public defaultGetter(targetObj: ME, key: string, proxyitself: Proxyfied<ME>): any {\r\n        if (!targetObj) return targetObj;\r\n        if (!targetObj._subMaps || !targetObj._subMaps[key]) return (targetObj as Dictionary)[key];\r\n        // if is a nexted subobject\r\n        let context: MapLogicContext = new MapLogicContext(proxyitself as any, targetObj, key, []);\r\n        let retRaw: Dictionary = this.lg[this.s + key]\r\n        return MapProxyHandler.mapWrap((targetObj as Dictionary)[key], targetObj as any, this.additionalPath + '.' + key)\r\n    }\r\n\r\n    public defaultSetter(targetObj: DPointerTargetable, propKey: string, value: any, proxyitself?: Proxyfied<ME>): boolean {\r\n        SetFieldAction.new(targetObj, propKey as any, value);\r\n        return true;\r\n    }\r\n\r\n    public set(targetObj: ME, propKey: string | symbol, value: any, proxyitself?: Proxyfied<ME>): boolean {\r\n        let enableFallbackSetter = true;\r\n\r\n        // console.error('_proxy set PRE:', {targetObj, propKey, value, proxyitself, arguments});\r\n        // if (propKey in this.l || propKey in this.d || (this.l as GObject)[this.s + (propKey as string)] || (this.l as GObject)[(propKey as string)]) {\r\n        if (propKey in this.l || propKey in this.d || (this.l as GObject)[this.s + (propKey as string)]) {\r\n            // todo: il LogicContext passato come parametro risulta nell'autocompletion editor automaticamente generato, come passo un parametro senza passargli il parametro? uso arguments senza dichiararlo?\r\n            if (typeof propKey !== 'symbol' && this.s + propKey in this.lg) return this.lg[this.s + propKey](value, new LogicContext(proxyitself as any, targetObj));\r\n\r\n\r\n            if (enableFallbackSetter) {\r\n                return this.defaultSetter(targetObj as any as DPointerTargetable, propKey as string, value, proxyitself);\r\n                // new SetFieldAction(new LogicContext(proxyitself as any, targetObj).data as any, propKey as string, value); return true;\r\n            }\r\n            // se esiste la proprietà ma non esiste il setter, che fare? do errore.\r\n            Log.eDevv(\"dev error: property exist but setter does not: \", propKey, this);\r\n            return false;\r\n        }\r\n        // if property do not exist\r\n        let breakpoint = 1;\r\n\r\n        if (enableFallbackSetter && typeof (propKey === \"string\") && ((propKey as string)[0] === '_' || (propKey as string).indexOf('tmp') > 0)) {\r\n            return this.defaultSetter(targetObj as any as DPointerTargetable, propKey as string, value, proxyitself);\r\n            // new SetFieldAction(new LogicContext(proxyitself as any, targetObj).data as any, propKey as string, value); return true;\r\n        }\r\n        Log.exx('SET property \"set_' + (propKey as any) + '\" do not exist in object of type \"' + U.getType(this.l) + \" DType:\" +  U.getType(this.l), {'this': this, targetObj});\r\n        return false; }\r\n    /*      problema: ogni oggetto deve avere multipli puntatori, quando ne modifico uno devo modificarli tutti, come tengo traccia?\r\n            ipotesi 1: lo memorizzo in un solo posto (store.idlookup) e uso Pointer<type, lb, ub> che è una stringa che simula un puntatore\r\n            problema 1: se fornisco l'intero store ai componenti si aggiornano ad ogni singola modifica, se estraggo i campi interesasti le stringhe puntatore sono invariate ma il contenuto puntato è cambiato e il componente non lo sa...\r\n            problemone 2: non so a quali proprietà dello store devo abbonarmi, devo leggere sempre tutto lo store?\r\n            !!!!! soluzione 2?: dovrei dichiarare le variabili a cui mi abbono, salvarle nello stato e precaricarle tramite mapStateToProps*/\r\n\r\n    public deleteProperty(target: ME, key: string | symbol, proxyItself?: Proxyfied<any>): boolean {\r\n        if (typeof key === \"symbol\") return false;\r\n        this.set(target, key, undefined, proxyItself);\r\n        delete target[key];\r\n        return true; }\r\n\r\n    ownKeys(target: ME): ArrayLike<string | symbol>{\r\n        return U.arrayMergeInPlace(Object.keys(target), Object.keys(this.l).filter(k => k.indexOf('set_') !== 0 || k.indexOf('get_') !== 0));\r\n    }\r\n\r\n    /*\r\n    apply(target: DModelElement, thisArg: any, argArray: any[]): any {\r\n        // will i ever use it? dovrei pasare una funzione invece di una classe, quindi in questo caso credo wrappi solo il costruttore\r\n    }*/\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class MapProxyHandler extends TargetableProxyHandler<Dictionary, LPointerTargetable> {\r\n    // todo: sposta alcune funzioni da TargetableProxy a MyProxy e fai estendere direttamente MyProxy a questa classe\r\n    public subMapKeys: Dictionary<string, any | Dictionary<DocString<'nested map keys'>>>;\r\n\r\n    constructor(d: Dictionary, baseObjInLookup: DPointerTargetable, additionalPath: string = '', subMapKeys: Dictionary<string, any | Dictionary<DocString<'nested map keys'>>> = {}) {\r\n        super(d, baseObjInLookup, additionalPath, LPointerTargetable.singleton);\r\n        this.subMapKeys = subMapKeys;\r\n    }\r\n\r\n    get(target: Dictionary, key: string | number | symbol, proxyitself: Proxyfied<Dictionary>): any {\r\n        if (typeof key === \"symbol\") return this.d[key as any];\r\n        let val: any = this.d[key];\r\n        if (key in this.subMapKeys && !(key in target)) { Log.exx('property not found in dictionary', {target, key, thiss:this, proxyitself, submapkeys: this.subMapKeys}); return undefined; }\r\n        if (key in this.subMapKeys) {\r\n            this.additionalPath += '.';\r\n            return MapProxyHandler.mapWrap( this.d, this.baseObjInLookup, this.additionalPath, this.subMapKeys[key]);\r\n            Log.exDevv('todo: wrap sub-map', {thiss: this});\r\n        }\r\n        return target[key as string]; }\r\n\r\n    set(target: Dictionary, key: string | number | symbol, value: any, proxyitself: Proxyfied<Dictionary>): boolean {\r\n        if (typeof key === \"symbol\") { Log.exx('cannot set a symbol in dictionary', {target, key, value, proxyitself}); return false; }\r\n        SetRootFieldAction.new(this.additionalPath + '.' + key, value, '',false)\r\n        return true;\r\n    }\r\n\r\n    public deleteProperty(target: Dictionary, key: string | symbol, proxyItself?: Proxyfied<any>): boolean {\r\n        if (typeof key === \"symbol\") return false;\r\n        this.set(target, key, undefined, proxyItself);\r\n        delete target[key];\r\n        return true; }\r\n}\r\n\r\n\r\n\r\n// 15-20 min + 5 di domande entro il 1° ottobre, discussione 10-12 ottobre\r\nexport const getPath: GetPath = new Proxy( {}, new GetPathHandler());\r\n(window as any).getPath = getPath;\r\n// usage: pathstring = ((getPath as DType).some.path.to.follow as any).$; // = \"some.path.to.follow\" with compilation-time validation\r\n","import type {ShortAttribETypes as SAType} from '../joiner';\r\nimport {GObject, RuntimeAccessible} from '../joiner';\r\nimport React, {ReactElement} from \"react\";\r\nconst beautify = require('js-beautify').html;\r\n\r\nlet ShortAttribETypes: typeof SAType = (window as any).ShortAttribETypes;\r\n\r\n@RuntimeAccessible\r\nexport class DV {\r\n    public static modelView(): string { return beautify(DefaultView.model()); } // damiano: che fa beautify? magari potremmo settarlo in LView.set_jsx invece che solo qui, così viene formattato anche l'input utente?\r\n    public static packageView(): string { return beautify(DefaultView.package()); }\r\n    public static classView(): string { return beautify(DefaultView.class()); }\r\n    public static attributeView(): string { return beautify(DefaultView.feature()); }\r\n    public static referenceView(): string { return beautify(DefaultView.feature()); }\r\n    public static enumeratorView(): string { return beautify(DefaultView.enum()); }\r\n    public static literalView(): string { return beautify(DefaultView.literal()); }\r\n    public static operationView(): string { return beautify(DefaultView.operation()); }\r\n    public static operationViewm1(): string { return beautify(DefaultView.operationm1()); }\r\n    public static objectView(): string { return beautify(DefaultView.object()); }\r\n    public static valueView(): string { return beautify(DefaultView.value()); }\r\n    public static defaultPackage(): string { return beautify(DefaultView.defaultPackage()); }\r\n    public static errorView(publicmsg: string | JSX.Element, debughiddenmsg?:any): ReactElement { console.error(\"error in view:\", {publicmsg, debuginfo:debughiddenmsg}); return DefaultView.error(publicmsg); }\r\n}\r\n\r\nlet valuecolormap: GObject = {};\r\nvaluecolormap[ShortAttribETypes.EBoolean] = \"orange\";\r\nvaluecolormap[ShortAttribETypes.EByte] = \"orange\";\r\nvaluecolormap[ShortAttribETypes.EShort] = \"orange\";\r\nvaluecolormap[ShortAttribETypes.EInt] = \"orange\";\r\nvaluecolormap[ShortAttribETypes.ELong] = \"orange\";\r\nvaluecolormap[ShortAttribETypes.EFloat] = \"orange\";\r\nvaluecolormap[ShortAttribETypes.EDouble] = \"orange\";\r\nvaluecolormap[ShortAttribETypes.EDate] = \"green\";\r\nvaluecolormap[ShortAttribETypes.EString] = \"green\";\r\nvaluecolormap[ShortAttribETypes.EChar] = \"green\";\r\nvaluecolormap[ShortAttribETypes.void] = \"gray\";\r\n\r\nlet valuecolormap_str = JSON.stringify(valuecolormap);\r\n\r\n\r\nclass DefaultView {\r\n\r\n    public static model(): string {\r\n        return `<div className={'root model'}>\r\n             {this.data.packages.map((child, index) => {\r\n                return <DefaultNode key={index} data={child.id}></DefaultNode>\r\n            })}\r\n            {this.data.allSubObjects.map((child, index) => {\r\n                return <DefaultNode key={index} data={child.id}></DefaultNode>\r\n            })}\r\n        </div>`;\r\n    }\r\n\r\n    public static package(): string {\r\n        return `<div className={'round bg-white root package'}>\r\n            <Input jsxLabel={<b className={'package-name'}>EPackage:</b>} \r\n                   obj={this.data.id} field={'name'} hidden={true} />\r\n            <hr />\r\n            <div className={'package-children'}>\r\n                {this.data.children.map((child, index) => {\r\n                    return <DefaultNode key={index} data={child.id}></DefaultNode>\r\n                })}\r\n            </div>\r\n        </div>`;\r\n    }\r\n\r\n    public static class(): string {\r\n        return `<div className={'round bg-white root class'}>\r\n            <Input jsxLabel={<b className={'class-name'}>EClass:</b>} \r\n                   obj={this.data.id} field={'name'} hidden={true} autosize={true} />\r\n            <hr/>\r\n            <div className={'class-children'}>\r\n                {this.data.children.map((child, index) => {\r\n                    return <DefaultNode key={index} data={child.id}></DefaultNode>\r\n                })}\r\n            </div>\r\n        </div>`;\r\n    }\r\n\r\n    public static enum(): string {\r\n        return `<div className={'round bg-white root enumerator'}>\r\n            <Input jsxLabel={<b className={'enumerator-name'}>EEnum:</b>} \r\n                   obj={this.data.id} field={'name'} hidden={true} autosize={true} />\r\n            <hr />\r\n            <div className={'enumerator-children'}>\r\n                {this.data.children.map((child, index) => {\r\n                    return <DefaultNode key={index} data={child.id}></DefaultNode>\r\n                })}\r\n            </div>\r\n        </div>`;\r\n    }\r\n\r\n    public static feature(): string {\r\n        return `<Select className={'root feature'} obj={this.data} field={'type'} label={this.data.name} />`;\r\n    }\r\n\r\n    public static literal(): string {\r\n        return `<label className={'d-block text-center root literal'}>{this.data.name}</label>`\r\n    }\r\n\r\n    public static operation(): string {\r\n        return `<Select className={'root operation'} obj={this.data} field={'type'} label={this.data.name+this.data.signature} />`;\r\n    }\r\n\r\n\r\n\r\n    public static operationm1(): string {\r\n        return `<div className={'d-flex root operationm1'} style={{paddingRight: \"6px\"}}>\r\n             {<label className={'d-block ms-1'}>{this.props.data.instanceof.name}</label>}\r\n            <label className={'d-block ms-auto hover-root'} style={{color:` + valuecolormap_str + `[this.props.data.values.type] || \"gray\"\r\n            }}>→→→{\r\n                <div className=\"hover-content\">{\r\n                    <ParameterForm operation = {this.props.data.id} vertical={true} />\r\n                }\r\n                }</label>\r\n        </div>`\r\n    }\r\n\r\n    public static object(): string {\r\n        return `<div className={'round bg-white root class'}>\r\n            <label className={'ms-1'}>\r\n                <Input jsxLabel={<b className={'class-name'}>{this.data.instanceof ? this.data.instanceof.name : \"Object\"}:</b>} \r\n                   obj={this.data.id} field={'name'} hidden={true} autosize={true}/>\r\n            </label>\r\n            <hr />\r\n            <div className={'object-children'}>\r\n                {this.data.features.map((child, index) => {\r\n                    return <DefaultNode key={index} data={child.id}></DefaultNode>\r\n                })}\r\n            </div>\r\n        </div>`;\r\n    }\r\n\r\n    public static value() {\r\n        return `<div className={'d-flex root value'} style={{paddingRight: \"6px\"}}>\r\n             {this.props.data.instanceof && <label className={'d-block ms-1'}>{this.props.data.instanceof.name}</label>}\r\n             {!this.props.data.instanceof && <Input asLabel={true} obj={this.data.id} field={'name'} hidden={true} autosize={true} />}\r\n            <label className={'d-block ms-auto'} style={{color:` + valuecolormap_str + `[this.props.data.values.type] || \"gray\"\r\n            }}>: {this.props.data.valuestring()}</label>\r\n        </div>`\r\n    }\r\n\r\n    public static defaultPackage() {\r\n        return `{this.data.children.map((child, index) => {\r\n            return <DefaultNode key={index} data={child.id}></DefaultNode>\r\n        })}`;\r\n    }\r\n\r\n    public static error(msg: undefined | string | JSX.Element) {\r\n        return <div className={'w-100 h-100'}>\r\n            <div className={\"h-100 round bg-white border border-danger\"}>\r\n                <div className={'text-center text-danger'}>\r\n                    <b>SYNTAX ERROR</b>\r\n                    <hr/>\r\n                    <label className={'text-center mx-1'}>\r\n                        The JSX you provide is NOT valid!\r\n                    </label>\r\n                    {msg && <label className={'text-center mx-1'}>{msg}</label>}\r\n                </div>\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n}\r\n","import type { GObject, Temporary, TODO} from \"../joiner\";\r\nimport {DPointerTargetable, RuntimeAccessible, windoww, Log, RuntimeAccessibleClass} from \"../joiner\";\r\n\r\n@RuntimeAccessible\r\nexport abstract class IPoint extends RuntimeAccessibleClass {\r\n    public x!: number;\r\n    public y!: number;\r\n\r\n    public static getM? = function(firstPt: IPoint, secondPt: IPoint): number { return (firstPt.y - secondPt.y) / (firstPt.x - secondPt.x); }\r\n    // @ts-ignore static getM is not null but must be declared nullable to achieve subclass mixing\r\n    public static getQ? = function(firstPt: IPoint, secondPt: IPoint): number { return firstPt.y - (IPoint.getM(firstPt, secondPt) * firstPt.x);  }\r\n\r\n    public constructor(x: number = 0, y: number = 0) {\r\n        super(); // super('dwc');\r\n        IPoint.init_constructor(this, x, y);\r\n    }\r\n\r\n    static init_constructor(thiss: GObject, x: any = 0, y: any = 0, ...a: any): void {\r\n        thiss.id = \"POINT_\" + (DPointerTargetable.maxID++) + \"_\" + new Date().getTime();\r\n        thiss.className = thiss.constructor.name;\r\n        if (x === null) thiss.x = null as Temporary;\r\n        else if (isNaN(+x)) { thiss.x = 0; }\r\n        else thiss.x = +x;\r\n        if (y === null) thiss.y = null as Temporary;\r\n        else if (isNaN(+y)) { thiss.y = 0; }\r\n        else thiss.y = +y;\r\n        thiss.className = this.name;\r\n    }\r\n\r\n    public toString(): string { return '(' + this.x + ', ' + this.y + ')'; }\r\n    public clone(other: { x: number, y: number }): this { this.x = other.x; this.y = other.y; return this; }\r\n\r\n    protected abstract new(): this;\r\n    public duplicate(): this { const ret = this.new(); ret.clone(this); return ret; }\r\n\r\n    public subtract(p2: IPoint, newInstance: boolean): this {\r\n        Log.e(!p2, 'subtract argument must be a valid point: ', p2);\r\n        let p1: this;\r\n        if (!newInstance) { p1 = this; } else { p1 = this.duplicate(); }\r\n        p1.x -= p2.x;\r\n        p1.y -= p2.y;\r\n        return p1; }\r\n\r\n    public add(p2: IPoint, newInstance: boolean): this {\r\n        Log.e(!p2, 'add argument must be a valid point: ', p2);\r\n        let p1: this;\r\n        if (!newInstance) { p1 = this; } else { p1 = this.duplicate(); }\r\n        p1.x += p2.x;\r\n        p1.y += p2.y;\r\n        return p1; }\r\n\r\n    public addAll(p: IPoint[], newInstance: boolean): this {\r\n        let i;\r\n        let p0: this;\r\n        if (!newInstance) { p0 = this; } else { p0 = this.duplicate(); }\r\n        for (i = 0; i < p.length; i++) { p0.add(p[i], true); }\r\n        return p0; }\r\n\r\n    public subtractAll(p: this[], newInstance: boolean): this {\r\n        let i;\r\n        let p0: this;\r\n        if (!newInstance) { p0 = this; } else { p0 = this.duplicate(); }\r\n        for (i = 0; i < p.length; i++) { p0.subtract(p[i], true); }\r\n        return p0; }\r\n\r\n    public multiply(pt: this, newInstance: boolean = false): this {\r\n        let ret: this = (newInstance ? this.duplicate() : this);\r\n        ret.x *= pt.x;\r\n        ret.y *= pt.y;\r\n        return ret; }\r\n\r\n    public divide(pt: this, newInstance: boolean = false): this {\r\n        let ret = (newInstance ? this.duplicate() : this);\r\n        ret.x /= pt.x;\r\n        ret.y /= pt.y;\r\n        return ret; }\r\n\r\n    public multiplyScalar(scalar: number, newInstance: boolean): this {\r\n        Log.e(isNaN(+scalar), 'IPoint.multiply()', 'scalar argument must be a valid number: ', scalar);\r\n        let p1: this;\r\n        if (!newInstance) { p1 = this; } else { p1 = this.duplicate(); }\r\n        p1.x *= scalar;\r\n        p1.y *= scalar;\r\n        return p1; }\r\n\r\n    public divideScalar(scalar: number, newInstance: boolean): this {\r\n        Log.e(isNaN(+scalar), 'IPoint.divide()', 'scalar argument must be a valid number: ', scalar);\r\n        let p1: this;\r\n        if (!newInstance) { p1 = this; } else { p1 = this.duplicate(); }\r\n        p1.x /= scalar;\r\n        p1.y /= scalar;\r\n        return p1; }\r\n\r\n    public isInTheMiddleOf(firstPt: this, secondPt: this, tolleranza: number): boolean {\r\n        const rectangle: Size = Size.fromPoints(firstPt, secondPt);\r\n        const tolleranzaX = tolleranza; // actually should be cos * arctan(m);\r\n        const tolleranzaY = tolleranza; // actually should be sin * arctan(m);\r\n        if (this.x < rectangle.x - tolleranzaX || this.x > rectangle.x + rectangle.w + tolleranzaX) { return false; }\r\n        if (this.y < rectangle.y - tolleranzaX || this.y > rectangle.y + rectangle.h + tolleranzaY) { return false; }\r\n        // const m = IPoint.getM(firstPt, secondPt);\r\n        // const q = IPoint.getQ(firstPt, secondPt);\r\n        const lineDistance = this.distanceFromLine(firstPt, secondPt);\r\n        // console.log('distance:', lineDistance, ', this:', this, ', p1:', firstPt, ', p2:', secondPt);\r\n        return lineDistance <= tolleranza; }\r\n\r\n    public distanceFromLine(p1: IPoint, p2: IPoint): number {\r\n        const top: number =\r\n            + (p2.y - p1.y) * this.x\r\n            - (p2.x - p1.x) * this.y\r\n            + p2.x * p1.y\r\n            - p1.x * p2.y;\r\n        const bot =\r\n            (p2.y - p1.y) * (p2.y - p1.y) +\r\n            (p2.x - p1.x) * (p2.x - p1.x);\r\n        return Math.abs(top) / Math.sqrt(bot);  }\r\n\r\n    public equals(pt: IPoint, tolleranzaX: number = 0, tolleranzaY: number = 0): boolean {\r\n        if (pt === null) { return false; }\r\n        return Math.abs(this.x - pt.x) <= tolleranzaX && Math.abs(this.y - pt.y) <= tolleranzaY; }\r\n\r\n    public moveOnNearestBorder(startVertexSize: ISize, clone: boolean, graph: TODO/*IGraph*/, debug: boolean = true): IPoint {\r\n        const pt: IPoint = clone ? this.duplicate() : this;\r\n        const tl: IPoint = startVertexSize.tl();\r\n        const tr: IPoint = startVertexSize.tr();\r\n        const bl: IPoint = startVertexSize.bl();\r\n        const br: IPoint = startVertexSize.br();\r\n        const L: number = pt.distanceFromLine(tl, bl);\r\n        const R: number = pt.distanceFromLine(tr, br);\r\n        const T: number = pt.distanceFromLine(tl, tr);\r\n        const B: number = pt.distanceFromLine(bl, br);\r\n        const min: number = Math.min(L, R, T, B);\r\n        if (min === L) { pt.x = tl.x; }\r\n        if (min === R) { pt.x = tr.x; }\r\n        if (min === T) { pt.y = tr.y; }\r\n        if (min === B) { pt.y = br.y; }\r\n        if (debug && graph && pt instanceof GraphPoint) { graph.markg(pt, false, 'purple'); }\r\n        return pt; }\r\n\r\n    public getM(pt2: IPoint): number { return IPoint.getM?.(this, pt2) as unknown as number; }\r\n\r\n    public degreeWith(pt2: IPoint, toRadians: boolean): number {\r\n        const directionVector: IPoint = this.subtract(pt2, true);\r\n        const ret: number = Math.atan2(directionVector.y, directionVector.x);\r\n        return toRadians ? ret : windoww.U.RadToDegree(ret); }\r\n\r\n    public absolute(): number { return Math.sqrt(this.x * this.x + this.y * this.y); }\r\n    public set(x: number, y: number) { this.x = x; this.y = y; }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class GraphPoint extends IPoint{\r\n    private dontmixwithPoint: any;\r\n    public static fromEvent(e: JQuery.ClickEvent | JQuery.MouseMoveEvent | JQuery.MouseUpEvent | JQuery.MouseDownEvent | JQuery.MouseEnterEvent | JQuery.MouseLeaveEvent | JQuery.MouseEventBase)\r\n        : GraphPoint | null {\r\n        if (!e) { return null; }\r\n        const p: Point = new Point(e.pageX, e.pageY);\r\n        const g: any = null;\r\n        throw new Error(\"todo: const g: IGraph = Status.status.getActiveModel().graph;\");\r\n        return g.toGraphCoord(p); }\r\n\r\n    protected new(): this { return new GraphPoint() as this;}\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class Point extends IPoint{\r\n    private dontmixwithGPoint: any;\r\n    /// https://stackoverflow.com/questions/6073505/what-is-the-difference-between-screenx-y-clientx-y-and-pagex-y\r\n    public static fromEvent(e: JQuery.ClickEvent | JQuery.MouseMoveEvent | JQuery.MouseUpEvent | JQuery.MouseDownEvent | JQuery.MouseEnterEvent | JQuery.MouseLeaveEvent | JQuery.MouseEventBase)\r\n        : Point {\r\n        const p: Point = new Point(e.pageX, e.pageY);\r\n        return p; }\r\n\r\n    protected new(): this { return new Point() as this;}\r\n}\r\n\r\n\r\n@RuntimeAccessible\r\nexport abstract class ISize<PT extends IPoint = IPoint> extends RuntimeAccessibleClass {\r\n    public x!: number;\r\n    public y!: number;\r\n    public w!: number;\r\n    public h!: number;\r\n    public constructor(x: number = 0, y: number = 0, w: number = 0, h: number = 0) {\r\n        super(); // super('dwc');\r\n        // do not override any fields from the DPointerTargetable, otherwise the ! in the override will reinizialize the attribute\r\n        // erasing the value set in super or in the functions called by the constructor as side effect (static_init called from constructor will be overridden too)\r\n        // if need to override types, build the \"new\" static function like in DModelElement\r\n        ISize.init_constructor(this, x, y, w, h);\r\n    }\r\n\r\n    static init_constructor(thiss: GObject, x: any = 0, y: any = 0, w: any = 0, h: any = 0, ...a: any): void {\r\n        thiss.id = \"SIZE_\" + (DPointerTargetable.maxID++) + \"_\" + new Date().getTime();\r\n        thiss.className = thiss.constructor.name;\r\n        if (x === null) thiss.x = null as Temporary;\r\n        else if (isNaN(+x)) { thiss.x = 0; }\r\n        else thiss.x = +x;\r\n        if (y === null) thiss.y = null as Temporary;\r\n        else if (isNaN(+y)) { thiss.y = 0; }\r\n        else thiss.y = +y;\r\n        if (w === null) thiss.w = null as Temporary;\r\n        else if (isNaN(+w)) { thiss.w = 0; }\r\n        else thiss.w = +w;\r\n        if (h === null) thiss.h = null as Temporary;\r\n        else if (isNaN(+h)) { thiss.h = 0; }\r\n        else thiss.h = +h;\r\n        thiss.className = this.name; }\r\n\r\n    public toString(): string { return JSON.stringify({x: this.x, y: this.y, w: this.w, h: this.h}); }\r\n\r\n    public set(x?: number, y?: number, w?: number, h?: number): void {\r\n        if (x !== undefined) (this.x = +x);\r\n        if (y !== undefined) (this.y = +y);\r\n        if (w !== undefined) (this.w = +w);\r\n        if (h !== undefined) (this.h = +h);\r\n    }\r\n\r\n    protected abstract makePoint(x: number, y: number): PT;\r\n    protected abstract new(): this;\r\n    public clone(json: this): this { this.x = json.x; this.y = json.y; this.w = json.w; this.h = json.h; return this; }\r\n    public duplicate(): this { return this.new().clone(this); }\r\n\r\n    public add(pt2: this | PT): void {\r\n        this.x += pt2.x;\r\n        this.y += pt2.y;\r\n        if (!('w' in pt2)) return;\r\n        this.w += (pt2 as ISize).w;\r\n        this.h += (pt2 as ISize).h; }\r\n\r\n    public subtract(pt2: this | PT): this {\r\n        this.x -= pt2.x;\r\n        this.y -= pt2.y;\r\n        if (!('w' in pt2)) return this;\r\n        this.w -= (pt2 as ISize).w;\r\n        this.h -= (pt2 as ISize).h; return this; }\r\n\r\n    public multiply(pt2: this | PT): void {\r\n        this.x *= pt2.x;\r\n        this.y *= pt2.y;\r\n        if (!('w' in pt2)) return;\r\n        this.w *= (pt2 as ISize).w;\r\n        this.h *= (pt2 as ISize).h; }\r\n\r\n    public divide(pt2: this | PT): void {\r\n        this.x /= pt2.x;\r\n        this.y /= pt2.y;\r\n        if (!('w' in pt2)) return;\r\n        this.w /= (pt2 as ISize).w;\r\n        this.h /= (pt2 as ISize).h; }\r\n\r\n    public tl(): PT { return this.makePoint(   this.x,             this.y         ); }\r\n    public tr(): PT { return this.makePoint(this.x + this.w,    this.y         ); }\r\n    public bl(): PT { return this.makePoint(   this.x,          this.y + this.h); }\r\n    public br(): PT { return this.makePoint(this.x + this.w, this.y + this.h); }\r\n    public equals(size: this): boolean { return this.x === size.x && this.y === size.y && this.w === size.w && this.h === size.h; }\r\n    /// field-wise Math.min()\r\n    public min(minSize: this, clone: boolean): this {\r\n        const ret: this = clone ? this.new() : this;\r\n        if (!isNaN(minSize.x) && ret.x < minSize.x) { ret.x = minSize.x; }\r\n        if (!isNaN(minSize.y) && ret.y < minSize.y) { ret.y = minSize.y; }\r\n        if (!isNaN(minSize.w) && ret.w < minSize.w) { ret.w = minSize.w; }\r\n        if (!isNaN(minSize.h) && ret.h < minSize.h) { ret.h = minSize.h; }\r\n        return ret; }\r\n    public max(maxSize: this, clone: boolean): this {\r\n        const ret: this = clone ? this.new() : this;\r\n        if (!isNaN(maxSize.x) && ret.x > maxSize.x) { ret.x = maxSize.x; }\r\n        if (!isNaN(maxSize.y) && ret.y > maxSize.y) { ret.y = maxSize.y; }\r\n        if (!isNaN(maxSize.w) && ret.w > maxSize.w) { ret.w = maxSize.w; }\r\n        if (!isNaN(maxSize.h) && ret.h > maxSize.h) { ret.h = maxSize.h; }\r\n        return ret; }\r\n\r\n    public intersection(size: this): this | null {\r\n        // anche \"isinside\"\r\n        let startx, starty, endx, endy;\r\n        startx = Math.max(this.x, size.x);\r\n        starty = Math.max(this.y, size.y);\r\n        endx = Math.min(this.x + this.w, size.x + size.w);\r\n        endy = Math.min(this.y + this.h, size.y + size.h);\r\n        const intersection: this = this.new();\r\n        // intersection.set(0, 0, 0, 0);\r\n        intersection.x = startx;\r\n        intersection.y = starty;\r\n        intersection.w = endx - startx;\r\n        intersection.h = endy - starty;\r\n        const doesintersect: boolean = intersection.w > 0 && intersection.h > 0;\r\n        return (doesintersect) ? intersection: null; }\r\n\r\n    public contains(pt: PT): boolean {\r\n        return  pt.x >= this.x && pt.x <= this.x + this.w && pt.y >= this.y && pt.y <= this.y + this.h; }\r\n\r\n    public isOverlapping(size2: this): boolean { return !!this.intersection(size2); }\r\n    public isOverlappingAnyOf(sizes: this[]): boolean {\r\n        if (!sizes) return false;\r\n        for (let size of sizes) { if (this.isOverlapping(size)) return true; }\r\n        return false;\r\n    }\r\n\r\n    public multiplyPoint(other: PT, newInstance: boolean): this {\r\n        const ret: this = newInstance ? this.new() : this;\r\n        ret.x *= other.x;\r\n        ret.w *= other.x;\r\n        ret.y *= other.y;\r\n        ret.h *= other.y;\r\n        return ret; }\r\n\r\n    public dividePoint(other: PT, newInstance: boolean): this {\r\n        const ret: this = newInstance ? this.new() : this;\r\n        ret.x /= other.x;\r\n        ret.w /= other.x;\r\n        ret.y /= other.y;\r\n        ret.h /= other.y;\r\n        return ret; }\r\n\r\n    public boundary(size2: this): void {\r\n        /*let minx, maxx, miny, maxy;\r\n        if (size2.y < this.y) { miny = size2.y; /*maxy = this.y;* / } else { miny = this.y; /*maxy = size2.y;* / }\r\n        if (size2.x < this.x) { minx = size2.y; /*maxx = this.x;* / } else { minx = this.x; /*maxy = size2.x;* / }\r\n        if (size2.y + size2.h < this.y + this.h) maxy = this.y + this.h; else maxy = size2.y + size2.h;\r\n        if (size2.x + size2.w < this.x + this.w) maxx = this.x + this.w; else maxx = size2.x + size2.w;\r\n        */\r\n        this.h = (size2.y + size2.h > this.y + this.h ? size2.y + size2.h : this.y + this.h); // -miny\r\n        this.w = (size2.x + size2.w > this.x + this.w ? size2.x + size2.w : this.x + this.w); // -minx\r\n        if (this.y < size2.y) this.y = size2.y;\r\n        if (this.x < size2.x) this.x = size2.x;\r\n        this.h -= this.y;\r\n        this.w -= this.x;\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class Size extends ISize<Point> {\r\n    private static sizeofvar: HTMLElement;\r\n    private static $sizeofvar: JQuery<HTMLElement>;\r\n    private dontMixWithGraphSize: any;\r\n\r\n    public static of(element0: Element, debug: boolean = false): Size {\r\n        let element: HTMLElement = element0 as HTMLElement;\r\n        Log.l(debug, 'sizeof()',  element);\r\n        Log.e(element as any === document, 'trying to measure document.');\r\n        if (element as any === document) { element = document.body as any; }\r\n        const $element = $(element);\r\n        Log.e(!element || element.tagName === 'foreignObject', 'sizeof()', 'SvgForeignElementObject have a bug with size, measure a child instead.', element);\r\n        let tmp;\r\n        let size: Size;\r\n        if (!Size.sizeofvar) {\r\n            Size.sizeofvar = document.createElement('div');\r\n            document.body.append(Size.sizeofvar); }\r\n\r\n        const isOrphan = element.parentNode === null;\r\n        // var visible = element.style.display !== 'none';\r\n        // var visible = $element.is(\":visible\"); crea bug quando un elemento è teoricamente visibile ma orfano\r\n        const ancestors =  windoww.U.ancestorArray(element);\r\n        const displayStyles: string[] = ancestors.map( (e: HTMLElement) => e?.style?.display);\r\n        if (isOrphan) { Size.sizeofvar.append(element); }\r\n        // show all and saveToDB visibility to restore it later\r\n        for (let i = 0; i < ancestors.length; i++) { // document has undefined style\r\n            displayStyles[i] = ancestors[i]?.style?.display;\r\n            if (displayStyles[i] === 'none' || (displayStyles[i] === '' && getComputedStyle(ancestors[i]).display === 'none')) { ancestors[i].style.display = 'block' }\r\n        }\r\n        tmp = $element.offset() as JQuery.Coordinates; // made sure cannot be undefined by removing display:none\r\n        size = new Size(tmp.left, tmp.top, 0, 0);\r\n        tmp = element.getBoundingClientRect();\r\n        size.w = tmp.width;\r\n        size.h = tmp.height;\r\n        // restore visibility\r\n        for (let i = 0; i < ancestors.length; i++) {\r\n            if (displayStyles[i] === ancestors[i].style?.display) continue;\r\n            if (displayStyles[i]) ancestors[i].style.display = displayStyles[i];\r\n            else ancestors[i].style.removeProperty('display');\r\n        }\r\n        if (isOrphan) {  windoww.U.clear(Size.sizeofvar); }\r\n        // Status.status.getActiveModel().graph.markS(size, false);\r\n        return size;\r\n    }\r\n\r\n    public static fromPoints(firstPt: IPoint, secondPt: IPoint): Size {\r\n        const minX = Math.min(firstPt.x, secondPt.x);\r\n        const maxX = Math.max(firstPt.x, secondPt.x);\r\n        const minY = Math.min(firstPt.y, secondPt.y);\r\n        const maxY = Math.max(firstPt.y, secondPt.y);\r\n        return new Size(minX, minY, maxX - minX, maxY - minY); }\r\n\r\n    protected makePoint(x: number, y: number): Point { return new Point(x, y); }\r\n    protected new(): this { return new Size() as this; }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class GraphSize extends ISize<GraphPoint> {\r\n    private dontMixWithSize: any;\r\n\r\n    public static fromPoints(firstPt: GraphPoint, secondPt: GraphPoint): GraphSize {\r\n        const minX = Math.min(firstPt.x, secondPt.x);\r\n        const maxX = Math.max(firstPt.x, secondPt.x);\r\n        const minY = Math.min(firstPt.y, secondPt.y);\r\n        const maxY = Math.max(firstPt.y, secondPt.y);\r\n        return new GraphSize(minX, minY, maxX - minX, maxY - minY); }\r\n\r\n    public static closestIntersection(vertexGSize: GraphSize, prevPt: GraphPoint, pt0: GraphPoint, gridAlign?: GraphPoint): GraphPoint | null {\r\n        let pt: GraphPoint | null = pt0.duplicate();\r\n        const m = GraphPoint.getM?.(prevPt, pt) as number;\r\n        const q = GraphPoint.getQ?.(prevPt, pt) as number;\r\n        // U.pe( Math.abs((pt.y - m * pt.x) - (prevPt.y - m * prevPt.x)) > .001, 'wrong math in Q:', (pt.y - m * pt.x), ' vs ', (prevPt.y - m * prevPt.x));\r\n        /*const isL = prevPt.x < pt.x;\r\n    const isT = prevPt.y < pt.y;\r\n    const isR = !isL;\r\n    const isB = !isT; */\r\n        if (m === Number.POSITIVE_INFINITY && q === Number.NEGATIVE_INFINITY) { // bottom middle\r\n            return new GraphPoint(vertexGSize.x + vertexGSize.w / 2, vertexGSize.y + vertexGSize.h); }\r\n        // console.log('pt:', pt, 'm:', m, 'q:', q);\r\n        let L: GraphPoint | null = new GraphPoint(0, 0);\r\n        let T: GraphPoint | null = new GraphPoint(0, 0);\r\n        let R: GraphPoint | null = new GraphPoint(0, 0);\r\n        let B: GraphPoint | null = new GraphPoint(0, 0);\r\n        L.x = vertexGSize.x;\r\n        L.y = m * L.x + q;\r\n        R.x = vertexGSize.x + vertexGSize.w;\r\n        R.y = m * R.x + q;\r\n        T.y = vertexGSize.y;\r\n        T.x = (T.y - q) / m;\r\n        B.y = vertexGSize.y + vertexGSize.h;\r\n        B.x = (B.y - q) / m;\r\n        // prendo solo il compreso pt ~ prevPt (escludo così il \"pierce\" sulla faccia opposta), prendo il più vicino al centro.\r\n        // console.log('4 possibili punti di intersezione (LTBR):', L, T, B, R);\r\n        /* this.owner.mark(this.owner.toHtmlCoord(T), true, 'blue');\r\n    this.owner.mark(this.owner.toHtmlCoord(B), false, 'violet');\r\n    this.owner.mark(this.owner.toHtmlCoord(L), false, 'red');\r\n    this.owner.mark(this.owner.toHtmlCoord(R), false, 'orange');*/\r\n        if ( (B.x >= pt.x && B.x <= prevPt.x) || (B.x >= prevPt.x && B.x <= pt.x) ) { } else { B = null; }\r\n        if ( (T.x >= pt.x && T.x <= prevPt.x) || (T.x >= prevPt.x && T.x <= pt.x) ) { } else { T = null; }\r\n        if ( (L.y >= pt.y && L.y <= prevPt.y) || (L.y >= prevPt.y && L.y <= pt.y) ) { } else { L = null; }\r\n        if ( (R.y >= pt.y && R.y <= prevPt.y) || (R.y >= prevPt.y && R.y <= pt.y) ) { } else { R = null; }\r\n        // console.log('superstiti step1: (LTBR):', L, T, B, R);\r\n        const vicinanzaT = !T ? Number.POSITIVE_INFINITY : ((T.x - pt.x) * (T.x - pt.x)) + ((T.y - pt.y) * (T.y - pt.y));\r\n        const vicinanzaB = !B ? Number.POSITIVE_INFINITY : ((B.x - pt.x) * (B.x - pt.x)) + ((B.y - pt.y) * (B.y - pt.y));\r\n        const vicinanzaL = !L ? Number.POSITIVE_INFINITY : ((L.x - pt.x) * (L.x - pt.x)) + ((L.y - pt.y) * (L.y - pt.y));\r\n        const vicinanzaR = !R ? Number.POSITIVE_INFINITY : ((R.x - pt.x) * (R.x - pt.x)) + ((R.y - pt.y) * (R.y - pt.y));\r\n        const closest = Math.min(vicinanzaT, vicinanzaB, vicinanzaL, vicinanzaR);\r\n        // console.log( 'closest:', closest);\r\n        // succede quando pt e prevPt sono entrambi all'interno del rettangolo del vertice.\r\n        // L'edge non è visibile e il valore ritornato è irrilevante.\r\n        if (closest === Number.POSITIVE_INFINITY) {\r\n            /* top center */\r\n            pt = vertexGSize.tl();\r\n            pt.x += vertexGSize.w / 2; } else\r\n        if (closest === Number.POSITIVE_INFINITY) {\r\n            /* bottom center */\r\n            pt = vertexGSize.br();\r\n            pt.x -= vertexGSize.w / 2; } else\r\n        if (closest === vicinanzaT) { pt = T; } else\r\n        if (closest === vicinanzaB) { pt = B; } else\r\n        if (closest === vicinanzaR) { pt = R; } else\r\n        if (closest === vicinanzaL) { pt = L; }\r\n\r\n        if (!gridAlign) { return pt; }\r\n        if (!pt) return null;\r\n        if ((pt === T || pt === B || isNaN(closest)) && gridAlign.x) {\r\n            const floorX: number = Math.floor(pt.x / gridAlign.x) * gridAlign.x;\r\n            const ceilX: number = Math.ceil(pt.x / gridAlign.x) * gridAlign.x;\r\n            let closestX;\r\n            let farthestX;\r\n            if (Math.abs(floorX - pt.x) < Math.abs(ceilX - pt.x)) {\r\n                closestX = floorX; farthestX = ceilX;\r\n            } else { closestX = ceilX; farthestX = floorX; }\r\n\r\n            // todo: possibile causa del bug che non allinea punti fake a punti reali. nel calcolo realPT questo non viene fatto.\r\n            // if closest grid intersection is inside the vertex.\r\n            if (closestX >= vertexGSize.x && closestX <= vertexGSize.x + vertexGSize.w) { pt.x = closestX; } else\r\n                // if 2° closer grid intersection is inside the vertex.\r\n            if (closestX >= vertexGSize.x && closestX <= vertexGSize.x + vertexGSize.w) { pt.x = farthestX;\r\n                // if no intersection are inside the vertex (ignore grid)\r\n            } else { /* do nothing */ }\r\n        } else if ((pt === L || pt === R) && gridAlign.y) {\r\n            const floorY: number = Math.floor(pt.y / gridAlign.y) * gridAlign.y;\r\n            const ceilY: number = Math.ceil(pt.y / gridAlign.y) * gridAlign.y;\r\n            let closestY;\r\n            let farthestY;\r\n            if (Math.abs(floorY - pt.y) < Math.abs(ceilY - pt.y)) {\r\n                closestY = floorY; farthestY = ceilY;\r\n            } else { closestY = ceilY; farthestY = floorY; }\r\n\r\n            // if closest grid intersection is inside the vertex.\r\n            if (closestY >= vertexGSize.y && closestY <= vertexGSize.y + vertexGSize.h) { pt.y = closestY; } else\r\n                // if 2° closer grid intersection is inside the vertex.\r\n            if (closestY >= vertexGSize.y && closestY <= vertexGSize.y + vertexGSize.h) { pt.y = farthestY;\r\n                // if no intersection are inside the vertex (ignore grid)\r\n            } else { /* do nothing */ }\r\n        }\r\n        return pt; }\r\n\r\n\r\n    protected new(): this { return new GraphSize() as this; }\r\n    protected makePoint(x: number, y: number): GraphPoint { return new GraphPoint(x, y) as GraphPoint; }\r\n\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class Geom {\r\n\r\n    static isPositiveZero(m: number): boolean {\r\n        if (!!Object.is) { return Object.is(m, +0); }\r\n        return (1 / m === Number.POSITIVE_INFINITY); }\r\n\r\n    static isNegativeZero(m: number): boolean {\r\n        if (!!Object.is) { return Object.is(m, -0); }\r\n        return (1 / m === Number.NEGATIVE_INFINITY); }\r\n\r\n    static TanToRadian(n: number): number { return Geom.DegreeToRad(Geom.TanToDegree(n)); }\r\n    static TanToDegree(n: number): number {\r\n        if (Geom.isPositiveZero(n)) { return 0; }\r\n        if (n === Number.POSITIVE_INFINITY) { return 90; }\r\n        if (Geom.isNegativeZero(n)) { return 180; }\r\n        if (n === Number.POSITIVE_INFINITY) { return 270; }\r\n        return Geom.RadToDegree((window as any).Math.atan(n)); }\r\n\r\n    static RadToDegree(radians: number): number { return radians * (180 / Math.PI); }\r\n    static DegreeToRad(degree: number): number { return degree * (Math.PI / 180); }\r\n\r\n}\r\n","import ReactJson from 'react-json-view' // npm i react-json-view\r\nimport {GObject, Dictionary, DocString, LPointerTargetable, U, Log, GraphElementComponent} from \"../joiner\";\r\nimport type {GraphElementOwnProps} from \"../joiner\";\r\nimport {windoww, JsType, RuntimeAccessible} from \"../joiner\";\r\nimport React, {ReactElement, ReactNode} from \"react\";\r\nimport withReactContent from \"sweetalert2-react-content\";\r\nimport Swal from \"sweetalert2\";\r\n\r\n// U-functions that require jsx\r\n@RuntimeAccessible\r\nexport class UX{\r\n    static recursiveMap<T extends ReactNode | ReactNode[] | null | undefined>(children: T, fn: (rn: T)=>T): T {\r\n        const innermap = (child: ReactNode): T => {\r\n            if (!React.isValidElement(child)) { return child as T; }\r\n            if (child.props.children) {\r\n                // Giordano: add ignore for webpack\r\n                //@ts-ignore\r\n                child = React.cloneElement(child, { children: UX.recursiveMap(child.props.children, fn) });\r\n            }\r\n            return fn(child as T);\r\n        };\r\n        if (!Array.isArray(children)) return innermap(children as ReactNode) as T;\r\n        return React.Children.map(children, innermap) as T;\r\n    }\r\n    static injectProp(parentComponent: GraphElementComponent, e: ReactNode, gvidmap: Dictionary<DocString<'VertexID'>, boolean>): ReactNode {\r\n        const re: ReactElement | null = UX.ReactNodeAsElement(e);\r\n        if (!re) return e;\r\n        // @ts-ignore this\r\n        // const parentComponent = this;\r\n        let type = (re.type as any).WrappedComponent?.name || re.type;\r\n        // const windoww = window as any;\r\n        // console.log('relement ', {type: (re.type as any).WrappedComponent?.name || re.type}, {thiss, mycomponents: windoww.mycomponents, re, props:re.props});\r\n        // add \"view\" (view id) prop as default to sub-elements of any depth to inherit the view of the parent unless the user forced another view to apply\r\n        switch (type) {\r\n            default:\r\n                // console.count('injectingProp case default: ' + type);\r\n                return re;\r\n            /*\r\n            case windoww.Components.Input.name:\r\n            case windoww.Components.Textarea.name:\r\n                const objid =  re.props.obj?.id || re.props.obj || parentComponent.props.data.id;\r\n                const ret = React.cloneElement(re, {key: re.props.key || parentComponent.props.view.id + '_' + parentComponent.props.data.id + '_' + re.props.field, obj: objid, obj2: objid});\r\n                //console.log('relement Input set props',\r\n                //    {'re.props.obj.id': re.props.obj?.id, 're.props.obj': re.props.obj, 'thiss.props.data.id': thiss.props.data.id, thiss, re, objid, ret, 'ret.props': ret.props});\r\n                return ret;*/\r\n            // case windoww.Components.GraphElement.name:\r\n            case windoww.Components.GraphElementComponent.name:\r\n            // case windoww.Components.DefaultNode.name:\r\n            case windoww.Components.DefaultNodeComponent.name:\r\n            // case windoww.Components.Graph.name:\r\n            case windoww.Components.GraphComponent.name:\r\n            // case windoww.Components.Field.name:\r\n            // case windoww.Components.FieldComponent.name:\r\n            // case windoww.Components.Vertex.name:\r\n            case windoww.Components.VertexComponent.name:\r\n                const injectProps: GraphElementOwnProps = {} as any;\r\n                injectProps.parentViewId = parentComponent.props.view.id || (parentComponent.props.view as any); // re.props.view ||  thiss.props.view\r\n                injectProps.parentnodeid = parentComponent.props.node?.id;\r\n                injectProps.graphid = parentComponent.props.graphid;\r\n                // const vidmap = GraphElementRaw.graphVertexID_counter;\r\n                // if (!vidmap[injectProps.graphid]) vidmap[injectProps.graphid] = {};\r\n                // const gvidmap = vidmap[injectProps.graphid];\r\n                const validVertexIdCondition = (id: string): boolean => gvidmap[id];\r\n                // todo: come butto dei sotto-vertici dentro un vertice contenitore? o dentro un sotto-grafo? senza modificare il jsx ma solo draggando?\r\n                const dataid = typeof re.props.data === \"string\" ? re.props.data : re.props.data?.id;\r\n                const idbasename: string = injectProps.graphid + '^' + dataid;\r\n                // console.log(\"setting nodeid\", {injectProps, props:re.props, re});\r\n                Log.exDev(!injectProps.graphid || !dataid, 'vertex is missing mandatory props.', {graphid: injectProps.graphid, dataid, props: re.props});\r\n                injectProps.nodeid = U.increaseEndingNumber(idbasename, false, false, validVertexIdCondition);\r\n                gvidmap[injectProps.nodeid] = true;\r\n                injectProps.key = injectProps.nodeid; // re.props.key || thiss.props.view.id + '_' + thiss.props.data.id;\r\n                // console.log(\"cloning jsx:\", re, injectProps);\r\n                return React.cloneElement(re, injectProps);\r\n        }}\r\n\r\n    static ReactNodeAsElement(e: React.ReactNode): React.ReactElement | null { return e && (e as ReactElement).type ? e as ReactElement : null; }\r\n\r\n    public static async deleteWithAlarm(lItem: LPointerTargetable) {\r\n        const MySwal = withReactContent(Swal);\r\n        const confirm = await MySwal.fire({\r\n            title: \"Delete \" + lItem.toString() + \"?\",\r\n            showCancelButton: true,\r\n            confirmButtonText: \"Yes\",\r\n            cancelButtonText: \"No\",\r\n            showLoaderOnConfirm: true\r\n        });\r\n        if (confirm.value === true) {\r\n            lItem.delete();\r\n        }\r\n    }\r\n    public static async info(text: string) {\r\n        const MySwal = withReactContent(Swal);\r\n        const confirm = await MySwal.fire({\r\n            title: text,\r\n            showCancelButton: false,\r\n            confirmButtonText: \"Got It\"\r\n        });\r\n    }\r\n}\r\n","import {DPointerTargetable, LPointerTargetable, RuntimeAccessible} from \"../../joiner\";\r\n\r\n@RuntimeAccessible\r\nexport class DLog extends DPointerTargetable {\r\n    static logic: typeof LPointerTargetable;\r\n    value: string;\r\n    constructor(value: string) {\r\n        super('todo' as any);\r\n        this.value = value;\r\n        this.className = this.constructor.name;\r\n    }\r\n}\r\n","import {LPointerTargetable, RuntimeAccessible} from \"../../joiner\";\r\n\r\n@RuntimeAccessible\r\nexport class LLog extends LPointerTargetable {\r\n    // static structure: typeof DLog;\r\n    // static singleton: LLog;\r\n    value!: string;\r\n//    protected constructor(value: string) {super(); }\r\n}\r\n","import type {\r\n    DClassifier,\r\n    DExtEdge,\r\n    DGraphElement,\r\n    DLog,\r\n    DModelElement,\r\n    DParameter,\r\n    DRefEdge, GObject,\r\n    LAttribute,\r\n    LClass,\r\n    LClassifier,\r\n    LEdgePoint,\r\n    LEnumerator,\r\n    LEnumLiteral,\r\n    LExtEdge,\r\n    LGraph,\r\n    LGraphVertex,\r\n    LLog,\r\n    LOperation,\r\n    LPackage,\r\n    LParameter,\r\n    LRefEdge,\r\n    LReference,\r\n    LVertex,\r\n    Pointer\r\n} from '../joiner';\r\nimport {\r\n    CreateElementAction,\r\n    DAttribute,\r\n    DClass,\r\n    DModel,\r\n    DEnumerator,\r\n    DEnumLiteral,\r\n    DGraph,\r\n    DObject,\r\n    DOperation,\r\n    DPackage,\r\n    DPointerTargetable,\r\n    DReference,\r\n    DUser,\r\n    DValue,\r\n    DViewElement,\r\n    getPath, LModel,\r\n    LObject,\r\n    LUser,\r\n    LValue, LViewElement,\r\n    RuntimeAccessible, SetFieldAction,\r\n    SetRootFieldAction, ShortAttribETypes,\r\n} from \"../joiner\";\r\nimport React from \"react\";\r\nimport {DV} from \"../common/DV\";\r\nimport LeaderLine from \"leader-line-new\";\r\nimport {DViewPoint, LViewPoint} from \"../view/viewPoint/viewpoint\";\r\n\r\nconsole.warn('ts loading store');\r\n\r\n// @RuntimeAccessible\r\n// NB: le voci che iniziano con '_' sono personali e non condivise\r\n\r\n\r\nexport interface EdgeOptions{\r\n    id: number,\r\n    options: LeaderLine.Options,\r\n    source: string,\r\n    target: string\r\n}\r\n\r\n// export const statehistory_obsoleteidea: {past: IStore[], current: IStore, future: IStore[]} = { past:[], current: null, future:[] } as any;\r\nexport const statehistory: {\r\n        [userpointer:Pointer<DUser>]: {undoable:GObject<\"delta\">[], redoable: GObject<\"delta\">[]}\r\n} & {\r\n    globalcanundostate: boolean // set to true at first user click }\r\n} = { globalcanundostate: false} as any;\r\nstatehistory[DUser.current] = {undoable:[], redoable:[]}; // todo: make it able to combine last 2 changes with a keystroke. reapeat N times to combine N actions. let it \"redo\" multiple times, it's like recording a macro.\r\n\r\n(window as any).statehistory = statehistory;\r\nexport class IStore {\r\n    logs: Pointer<DLog, 0, 'N', LLog> = [];\r\n    models: Pointer<DModel, 0, 'N'> = []; // Pointer<DModel, 0, 'N'>[] = [];\r\n    currentUser: DUser;\r\n\r\n    viewelements: Pointer<DViewElement, 0, 'N', LViewElement> = [];\r\n    stackViews: Pointer<DViewElement, 0, 'N', LViewElement> = [];\r\n\r\n    // users: Dictionary<DocString<Pointer<DUser>>, UserState> = {};\r\n    // collaborators: UserState[];\r\n    idlookup: Record<Pointer<DPointerTargetable, 1, 1>, DPointerTargetable> = {};\r\n\r\n    //// DClass section to fill\r\n    graphs: Pointer<DGraph, 0, 'N', LGraph> = [];\r\n    voidvertexs: Pointer<DGraph, 0, 'N', LGraphVertex> = [];\r\n    vertexs: Pointer<DGraph, 0, 'N', LVertex> = [];\r\n    graphvertexs: Pointer<DGraph, 0, 'N', LGraphVertex> = [];\r\n\r\n    edgepoints: Pointer<DGraph, 0, 'N', LEdgePoint> = [];\r\n    //my addon\r\n    extEdges: Pointer<DExtEdge, 0, \"N\", LExtEdge> = [];\r\n    refEdges: Pointer<DRefEdge, 0, \"N\", LRefEdge> = [];\r\n\r\n    classifiers: Pointer<DClassifier, 0, 'N', LClassifier> = [];\r\n    enumerators: Pointer<DEnumerator, 0, 'N', LEnumerator> = [];\r\n    packages: Pointer<DPackage, 0, 'N', LPackage> = [];\r\n    primitiveTypes: Pointer<DClass, 0, \"N\", LClass> = [];\r\n    attributes: Pointer<DAttribute, 0, \"N\", LAttribute> = [];\r\n    enumliterals: Pointer<DEnumLiteral, 0, \"N\", LEnumLiteral> = [];\r\n    references: Pointer<DReference, 0, \"N\", LReference> = [];\r\n    classs: Pointer<DClass, 0, \"N\", LClass> = [];\r\n    operations: Pointer<DOperation, 0, \"N\", LOperation> = [];\r\n    parameters: Pointer<DParameter, 0, \"N\", LParameter> = [];\r\n    returnTypes: Pointer<DClass, 0, \"N\", LClass> = [];\r\n    /// DClass section end\r\n\r\n    isEdgePending: {user: Pointer<DUser, 1, 1, LUser>, source: Pointer<DClass, 1, 1, LClass>} = {user: '', source: ''};\r\n\r\n    contextMenu: {display: boolean, x: number, y: number} = { display: false, x: 0, y: 0 };\r\n\r\n    //dragging: {random: number, id: string} = { random: 0, id: \"\" }; fix\r\n    edges: EdgeOptions[] = [];  // delete\r\n\r\n    deleted : string[] = [];\r\n\r\n    objects: Pointer<DObject, 0, 'N', LObject> = [];\r\n    values: Pointer<DValue, 0, 'N', LValue> = [];\r\n\r\n    // private, non-shared fields\r\n    _lastSelected?: {\r\n        node: Pointer<DGraphElement, 1, 1>,\r\n        view: Pointer<DViewElement, 1, 1>,\r\n        modelElement: Pointer<DModelElement, 0, 1> // if a node is clicked: a node and a view are present, a modelElement might be. a node can exist without a modelElement counterpart.\r\n    };\r\n    users: Pointer<DUser, 1, 'N', LUser>;\r\n    _edgeSettings = { strokeWidth: 1, color: '#000000', zIndex: 150, path: 'smooth' }\r\n    _edgesDisplayed = { extend: true, referenceM2: true, referenceM1: true }\r\n\r\n    viewpoint: Pointer<DViewPoint, 1, 1, LViewPoint> = '';\r\n    viewpoints: Pointer<DViewPoint, 0, 'N', LViewPoint> = [];\r\n\r\n    m2models: Pointer<DModel, 0, 'N', LModel> = [];\r\n    m1models: Pointer<DModel, 0, 'N', LModel> = [];\r\n\r\n\r\n    constructor() {\r\n        // todo: this must become a pointer to idlookup and fire a CreateNewElementAction\r\n        this.currentUser = DUser.new(undefined, false);\r\n        this.users = [this.currentUser.id];\r\n        this.models = [];\r\n    }\r\n\r\n    static fakeinit(store?: IStore): void {\r\n        const graphDefaultViews: DViewElement[] = makeDefaultGraphViews();\r\n        for (let graphDefaultView of graphDefaultViews) { CreateElementAction.new(graphDefaultView); }\r\n\r\n        const viewpoint = DViewPoint.new('Default');\r\n        CreateElementAction.new(viewpoint);\r\n        SetRootFieldAction.new('viewpoint', viewpoint.id, '', true);\r\n/*\r\n        const dMetaModel = DModel.new(\"Metamodel\", undefined, true, true);\r\n        // CreateElementAction.new(dMetaModel);\r\n        CreateElementAction.new(DGraph.new(dMetaModel.id));\r\n        SetRootFieldAction.new('metamodel', dMetaModel.id, '', true);\r\n\r\n*/\r\n\r\n        for (let primitiveType of Object.values(ShortAttribETypes)) {\r\n            let dPrimitiveType;\r\n            if (primitiveType === ShortAttribETypes.void) continue; // or make void too without primitiveType = true, but with returnType = true?\r\n            else dPrimitiveType = DClass.new(primitiveType, false, false, true, false, '',undefined, true);\r\n            // CreateElementAction.new(dPrimitiveType);\r\n            SetRootFieldAction.new('primitiveTypes', dPrimitiveType.id, '+=', true);\r\n        }\r\n/*\r\n        const returnTypes = [\"void\", \"undefined\", \"null\"]; // rimosso undefined dovrebbe essere come void (in ShortAttribEtypes, null è ritornato solo dalle funzioni che normalmente ritornano qualche DObject, quindi tipizzato con quel DObject\r\n        for (let returnType of returnTypes) {\r\n            const dReturnType = DClass.new(returnType);\r\n            CreateElementAction.new(dReturnType);\r\n            SetRootFieldAction.new(\"returnTypes\", dReturnType.id, '+=', true);\r\n        }*/\r\n\r\n        /*\r\n        const dMetaModel = DModel.new(\"Metamodel\");\r\n        CreateElementAction.new(dMetaModel);\r\n        CreateElementAction.new(DGraph.new(dMetaModel.id));\r\n\r\n        const dModel: DModel = DModel.new('Model');\r\n        dModel.isMetamodel = false; dModel.father = dMetaModel.id;\r\n        CreateElementAction.new(dModel);\r\n        CreateElementAction.new(DGraph.new(dModel.id));\r\n        SetFieldAction.new(dMetaModel, 'models', dModel.id, '+=', true);\r\n        */\r\n\r\n    }\r\n\r\n    static makeM3Test(fireAction: boolean = true, outElemArray: DPointerTargetable[] = []): DModel {\r\n        const me: DClass = DClass.new('ModelElement', true);\r\n        const annotation: DClass = DClass.new('Annotation');\r\n        annotation.implements = [me.id];\r\n        const namedElement: DClass = DClass.new('NamedElement');\r\n        const attribname: DAttribute = DAttribute.new('name');\r\n        namedElement.implements = [me.id]; // , classifier.id, namedelement.id, modelelement.id]\r\n        namedElement.attributes = [attribname.id];\r\n\r\n        // todo: uncomment const pkg: DClass = new DClass('M3Package');\r\n        const pkg: DPackage = DPackage.new('M3Package');\r\n        const attriburi: DAttribute = DAttribute.new('uri');\r\n        // todo: uncomment pkg.implements = [namedElement.id];\r\n        // todo: uncomment pkg.attributes = [attriburi.id];\r\n        const classifierref: DReference = DReference.new('classifiers');\r\n        // todo: uncomment pkg.references = [classifierref.id];\r\n\r\n        const model: DClass = DClass.new('M3');\r\n        const pkgref: DReference = DReference.new('package');\r\n        model.implements = [namedElement.id];\r\n        //pkgref.type = pkg.id;\r\n        const classe: DClass = DClass.new('Class', false, true);\r\n        classifierref.type = classe.id;\r\n        classe.implements = [namedElement.id]; // , classifier.id, namedelement.id, modelelement.id]\r\n        /// model itself outside of ecore\r\n        const m3: DModel = DModel.new('M3');\r\n        m3.packages = [pkg.id];\r\n        // const m3graph: DGraph = DGraph.create(m3.id);\r\n        const m3graph: DGraph = DGraph.new(m3.id);\r\n        // m3.modellingElements = [me.id, annotation.id, namedElement.id, attribname.id, pkg.id, attriburi.id, classifierref.id, pkgref.id, classe.id];\r\n        // dispatching actions\r\n\r\n\r\n        const editinput = \"<Input className={''} field={'name'} />\";\r\n        // let m3view: DViewElement = new DViewElement('m3View', '<p style={{display: \"flex\", flexFlow: \"wrap\"}}><h1>m3view {this.data.name + (this.data.id)}</h1><i>{JSON.stringify(Object.keys(this))}</i>' + editinput + '</p>');\r\n        // let editView: DViewElement = makeEditView();\r\n        let graphDefaultViews: DViewElement[] = makeDefaultGraphViews();\r\n        outElemArray.push.call(outElemArray, m3, m3graph, me, annotation, namedElement, attribname, pkg, attriburi, classifierref, pkgref, classe, ...graphDefaultViews);\r\n        return m3;\r\n    }\r\n}\r\nfunction makeDefaultGraphViews(): DViewElement[] {\r\n\r\n    let mview: DViewElement = DViewElement.new('ModelDefaultView', DV.modelView(), undefined, '', '', '', [DModel.name]);\r\n    mview.draggable = false; mview.resizable = false; // mview.adaptWidth = true; mview.adaptHeight = true;\r\n    mview.adaptHeight = '-webkit-fill-available';\r\n    mview.adaptWidth = '-webkit-fill-available';\r\n\r\n    let pkgview: DViewElement = DViewElement.new('PackageDefaultView', DV.packageView(), undefined, '', '', '', [DPackage.name]);\r\n    pkgview.width = 500; pkgview.height = 500;\r\n\r\n    let cview: DViewElement = DViewElement.new('ClassDefaultView', DV.classView(), undefined, '', '', '', [DClass.name]);\r\n\r\n    let eview: DViewElement = DViewElement.new('EnumDefaultView', DV.enumeratorView(), undefined, '', '', '', [DEnumerator.name]);\r\n\r\n    let aview: DViewElement = DViewElement.new('AttribDefaultView', DV.attributeView(), undefined, '', '', '', [DAttribute.name]);\r\n\r\n\r\n    let rview: DViewElement = DViewElement.new('RefDefaultView', DV.referenceView(), undefined, '', '', '', [DReference.name]);\r\n\r\n\r\n    let oview: DViewElement = DViewElement.new('OperationDefaultView', DV.operationView(), undefined, '', '', '', [DOperation.name]);\r\n\r\n\r\n    let literalView: DViewElement = DViewElement.new('LiteralDefaultView', DV.literalView(), undefined, '', '', '', [DEnumLiteral.name]);\r\n\r\n\r\n    let objectView: DViewElement = DViewElement.new('ObjectDefaultView', DV.objectView(), undefined, '', '', '', [DObject.name]);\r\n\r\n    let valueView: DViewElement = DViewElement.new('ValueDefaultView', DV.valueView(), undefined, '', '', '', [DValue.name]);\r\n\r\n    const defaultPackage: DViewElement = DViewElement.new('Default Package', DV.defaultPackage());\r\n    defaultPackage.draggable = false; defaultPackage.resizable = false; defaultPackage.adaptWidth = false; defaultPackage.adaptHeight = false;\r\n    defaultPackage.query = `metamodel.packages.filter((pkg) => {return pkg.name === 'default'})`;\r\n\r\n    pkgview.subViews = [cview.id]; // children can use this view too todo: this is temporary\r\n\r\n    let alldefaultViews = [mview, pkgview, cview, eview, aview, rview, oview, literalView, objectView, valueView, defaultPackage];\r\n    mview.subViews = [mview.id, ...alldefaultViews.slice(1).map(e => e.id)]// children can use this view too todo: this is temporary, should just be the sliced map of everything else.\r\n    return alldefaultViews;\r\n}\r\n\r\nfunction makeEditView(): DViewElement{\r\n    // let jsx = <p><h1>edit view of {this.data.name}</h1><Input className={'raw'} obj={this.view.id} field={((getPath as DViewElement).jsxString as any).$}/></p>;\r\n    let jsxstring = '<p style={{display: \"flex\", flexFlow: \"wrap\"}}><h1>edit view of {this.data.name}</h1><Textarea obj={this.views[1].id} field={((getPath).jsxString).$}/></p>;';\r\n    let view: DViewElement = DViewElement.new('EditView', jsxstring);\r\n    view.subViews = [view.id]; // children can use this view too, this is indented and likely definitive.\r\n    return view;\r\n}\r\n/*\r\nclass SynchStore{// shared on session\r\n\r\n}\r\nclass AsynchStore{ // user private\r\n    pendingUserAction: UserPendingAction[];\r\n}*/\r\n/*\r\n@RuntimeAccessible\r\nexport class DUserState extends DPointerTargetable {\r\n    pointerPosition?: GraphPoint;\r\n    // nope, la selezione è vertex-wise, e il vertex è graph-dependent. la view è graph-indipendent. selection: Dictionary<Pointer<User, 1, 1>, Pointer<DGraphElement, 0, 'N'>[]> = {};\r\n    constructor() {\r\n        super(true);\r\n        this.className = this.constructor.name;\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LUserState extends MixOnlyFuncs(DUserState, LPointerTargetable) {\r\n    pointerPosition?: GraphPoint;\r\n    defaultView!: LViewElement;\r\n    // nope, la selezione è vertex-wise, e il vertex è graph-dependent. la view è graph-indipendent. selection: Dictionary<Pointer<User, 1, 1>, Pointer<DGraphElement, 0, 'N'>[]> = {};\r\n\r\n}\r\nDPointerTargetable.subclasses.push(DUserState);*/\r\n\r\n@RuntimeAccessible\r\nexport class ViewPointState extends DPointerTargetable{\r\n    name: string = '';\r\n}\r\n\r\n// todo: ogni entità ha: dati (store), logica con operazioni, dati di presentazione, ...?\r\n\r\n@RuntimeAccessible\r\nexport class ModelStore {\r\n    private _meta!: ModelStore | string; // todo: credo sia un Pointer? roba vecchia. oldcomment: // string memorizzata nello store, logicamente si comporta come una reference perchè usi la stringa per recuperare un modelstore (il tipo modelstore è di documentazione)\r\n    instances!: (ModelStore | string)[];\r\n\r\n    // todo: figata! getter e setter senza proxy??\r\n    get meta(): ModelStore | string {\r\n        return this._meta;\r\n    }\r\n\r\n    set meta(value: ModelStore | string) {\r\n        this._meta = value;\r\n    }\r\n}\r\n/*\r\ntype Cconnect = <TStateProps = {}, TDispatchProps = {}, TOwnProps = {}, State = DefaultState>(\r\n    mapStateToProps: MapStateToPropsParam<TStateProps, TOwnProps, State>,\r\n    mapDispatchToProps: MapDispatchToPropsNonObject<TDispatchProps, TOwnProps>\r\n): InferableComponentEnhancerWithProps<TStateProps & TDispatchProps, TOwnProps>;\r\n*/\r\n// export const initialState: IStore = new IStore();\r\n// console.info('ts loaded store');\r\n","import type {U as UType} from '../../joiner';\r\nimport {\r\n    Action,\r\n    CompositeAction,\r\n    CreateElementAction,\r\n    DeleteElementAction,\r\n    Dictionary,\r\n    DocString,\r\n    DPointerTargetable,\r\n    IStore,\r\n    Log,\r\n    MyError,\r\n    ParsedAction,\r\n    Pointer,\r\n    RuntimeAccessibleClass,\r\n    SetFieldAction,\r\n    SetRootFieldAction,\r\n    LPointerTargetable,\r\n    store,\r\n    getPath,\r\n    Selectors,\r\n    PointedBy,\r\n    PendingPointedByPaths,\r\n    statehistory, DUser, GObject\r\n} from \"../../joiner\";\r\nimport React from \"react\";\r\nimport {CombineHistoryAction, LoadAction, RedoAction, UndoAction} from \"../action/action\";\r\n\r\nlet windoww = window as any;\r\nlet U: typeof UType = windoww.U;\r\n\r\nfunction deepCopyButOnlyFollowingPath(oldStateDoNotModify: IStore, action: ParsedAction, prevAction: ParsedAction, newVal: any): IStore {\r\n    let newRoot: IStore = {...oldStateDoNotModify} as IStore;\r\n    let current: any = newRoot;\r\n    if (!action.path?.length) throw new MyError(\"path length must be at least 1\", {action});\r\n    let gotChanged: boolean = false; // dovrebbe cambiare sempre, se non cambia non lancio neanche l'azione e non faccio la shallow copy, ma non si sa mai, così posso evitare un render se succede l' \"insuccedibile\"\r\n    let alreadyPastDivergencePoint = false; // true dal momento in cui il path dell'azione attuale e della azione precedente divergono, false fino al sotto-segmento in cui combaciano\r\n    // console.log('deepCopyButOnlyFollowingPath', arguments);\r\n    for (let i = 0; i < action.pathArray.length; i++) {\r\n        let key = action.pathArray[i].trim();\r\n        let prevActionPathKey = prevAction?.pathArray[i];\r\n        // middle execution: not on final loop\r\n        // console.log('deepCopyButOnlyFollowingPath', {current, i, imax:action.pathArray.length, key, gotChanged, alreadyPastDivergencePoint});\r\n        if (i !== action.pathArray.length - 1) {\r\n            if (alreadyPastDivergencePoint || key !== prevActionPathKey) {\r\n                // se l'oggetto è stato già duplicato in una azione composita, non lo duplico 2 volte.\r\n                alreadyPastDivergencePoint = true;\r\n                current[key] = Array.isArray(current[key]) ? [...current[key]] : {...current[key]};\r\n                current[key].clonedCounter = 1 + (current[key].clonedCounter || 0);\r\n            }\r\n            current = current[key];\r\n            continue; }\r\n\r\n        // perform final assignment\r\n        if (i >= action.pathArray.length - 1) {\r\n            let isArrayAppend = false;\r\n            let isArrayRemove = false;\r\n            // console.log('isarrayappend?', {endswith: U.endsWith(key, ['+=', '[]', '-1']), key, action, i});\r\n            // console.log('isarraydelete?', {endswith: U.endsWith(key, ['-='])});\r\n            if (U.endsWith(key, ['+=', '[]'])) {\r\n                key = key.substr(0, key.length - 2).trim();\r\n                isArrayAppend = true; }\r\n            if (U.endsWith(key, ['-='])) {\r\n                key = key.substr(0, key.length - 2).trim();\r\n                isArrayRemove = true; }\r\n\r\n            let oldValue: any;\r\n            let unpointedElement: DPointerTargetable | undefined;\r\n            // perform final assignment\r\n            if (isArrayAppend) {\r\n                gotChanged = true;\r\n                if (!Array.isArray(current[key])) { current[key] = []; }\r\n                oldValue = [...current[key]];\r\n                current[key] = [...current[key]];\r\n                current[key].push(newVal);\r\n                unpointedElement = undefined;\r\n                if (action.isPointer) { newRoot = PointedBy.add(newVal as Pointer, action, newRoot, \"+=\"); }\r\n            } else\r\n            if (isArrayRemove){\r\n                if (!Array.isArray(current[key])) { current[key] = []; }\r\n                oldValue = [...current[key]];\r\n                let index = U.isNumber(newVal) ? +newVal : -1;\r\n                if (index === -1) index = current[key].length - 1;\r\n                gotChanged = index >=0 && index < current[key].length;\r\n                if (gotChanged){\r\n                    current[key] = [...current[key]];\r\n                    let removedval = current[key].splice(index, 1); // in-place edit\r\n                    if (action.isPointer) { newRoot = PointedBy.remove(removedval as Pointer, action, newRoot, '-='); }\r\n\r\n                    /// a.pointsto = [x, y, z]; a.pointsto = [x, z]       --->    remove a from y.pointedby\r\n                    /*\r\n                    const elementsThatChangedIndex: DPointerTargetable[] = current[key].slice(index);\r\n                    todo: problema: se ho [dobj1, dobj2]... e li swappo, cambia un indice nel percorso \"pointedby\" e non me ne accorgo mai e un oggetto risulta \"pointedby\" da oggetti che non lo puntano o non esistono più a quell'indice\r\n                    for (let j = 0; j < elementsThatChangedIndex.length; j++) {\r\n                        let newindex = index + j - 1;\r\n                        let oldFullpathTrimmed = action.pathArray.join('.');\r\n                        se realizzi \"pointedby\" qui è to do: remove old paths and re-add them with updated index\r\n                    }*/\r\n                    //unpointedElement = newRoot.idlookup[oldValue];\r\n                }\r\n            }\r\n            else if (current[key] !== newVal) {\r\n                // todo: caso in cui setto manualmente classes.1 = pointer; // the latest element is array and not DPointerTargetable, so might need to buffer upper level in the tree? or instead of \"current\" keep an array of sub-objects encountered navigating the path in state.\r\n                oldValue = current[key];\r\n                gotChanged = true;\r\n                unpointedElement = newRoot.idlookup[oldValue];\r\n                // NB: se elimino un oggetto che contiene array di puntatori, o resetto l'array di puntatori kinda like store.arr= [ptr1, ptr2, ...]; store.arr = [];\r\n                // i puntati dall'array hanno i loro pointedBY non aggiornati, non voglio fare un deep check di tutto l'oggetto a cercare puntatori per efficienza.\r\n                if (newVal === undefined) delete current[key];\r\n                else current[key] = newVal;\r\n\r\n                if (action.isPointer) {\r\n                    if (Array.isArray(action.value)) {\r\n                        let oldpointerdestinations: Pointer[] = oldValue;\r\n                        let difference = U.arrayDifference(oldpointerdestinations, current[key]); // : {added: Pointer[], removed: Pointer[], starting: Pointer[], final: Pointer[]}\r\n                        for (let rem of difference.removed) { newRoot = PointedBy.remove(rem as Pointer, action, newRoot); }\r\n                        for (let add of difference.added) { newRoot = PointedBy.add(add as Pointer, action, newRoot); }\r\n                        // a.pointsto = [a, b, c];  a.pointsto = [a, b, x];    ------>     c.pointedby.remove(a) & x.pointedby.add(a)\r\n                        // idlookup.somelongid.pointsto = [...b];\r\n                    }\r\n                    else {\r\n                        // a.pointsto = b;  a.pointsto = c;    ------>     b.pointedby.remove(a)\r\n                        newRoot = PointedBy.remove(oldValue as Pointer, action, newRoot);\r\n                        newRoot = PointedBy.add(current[key] as Pointer, action, newRoot);\r\n                    }\r\n                }\r\n            } else {\r\n                gotChanged = false;\r\n                // value not changed\r\n            }\r\n\r\n            let fullpathTrimmed = action.pathArray.join('.');\r\n            /*if (unpointedElement) {\r\n                if (isArrayAppend || isArrayAppend) fullpathTrimmed.substr(0, fullpathTrimmed.length - 2);\r\n                U.arrayRemoveAll(unpointedElement.pointedBy, fullpathTrimmed); // todo: se faccio una insert in mezzo ad un array devo aggiustare tutti i path di pointedby...\r\n            }\r\n            let newlyPointedElement = newRoot.idlookup[newVal];\r\n            if (newlyPointedElement) {\r\n                U.ArrayAdd(newlyPointedElement.pointedBy, fullpathTrimmed);\r\n            }*/\r\n            // console.log('deepCopyButOnlyFollowingPath final', {current, i, imax:action.pathArray.length, key, isArrayAppend, gotChanged, alreadyPastDivergencePoint});\r\n            break;\r\n        }\r\n        Log.exDevv('should not reach here: reducer');\r\n    }\r\n    return gotChanged ? newRoot : oldStateDoNotModify;\r\n}\r\n\r\n\r\n// const pendingPointedByPaths: {from: DocString<\"Path in store\">, field: DocString<\"keyof object found in from path\">, to: Pointer}[] = [];\r\nfunction CompositeActionReducer(oldState: IStore, actionBatch: CompositeAction): IStore {\r\n    // per via di thunk se arrivo qui lo stato cambia sicuro in mono-client non synchro (non ri-assegno valori equivalenti)\r\n    // todo: ma se arrivano in ordine sbagliato da altri client? posso permetterlo?\r\n    let actions: ParsedAction[];\r\n    if (actionBatch.actions) actions = Action.parse(actionBatch.actions);\r\n    else actions = [Action.parse(actionBatch)]; // else-case is if it's a single action and not an actual compositeaction\r\n    if (PendingPointedByPaths.all.length) actions.push(...PendingPointedByPaths.getSolveableActions(oldState)); //.all.map( p=> p.resolve() ) );\r\n\r\n    Action.possibleInconsistencies = {};\r\n\r\n    // estraggo le azioni derivate\r\n    let derivedActions: ParsedAction[] = [];\r\n    for (let action of actions) {\r\n        switch (action.type){\r\n            default: break;\r\n            case LoadAction.type: return action.value;\r\n            case CreateElementAction.type:\r\n                const elem: DPointerTargetable = action.value;\r\n                elem.className = elem.className || elem.constructor.name;\r\n                let statefoldername = elem.className.substring(1).toLowerCase() + 's';\r\n                derivedActions.push(\r\n                    Action.parse(SetRootFieldAction.create(statefoldername, elem.id,'[]', true)));\r\n                if (!Array.isArray(elem.pointedBy)) elem.pointedBy = [];\r\n                elem.pointedBy.push(PointedBy.new(statefoldername));\r\n                /*if (false && action.isPointer) {\r\n                    if (Array.isArray(action.value)) {\r\n                        const ptr: Pointer[] = action.value;\r\n                        // todo but replaced by side actions in execution of the main action instead of triggering derived actions\r\n                    }\r\n                    else {\r\n                        const ptr: Pointer = action.value;\r\n                        const target: DPointerTargetable | null = oldState.idlookup[ptr];\r\n                        let pendingPointedBy = PendingPointedByPaths.new(action, oldState);\r\n                        if (!target) PendingPointedByPaths.new(action, oldState).saveForLater(); // {from: action.path, field: action.field, to: target});\r\n                        // @ts-ignore\r\n                        else derivedActions.push(pendingPointedBy.resolve());\r\n                        // a -> x\r\n                        // a -> y     unset x.pointedby(a)\r\n                    }\r\n                }*/\r\n                break;\r\n        }\r\n    }\r\n    // console.error({U, Umip:U.arrayMergeInPlace, WU: windoww.U, WUmip: windoww.U.arrayMergeInPlace});\r\n    actions = U.arrayMergeInPlace<ParsedAction>(actions, derivedActions);\r\n\r\n    // ordino i path con segmenti comuni\r\n    actions = actions.sort( (a1, a2) => U.stringCompare(a1.path, a2.path));\r\n\r\n    // destrutturo solo i nodi intermedi e solo la prima volta che li incontro (richiede le azioni ordinate in base al path)\r\n    let newState = oldState;\r\n    for (let i = 0; i < actions.length; i++) {\r\n        const prevAction: ParsedAction = actions[i-1];\r\n        const action: ParsedAction = actions[i];\r\n        const actiontype = action.type.indexOf('@@') === 0 ? 'redux' : action.type;\r\n        console.log('executing action:', {action, actiontype, count: ++action.executionCount});\r\n\r\n        switch (actiontype) {\r\n            /*\r\n            case '@@redux/INIT6.x.f.d.r.e':\r\n            case '@@redux/INITm.f.1.s.o.g':\r\n            case '@@redux/INIT5.t.4.v.d.o':\r\n            case '@@redux/INITy.a.d.r.l.a':\r\n            case '@@redux/INIT4.2.q.u.z.k':\r\n            case '@@redux/INITj.8.e.g.y.p':\r\n            case '@@redux/INITp.k.q.g.z.w':\r\n            case '@@redux/INITq.c.u.w.f.e': ... etc*/\r\n            default:\r\n                if (action.type.indexOf('@@redux/') === 0) break;\r\n                return Log.exDevv('unexpected action type:', action.type);\r\n            case CreateElementAction.type:\r\n            case SetRootFieldAction.type:\r\n            case DeleteElementAction.type:\r\n            case SetFieldAction.type:\r\n                newState = deepCopyButOnlyFollowingPath(newState, action, prevAction, action.value);\r\n                break;\r\n        }\r\n\r\n        // and that's all, the reducer is really simple as actions are really simple.\r\n    }\r\n\r\n    // effetti collaterali, aggiornamento di ridondanze\r\n    newState = updateRedundancies_OBSOLETE(newState, oldState, Action.possibleInconsistencies);\r\n    return newState;\r\n}\r\n\r\nfunction updateRedundancies_OBSOLETE(state: IStore, oldState:IStore, possibleInconsistencies: Dictionary<DocString<'subtype'>, (Pointer | DPointerTargetable)[]>): IStore {\r\n    for (let subType in possibleInconsistencies)\r\n    switch (subType) {\r\n        default: break;\r\n        case Action.SubType.vertexSubElements:/*\r\n            risolto triggrerando più azioni da LGraphElement setter\r\n            let dvertexid: Pointer, newdvertex: DGraphElement, olddvertex: DGraphElement;\r\n            for (newdvertex of possibleInconsistencies[subType] as DGraphElement[]){\r\n                const olddvertex: DGraphElement = oldState.idlookup[newdvertex.id] as DGraphElement;\r\n                const notContainedAnymoreOut: Pointer<DGraphElement> = [];\r\n                const newlyInsertedOut: Pointer<DGraphElement>[] = [];\r\n                U.arraySymmetricDifference(olddvertex.subElements, newdvertex.subElements, notContainedAnymoreOut, newlyInsertedOut);\r\n                for (let geid of notContainedAnymoreOut) {\r\n                    const oldge = oldState.idlookup[geid] as DGraphElement;\r\n                    const newge = state.idlookup[geid] as DGraphElement;\r\n                    if (oldge.containedIn === newge.containedIn) continue;\r\n                }\r\n                for (let geid of notContainedAnymoreOut) {\r\n                    const ge = idlookup[geid] as DGraphElement;\r\n                    if (ge.containedIn === context.data.id) set container = context.data.id\r\n                    meglio se sti 2 cicli li fai nel reducer perchè  potrebbe esserci una azione pending che setta il parent = someotherid e qui faccio partire una azione che setta il parent a null, \"annullando\" una azione pending non ancora eseguita\r\n                }\r\n            }\r\n            break;*/\r\n    }\r\n    // if state is updated shallow copy state before returning it\r\n    return state;\r\n}\r\n\r\nlet initialState: IStore = null as any;\r\nlet storeLoaded: boolean = false;\r\n\r\nexport function reducer/*<S extends StateNoFunc, A extends Action>*/(oldState: IStore = initialState, action: Action): IStore{\r\n    let times: number;\r\n    let state: IStore;\r\n    switch(action.type) {\r\n        case UndoAction.type:\r\n            times = action.value;\r\n            state = oldState;\r\n            Log.exDev(times<=0, \"undo must be positive\", action);\r\n            while (times--) {\r\n                state = undo(state, statehistory[DUser.current].undoable.pop());\r\n            }\r\n            return state;\r\n\r\n        case RedoAction.type:\r\n            times = action.value;\r\n            state = oldState;\r\n            Log.exDev(times<=0, \"redo must be positive\", action);\r\n            while (times--) {\r\n                state = undo(state, statehistory[DUser.current].redoable.pop(), false);\r\n            }\r\n            return state;\r\n        // case CombineHistoryAction.type: return combineHistory(oldState); break;\r\n        // todo: se al posto di \"annullare l'undo\" memorizzo l'azione e la rieseguo, posso ripetere l'ultimo passo N volte e questa azione diventa utile per combinare passi e ripetere blocchi di azioni assieme\r\n        default:\r\n            let ret = doreducer(oldState, action);\r\n            if (ret === oldState) return ret;\r\n            statehistory[DUser.current].redoable = [];\r\n            let delta =  U.objectDelta(ret, oldState);\r\n            if (!filterundoableactions(delta)) return ret;\r\n            // console.log(\"setting undoable action:\", {ret, oldState0:{...oldState}, oldState, delta});\r\n            if (oldState !== null) statehistory[DUser.current].undoable.push(delta);\r\n            return ret;\r\n    }\r\n}\r\n\r\nfunction filterundoableactions(delta: Partial<IStore>): boolean {\r\n    if (!statehistory.globalcanundostate) return false;\r\n    if (Object.keys(delta).length === 1 && \"dragging\" in delta) return false;\r\n    if (Object.keys(delta).length === 1 && \"_lastSelected\" in delta) return false;\r\n    if (Object.keys(delta).length === 1 && \"contextMenu\" in delta) return false;\r\n    return true;\r\n}\r\nfunction undo(state: IStore, delta: GObject | undefined, isundo = true): IStore {\r\n    if (!delta) return state;\r\n    let undonestate = {...state};\r\n    //   controlla se vengono shallow-copied solo e tutti gli oggetti nested lungo la catena del percorso delle modifiche\r\n    //   es: root.a.b.c=3 + root.a.b.d=3 = 4+1 modifiche, 5 shallow copies including the root\r\n    undorecursive(delta, undonestate);\r\n    if (isundo) statehistory[DUser.current].redoable.push( U.objectDelta(undonestate, state) ); // reverses from undo to redo and viceversa swapping arguments, so the target result after appliying the delta changes\r\n    else statehistory[DUser.current].undoable.push( U.objectDelta(undonestate, state) ); // redo is \"undoing an undo\", reversing his changes just like an undo reverses an ordinary action changes.\r\n    return undonestate;\r\n}\r\n\r\nfunction undorecursive(deltalevel: GObject, statelevel: GObject): void {\r\n    // statelevel = {...statelevel}; not working if i do it here, just a new var. first time copy id done in caller func undo(). recursive copies are done before recursive step\r\n    for (let key in deltalevel) {\r\n        let delta = deltalevel[key];\r\n        console.log(\"undoing\", {delta, key, deltalevel, statelevel})\r\n        if (key.indexOf(\"_-\") === 0) { delete statelevel[key.substring(2)]; continue; }\r\n        if (typeof delta === \"object\") {\r\n        // if (U.isObject(delta, false, false, true)) {\r\n            statelevel[key] = {...statelevel[key]};\r\n            undorecursive(deltalevel[key], statelevel[key]); }\r\n        else { statelevel[key] = delta; }\r\n    }\r\n}\r\n\r\nfunction doreducer/*<S extends StateNoFunc, A extends Action>*/(oldState: IStore = initialState, action: Action): IStore{\r\n    if (!oldState) { oldState = initialState = new IStore(); }\r\n    let ca: CompositeAction;\r\n    // console.log('external REDUCER', {action, CEtype:CreateElementAction.type});\r\n    if (!storeLoaded) {\r\n        // new SetRootFieldAction('forceinit', true);\r\n        storeLoaded = true;\r\n    }\r\n    if (!(oldState as any).forceinit) {\r\n        // afterStoreLoad();\r\n        // new SetRootFieldAction('forceinit', true);\r\n    } //  setTimeout(afterStoreLoad, 1);\r\n    switch (action.type) {\r\n        case CompositeAction.type: ca = action as CompositeAction; break;\r\n        case LoadAction.type:\r\n        default:\r\n            if (action.type.indexOf('@@redux/') === 0) {\r\n                //storeLoaded = true;\r\n                return oldState;\r\n            }\r\n            ca = new CompositeAction([action], false);\r\n            break;\r\n    }\r\n    let ret = CompositeActionReducer(oldState, ca);\r\n    /*if (state.current !== ret) {\r\n        state.current = ret;\r\n        state.past.push(ret);\r\n    }*/\r\n    return ret;\r\n}\r\n\r\nfunction buildLSingletons(alld: Dictionary<string, typeof DPointerTargetable>, alll: Dictionary<string, typeof LPointerTargetable>) {\r\n    for (let dname in alld) {\r\n        switch (dname) {\r\n            case \"DeleteElementAction\": continue;\r\n            case \"DV\": continue;\r\n            default: break;\r\n        }\r\n        let tagless = dname.substring(1);\r\n        let d = alld[dname];\r\n        let l = alll['L'+tagless];\r\n        d.logic = l;\r\n        if (!l) console.error('lllllllll', l, d);\r\n        // @ts-ignore\r\n        d.singleton = new l('dwc');\r\n        d.structure = d;\r\n\r\n        l.logic = d.logic;\r\n        l.singleton = d.singleton;\r\n        l.structure = d.structure;\r\n\r\n        if (!d.subclasses) d.subclasses = [];\r\n        // @ts-ignore\r\n        for (let sc of d.subclasses) { if (!sc[\"_extends\"]) sc[\"_extends\"] = [];  sc[\"_extends\"].push(d); }\r\n    }\r\n}\r\n\r\nexport function jodelInit() {\r\n    RuntimeAccessibleClass.fixStatics();\r\n\r\n    let dClasses: string[] = RuntimeAccessibleClass.getAllNames().filter( rc => rc[0] === 'D');\r\n    let lClasses: string[] = RuntimeAccessibleClass.getAllNames().filter( rc => rc[0] === 'L');\r\n    let dClassesmap: Dictionary<string, typeof DPointerTargetable> = dClasses.reduce((acc: any,curr)=> (acc[curr] = RuntimeAccessibleClass.get(curr), acc),{});\r\n    let lClassesmap: Dictionary<string, typeof LPointerTargetable> = lClasses.reduce((acc: any,curr)=> (acc[curr] = RuntimeAccessibleClass.get(curr), acc),{});\r\n    buildLSingletons(dClassesmap, lClassesmap);\r\n\r\n\r\n    windoww.defaultContext = {$: windoww.$, getPath, React: React, Selectors, ...RuntimeAccessibleClass.getAllClassesDictionary(), ...windoww.Components};\r\n\r\n    console.log('EXecute on read RuntimeClasses:', {dClasses, allClasses: {...RuntimeAccessibleClass.classes}});\r\n    /*for (let dclassname of dClasses) {\r\n        const dclass = RuntimeAccessibleClass.get(dclassname) as typeof DPointerTargetable;\r\n        const lclass = RuntimeAccessibleClass.get('L' + dclassname.substr(1)) as typeof LPointerTargetable;\r\n        dclass.logic = lclass;\r\n        console.log('EXecute on read set singletons:', {dclass, lclass});\r\n        if (!lclass) continue;\r\n        lclass.singleton = new lclass();\r\n        lclass.structure = dclass;\r\n    }*/\r\n\r\n    IStore.fakeinit();\r\n//    setTimeout( () => createOrOpenModelTab('m3'), 1);\r\n    // GraphDragHandler.init();\r\n\r\n}\r\n\r\n// ideally launched before component render, verify it. maybe move the callback to <App> component mounting\r\nfunction afterStoreLoad() {\r\n    jodelInit();\r\n}\r\n","import {createStore, Store} from \"redux\";\r\nimport {Action, IStore, reducer, windoww} from \"../joiner\";\r\n\r\ninterface StateExt{}\r\nexport let store: Store<IStore & StateExt, Action> = createStore(reducer);\r\n\r\nwindoww.store = store;\r\nwindoww.s = store.getState;\r\n\r\n// console.log('store:', {store, wstore: windoww.store, state: U.cloneObj(store.getState())});\r\n","import {OclEngine} from \"@stekoe/ocl.js\"\r\nimport {Constructor, GObject, RuntimeAccessible} from \"../joiner\";\r\nimport {OclResult} from \"@stekoe/ocl.js/dist/components/OclResult\";\r\n\r\nlet windoww = window as any;\r\n\r\nexport class Company {\r\n    static all: Company[] = [];\r\n    constructor(public name: string ='cname', public employee: Persona[]=[], public manager: Persona|null = null) { Company.all.push(this); }\r\n}\r\n@RuntimeAccessible\r\nexport class Persona {\r\n    static all: Persona[] = [];\r\n    constructor(public name: string='pname', public age: number=18, public isUnemployed: boolean=true){ Persona.all.push(this) }\r\n}\r\n\r\nexport class OCL{\r\n    public static evaluate<T extends GObject>(obj0: T, constructor: Constructor<T>, oclexp: string, typeused: Constructor[]=[], oclEngine?: OclEngine): OclResult {\r\n        if (!oclEngine) {\r\n            oclEngine = OclEngine.create();\r\n            var oclResult = null;\r\n            // let objexp = //\"context Object inv: self.age > 0\" +\r\n            if (!oclexp) oclexp = \"context Persona inv: self.age>0\";\r\n\r\n\r\n            const typeregister: GObject = {};\r\n            typeregister[constructor.name] = constructor;\r\n            for (let type of typeused) { typeregister[type.name] = type; }\r\n            oclEngine.registerTypes(typeregister);\r\n            oclEngine.addOclExpression(oclexp);\r\n        }\r\n\r\n        let obj: GObject = obj0;\r\n        if (!obj) {\r\n            obj = new Persona();\r\n            obj.age = -55;\r\n            obj.name = {notEmpty: () => { console.log('innerfunc'); return true} };\r\n            obj.f = (a:any) => { console.error('called a', a); return a>0};\r\n            obj.name0= '';\r\n//obj.$$typeof = Persona;\r\n\r\n            obj.__asArray = true;\r\n        }\r\n        // as you set classname in runtimeaccessible you must set this typeName\r\n        // obj.typeName = constructor.name || constructor;\r\n// obj = getPath;\r\n// obj.constructor = Persona;\r\n        oclResult = oclEngine.evaluate(obj);\r\n        return oclResult;\r\n    }\r\n\r\n    public static filter<T extends GObject>(keepIndex: boolean, returnType: 'ocl' | 'bool' | 'src', obj0: T[], oclexp: string, typeused: Constructor[]=[]) {\r\n        var oclEngine = OclEngine.create();\r\n        var oclResult = null;\r\n        const typeregister: GObject = {};\r\n        for (let type of typeused) { typeregister[type.name] = type; }\r\n        oclEngine.registerTypes(typeregister);\r\n        if (!oclexp) oclexp = \"context Persona inv: self.age>0\";\r\n        oclEngine.addOclExpression(oclexp);\r\n\r\n        let obj: GObject[] = obj0;\r\n        let ret: ((OclResult | boolean) | (GObject | null))[] = [];\r\n\r\n        for (let i = 0; i < obj.length; i++) {\r\n            let res: OclResult | null;\r\n            try { res = oclEngine.evaluate(obj[i]); }\r\n            catch(e) { console.error('failed to evalute object:', {e}); res = null; }\r\n            if (returnType === 'ocl') {\r\n                ret[i] = res;\r\n                continue; }\r\n            let bool = res && res.getEvaluatedContexts().length > 0 && res.getResult();\r\n            if (returnType === 'bool') ret[i] = bool;\r\n            else ret[i] = bool ? obj[i] : null;\r\n        }\r\n\r\n        if (!keepIndex) {\r\n            ret = (ret).filter((r:any) => !!r) as any;\r\n        }\r\n\r\n        return ret;\r\n    }\r\n}\r\nwindoww.OCL = OCL;\r\nconst oclEngine = OclEngine.create();\r\n\r\n\r\n/*\r\n\r\nlet p = new Persona();\r\np.age = 0;\r\nlet p2 = new Persona();\r\np2.age = 1;\r\nlet p3 = new Persona();\r\np3.age = -5;\r\nlet pp = [p, p2, p3];\r\nOCL.filter(true, 'ocl', pp, undefined, \"context Persona inv: self.age>0\")\r\n\r\n\r\n///\r\n\r\nOCL.filter(true, 'src', Selectors.getAll(DClass, undefined, undefined, true), \"context DClass inv: self.abstract\")\r\n/// works\r\nlet pp = Selectors.getAll(DClass, undefined, undefined, true);\r\nOCL.filter(true, 'src', Selectors.getAll(DClass, undefined, undefined, true), \"context DClass inv: self.name = \\\"class_2\\\"\")\r\n\r\n* */\r\n\r\noclEngine.addOclExpression(`\r\n    -- No one should work that long...\r\n    context Company inv:\r\n        self.employee->forAll(p : Person | p.age <= 65 )\r\n\r\n    -- If a company has a manager, \r\n    -- the company has at least one employee.\r\n    context Company\r\n        inv: self.manager.isUnemployed = false\r\n        inv: self.employee->notEmpty()\r\n`);\r\n\r\nlet company = new Company();\r\ncompany.employee.push(new Persona());\r\n\r\nconst oclResult = oclEngine.evaluate(company);\r\n\r\n\r\n\r\nwindoww.Person = Persona;\r\nwindoww.Company = Company;\r\nwindoww.oclEngine = oclEngine;\r\n\r\nconsole.log('tests:', '\\n' +\r\n    'oclEngine.addOclExpression(`\\n' +\r\n    '    -- No one should work that long...\\n' +\r\n    '    context Company inv:\\n' +\r\n    '        self.employee->forAll(p : Person | p.age <= 65 )\\n' +\r\n    '\\n' +\r\n    '    -- If a company has a manager, \\n' +\r\n    '    -- the company has at least one employee.\\n' +\r\n    '    context Company\\n' +\r\n    '        inv: self.manager.isUnemployed = false\\n' +\r\n    '        inv: self.employee->notEmpty()\\n' +\r\n    '`);\\n' +\r\n    '\\n' +\r\n    'const customTypes = {\\n' +\r\n    '  \"Person\": Person, \"Company\": Company \\n' +\r\n    '}\\n' +\r\n    '\\n' +\r\n    'oclEngine.registerTypes(customTypes);' +\r\n    'let company = new Company();\\n' +\r\n    'let employee = new Person();\\n' +\r\n    'let parent = new Person();\\n' +\r\n    'let child = new Person();\\n' +\r\n    'child.parents = [parent];\\n' +\r\n    'parent.parents = [parent];\\n' +\r\n    'employee.age = 70;\\n' +\r\n    'company.employee.push(employee);\\n' +\r\n    '\\n' +\r\n    'console.log(\\'evaluate company\\', oclEngine.evaluate(company));\\n' +\r\n    '\\n' +\r\n    '\\n' +\r\n    '// parentchild test\\n' +\r\n    'let oclEnginep = OclEngine.create();\\n' +\r\n    'oclEnginep.addOclExpression(`\\n' +\r\n    '    context Person\\n' +\r\n    '        inv: self.parents->forAll(p | p <> self)\\n' +\r\n    '`)\\n' +\r\n    'console.log(\\'evaluate parent\\', oclEnginep.evaluate(parent));\\n' +\r\n    'console.log(\\'evaluate child\\', oclEnginep.evaluate(child));\\n');\r\n","import {jodelInit, windoww} from \"../joiner\";\r\nimport * as Componentss from '../joiner/components';\r\n\r\n\r\n/*\r\nlet pairs = [\r\n    [DAnnotation, LAnnotation],\r\n    [DModelElement, LModelElement],\r\n    [DAttribute, LAttribute],\r\n    [DClass, LClass],\r\n    [DClassifier, LClassifier],\r\n    [DEnumerator, LEnumerator],\r\n    [DEnumLiteral, LEnumLiteral],\r\n    [DModel, LModel],\r\n    [DObject, LObject],\r\n    [DOperation, LOperation],\r\n    [DPackage, LPackage],\r\n    [DParameter, LParameter],\r\n    [DReference, LReference],\r\n    [DStructuralFeature, LStructuralFeature],\r\n    [DValue, LValue],\r\n    [DModelElementTransientProperties, LModelElementTransientProperties],\r\n    [DViewTransientProperties, LViewTransientProperties],\r\n    [DViewPrivateTransientProperties, LViewPrivateTransientProperties],\r\n    [DViewElement, LViewElement],\r\n    [DVoidVertex, LVoidVertex]\r\n    // [DMap, LMap],\r\n];\r\n*/\r\n\r\n/*for (let pair of pairs as any[]) {\r\n    pair[0].logic = pair[1];\r\n    pair[1].singleton = new pair[1]();\r\n    pair[1].structure = pair[0];\r\n    windoww[pair[0].name] = pair[0];\r\n    windoww[pair[1].name] = pair[1];\r\n}*/\r\n\r\n/*\r\nDAnnotation.logic = LAnnotation;\r\nLAnnotation.singleton = new LAnnotation();\r\n\r\nDModelElement.logic = LModelElement;\r\nLModelElement.singleton = new LModelElement();\r\nDAttribute.logic = LAttribute;\r\nLAttribute.singleton = new LAttribute();\r\nDClass.logic = LClass;\r\nDClassifier.logic = LClassifier;\r\nDEnumerator.logic = LEnumerator;\r\nDEnumLiteral.logic = LEnumLiteral;\r\nDModel.logic = LModel;\r\nDOBject.logic = LObject;\r\nDOperation.logic = LOperation;\r\nDPackage.logic = LPackage;\r\nDParameter.logic = LParameter;\r\nDReference.logic = LReference;\r\nDStructuralFeature.logic = LStructuralFeature;\r\nDValue.logic = LValue;\r\nDModelElementTransientProperties.logic = LModelElementTransientProperties;\r\n\r\nLClass.singleton = new LClass();\r\nLClassifier.singleton = new LClassifier();\r\nLEnumerator.singleton = new LEnumerator();\r\nLEnumLiteral.singleton = new LEnumLiteral();\r\nLOperation.singleton = new LOperation();\r\nLPackage.singleton = new LPackage();\r\nLParameter.singleton = new LParameter();\r\nLReference.singleton = new LReference();\r\nLStructuralFeature.singleton = new LStructuralFeature();\r\nLValue.singleton = new LValue();\r\nLModel.singleton = new LModel();\r\nLObject.singleton = new LObject();\r\nLModelElementTransientProperties.singleton = new LModelElementTransientProperties();\r\n*/\r\nexport const fakeExport = {}; // just to import-execute this file\r\n// IStore.fakeinit();\r\n// Symbol.prototype.toString = function(): string { alert('symbol to string'); return String(this); }\r\n\r\nlet Components = Componentss;\r\n/*\r\nComponents.map(C=> {\r\n    if (typeof C === 'object') return\r\n})\r\nfor (let Comp of Components) {\r\n\r\n}*/\r\nwindoww.Components = Componentss;\r\n\r\n\r\nfunction afterStoreLoad() {\r\n    jodelInit();\r\n}\r\n\r\n// afterStoreLoad();\r\n// setTimeout( afterStoreLoad, 0);\r\n","import * as jsxtt from 'jsx-transform/lib/jsx.js';\r\nimport $$ from 'jquery';\r\nimport {ReactNode} from \"react\";\r\nimport * as _pr_json2xml from '../common/libraries/prj_json2xml.js';\r\nimport * as _pr_xml2json from '../common/libraries/prj_xml2json.js';\r\n// true imports for this file (should all be import type\r\nimport type {DocString, GObject as GObjectt} from './types';\r\nimport type {U as UType} from \"../common/U\";\r\nimport type {Selectors as SelType} from \"../redux/selectors/selectors\";\r\n\r\nexport type {Constructor, AbstractConstructor} from \"../joiner/types\";\r\nexport type {ValueDetail, SetValueAtPoisitionInfoType} from \"../model/logicWrapper/LModelElement\";\r\nvar windoww = (window as any);\r\nwindoww.windoww = windoww;\r\n\r\n\r\n// console.error('iiiiiiiiiiiiiiii 0');\r\n\r\nwindoww.$ = $$;\r\nexport const $: JQueryStatic = $$;\r\nexport const prjson2xml = _pr_json2xml;\r\nexport const prxml2json = _pr_xml2json;\r\nwindoww.prjson2xml = prjson2xml;\r\nwindoww.prxml2json = prxml2json;\r\n\r\n// import types\r\n//import {$s, GraphPoint, GraphSize, IPoint, ISize, Log, Point, Size, U} from \"../common/U\";\r\n\r\n// nb: export type è un export \"finto\" che esiste solo in compilazione per fare capire a typescript i tipi. permette export di alias con nomi diversi (l'export normale no)\r\nexport type {GetPath} from './proxy';\r\n\r\nexport type {Subtract, Class, Empty, Json, GObject, bool, Dictionary, Proxyfied, Temporary, RawObject, NotFoundv,\r\n    NotFound, DocString, nbool, nnumber, nstring, Nullable, TODO, UnixTimestamp, UObject, IsActually,\r\n    Function, Function2, InOutParam,\r\n    unArr, orArr, PrimitiveType, CClass, NonEmptyString, Overlap\r\n} from \"./types\";\r\nexport type {Pointer, PtrString, getWParams, WUser, WtoD, WtoL, DtoW, LtoW, LtoD, DtoL, PackArr, Pack, Pack1, } from \"./classes\";\r\n\r\nexport type { WAnnotation, WNamedElement, WFactory_useless_, WClass, WAttribute, WClassifier, WDataType, WMap, WModel,\r\n    WModelElement, WEnumerator, WObject, WPackage, WOperation, WValue, WParameter, WReference, WTypedElement, WEnumLiteral, WStructuralFeature,\r\n} from \"../model/logicWrapper/LModelElement\";\r\nexport type {WEdge, WEdgePoint, WExtEdge, WGraph, WRefEdge, WGraphElement, WVoidEdge, WGraphVertex, WVertex, WVoidVertex} from \"../model/dataStructure/GraphDataElements\";\r\n\r\nexport {windoww} from './types';\r\nexport {GraphElementStatee, GraphElementDispatchProps, GraphElementReduxStateProps, GraphElementOwnProps} from \"../graph/graphElement/sharedTypes/sharedTypes\";\r\nexport {EdgeBendingMode} from \"./types\";\r\nexport {Constructors, JsType, RuntimeAccessibleClass, DPointerTargetable, LPointerTargetable, WPointerTargetable, MyError, RuntimeAccessible, Obsolete, Leaf, Node, Abstract, Instantiable, MixOnlyFuncs, LUser, DUser, Pointers, PointedBy, PendingPointedByPaths} from \"./classes\";\r\n\r\n// export type {Pointer} from './typeconverter';\r\nexport {getPath, TargetableProxyHandler, MyProxyHandler, MapProxyHandler, LogicContext, MapLogicContext} from './proxy';\r\n// console.error('iiiiiiiiiiiiiiii 3');\r\n// import independent generic modules (only dependent from types and RuntimeAccessible\r\n\r\nexport {Uarr,  DDate, ParseNumberOrBooleanOptions, myFileReader,\r\n    Keystrokes, ShortAttribETypes, AttribETypes, FileReadTypeEnum, FocusHistoryEntry, SelectorOutput, U as UU, ShortAttribSuperTypes,\r\n    } from \"../common/U\";\r\nexport {DV} from '../common/DV';\r\nexport {Size, GraphSize, GraphPoint, IPoint, ISize, Point} from \"../common/Geom\";\r\nexport { CSSRuleSorted, CSSParser, TagNames } from \"../common/Uhtml\";\r\n// export {Log as Logg, Size, GraphSize, GraphPoint, IPoint, ISize, Point} from \"../common/Log\";\r\nexport const Log = windoww.Log;\r\nexport {UX} from \"../common/UX\";\r\nexport var U = windoww.U as typeof UType;\r\nexport {DLog} from \"../model/classes/D\";\r\nexport {LLog} from \"../model/classes/L\";\r\n// console.error('iiiiiiiiiiiiiiii 4');\r\n\r\nexport {EcoreParser} from \"../api/data\";\r\n// import domain-specific classes\r\n\r\n\r\nexport {\r\n    DModelElement,\r\n    LModelElement,\r\n    DModel, LModel,\r\n    DValue, LValue,\r\n    DNamedElement, LNamedElement,\r\n    DObject, LObject,\r\n    DEnumerator, LEnumerator,\r\n    DEnumLiteral, LEnumLiteral,\r\n    DAttribute, LAttribute,\r\n    DReference, LReference,\r\n    DStructuralFeature, LStructuralFeature,\r\n    DClassifier, LClassifier,\r\n    DDataType, LDataType,\r\n    DClass, LClass,\r\n    DParameter, LParameter,\r\n    DOperation, LOperation,\r\n    DPackage, LPackage,\r\n    DTypedElement, LTypedElement,\r\n    DAnnotation, LAnnotation,\r\n    EJavaObject,\r\n    DFactory_useless_, LFactory_useless_, DMap, LMap\r\n} from \"../model/logicWrapper/LModelElement\";\r\n\r\n// console.error('joiner here 3');\r\n/*\r\nexport {\r\n    LModelElement,\r\n    LAnnotation,\r\n    LAttribute,\r\n    LClass,\r\n    LClassifier,\r\n    LEnumerator,\r\n    LEnumLiteral, LModel,\r\n    LObject, LOperation,\r\n    LPackage, LParameter, LReference,\r\n    LStructuralFeature, LDataType, LTypedElement, LNamedElement, // DMap, LMap,\r\n    LValue,\r\n} from \"../model/logicWrapper/LModelElement\";*/\r\nexport {DExtEdge, DRefEdge, DVoidEdge, LGraphVertex, LRefEdge, LEdgePoint, DVoidVertex, DGraphVertex, DEdgePoint, DVertex, DEdge, LVertex, LGraph, DGraph, LVoidVertex, LVoidEdge, LEdge, LGraphElement, LExtEdge, DGraphElement, defaultVSize} from \"../model/dataStructure/GraphDataElements\";\r\n\r\n\r\n// export {GraphDragHandler} from \"../graph/vertex/GraphDragHandler\";\r\n\r\n// console.error('iiiiiiiiiiiiiiii 11', windoww.DViewElement);\r\nexport type {WViewElement, WViewTransientProperties} from \"../view/viewElement/view\";\r\nexport {DViewTransientProperties, LViewTransientProperties, LViewElement, DViewElement} from \"../view/viewElement/view\";\r\n// console.error('iiiiiiiiiiiiiiii 12', windoww.DViewElement);\r\n\r\nexport {Action, CreateElementAction, DeleteElementAction, SetFieldAction, SetRootFieldAction, CompositeAction, ParsedAction, LoadAction, CombineHistoryAction, RedoAction, UndoAction, TRANSACTION, BEGIN, ABORT, END} from \"../redux/action/action\";\r\nexport {IStore, ModelStore, ViewPointState, statehistory} from \"../redux/store\";\r\nexport {Selectors as Selectorss} from \"../redux/selectors/selectors\";\r\nexport var Selectors = windoww.Selectors as (GObjectt & typeof SelType);\r\nexport {reducer, jodelInit} from \"../redux/reducer/reducer\";\r\nexport {store} from \"../redux/createStore\";\r\n\r\nexport {OCL} from \"../ocl/ocl\";\r\n\r\n\r\n\r\n\r\nclass JSXT_TYPE{\r\n    fromString(str: string, options?:\r\n        {   factory: string,\r\n            spreadFn?:Function,\r\n            unknownTagPattern?:string,\r\n            passUnknownTagsToFactory?:boolean,\r\n            unknownTagsAsString?:boolean,\r\n            arrayChildren?:boolean\r\n        }): DocString<ReactNode, 'compiled code as string, like React.CreateElement(...)'> { return ''; }\r\n    fromFile(path: string, options?:\r\n        {   factory: string,\r\n            spreadFn?:Function,\r\n            unknownTagPattern?:string,\r\n            passUnknownTagsToFactory?:boolean,\r\n            unknownTagsAsString?:boolean,\r\n            arrayChildren?:boolean\r\n        }): DocString<ReactNode, 'compiled code as string, like React.CreateElement(...)'> { return ''; }\r\n    browserifyTransform(...params: any): any {}\r\n    visitor: unknown = null;\r\n}\r\n\r\nexport const JSXT = jsxtt as any as JSXT_TYPE/*as {\r\n    fromString: (str: string, options?:\r\n        {   factory: string,\r\n            spreadFn?:Function,\r\n            unknownTagPattern?:string,\r\n            passUnknownTagsToFactory?:boolean,\r\n            unknownTagsAsString?:boolean,\r\n            arrayChildren?:boolean\r\n        }) =>string,\r\n    fromFile: (path: string, options?:\r\n        {   factory: string,\r\n            spreadFn?:Function,\r\n            unknownTagPattern?:string,\r\n            passUnknownTagsToFactory?:boolean,\r\n            unknownTagsAsString?:boolean,\r\n            arrayChildren?:boolean\r\n        }) =>string,\r\n    browserifyTransform: unknown | Function,\r\n    visitor: unknown\r\n}*/\r\n\r\n\r\n\r\nexport type Event = JQuery.Event;\r\nexport type EventBase = JQuery.EventBase;\r\nexport type EventHandlerBase<T1, T2> = JQuery.EventHandlerBase<T1, T2>;\r\nexport type MouseEventBase = JQuery.MouseEventBase;\r\nexport type MouseUpEvent = JQuery.MouseUpEvent;\r\nexport type ChangeEvent = JQuery.ChangeEvent;\r\nexport type ContextMenuEvent = JQuery.ContextMenuEvent;\r\nexport type ClickEvent = JQuery.ClickEvent;\r\nexport type MouseDownEvent = JQuery.MouseDownEvent;\r\nexport type BlurEvent = JQuery.BlurEvent;\r\nexport type KeyDownEvent = JQuery.KeyDownEvent;\r\nexport type KeyPressEvent = JQuery.KeyPressEvent;\r\nexport type DoubleClickEvent = JQuery.DoubleClickEvent;\r\nexport type DragEndEvent = JQuery.DragEndEvent;\r\nexport type DragEnterEvent = JQuery.DragEnterEvent;\r\nexport type DragEvent = JQuery.DragEvent;\r\nexport type DragExitEvent = JQuery.DragExitEvent;\r\nexport type DragLeaveEvent = JQuery.DragLeaveEvent;\r\nexport type DragOverEvent = JQuery.DragOverEvent;\r\nexport type DragStartEvent = JQuery.DragStartEvent;\r\nexport type DropEvent = JQuery.DropEvent;\r\nexport type FocusEvent = JQuery.FocusEvent;\r\nexport type FocusInEvent = JQuery.FocusInEvent;\r\nexport type FocusOutEvent = JQuery.FocusOutEvent;\r\nexport type FocusEventBase = JQuery.FocusEventBase;\r\n\r\n// todo: continua\r\n\r\n\r\n// window (NB: most of them should be replaced by RuntimeAccessibleClass)\r\nlet w: any = window;/*\r\nw.$ = $;\r\nw.Log = Log;\r\nw.U = U;\r\nw.Size = Size;\r\nw.ISize = ISize;\r\nw.GraphSize = GraphSize;\r\nw.Point = Point;\r\nw.IPoint = IPoint;\r\nw.GraphPoint = GraphPoint;\r\nw.$s = $s;\r\n*/\r\nexport {\r\n    GraphElementComponent,\r\n    VertexComponent,\r\n    GraphElement,\r\n    TextArea, Select, Input, Image, Edge,\r\n    GraphComponent,\r\n    GraphsContainerComponent,\r\n    Overlap as OverlapComponent,\r\n    GraphsContainer,\r\n    Vertex,    Graph,\r\n    // DockLayoutComponent,\r\n    ColorScheme, Edges,\r\n    DataOutputComponent, LoggerComponent, MyInputComponent\r\n} from './components'\r\n\r\n//export {createOrOpenModelTab} from \"../components/abstract/DockLayoutComponent\"; // needs to be after docklayoutcomponent or to split the file\r\nexport {fakeExport} from './ExecuteOnRead';\r\nconsole.info('joiner loaded');\r\nclass Joiner{\r\n    // just to help the file search\r\n}\r\n\r\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 110;","import React, {Dispatch, PureComponent, ReactElement, ReactNode,} from \"react\";\r\nimport {createPortal} from \"react-dom\";\r\nimport {connect} from \"react-redux\";\r\nimport './graphElement.scss';\r\n\r\nimport {\r\n    CreateElementAction,\r\n    DGraph,\r\n    DGraphElement,\r\n    Dictionary,\r\n    DModelElement,\r\n    DocString, DViewElement,\r\n    GObject,\r\n    GraphElementDispatchProps,\r\n    GraphElementOwnProps,\r\n    GraphElementReduxStateProps,\r\n    GraphElementStatee,\r\n    InOutParam,\r\n    IStore,\r\n    JSXT,\r\n    LModelElement,\r\n    Log, LPointerTargetable,\r\n    LViewElement,\r\n    MyProxyHandler, Overlap,\r\n    Pointer,\r\n    RuntimeAccessible,\r\n    Selectors,\r\n    SetRootFieldAction,\r\n    U,\r\n    UX,\r\n    windoww, DV\r\n} from \"../../joiner\";\r\n\r\n\r\nexport function makeEvalContext(props: AllPropss, view: LViewElement): GObject {\r\n    let evalContext: GObject = view.constants ? eval('window.tmp = ' + view.constants) : {};\r\n    evalContext = {...windoww.defaultContext, ...evalContext, model: props.data, ...props};\r\n    windoww.evalContext = evalContext;\r\n    return evalContext;\r\n}\r\n\r\nfunction setTemplateString(stateProps: InOutParam<GraphElementReduxStateProps>, ownProps: Readonly<GraphElementOwnProps>): void {\r\n    //if (!jsxString) { this.setState({template: this.getDefaultTemplate()}); return; }\r\n    // sintassi: '||' + anything + (opzionale: '|' + anything)*N_Volte + '||' + jsx oppure direttamente: jsx\r\n    const view: LViewElement = stateProps.view; //data._transient.currentView;\r\n    // eslint-disable-next-line no-mixed-operators\r\n    let allProps: AllPropss = {...ownProps, ...stateProps} as AllPropss;\r\n    (allProps as GObject).props = allProps;\r\n    const evalContext = makeEvalContext(allProps, view);\r\n    // const evalContextOld = U.evalInContext(this, constants);\r\n    // this.setState({evalContext});\r\n    //console.error({jsx:view.jsxString, view});\r\n\r\n    // todo: invece di fare un mapping ricorsivo dei figli per inserirgli delle prop, forse posso farlo passando una mia factory che wrappa React.createElement\r\n    let jsxCodeString: DocString<ReactNode>;\r\n    try { jsxCodeString = JSXT.fromString(view.jsxString, {factory: 'React.createElement'}); }\r\n    catch (e: any) {\r\n        Log.eDevv('Syntax Error in custom user-defined template. try to remove typescript typings:\\n\\n' +e.toString() + '\\n\\n' + view.jsxString, {evalContext});\r\n        jsxCodeString = '<div>Syntax error 1</div>';\r\n    }\r\n    let jsxparsedfunc: () => React.ReactNode;\r\n    try {\r\n        jsxparsedfunc = U.evalInContextAndScope<() => ReactNode>('()=>{ return ' + jsxCodeString + '}', evalContext);\r\n        // U.evalInContext({...this, ...evalContext}, res); // todo: remove eval and add new Function() ?\r\n    }\r\n    catch (e: any) {\r\n        let errormsg = ''; // 'Syntax Error in custom user-defined template.\\n';\r\n        let otherargs: any = {e, jsxCodeString, evalContext, where:\"setTemplateString()\", view};\r\n        if (e.message.indexOf(\"Unexpected token .\") >= 0 || view.jsxString.indexOf('?.') >= 0 || view.jsxString.indexOf('??') >= 0)\r\n        { errormsg += 'Reminder: nullish operators \".?\" and \"??\" are not supported.\\n\\n' +e.toString() + '\\n\\n' + view.jsxString; }\r\n        else if (view.jsxString.indexOf('?.') >= 0) { errormsg += 'Reminder: ?. operator and empty tags <></> are not supported.\\n\\n' +e.toString() + '\\n\\n' + view.jsxString; }\r\n        jsxparsedfunc = ()=> DV.errorView(errormsg, otherargs);\r\n    }\r\n\r\n    stateProps.preRenderFunc = view.preRenderFunc;\r\n    stateProps.evalContext = evalContext;\r\n    stateProps.template = jsxparsedfunc;\r\n    // console.log('GE settemplatestring:', {stateProps});\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class GraphElementComponent<AllProps extends AllPropss = AllPropss, GraphElementState extends GraphElementStatee = GraphElementStatee>\r\n    extends PureComponent<AllProps, GraphElementState>{\r\n    static maxid: number = 0;\r\n    static all: Dictionary<number, GraphElementComponent> = {};\r\n    id: number;\r\n    public static refresh() {\r\n        for (let key in GraphElementComponent.all) {\r\n            GraphElementComponent.all[key].forceUpdate();\r\n        }\r\n        console.log(GraphElementComponent.all);\r\n    }\r\n\r\n    public static defaultShouldComponentUpdate<AllProps extends GObject, State extends GObject, Context extends any>\r\n    (instance: React.Component, nextProps: Readonly<AllProps>, nextState: Readonly<State>, nextContext: Context) {\r\n        return (\r\n            !U.shallowEqual(instance.props, nextProps) ||\r\n            !U.shallowEqual(instance.state, nextState)\r\n        );\r\n    }\r\n\r\n    static mapViewStuff(state: IStore, ret: GraphElementReduxStateProps, ownProps: GraphElementOwnProps) {\r\n        let dnode: DGraphElement | undefined = ownProps?.nodeid && state.idlookup[ownProps.nodeid] as any;\r\n        if (ownProps.view) {\r\n            ret.views = [];\r\n            ret.view = LPointerTargetable.wrap(ownProps.view) as LViewElement;\r\n        }\r\n        else {\r\n            const viewScores = Selectors.getAppliedViews(ret.data, dnode, ret.graph, ownProps.view || null, ownProps.parentViewId || null);\r\n            ret.views = viewScores.map(e => MyProxyHandler.wrap(e.element));\r\n            ret.view = ret.views[0];\r\n            (ret as any).viewScores = viewScores; // debug only\r\n        }\r\n\r\n        /*        if (ownProps.view) {\r\n                    ret.view = DPointerTargetable.wrap(state.idlookup[ownProps.view]);\r\n                } else {\r\n                    ret.view = ret.views[0];\r\n                }*/\r\n    }\r\n\r\n    static mapLModelStuff(state: IStore, ownProps: GraphElementOwnProps, ret: GraphElementReduxStateProps): void {\r\n        const meid: string = (typeof ownProps.data === 'string' ? ownProps.data as string : (ownProps.data as any as DModelElement)?.id) as string;\r\n        // Log.exDev(!meid, \"model element id not found in GE.mapstatetoprops\", {meid, ret, ownProps, state});\r\n        ret.data = MyProxyHandler.wrap(state.idlookup[meid as any]);\r\n        // Log.ex(!ret.data, \"can't find model data:\", {meid, state, ownpropsdata:ownProps.data, ownProps});\r\n\r\n    }\r\n\r\n    static mapLGraphElementStuff(state: IStore,\r\n                                 ownProps: GraphElementOwnProps,\r\n                                 ret: GraphElementReduxStateProps,\r\n                                 dGraphElementDataClass: typeof DGraphElement = DGraphElement,\r\n                                 isDGraph?: DGraph): void {\r\n        const idlookup = state.idlookup;\r\n        let nodeid: string = ownProps.nodeid as string;\r\n        let graphid: string = isDGraph ? isDGraph.id : ownProps.graphid as string;\r\n        let parentnodeid: string = ownProps.parentnodeid as string;\r\n        let dataid: Pointer<DModelElement, 0, 1, LModelElement> = ownProps.data || null;\r\n        // Log.exDev(!nodeid || !graphid, 'node id injection failed', {ownProps, data: ret.data, name:(ret.data as any)?.name || (ret.data as any)?.className}); /*\r\n        /*if (!nodeid) {\r\n            nodeid = 'nodeof_' + stateProps.data.id + (stateProps.view.bindVertexSizeToView ? '^' + stateProps.view.id : '') + '^1';\r\n            stateProps.nodeid = U.increaseEndingNumber(nodeid, false, false, id => !idlookup[id]);\r\n            todo: quando il componente si aggiorna questo viene perso, come posso rendere permanente un settaggio di reduxstate in mapstatetoprops? o devo metterlo nello stato normale?\r\n        }*/\r\n\r\n        ret.graph = idlookup[graphid] as DGraphElement as any; // se non c'è un grafo lo creo\r\n        if (!ret.graph) {\r\n            Log.exDev(!dataid, 'attempted to make a Graph element without model', {dataid, ownProps, ret, thiss:this});\r\n            if (dataid) CreateElementAction.new(DGraph.new(dataid, parentnodeid, graphid, graphid)); }\r\n        else {\r\n            ret.graph = MyProxyHandler.wrap(ret.graph);\r\n            Log.exDev(ret.graph.__raw.className !== \"DGraph\", 'graph class is wrong', {graph: ret.graph, ownProps});\r\n        }\r\n\r\n\r\n        let dnode: DGraphElement = idlookup[nodeid] as DGraphElement;\r\n\r\n        // console.log('dragx GE mapstate addGEStuff', {dGraphElementDataClass, created: new dGraphElementDataClass(false, nodeid, graphid)});\r\n        if (!dnode) {\r\n            let dge = dGraphElementDataClass.new(dataid, parentnodeid, graphid, nodeid);\r\n            let act = CreateElementAction.new(dge, false);\r\n            // console.log(\"map ge2\", {nodeid: nodeid+'', dge: {...dge}, dgeid: dge.id});\r\n        }\r\n        else { ret.node = MyProxyHandler.wrap(dnode); }\r\n    }\r\n\r\n    ////// mapper func\r\n    static mapStateToProps(state: IStore, ownProps: GraphElementOwnProps, dGraphDataClass: typeof DGraphElement = DGraphElement, startingobj?: GObject): GraphElementReduxStateProps {\r\n        // console.log('dragx GE mapstate', {dGraphDataClass});\r\n        let ret: GraphElementReduxStateProps = (startingobj || {}) as GraphElementReduxStateProps; // NB: cannot use a constructor, must be pojo\r\n        GraphElementComponent.mapLModelStuff(state, ownProps, ret);\r\n        // console.log(\"map ge\", {ownProps, ret, state});\r\n        GraphElementComponent.mapLGraphElementStuff(state, ownProps, ret, dGraphDataClass);\r\n        GraphElementComponent.mapViewStuff(state, ret, ownProps);\r\n        // ret.view = LViewElement.wrap(state.idlookup[vid]);\r\n        // view non deve essere più injected ma calcolata, però devo fare inject della view dell'elemento parent. learn ocl to make view target\r\n        Log.exDev(!ret.view, 'failed to inject view:', {state, ownProps, reduxProps: ret});\r\n        // console.log(!ret.view, 'failed to inject view:', {state, ownProps, reduxProps: ret});\r\n        if (ret.view.usageDeclarations) U.objectMergeInPlace(ret, U.evalInContextAndScope(ret.view.usageDeclarations));\r\n        // console.log('GE mapstatetoprops:', {state, ownProps, reduxProps: ret});\r\n        // ret.model = state.models.length ? LModelElement.wrap(state.models[0]) as LModel : undefined;\r\n        setTemplateString(ret, ownProps); // todo: this is heavy, should be moved somewhere where it's executed once unless view changes (pre-render with if?)\r\n        // @ts-ignore\r\n        ret.forceupdate = state.forceupdate;\r\n        return ret;\r\n    }\r\n\r\n    static mapDispatchToProps(dispatch: Dispatch<any>): GraphElementDispatchProps {\r\n        const ret: GraphElementDispatchProps = {} as any;\r\n        return ret;\r\n    }\r\n\r\n\r\n    _isMounted: boolean;\r\n    // todo: can be improved by import memoize from \"memoize-one\"; it is high-order function that memorize the result if params are the same without re-executing it (must not have side effects)\r\n    //  i could use memoization to parse the jsx and to execute the user-defined pre-render function\r\n    constructor(props: AllProps, context: any) {\r\n        super(props, context);\r\n        this._isMounted = false;\r\n        this.id = GraphElementComponent.maxid++;\r\n        GraphElementComponent.all[this.id] = this;\r\n/*\r\n        console.log('GE constructor props:', this.props);\r\n        this.setTemplateString(this.props.view, true);\r\n        /*if (false) this.setTemplateString('{colors:[\"rEd\", \"gReen\", \"blye\"], key2:[0,2,5]}',\r\n            '() => { colors = colors.map(c=>c.toLowerCase())}',\r\n            '<div><b>GraphElement colors:</b>{colors.map( (c, i) => <li key={c} style={{color: c}}>{c}</li>)}</div>', true);*/\r\n        // this.onMountBindID();\r\n    }\r\n/*\r\n    onMountBindID() {\r\n        /*if (!this.props.view.bindVertexSizeToView) {\r\n            // get position from view itself\r\n            nodeid = 'nodeof_' + this.props.data.id;\r\n            if (!store.getState().idlookup[nodeid]){\r\n                new CreateElementAction(this.createDataNode(nodeid));\r\n            } // view-indipendent fallback, i do not add view.id to node.id\r\n        } else {* /\r\n        if (this.getId()) return;\r\n        let dnode: DGraphElement = this.createDataNode(this.generateId());\r\n        new CreateElementAction(dnode);\r\n        // let nodeid: Pointer<DGraphElement, 1, 1, LGraphElement> = dnode.id;\r\n        // this.setState({nodeid} );\r\n    }\r\n\r\n    getId(): string | undefined {\r\n        return this.props.nodeid;\r\n    }\r\n\r\n    generateId(): Pointer<DGraphElement, 1, 1, LGraphElement> {\r\n        // if (this.state.nodeid) return this.state.nodeid;\r\n        let ret: string = 'nodeof_' + this.props.data.id + (this.props.view.bindVertexSizeToView ? '^' + this.props.view.id : '') + '^1';\r\n        const idlookup = store.getState().idlookup;\r\n        ret = U.increaseEndingNumber(ret, false, false, id => !idlookup[id]);\r\n        return ret;\r\n    }\r\n\r\n    // to override\r\n\r\n    createDataNode(id?: string): DGraphElement {\r\n        return new DGraphElement(id || this.generateId(), this);\r\n    }\r\n */\r\n\r\n    // constants: evalutate solo durante il primo render, può essere una funzione con effetti collaterali sul componente,\r\n    // in tal caso la si esegue e si prende il valore di ritorno.\r\n    // preRenderFunc: funzione evalutata ed eseguita sempre prima del render, ha senso solo per generare effetti collaterali sulle \"costanti\".\r\n    // jsxString: funzione evalutata una sola volta durante il primo render ed eseguita ad ogni update dei dati.\r\n\r\n    /*getDefaultTemplate(): () => ReactNode{\r\n        // to delete, i will get it from redux props instead of asking them with a func\r\n        return () => null;\r\n    }*/\r\n\r\n    static graphVertexID_counter: Dictionary<DocString<'GraphID'>, Dictionary<DocString<'VertexID'>, boolean>> = {}\r\n\r\n    /*\r\n    makeEvalContext_to_move(view: ViewElement): GObject {\r\n        let evalContext: GObject = view.constants ? eval('window.tmp = ' + view.constants) : {};\r\n        evalContext = {...GraphElementRaw.defaultContext, ...evalContext, model: this.props.data, ...this.props};\r\n        (window as any).evalContext = evalContext;\r\n        return evalContext;\r\n    }\r\n    /*\r\n    setTemplateStringToDelete_move_in_map_statetoprops(view: ViewElement, fromConstructor: boolean = false): void {\r\n        // to delete, i will get it from redux props instead of asking them with a func\r\n        //if (!jsxString) { this.setState({template: this.getDefaultTemplate()}); return; }\r\n        // sintassi: '||' + anything + (opzionale: '|' + anything)*N_Volte + '||' + jsx oppure direttamente: jsx\r\n        let colors = [\"red\", \"green\", \"blallo\"];\r\n        let daa = \"daa_var\";\r\n        sposta tutto lo stato non-redux in stato redux e memoizza\r\n        learn samuro & zeratul\r\n        // eslint-disable-next-line no-mixed-operators\r\n        windoww.Input2 = Input;\r\n        const evalContext = this.makeEvalContext();\r\n        // const evalContextOld = U.evalInContext(this, constants);\r\n        // this.setState({evalContext});\r\n        //console.error({jsx:view.jsxString, view});\r\n\r\n        let jsxCodeString: DocString<ReactNode> = JSXT.fromString(view.jsxString, {factory: 'React.createElement'}) as any;\r\n        const jsxparsedfunc = U.evalInContextAndScope<() => ReactNode>('()=>' + jsxCodeString, evalContext); // U.evalInContext({...this, ...evalContext}, res); // todo: remove eval and add new Function() ?\r\n\r\n        let state: GraphElementState = new GraphElementStatee(view.preRenderFunc, evalContext, jsxparsedfunc) as GraphElementState;\r\n        if (!fromConstructor) this.setState(state);\r\n        else (this as any).state = state;\r\n        console.log('parsed:', {state, thisstate: this.state, 'template':jsxparsedfunc, data:this.props.data});\r\n    }\r\n    /*\r\n        setState<K extends keyof MPState>(state: ((prevState: Readonly<MPState>, props: Readonly<AllProps>) => (Pick<MPState, K> | MPState | null)) | Pick<MPState, K> | MPState | null, callback?: () => void): void {\r\n            if (this._isMounted) super.setState(state, callback);\r\n            else this.state = state as MPState;\r\n        }*/\r\n\r\n    componentDidMount(): void {\r\n        // after first render\r\n        this._isMounted = true;\r\n    }\r\n\r\n    componentWillUnmount(): void {\r\n        // todo: devo fare in modo che il nodo venga cancellato solo se sto modificando la vista in modo che questo vertice non esista più.\r\n        //  e non venga cancellato se il componente viene smontato perchè ho solo cambiato vista\r\n        //  LOW PRIORITY perchè funziona anche senza, pur sprecando memoria che potrebbe essere liberata.\r\n        // if (view_is_still_active_but_got_modified_and_vertex_is_deleted) new DeleteElementAction(this.getId());\r\n    }\r\n    /*\r\n        componentDidUpdate(oldProps: Readonly<AllProps {/*\r\n            const newProps = this.props\r\n            if (oldProps.view !== newProps.view) { this.setTemplateString(newProps.view); }\r\n    }*/\r\n\r\n    private getTemplate(): ReactNode {\r\n        /*if (!this.state.template) {\r\n            this.setTemplateString('{c1: 118}', '()=>{this.setState({c1: this.state.c1+1})}',\r\n                '<div><input value=\"{name}\" onInput=\"{setName}\"></input><p>c1:{this.state.c1}</p><Attribute prop1={daa} prop2={1 + 1.5} stringPropdaa=\\\"daa\\\" /><ul>{colors.map( color => <li>color: {color}</li>)}</ul></div>');\r\n        }*/\r\n        // console.log('getTemplate:', {props: this.props, template: this.props.template, ctx: this.props.evalContext});\r\n        let ret;\r\n        if (false && this.props.evalContext.Vertex) {\r\n            setTimeout( () => SetRootFieldAction.new('forceupdate_', 41), 1); // todo: optimize this to avoid triggering it tons of times when a model is loaded.\r\n            return <div>Loading</div>;}\r\n        let context = {component:this, __proto__:this.props.evalContext};\r\n        try {\r\n            ret = U.execInContextAndScope<() => ReactNode>(this.props.template, [], context); }\r\n        catch(e: any) {\r\n            const view: LViewElement = this.props.view; //data._transient.currentView;\r\n            let errormsg = ''; // 'Syntax Error in custom user-defined template.\\n';\r\n            if (e.message.indexOf(\"Unexpected token .\") >= 0 || view.jsxString.indexOf('?.') >= 0 || view.jsxString.indexOf('??') >= 0)\r\n            { errormsg += 'Reminder: nullish operators \".?\" and \"??\" are not supported.\\n\\n' +e.toString() + '\\n\\n' + view.jsxString; }\r\n            else if (view.jsxString.indexOf('?.') >= 0) { errormsg += 'Reminder: ?. operator and empty tags <></> are not supported.\\n\\n' +e.toString() + '\\n\\n' + view.jsxString; }\r\n            ret = DV.errorView(errormsg, {where:\"in getTemplate()\", e});\r\n        }\r\n        return ret;\r\n    }\r\n/**\r\n * package got node id injected\r\n * package.render() start\r\n *    ge render message\r\n *    mapstate of denum before?? crash here?\r\n *    inject enum props (not happening?)\r\n *    mapstate of denum again after??\r\n * package.render() end\r\n *\r\n * */\r\n    public render(): ReactNode {\r\n        if (this.props.preRenderFunc) U.evalInContextAndScope(this.props.preRenderFunc, {component:this, __proto__:this.props.evalContext});\r\n        const rnode: ReactNode = this.getTemplate();\r\n        let rawRElement: ReactElement | null = U.ReactNodeAsElement(rnode);\r\n        // @ts-ignore\r\n        // console.log('GE render', {rnode, rawRElement, props:this.props, name: this.props.data.name});\r\n        const me: LModelElement = this.props.data as LModelElement; // this.props.model;\r\n\r\n        const addprops: boolean = true;\r\n        let fiximport = !!this.props.node; // todo: check if correct approach\r\n        if (addprops && me && rawRElement && fiximport) {\r\n            // console.log(\"pre-injecting\", {thiss:this, data:this.props.data, props:this.props});\r\n            let fixdoubleroot = true;\r\n            const onDragTestInject = () => {}; // might inject event handlers like this with cloneelement\r\n            // add view props to GraphElement children (any level down)\r\n            const subElements: Dictionary<DocString<'nodeid'>, boolean> = {}; // this.props.getGVidMap(); // todo: per passarla come prop ma mantenerla modificabile\r\n            try {\r\n                rawRElement = React.cloneElement(rawRElement, {key: this.props.key || this.props.view.id + '_' + me.id, onDragTestInject, children: UX.recursiveMap(rawRElement/*.props.children*/,\r\n                        (rn: ReactNode) => UX.injectProp(this, rn, subElements))});\r\n                if(fixdoubleroot) rawRElement = rawRElement.props.children;\r\n                // console.log(\"probem\", {rawRElement, children:(rawRElement as any)?.children, pchildren:(rawRElement as any)?.props?.children});\r\n            } catch (e) {\r\n                rawRElement = DV.errorView(\"error while injecting props to subnodes\", {e, rawRElement, key:this.props.key, newid: this.props.view?.id+'_'+me?.id});\r\n            }\r\n            /*console.log('tempdebug', {deepStrictEqual, okeys:Object.keys});\r\n            let isEqual = true;\r\n            try {deepStrictEqual(subElements, this.props.node.subElements)} catch(e) { isEqual = false; }\r\n            if (isEqual) {\r\n                this.props.node.subElements = Object.keys(subElements);\r\n            }*/\r\n        }\r\n        // const injectprops = {a:3, b:4} as DetailedHTMLProps<HTMLAttributes<HTMLDivElement>, HTMLDivElement>;\r\n        // rnode = React.cloneElement(rnode as ReactElement, injectprops);\r\n\r\n        // console.log(\"nodeee\", {thiss:this, props:this.props, node: this.props.node});\r\n        if (false && (this.props.node?.__raw as DGraphElement).father) {\r\n            let $containedIn = $('#' + this.props.node.father);\r\n            let $containerDropArea = $containedIn.find(\".VertexContainer\");\r\n            const droparea = $containerDropArea[0] || $containedIn[0];\r\n            Log.exDev(!droparea, 'invalid vertex container target', {$containedIn, $containerDropArea});\r\n            if (droparea) return createPortal(\r\n                rawRElement || rnode,\r\n                droparea\r\n            );\r\n        }\r\n        return rawRElement || rnode;\r\n    }\r\n\r\n}\r\n\r\n// private\r\n// type AllPropss = GraphElementOwnProps & GraphElementDispatchProps & GraphElementReduxStateProps;\r\ntype AllPropss = Overlap<Overlap<GraphElementOwnProps, GraphElementDispatchProps>, GraphElementReduxStateProps>;\r\n\r\nconst GraphElementConnected = connect<GraphElementReduxStateProps, GraphElementDispatchProps, GraphElementOwnProps, IStore>(\r\n    GraphElementComponent.mapStateToProps,\r\n    GraphElementComponent.mapDispatchToProps\r\n)(GraphElementComponent as any);\r\n\r\nexport const GraphElement = (props: GraphElementOwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <GraphElementConnected {...{...props, children}} />; }\r\nconsole.info('graphElement loaded');\r\n","import type { NotAString } from \"../../joiner/classes\";\r\nimport {\r\n    BEGIN,\r\n    Constructor,\r\n    Constructors,\r\n    CreateElementAction,\r\n    DEdge, DeleteElementAction,\r\n    Dictionary,\r\n    DPointerTargetable,\r\n    DtoL,\r\n    END,\r\n    getWParams,\r\n    GObject,\r\n    IStore,\r\n    Leaf,\r\n    LEdge,\r\n    LGraphElement,\r\n    Log,\r\n    LogicContext,\r\n    LPointerTargetable,\r\n    Node,\r\n    Pack,\r\n    Pack1,\r\n    PackArr,\r\n    PointedBy,\r\n    Pointer,\r\n    Pointers,\r\n    RuntimeAccessible,\r\n    Abstract,\r\n    Instantiable,\r\n    RuntimeAccessibleClass,\r\n    Selectors,\r\n    SetFieldAction,\r\n    SetRootFieldAction,\r\n    ShortAttribETypes,\r\n    ShortAttribSuperTypes,\r\n    store,\r\n    TargetableProxyHandler,\r\n    U,\r\n    unArr,\r\n    WPointerTargetable, DUser, DocString\r\n} from \"../../joiner\";\r\nimport {Json, ObjectWithoutPointers, orArr, PrimitiveType} from \"../../joiner/types\";\r\n\r\nimport {\r\n    AccessModifier,\r\n    ECoreAnnotation,\r\n    ECoreAttribute,\r\n    ECoreClass,\r\n    ECoreEnum,\r\n    EcoreLiteral,\r\n    ECoreOperation,\r\n    ECorePackage,\r\n    EcoreParser,\r\n    ECoreReference,\r\n    ECoreRoot\r\n} from \"../../api/data\";\r\n\r\n\r\n@Node\r\n@RuntimeAccessible\r\nexport class DModelElement extends DPointerTargetable {\r\n    // static _super = DPointerTargetable;\r\n    // static logic: typeof LModelElement;\r\n    // static structure: typeof DModelElement;\r\n    // static singleton: LModelElement;\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n\r\n    id!: Pointer<DModelElement, 1, 1, LModelElement>;\r\n    parent: Pointer<DModelElement, 0, 'N', LModelElement> = [];\r\n    father!: Pointer<DModelElement, 1, 1, LModelElement>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n\r\n    public static new(): DModelElement {\r\n        Log.exx(\"DModelElement is abstract, cannot instantiate\");\r\n        return null as any;\r\n        //return new Constructors(new DModelElement('dwc')).DPointerTargetable().DModelElement().end();\r\n    }\r\n}\r\n\r\n@Leaf\r\n@RuntimeAccessible\r\nexport class DAnnotationDetail extends DPointerTargetable {\r\n    // todo\r\n}\r\n\r\n/*\r\ntype Pack1<D extends DPointerTargetable, L extends LPointerTargetable = DtoL<D>, P extends Pointer<D, 0, 1, L> = Pointer<D, 0, 1, L>, R = {D:D, L:L, P:P} > = P|D|L\r\ntype PackArr<D extends DPointerTargetable, L extends LPointerTargetable = DtoL<D>, P extends Pointer<D, 0, 1, L> = Pointer<D, 0, 1, L> , ARR = Pack1<D>> = (ARR)[];\r\ntype Pack<D extends DPointerTargetable, L extends LPointerTargetable = DtoL<D>, P extends Pointer<D, 0, 1, L> = Pointer<D, 0, 1, L> , ARR = Pack1<D>> = ARR | (ARR)[];*/\r\n\r\n\r\n@Abstract\r\n@RuntimeAccessible\r\nexport class LModelElement<Context extends LogicContext<DModelElement> = any, D extends DModelElement = DModelElement> extends LPointerTargetable {\r\n    // extends Mixin(DModelElement0, LPointerTargetable)\r\n    // static logic: typeof LModelElement;\r\n    // static structure: typeof DModelElement;\r\n    // static singleton: LModelElement;\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    /*static ResolvePointer = resolvePointerFunction;\r\n    private static ResolvePointers? = resolvePointersFunction;\r\n    private resolvePointer<T extends DPointerTargetable = DPointerTargetable, LB extends number = 0, UB extends number = 0, RET extends LPointerTargetable = LPointerTargetable>(ptr: Pointer<T, LB, UB, RET>): RET | null {\r\n        return LModelElement.ResolvePointer(ptr); }\r\n    private resolvePointers<T extends DPointerTargetable = DPointerTargetable, LB extends number = 0, RET extends LPointerTargetable = LPointerTargetable>(ptr: Pointer<T, LB, 'N', RET>)\r\n        : (RET | null)[] { return resolvePointersFunction(ptr); }\r\n    */\r\n    public __raw!: DModelElement;\r\n    id!: Pointer<DModelElement, 1, 1, LModelElement>;\r\n    parent!: LModelElement[];\r\n    father!: LModelElement; // annotations can be children of everything. except them fathers are: Model, Package, Classifier(class+enum), Operation\r\n\r\n    private __info_of__father = {type: \"LModelElement[]\", txt:\"<a href=\\\"https://github.com/DamianoNaraku/jodel-react/wiki/LModelElement\\\"><span>The element containing this object.</span></a>\"};\r\n    public fatherList!: LModelElement[]; // chain of fathers going up recursively\r\n    annotations!: LAnnotation[];\r\n    children!: (LPackage | LClassifier | LTypedElement | LAnnotation | LObject | LValue)[];\r\n    nodes!: LGraphElement[];\r\n    node!: LGraphElement | null;\r\n\r\n    // utilities to go up in the tree (singular names)\r\n    model!: LModel; // utility, follow father chain until get a Model parent or null\r\n    package!: LPackage | null;\r\n    class!: LClass | null;\r\n    enum!: LEnumerator | null;\r\n    operation!: LOperation | null;\r\n    subNodes!: LGraphElement[] | null;\r\n\r\n\r\n    property!: keyof DModelElement;\r\n    containers!: LNamedElement[]; // list of fathers until the model is reached.\r\n\r\n    public generateEcoreJson(loopDetectionloopDetectionObj: Dictionary<Pointer, DModelElement> = {}): Json {\r\n        throw new Error(\"cannot be called directly, should trigger getter. this is only for correct signature\");\r\n    }\r\n\r\n    private get_generateEcoreJson(context: Context): (loopdetectionobj: Dictionary<Pointer, DModelElement>) => Json {\r\n        return (loopdetectionobj) => this.generateEcoreJson_impl(context, loopdetectionobj);\r\n    }\r\n\r\n    protected generateEcoreJson_impl(context: Context, loopDetectionObj?: Dictionary<Pointer, DModelElement>): Json {\r\n        return Log.exDevv(\"generateEcoreJson() should be overridden\", context);\r\n    }\r\n\r\n    public duplicate(deep: boolean = true): this {\r\n        return this.cannotCall(this.constructor.name + \"duplicate() class is abstract\");\r\n    }\r\n\r\n    public addAnnotation(source?: DAnnotation[\"source\"], details?: DAnnotation[\"details\"]): DAnnotation {\r\n        return this.cannotCall(\"addAnnotation\");\r\n    }\r\n\r\n    protected get_addAnnotation(context: Context): this[\"addAnnotation\"] {\r\n        return (source?: DAnnotation[\"source\"], details?: DAnnotation[\"details\"]) => DAnnotation.new(source, details, context.data.id, true);\r\n    }\r\n\r\n    protected set_containers(): boolean {\r\n        return this.cannotSet('containers');\r\n    }\r\n\r\n    protected get_containers(context: Context): LModelElement[\"containers\"] {\r\n        let thiss: LModelElement = context.proxyObject;\r\n        const ret: LModelElement[] = [thiss];\r\n        while (true) {\r\n            thiss = thiss.father;\r\n            if (!thiss) break;\r\n            ret.push(thiss);\r\n        }\r\n        return ret as LNamedElement[];\r\n    }\r\n\r\n\r\n    protected get_namespace(context: Context): string {\r\n        throw new Error(\"?? get namespace ?? todo\");\r\n        return \"\";\r\n    }\r\n\r\n    protected get_subNodes(context: LogicContext<LClass>, includingthis: boolean = false): LGraphElement[] {\r\n        const lclass: LClass = context.proxyObject as any;\r\n        let $class = $('[data-dataid=\"' + context.data.id + '\"]');\r\n        let $subnodes = $class.find('[data-nodeid]');\r\n\r\n        function mapfunc(this: HTMLElement) {\r\n            return this.dataset.nodeid;\r\n        }\r\n\r\n        let nodehtmlarr: HTMLElement[] = $subnodes.toArray();\r\n        if (includingthis) nodehtmlarr.push($class[0]);\r\n        let nodeidarr: string[] = nodehtmlarr.map((html: HTMLElement) => html.dataset.nodeid) as string[];\r\n        let state = store.getState();\r\n        let dnodes = nodeidarr.map(id => state.idlookup[id]).filter((d) => !!d);\r\n        return dnodes.map(d => LPointerTargetable.wrap(d)) as any;\r\n    }\r\n\r\n\r\n    // name -> redux (es. DClass -> classs)\r\n    protected get_property(context: Context): this[\"property\"] {\r\n        return (context.data.className.substring(1) + \"s\").toLowerCase() as any;\r\n    }\r\n\r\n    protected targetRemoved(context: Context, field: keyof DPointerTargetable): void {\r\n        context.proxyObject.delete();\r\n    }\r\n\r\n\r\n    protected get_fatherList(context: Context): LModelElement[] {\r\n        let ret: LModelElement[] = [context.proxyObject];\r\n        let loopdetection: Dictionary<Pointer, boolean> = {};\r\n        loopdetection[context.data.id] = true;\r\n        let current = this.get_father(context);\r\n        while (current) {\r\n            if (loopdetection[current.id]) { console.error(\"found loop\", {loopdetection, ret, current}); return ret; }\r\n            loopdetection[current.id] = true;\r\n            ret.push(current);\r\n            current = current.father;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public superDelete(): void {\r\n    }\r\n\r\n    protected get_superDelete(context: Context): () => void {\r\n        const data = context.proxyObject;\r\n        const father = data.father.__raw;\r\n        const fatherFieldName = U.getFatherFieldToDelete(data);\r\n        const reduxFieldName = U.getReduxFieldToDelete(data);\r\n        const ret = () => {\r\n            if (fatherFieldName) {\r\n                const fatherField: Pointer<DModelElement, 0, 'N', LModelElement> = father[fatherFieldName] as Pointer<DModelElement, 0, 'N', LModelElement>;\r\n                SetFieldAction.new(father, fatherFieldName, fatherField.indexOf(data.id), '-=', true);\r\n            }\r\n            if (reduxFieldName) {\r\n                const state = Selectors.getState();\r\n                const reduxField: Pointer<DModelElement, 0, 'N', LModelElement> = state[reduxFieldName];\r\n                SetRootFieldAction.new(reduxFieldName, reduxField.indexOf(data.id), '-=', true);\r\n            }\r\n            if(data.children) { for(let child of data.children) { child.delete(); } }\r\n            const selected = Selectors.getState()._lastSelected?.modelElement;\r\n            if(selected && selected === data.id) SetRootFieldAction.new('_lastSelected', {}, '', false);\r\n            DeleteElementAction.new(data.id);\r\n        };\r\n        return ret;\r\n    }\r\n\r\n\r\n    protected get_delete(context: Context): () => void {\r\n        const ret = () => {\r\n            context.proxyObject.superDelete();\r\n        }\r\n        return ret;\r\n    }\r\n\r\n\r\n    // @ts-ignore\r\n    private get_until_parent<D extends Constructor, L extends DtoL<InstanceType<D>>>(l: LModelElement, d: DModelElement, father: D): L | null {\r\n        while (true) {\r\n            // console.log('get_until_parent', {l, d, father}, {dname: d.className, fname: father.name});\r\n            if (d.className === father.name) return l as L;\r\n            l = l.father;\r\n            let oldd = d;\r\n            d = l.__raw;\r\n            if (oldd === d) return null; // reached end of father chain (a model) without finding the desired parent.\r\n        }\r\n    }\r\n\r\n    protected get_nodes(context: Context): LGraphElement[] {\r\n        const nodes: LGraphElement[] = [];\r\n        const nodeElements = $('[data-dataid=\"' + context.data.id + '\"]');\r\n        for (let nodeElement of nodeElements) {\r\n            const nodeId = nodeElement.id;\r\n            if (nodeId) {\r\n                const lNode: LGraphElement | undefined = LPointerTargetable.wrap(nodeId);\r\n                if (lNode) nodes.push(lNode);\r\n            }\r\n        }\r\n        return nodes;\r\n    }\r\n\r\n    protected get_node(context: Context): LGraphElement | null {\r\n        const nodes = context.proxyObject.nodes;\r\n        const node = (nodes.length > 0) ? nodes[0] : null;\r\n        return node;\r\n    }\r\n\r\n    /*\r\n    protected get_nodes(context: Context): this[\"nodes\"] {\r\n        return context.data.nodes.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n    protected set_nodes(val: PackArr<this[\"nodes\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        SetFieldAction.new(context.data, 'nodes', list);\r\n        return true;\r\n    }\r\n    */\r\n\r\n    protected get_model(context: Context): LModel {\r\n        return this.get_until_parent(context.proxyObject, context.data, DModel) as LModel;\r\n    }\r\n\r\n    protected get_package(context: Context): LPackage {\r\n        return this.get_until_parent(context.proxyObject, context.data, DPackage) as LPackage;\r\n    }\r\n\r\n    protected get_class(context: Context): LClass | null {\r\n        return this.get_until_parent(context.proxyObject, context.data, DClass);\r\n    } // todo: might be better for pergormance to erase this universal method and add implementations to every single L-class counting the correct amount of \"father\" navigations for each ( attrib to package? use attrib.father.father)\r\n    protected get_operation(context: Context): LOperation | null {\r\n        return this.get_until_parent(context.proxyObject, context.data, DOperation);\r\n    }\r\n\r\n    protected get_enum(context: Context): LEnumerator | null {\r\n        return this.get_until_parent(context.proxyObject, context.data, DEnumerator);\r\n    }\r\n\r\n    protected get_father(context: Context): LModelElement {\r\n        return LPointerTargetable.from(context.data.father);\r\n    }\r\n\r\n    protected get_children_idlist(context: Context): Pointer<DAnnotation | DPackage | DClassifier | DEnumerator | DEnumLiteral | DParameter | DStructuralFeature | DOperation | DObject | DValue, 1, 'N'> { // LPackage | LClassifier | LTypedElement | LAnnotation | LEnumLiteral | LParameter | LStructuralFeature | LOperation\r\n        return context.data.annotations ? [...context.data.annotations] : [];\r\n    }\r\n\r\n    protected get_children(context: Context): this[\"children\"] {\r\n        // return this.get_children_idlist(context).map(e => LPointerTargetable.from(e));\r\n        return LPointerTargetable.from(this.get_children_idlist(context));\r\n    }\r\n\r\n    protected set_children(a: never, context: Context): boolean {\r\n        return Log.exx('children is a derived read-only collection', this);\r\n    }\r\n\r\n\r\n    add_parent(val: Pack<this[\"parent\"]>, logicContext: Context): boolean { // todo: when will be used?\r\n        const ptr = Pointers.from(val);\r\n        return SetFieldAction.new(logicContext.data, 'parent', ptr, '+=', true); // todo: need to update children of the old and new parents\r\n    }\r\n\r\n    protected remove_parent(logicContext: Context): boolean { // todo: perchè senza bersaglio? perchè sempre elimina tutti?\r\n        return SetFieldAction.new(logicContext.data, 'parent', [], '', true);\r\n    }\r\n\r\n    protected get_parent(context: Context): this[\"parent\"] {\r\n        return LPointerTargetable.from(context.data.id);\r\n    }\r\n\r\n    protected set_parent(val: Pack<LAnnotation>, context: Context): boolean { // val: Pack<DModelElement>\r\n        const ptrs = Pointers.from(val);\r\n        SetFieldAction.new(context.data, 'father', ptrs?.[0] || ptrs, '', true);\r\n        return SetFieldAction.new(context.data, 'parent', ptrs, '', true);\r\n    }\r\n\r\n    add_annotation(val: Pack<this[\"annotations\"]>, context: Context): boolean {\r\n        const ptrs = Pointers.from(val);\r\n        return SetFieldAction.new(context.data, 'annotations', ptrs, '+=', true);\r\n    }\r\n\r\n    remove_annotation(val: Pack<this[\"annotations\"]>, context: Context): boolean { // todo: when this will be ever used? this should be triggered by LObject but only get_ / set_ and delete of whole elements should be triggerable.\r\n        //todo: remove as any\r\n        const ptrs: Pointer<DAnnotation, 1, 'N', LAnnotation> = Pointers.from(val) as any;\r\n        let indexes = ptrs.map(ptr => context.data.annotations.indexOf(ptr)).filter(p => p >= 0);\r\n        return SetFieldAction.new(context.data, 'annotations', indexes, '-=', true);\r\n    }\r\n\r\n    protected get_annotations(context: Context): this[\"annotations\"] {\r\n        return LPointerTargetable.fromPointer(context.data.annotations);\r\n    }\r\n\r\n    protected set_annotations(val: Pack<LAnnotation>, context: Context): boolean {\r\n        //  if (!Array.isArray(val)) val = [val];\r\n        //         val = val.map( v => (v instanceof LAnnotation ? v.id : ( Pointers.filterValid(v) ? v : null ))) as Pointer<DAnnotation>[];\r\n        const ptrs = Pointers.from(val);\r\n        SetFieldAction.new(context.data, 'annotations', ptrs, '', true);\r\n        return true;\r\n    }\r\n\r\n    protected get_addChild(context: Context): (type: string, ...params: any[]) => void { // just for add new, not for add pre-existing.\r\n        console.log(\"addchild\", context, this);\r\n        return (type, ...args: any) => {\r\n            let ret: (...params: any[]) => void = () => {\r\n            };\r\n            switch ((type || '').toLowerCase()) {\r\n                default:\r\n                    Log.ee('cannot find children type requested to add:', {type: (type || '').toLowerCase(), context});\r\n                    break;\r\n                case \"attribute\":\r\n                    ret = (this as any).get_addAttribute(context as any);\r\n                    break;\r\n                case \"class\":\r\n                    ret = (this as any).get_addClass(context as any);\r\n                    break;\r\n                case \"package\":\r\n                    ret = (this as any).get_addPackage(context as any);\r\n                    break;\r\n                case \"reference\":\r\n                    ret = (this as any).get_addReference(context as any);\r\n                    break;\r\n                case \"enumerator\":\r\n                    ret = (this as any).get_addEnumerator(context as any);\r\n                    break;\r\n                case \"literal\":\r\n                    ret = (this as any).get_addLiteral(context as any);\r\n                    break;\r\n                case \"operation\":\r\n                    ret = (this as any).get_addOperation(context as any);\r\n                    break;\r\n                case \"parameter\":\r\n                    ret = (this as any).get_addParameter(context as any);\r\n                    break;\r\n                //case \"exception\": ret = ((exception: Pack1<LClassifier>) => { let rett = this.get_addException(context as any); rett(exception); }) as any; break;\r\n                case \"exception\":\r\n                    ret = (this as any).get_addException(context as any);\r\n                    break;\r\n            }\r\n            return ret(...args);\r\n        }\r\n    }\r\n\r\n    /*\r\n        protected get_addPackage(context: Context): (() => void) {\r\n            let ret = () => {};\r\n            switch (context.data?.className) {\r\n                default: break;\r\n                case \"DModel\": ret = () => LModelElement.addPackage(context.data as DModel); break;\r\n                case \"DPackage\": ret = () => LModelElement.addSubPackage(context.data as DPackage); break;\r\n            }\r\n            ret();\r\n            return ret;\r\n        }\r\n\r\n        private static addPackage(dModel: DModel): void {\r\n            const lModel: LModel = LModelElement.from(dModel);\r\n            let name = 'package_' + 0;\r\n            let childrenNames: (string)[] = lModel.packages.map( p => p.name);\r\n            name = U.increaseEndingNumber(name, false, false, (newName) => childrenNames.indexOf(newName) >= 0)\r\n            const dPackage = DPackage.new(name);\r\n            CreateElementAction.new(dPackage);\r\n            let wModel = WPointerTargetable.fromD(dModel);\r\n            wModel.packages = [...dModel.packages, dPackage];\r\n        }\r\n\r\n        private static addSubPackage_obsolete(dPackage: never): void {\r\n            const lPackage: LPackage = LPackage.from(dPackage);\r\n            let name = 'subpackage_' + 0;\r\n            let childrenNames: (string)[] = lPackage.children.map( p => (p as LPackage).name);\r\n            name = U.increaseEndingNumber(name, false, false, (newName) => childrenNames.indexOf(newName) >= 0)\r\n            const dSubPackage = DPackage.new(name);\r\n            CreateElementAction.new(dSubPackage);\r\n            let wPackage = WPointerTargetable.fromD(dPackage);\r\n            wPackage.subpackages = [...dPackage.subpackages, dSubPackage];\r\n        }*/\r\n\r\n    protected get_addException(context: Context): () => void {\r\n        let ret = () => {\r\n        };\r\n        const dOperation: DOperation | null = (context.data?.className === \"DOperation\") ? context.data as DOperation : null;\r\n        if (dOperation) {\r\n            const dClass = DPointerTargetable.from(dOperation.father);\r\n            ret = () => {\r\n                SetFieldAction.new(dOperation, \"exceptions\", dClass.id, '+=', true);\r\n            }\r\n        }\r\n        ret();\r\n        return ret;\r\n    }\r\n\r\n    // activated by user in JSX\r\n    // todo: this.wrongAccessMessage(\"addClass\");\r\n    protected cannotCall(name: string, ...params: string[]): any {\r\n        Log.exDevv(name + ' should never be called directly, but should trigger get_' + name + '(' + params.join(', ') + '), this is only a signature for type checking.');\r\n    }\r\n\r\n    public addClass(): void {\r\n        this.cannotCall('addClass');\r\n    }\r\n\r\n    public addAttribute(): void {\r\n        this.cannotCall('addAttribute');\r\n    }\r\n\r\n    public addReference(): void {\r\n        this.cannotCall('addReference');\r\n    }\r\n\r\n    public addEnumerator(): void {\r\n        this.cannotCall('addEnumerator');\r\n    }\r\n\r\n    public addParameter(): void {\r\n        this.cannotCall('addParameter');\r\n    }\r\n\r\n    // chiedere al prof: cosa può lanciato come eccezione: se tutte le classi o se solo quelle che estendono Exception\r\n    public addException(exception?: DClassifier): () => void {\r\n        throw this.wrongAccessMessage(\"AddException\");\r\n    }\r\n\r\n    public addChild(type: string): void {\r\n        this.cannotCall(\"addChild, it's obsolete call specific adders\", type);\r\n    }\r\n\r\n}\r\n\r\n/*function isValidPointer<T extends DPointerTargetable = DModelElement, LB extends number = 0, UB extends number = 1, RET extends LPointerTargetable = LModelElement>\r\n(p: Pointer<T, LB, UB, RET>, constraintType?: typeof DPointerTargetable): boolean {\r\n    const pointerval: RET | null = LModelElement.ResolvePointer(p);\r\n    if (!pointerval) return false;\r\n    if (!constraintType) return true;\r\n    return (pointerval instanceof constraintType); }*/\r\n\r\n/* todo:\r\nnel proxy aggiungi regola di default, se prendi qualcosa che inizia con \"set_X\" esplicitamente (dovrebbe farlo solo il dev)\r\nrichiama _set_X(context, ...params)     <---- nuova funzione set di default, anche this.x = x richiama _set_x\r\n\r\nil dev specifica set_x come public di sola firma senza implementazione (throw exception) e senza context\r\nil dev specifica _set_x come implementazione private\r\n\r\nper la get esiste solo _get_x, non \"get_x\"\r\n\r\n todo2: aggiungi readonly a tutti i campi L per non sbagliarsi e fare in modo che il dev usi sempre i \"set_\" che sono correttamente tipizzati\r\n*\r\n* */\r\n\r\n/*todo:\r\n* for every feature X: typed L, in CLASS_L0 with a side effects when they are edited (like need to update other data for consistency)\r\n*\r\n* dev will use this\r\n* protected set_X(val: D | L | Pointer<D> ) { throw new Error(\"set_X should never be executed, the proxy should redirect to get_set_X.\"); }\r\n* protected get_set_X( val: D | L | Pointer<D>, otherparams, ContextD>) { throw new Error(\"set_X should never be executed, the proxy should redirect to get_set_X.\"); }\r\n*\r\n*\r\n* */\r\n// @RuntimeAccessible export class _WModelElement extends LModelElement { }\r\n// export type WModelElement = DModelElement | LModelElement | _WModelElement;\r\nDPointerTargetable.subclasses.push(DModelElement);\r\nDPointerTargetable.subclasses.push(LModelElement);\r\n\r\n\r\n@Leaf\r\n@RuntimeAccessible\r\nexport class DAnnotation extends DModelElement { // extends Mixin(DAnnotation0, DModelElement)\r\n    // static singleton: LAnnotation;\r\n    // static logic: typeof LAnnotation;\r\n    // static structure: typeof DAnnotation;\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // inherit redefine\r\n    id!: Pointer<DAnnotation, 1, 1, LAnnotation>;\r\n    parent: Pointer<DModelElement, 0, 'N', LModelElement> = [];\r\n    father!: Pointer<DModelElement, 1, 1, LModelElement>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    // personal\r\n    source!: string;\r\n    details!: DAnnotationDetail[];//Dictionary<string, string>;\r\n\r\n    public static new(source?: DAnnotation[\"source\"], details?: DAnnotation[\"details\"], father?: Pointer, persist: boolean = true): DAnnotation {\r\n        // if (!name) name = this.defaultname(\"annotation \", father);\r\n        return new Constructors(new DAnnotation('dwc'), father, persist, undefined).DPointerTargetable().DModelElement().DAnnotation(source, details).end();\r\n    }\r\n}\r\n\r\n@Node\r\n@RuntimeAccessible\r\nexport class LAnnotation<Context extends LogicContext<DAnnotation> = any, D extends DAnnotation = DAnnotation> extends LModelElement {\r\n    // Mixin(DAnnotation0, LModelElement)\r\n    // @ts-ignore\r\n    __namee!: \"LAnnotation\" = \"LAnnotation\";\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DAnnotation;\r\n    id!: Pointer<DAnnotation, 1, 1, LAnnotation>;\r\n    // static singleton: LAnnotation;\r\n    // static logic: typeof LAnnotation;\r\n    // static structure: typeof DAnnotation;\r\n\r\n    // inherit redefine\r\n    parent!: LModelElement[];\r\n    father!: LModelElement;\r\n    annotations!: LAnnotation[];\r\n    // personal\r\n    source!: string;\r\n    details!: LAnnotationDetail[];// Dictionary<string, string> = {};\r\n\r\n    protected generateEcoreJson_impl(context: Context, loopDetectionObj: Dictionary<Pointer, DModelElement> = {}): Json {\r\n        loopDetectionObj[context.data.id] = context.data;\r\n        const json: Json = {};\r\n        EcoreParser.write(json, ECoreAnnotation.source, context.data.source);\r\n        // EcoreParser.write(json, ECoreAnnotation.references, context.proxyObject.referencesStr);\r\n        EcoreParser.write(json, ECoreAnnotation.details, context.proxyObject.details.map(d => d.generateEcoreJson(loopDetectionObj)));\r\n        return json;\r\n    }\r\n\r\n    public duplicate(deep: boolean = true): this {\r\n        return this.cannotCall(this.constructor.name + \"duplicate()\");\r\n    }\r\n\r\n    protected get_duplicate(context: Context): ((deep?: boolean) => this) {\r\n        return (deep: boolean = false) => {\r\n            BEGIN()\r\n            let de = context.proxyObject.father.addAnnotation(context.data.source, (deep ? context.proxyObject.details.map(ldet => ldet.duplicate().__raw) : context.data.details));\r\n            let le: this = LPointerTargetable.fromD(de);\r\n            let we: WAnnotation = le as any;\r\n            we.annotations = deep ? context.proxyObject.annotations.map(lchild => lchild.duplicate(deep).id) : context.data.annotations;\r\n            END()\r\n            return le;\r\n        }\r\n    }\r\n\r\n    protected get_source(context: Context): this[\"source\"] {\r\n        return context.data.source;\r\n    }\r\n\r\n    protected set_source(val: this[\"source\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'source', val, '', false);\r\n        return true;\r\n    }\r\n\r\n    protected get_details(context: Context): this[\"details\"] {\r\n        return TargetableProxyHandler.wrapAll(context.data.details);\r\n    }\r\n\r\n    protected set_details(val: this[\"details\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'details', val);\r\n        return true;\r\n    }\r\n}\r\n\r\nDModelElement.subclasses.push(DAnnotation);\r\nLModelElement.subclasses.push(LAnnotation);\r\n\r\n@Leaf\r\n@RuntimeAccessible\r\nexport class LAnnotationDetail<Context extends LogicContext<DAnnotationDetail> = any> extends LModelElement { // todo\r\n    father!: LAnnotation;\r\n\r\n    protected generateEcoreJson_impl(context: Context, loopDetectionObj: Dictionary<Pointer, DModelElement> = {}): Json {\r\n        // loopDetectionObj[context.data.id] = context.data;\r\n        const json: Json = {};\r\n        // if (context.data.name !== null) EcoreParser.write(json, ECoreDetail.key, context.data.name);\r\n        // if (context.data.value !== null) EcoreParser.write(json, ECoreDetail.value, context.data.value);\r\n        return json;\r\n    }\r\n\r\n    public duplicate(deep: boolean = true): this {\r\n        return this.cannotCall(this.constructor.name + \"duplicate()\");\r\n    }\r\n\r\n    protected get_duplicate(context: Context): ((deep?: boolean) => this) {\r\n        Log.exDevv(\"LAnnotationDetail.getDuplicate(): todo\");\r\n        return () => this;\r\n        // return (deep: boolean = false) => (context.proxyObject as LAnnotationDetail).father.addAnnotationDetail( {...context.data._subMaps})\r\n    }\r\n}\r\n\r\nDModelElement.subclasses.push(DAnnotationDetail);\r\nLModelElement.subclasses.push(LAnnotationDetail);\r\n\r\n@Node\r\n@RuntimeAccessible\r\nexport class DNamedElement extends DPointerTargetable { // Mixin(DNamedElement0, DAnnotation)\r\n    // static _super = DAnnotation;\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LNamedElement;\r\n    // static logic: typeof LNamedElement;\r\n    // static structure: typeof DNamedElement;\r\n\r\n    // inherit redefine\r\n    id!: Pointer<DNamedElement, 1, 1, LNamedElement>;\r\n    parent: Pointer<DModelElement, 0, 'N', LModelElement> = [];\r\n    father!: Pointer<DModelElement, 1, 1, LModelElement>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    // personal\r\n    name!: string;\r\n\r\n    public static new(name?: DNamedElement[\"name\"]): DNamedElement {\r\n        Log.exx(\"DNamedElement is abstract, cannot instantiate\");\r\n        return null as any;\r\n        // return new Constructors(new DNamedElement('dwc')).DPointerTargetable().DModelElement().DNamedElement(name).end();\r\n    }\r\n\r\n}\r\n\r\n@Abstract\r\n@RuntimeAccessible\r\nexport class LNamedElement<Context extends LogicContext<DNamedElement> = any> extends LModelElement { // Mixin(DNamedElement0, DAnnotation)\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // public __raw!: DNamedElement;\r\n    id!: Pointer<DNamedElement, 1, 1, LNamedElement>;\r\n    // static singleton: LNamedElement;\r\n    // static logic: typeof LNamedElement;\r\n    // static structure: typeof DNamedElement;\r\n\r\n    // inherit redefine\r\n    parent!: LModelElement[];\r\n    father!: LModelElement;\r\n    annotations!: LAnnotation[];\r\n    // personal\r\n    name!: string;\r\n    namespace!: string;\r\n    fullname!: string;\r\n\r\n    protected set_containers(): boolean {\r\n        return this.cannotSet('containers');\r\n    }\r\n\r\n    protected get_containers(context: Context): LNamedElement[\"containers\"] {\r\n        let thiss: LNamedElement = context.proxyObject;\r\n        const ret: LNamedElement[] = [thiss];\r\n        while (true) {\r\n            thiss = thiss.father as LNamedElement;\r\n            if (!thiss) break;\r\n            ret.push(thiss);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    // protected get_namespace(context: Context): string { throw new Error(\"?? get namespace ?? todo\"); return \"\"; }\r\n\r\n    protected get_fullname(context: Context): this[\"fullname\"] {\r\n        const containers = this.get_containers(context);\r\n        let fullname: string = containers.reverse().slice(1, containers.length).map(c => c.name).join('.');\r\n        return fullname;\r\n    }\r\n\r\n\r\n    protected get_name(context: Context): this[\"name\"] {\r\n        return context.data.name;\r\n    }\r\n\r\n    protected set_name(val: this[\"name\"], context: Context): boolean {\r\n        let name = val;\r\n        const father = context.proxyObject.father;\r\n        if (father) {\r\n            const check = father.children.filter((child) => {\r\n                return (DNamedElement.fromPointer(child.id) as DNamedElement).name === name\r\n            });\r\n            if (check.length > 0) {\r\n                U.alert('error', 'Cannot rename the selected element since this name is already taken.');\r\n                return true\r\n            }\r\n        }\r\n        SetFieldAction.new(context.data, 'name', name, '', false);\r\n        return true;\r\n\r\n        /*\r\n        // this autofix removes spaces with _\r\n        if (val.match(/\\s/)) val = this._autofix_name(val, context);\r\n        // todo: validate if operation can be completed or need autocorrection, then either return false (invalid parameter cannot complete) or send newVal at redux\r\n        const fixedVal: string = val;\r\n        SetFieldAction.new(context.data, 'name', fixedVal, '', false);\r\n        return true;\r\n        */\r\n    }\r\n\r\n    protected _autofix_name(val: string, context: Context): string {\r\n        // NB: NON fare autofix di univocità nome tra i children o qualsiasi cosa dipendente dal contesto, questo potrebbe essere valido in alcuni modelli e invalido in altri e modificare un oggetto condiviso.\r\n        return val.replaceAll(/\\s/g, '_');\r\n    }\r\n\r\n    protected get_autofix_name(val: string, context: Context): (val: string) => string {\r\n        return (val: string) => this._autofix_name(val, context);\r\n    }\r\n\r\n    public autofix_name(val: string): string {\r\n        return this.wrongAccessMessage(\"autofix_name\");\r\n    }\r\n}\r\n\r\n// @RuntimeAccessible export class _WNamedElement extends _WModelElement { }\r\n// export type WNamedElement = DNamedElement | LNamedElement | _WNamedElement;\r\nDModelElement.subclasses.push(DNamedElement);\r\nLModelElement.subclasses.push(LNamedElement);\r\n\r\n\r\n@RuntimeAccessible\r\nexport class DTypedElement extends DPointerTargetable { // Mixin(DTypedElement0, DNamedElement)\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LTypedElement;\r\n    // static logic: typeof LTypedElement;\r\n    // static structure: typeof DTypedElement;\r\n\r\n    // inherit redefine\r\n    id!: Pointer<DTypedElement, 1, 1, LTypedElement>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    parent: Pointer<DModelElement, 0, 'N', LModelElement> = [];\r\n    father!: Pointer<DModelElement, 1, 1, LModelElement>;\r\n    name!: string;\r\n    instances!: Pointer<DValue, 0, 'N', LValue>;\r\n    // personal\r\n    type!: Pointer<DClassifier, 1, 1, LClassifier>;\r\n    ordered: boolean = true;\r\n    unique: boolean = true;\r\n    lowerBound: number = 0;\r\n    upperBound: number = 1;\r\n    many!: boolean; // ?\r\n    required!: boolean; // ?\r\n\r\n\r\n    public static new(name?: DNamedElement[\"name\"], type?: DTypedElement[\"type\"], father?: Pointer, persist: boolean = true): DTypedElement {\r\n        Log.exx(\"DTypedElement is abstract, cannot instantiate\");\r\n        return null as any;\r\n        //return new Constructors(new DTypedElement('dwc'), father, persist, undefined).DPointerTargetable().DModelElement().DNamedElement(name).DTypedElement(type).end();\r\n    }\r\n}\r\n\r\n@Abstract\r\n@RuntimeAccessible\r\nexport class LTypedElement<Context extends LogicContext<DTypedElement> = any> extends LNamedElement { // extends Mixin(DTypedElement0, LNamedElement)\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DTypedElement;\r\n    id!: Pointer<DTypedElement, 1, 1, LTypedElement>;\r\n    // static singleton: LTypedElement;\r\n    // static logic: typeof LTypedElement;\r\n    // static structure: typeof DTypedElement;\r\n\r\n    // inherit redefine\r\n    parent!: LModelElement[];\r\n    father!: LModelElement;\r\n    annotations!: LAnnotation[];\r\n    name!: string;\r\n    namespace!: string;\r\n    instances!: LValue[];\r\n    // personal\r\n    type!: LClassifier;\r\n\r\n    primitiveType?: LClass;\r\n    classType?: LClass;\r\n    enumType?: LEnumerator;\r\n\r\n    ordered!: boolean;\r\n    unique!: boolean;\r\n    lowerBound!: number;\r\n    upperBound!: number;\r\n    many!: boolean;\r\n    required!: boolean;\r\n\r\n\r\n    protected get_classType(context: Context): this[\"classType\"] {\r\n        let type = this.get_type(context);\r\n        return type.isClass ? type as LClass : undefined;\r\n    }\r\n\r\n    protected get_enumType(context: Context): this[\"enumType\"] {\r\n        let type = this.get_type(context);\r\n        return type.isEnum ? type as LEnumerator : undefined;\r\n    }\r\n\r\n    protected get_primitiveType(context: Context): this[\"primitiveType\"] {\r\n        let type = this.get_type(context);\r\n        return type.isPrimitive ? type as LClass : undefined;\r\n    }\r\n\r\n    protected get_type(context: Context): this[\"type\"] {\r\n        return LPointerTargetable.from(context.data.type);\r\n    }\r\n\r\n    protected set_type(val: Pack1<this[\"type\"]>, context: Context): boolean {\r\n        const data = context.data;\r\n        let instances: LValue[] = context.proxyObject.instances;\r\n        SetFieldAction.new(context.data, 'type', Pointers.from(val), \"\", true);\r\n        return true;\r\n    }\r\n\r\n    protected get_ordered(context: Context): this[\"ordered\"] {\r\n        return context.data.ordered;\r\n    }\r\n\r\n    protected set_ordered(val: this[\"ordered\"], logicContext: Context): boolean {\r\n        return SetFieldAction.new(logicContext.data, 'ordered', val);\r\n    }\r\n\r\n    protected get_unique(context: Context): this[\"unique\"] {\r\n        return context.data.unique;\r\n    }\r\n\r\n    protected set_unique(val: this[\"unique\"], logicContext: Context): boolean {\r\n        return SetFieldAction.new(logicContext.data, 'unique', val);\r\n    }\r\n\r\n    protected get_lowerBound(context: Context): this[\"lowerBound\"] {\r\n        return context.data.lowerBound;\r\n    }\r\n\r\n    protected set_lowerBound(val: this[\"lowerBound\"], context: Context): boolean {\r\n        val = +val;\r\n        if (isNaN(val)) val = 0;\r\n        else val = Math.max(0, val);\r\n        SetFieldAction.new(context.data, 'lowerBound', val);\r\n        if (context.data.upperBound !=-1 && val > context.data.upperBound) SetFieldAction.new(context.data, 'upperBound', val);\r\n        return true;\r\n    }\r\n\r\n    protected get_upperBound(context: Context): this[\"upperBound\"] {\r\n        return context.data.upperBound;\r\n    }\r\n\r\n    protected set_upperBound(val: this[\"upperBound\"], context: Context): boolean {\r\n        val = +val;\r\n        if (isNaN(val)) val = -1;\r\n        else val = Math.max(-1, val);\r\n        SetFieldAction.new(context.data, 'upperBound', val);\r\n        if (val !== -1 && val < context.data.lowerBound) SetFieldAction.new(context.data, 'lowerBound', val);\r\n        return true;\r\n    }\r\n\r\n    protected get_many(context: Context): this[\"many\"] {\r\n        return context.data.many;\r\n    }\r\n\r\n    protected set_many(val: this[\"many\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'many', val);\r\n        return true;\r\n    }\r\n\r\n    protected get_required(context: Context): this[\"required\"] {\r\n        return context.data.required;\r\n    }\r\n\r\n    protected set_required(val: this[\"required\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'required', val);\r\n        return true;\r\n    }\r\n\r\n    public typeToEcoreString(): string {\r\n        return this.cannotCall(\"typeToEcoreString\");\r\n    }\r\n\r\n    protected get_typeToEcoreString(context: Context): () => string {\r\n        // if (context.data.classType) return EcoreParser.classTypePrefix + context.proxyObject.classType.name;\r\n        // if (context.data.enumType) return EcoreParser.classTypePrefix + context.proxyObject.enumType.name;\r\n        // if (context.data.primitiveType) return context.proxyObject.primitiveType.long;\r\n        return () => context.proxyObject.type.typeEcoreString;\r\n    }\r\n\r\n    public typeToShortString(): string {\r\n        return this.cannotCall(\"typeToShortString\");\r\n    }\r\n\r\n    protected get_typeToShortString(context: Context): () => string {\r\n        // if (context.data.classType) return '' + context.data.classType.name;\r\n        // if (context.data.enumType) return '' + context.data.enumType.name;\r\n        // if (context.data.primitiveType) return '' + context.data.primitiveType.getName();\r\n        return () => context.proxyObject.type.typeString;\r\n    }\r\n\r\n    canOverride(context: Context, other: LTypedElement): boolean {\r\n        // i primitivi identici sono compatibili\r\n        if (context.data.type === other.type.id) return true;\r\n        let t1 = context.proxyObject.type;\r\n        let t2 = other.type;\r\n        // se entrambi primitivi\r\n        if (context.proxyObject.primitiveType && other.primitiveType) {\r\n            ShortAttribSuperTypes[t1.name as ShortAttribETypes].includes(other.name as ShortAttribETypes);\r\n        }\r\n        if (context.proxyObject.enumType) return t1 === t2; // only if they are same enumerator\r\n        // now assumed to be class type\r\n        if (other.classType === other.classType) return true;\r\n        return (context.proxyObject.classType as LClass).isExtending(other.classType as LClass);\r\n    }\r\n\r\n}\r\n\r\n// @RuntimeAccessible export class _WTypedElement extends _WNamedElement { }\r\n// export type WTypedElement = DTypedElement | LTypedElement | _WTypedElement;\r\nDNamedElement.subclasses.push(DTypedElement);\r\nLNamedElement.subclasses.push(LTypedElement);\r\n\r\n\r\n@RuntimeAccessible\r\nexport /*abstract*/\r\nclass DClassifier extends DPointerTargetable { // extends DNamedElement\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LClassifier;\r\n    // static logic: typeof LClassifier;\r\n    // static structure: typeof DClassifier;\r\n\r\n    // inherit redefine\r\n    id!: Pointer<DClassifier, 1, 1, LClassifier>;\r\n    parent: Pointer<DPackage, 0, 'N', LPackage> = [];\r\n    father!: Pointer<DPackage, 1, 1, LPackage>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    name!: string;\r\n    // personal\r\n    instanceClassName!: string;\r\n    // instanceClass: EJavaClass // ?\r\n    defaultValue!: Pointer<DObject, 1, 1, LObject>[] | string[];\r\n    // isInstance(object: EJavaObject): boolean; ?\r\n    // getClassifierID(): number;\r\n\r\n    public static new(name?: DNamedElement[\"name\"], father?: Pointer, persist: boolean = true): DClassifier {\r\n        Log.exx(\"DClassifier is abstract, cannot instantiate\");\r\n        return null as any;\r\n        // return new Constructors(new DClassifier('dwc'), father, persist, undefined).DPointerTargetable().DModelElement().DNamedElement(name).DClassifier().end();\r\n    }\r\n}\r\n\r\n@Abstract\r\n@RuntimeAccessible\r\nexport class LClassifier<Context extends LogicContext<DClassifier> = any> extends LNamedElement { // extends DNamedElement\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DClassifier;\r\n    id!: Pointer<DClassifier, 1, 1, LClassifier>;\r\n    // static singleton: LClassifier;\r\n    // static logic: typeof LClassifier;\r\n    // static structure: typeof DClassifier;\r\n\r\n    // inherit redefine\r\n    parent!: LPackage[];\r\n    father!: LPackage;\r\n    annotations!: LAnnotation[];\r\n    name!: string;\r\n    namespace!: string;\r\n    // personal\r\n    instanceClassName!: string;\r\n    // instanceClass: EJavaClass // ?\r\n    defaultValue!: LObject[] | string[];\r\n    isPrimitive!: boolean;\r\n    isClass!: boolean;\r\n    isEnum!: boolean;\r\n    // isInstance(object: EJavaObject): boolean; ?\r\n    // getClassifierID(): number;\r\n\r\n    protected get_instanceClassName(context: Context): this[\"instanceClassName\"] {\r\n        return context.data.instanceClassName;\r\n    }\r\n\r\n    protected set_instanceClassName(val: this[\"instanceClassName\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'instanceClassName', val, \"\", false);\r\n        return true;\r\n    }\r\n\r\n    protected set_isPrimitive(val: this[\"isPrimitive\"], context: Context): boolean {\r\n        return this.cannotSet(\"isPrimitive\");\r\n    }\r\n\r\n    protected set_isClass(val: this[\"isClass\"], context: Context): boolean {\r\n        return this.cannotSet(\"isClass\");\r\n    }\r\n\r\n    protected set_isEnum(val: this[\"isEnum\"], context: Context): boolean {\r\n        return this.cannotSet(\"isEnum\");\r\n    }\r\n\r\n    protected get_isPrimitive(context: Context): this[\"isPrimitive\"] {\r\n        return !!((context.data as DClass).isPrimitive as unknown);\r\n    }\r\n\r\n    protected get_isClass(context: Context): this[\"isClass\"] {\r\n        return (context.data as DClass).isPrimitive ? false : context.data.className === DClass.name;\r\n    }\r\n\r\n    protected get_isEnum(context: Context): this[\"isEnum\"] {\r\n        return context.data.className === DEnumerator.name;\r\n    }\r\n\r\n    protected set_defaultValue(val: this[\"defaultValue\"] | DClassifier[\"defaultValue\"], context: Context): boolean {\r\n        if (typeof val !== \"object\" && !Pointers.isPointer(val)) {\r\n            // primitive default value for enums\r\n            SetFieldAction.new(context.data, 'defaultValue', val, \"\", false);\r\n        } else {\r\n            SetFieldAction.new(context.data, 'defaultValue', Pointers.from(val as Pointer[]) || [], \"\", true);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    typeEcoreString!: string;\r\n    typeString!: string;\r\n\r\n    private get_typeEcoreString(context: Context) {\r\n        return EcoreParser.classTypePrefix + context.data.name;\r\n    }\r\n\r\n    private get_typeString(context: Context) {\r\n        return context.data.name;\r\n    }\r\n}\r\n\r\n// @RuntimeAccessible export class _WClassifier extends _WNamedElement { }\r\n// export type WClassifier = DClassifier | LClassifier | _WClassifier;\r\nDNamedElement.subclasses.push(DClassifier);\r\nLNamedElement.subclasses.push(LClassifier);\r\n\r\n\r\n@RuntimeAccessible\r\nexport class DPackage extends DPointerTargetable { // extends DNamedElement\r\n    // static _super = DNamedElement;\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LPackage;\r\n    // static logic: typeof LPackage;\r\n    // static structure: typeof DPackage;\r\n\r\n    // inherit redefine\r\n    id!: Pointer<DPackage, 1, 1, LPackage>;\r\n    parent: Pointer<DPackage | DModel, 0, 'N', LPackage | LModel> = [];\r\n    father!: Pointer<DPackage | DModel, 1, 1, LPackage | LModel>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    name!: string;\r\n    // personal\r\n    classifiers: Pointer<DClassifier, 0, 'N', LClassifier> = [];\r\n    subpackages: Pointer<DPackage, 0, 'N', LPackage> = [];\r\n    uri!: string;\r\n    prefix!: string;\r\n\r\n    public static new(name?: DNamedElement[\"name\"], uri?: DPackage[\"uri\"], prefix?: DPackage[\"prefix\"], father?: Pointer, persist: boolean = true, fatherType?: Constructor): DPackage {\r\n        let dmodel: DModel | undefined;\r\n        if (!name) {\r\n            dmodel = father && DPointerTargetable.from(father);\r\n            name = this.defaultname(\"pkg_\", dmodel);\r\n        }\r\n        /*if (!uri) {\r\n            dmodel = dmodel || father && DPointerTargetable.from(father);\r\n            uri = ('org.jodel-react.') + (dmodel?.name || \"username\"); // (DPointerTargetable.from(DUser.current)).name) todo: when DUser is done\r\n        }*/\r\n        return new Constructors(new DPackage('dwc'), father, persist, fatherType).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DPackage(uri, prefix).end();\r\n    }/*\r\n    static new15(setter: (d: DPackage) => void, father: DPackage[\"father\"], fatherType: Constructor, name?: string): DPackage {\r\n        if (!name) name = this.defaultname(\"pkg_\", father);\r\n        return new Constructors(new DPackage('dwc'), father, true, fatherType).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DPackage().end(setter);\r\n    }*/\r\n    static new2(setter: Partial<ObjectWithoutPointers<DPackage>>, father: DPackage[\"father\"], fatherType: Constructor, name?: string): DPackage {\r\n        if (!name) name = this.defaultname(\"pkg_\", father);\r\n        return new Constructors(new DPackage('dwc'), father, true, fatherType).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DPackage().end((d)=> { Object.assign(d, setter); });\r\n    }\r\n}\r\n\r\n\r\n@Leaf\r\n@RuntimeAccessible\r\nexport class LPackage<Context extends LogicContext<DPackage> = any, C extends Context = Context, D extends DPackage = DPackage> extends LNamedElement { // extends DNamedElement\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DPackage;\r\n    id!: Pointer<DPackage, 1, 1, LPackage>;\r\n    // static singleton: LPackage;\r\n    // static logic: typeof LPackage;\r\n    // static structure: typeof DPackage;\r\n    // inherit redefine\r\n    parent!: (LPackage| LModel)[];  // ype 'LPackage' is missing the following properties from type 'LModelElement': get_set_parent, set_parent\r\n    father!: LPackage | LModel;\r\n    annotations!: LAnnotation[];\r\n    name!: string;\r\n    namespace!: string;\r\n    // personal\r\n    classifiers!: LClassifier[];\r\n    subpackages!: LPackage[];\r\n    uri!: string;\r\n    prefix: string = '';\r\n    // derived\r\n    classes!: LClass[];\r\n    enums!: LEnumerator[];\r\n    enumerators!: LEnumerator[];\r\n\r\n    // utilities to go down in the tree (plural names)\r\n    allSubPackages!: LPackage[];\r\n    allSubEnums!: LEnumerator[];\r\n    allSubClasses!: LClass[];\r\n    operations!: LOperation[];\r\n    parameters!: LParameter[];\r\n    exceptions!: LClassifier[];\r\n    attributes!: LAttribute[];\r\n    references!: LReference[];\r\n    literals!: LEnumLiteral[];\r\n\r\n    protected generateEcoreJson_impltemplate(context: Context, loopDetectionObj: Dictionary<Pointer, DModelElement> = {}): Json {\r\n        loopDetectionObj[context.data.id] = context.data;\r\n        const json: GObject = {};\r\n        return json; }\r\n\r\n    protected generateEcoreJson_impl(context: Context, loopDetectionObj: Dictionary<Pointer, DModelElement> = {}): Json {\r\n        loopDetectionObj[context.data.id] = context.data;\r\n        const model: GObject = {};\r\n        const d = context.data;\r\n        let classarr = context.proxyObject.classes.map( c => c.generateEcoreJson(loopDetectionObj));\r\n        let enumarr = context.proxyObject.enums.map(e => e.generateEcoreJson(loopDetectionObj));\r\n        const classifiers: Json[] = Array.prototype.concat.call(classarr, enumarr);\r\n        model[ECorePackage.xmiversion] = '2.0';\r\n        model[ECorePackage.xmlnsxmi] = 'http://www.omg.org/XMI';\r\n        model[ECorePackage.xmlnsxsi] = 'http://www.w3.org/2001/XMLSchema-instance';\r\n        model[ECorePackage.xmlnsecore] = 'http://www.eclipse.org/emf/2002/Ecore';\r\n        model[ECorePackage.namee] = d.name;\r\n        model[ECorePackage.nsURI] = d.uri;\r\n        model[ECorePackage.nsPrefix] = d.prefix;//getModelRoot().namespace();\r\n        model[ECorePackage.eClassifiers] = classifiers;\r\n        return model; }\r\n\r\n    public duplicate(deep: boolean = true): this { return this.cannotCall( this.constructor.name + \"duplicate()\"); }\r\n    protected get_duplicate(context: Context): ((deep?: boolean) => this) {\r\n        return (deep: boolean = false) => {\r\n            BEGIN()\r\n            let de: D = context.proxyObject.father.addPackage(context.data.name, context.data.uri, context.data.prefix) as D;\r\n            let le: this = LPointerTargetable.fromD(de);\r\n            let we: WPackage = le as any;\r\n            we.subpackages = deep ? context.proxyObject.subpackages.map( lchild => lchild.duplicate(deep).id) : context.data.subpackages;\r\n            we.classifiers = deep ? context.proxyObject.classifiers.map( lchild => lchild.duplicate(deep).id) : context.data.classifiers;\r\n            we.annotations = deep ? context.proxyObject.annotations.map( lchild => lchild.duplicate(deep).id) : context.data.annotations;\r\n            END()\r\n            return le;\r\n        }\r\n    }\r\n\r\n    public addPackage(name?: D[\"name\"], uri?: D[\"uri\"], prefix?: D[\"prefix\"]): DPackage { return this.cannotCall(\"addPackage\"); }\r\n    protected get_addPackage(context: Context): this[\"addPackage\"] {\r\n        return (name?: D[\"name\"], uri?: D[\"uri\"], prefix?: D[\"prefix\"]) => DPackage.new(name, uri, prefix, context.data.id, true, DPackage); }\r\n\r\n    public addClass(name?: DClass[\"name\"], isInterface?: DClass[\"interface\"], isAbstract?: DClass[\"abstract\"], isPrimitive?: DClass[\"isPrimitive\"],\r\n                    isPartial?: DClass[\"partial\"], partialDefaultName?: DClass[\"partialdefaultname\"]): DClass {\r\n        return this.cannotCall(\"addClass\"); }\r\n    protected get_addClass(context: Context): this[\"addClass\"] {\r\n        return (name?: DClass[\"name\"], isInterface?: DClass[\"interface\"], isAbstract?: DClass[\"abstract\"], isPrimitive?: DClass[\"isPrimitive\"],\r\n                isPartial?: DClass[\"partial\"], partialDefaultName?: DClass[\"partialdefaultname\"]\r\n        ) => DClass.new(name, isInterface, isAbstract, isPrimitive, isPartial, partialDefaultName, context.data.id, true); }\r\n\r\n    public addEnum(...p:Parameters<this[\"addEnumerator\"]>): DEnumerator { return this.addEnumerator(...p); }\r\n    protected get_addEnum(context: Context): this[\"addEnumerator\"] { return this.get_addEnumerator(context); }\r\n    public addEnumerator(name?: DEnumerator[\"name\"]): DEnumerator { return this.cannotCall(\"addEnumerator\"); }\r\n    protected get_addEnumerator(context: Context): this[\"addEnumerator\"] {\r\n        return (name?: DEnumerator[\"name\"]) => DEnumerator.new(name, context.data.id, true); }\r\n\r\n    protected get_classes(context: Context): LClass[] {\r\n        let classifiers = DPointerTargetable.fromPointer(context.data.classifiers as Pointer<DClassifier, 1, 1, LClassifier>[]);\r\n        let enumerators = classifiers.filter(dc => dc?.className === DClass.name ) as DClass[];\r\n        return LPointerTargetable.from(enumerators.map(e=> e.id)); }\r\n    protected get_enums(context: Context): LEnumerator[] { return this.get_enumerators(context); }\r\n    protected get_enumerators(context: Context): LEnumerator[] {\r\n        let classifiers = DPointerTargetable.fromPointer(context.data.classifiers as Pointer<DClassifier, 1, 1, LClassifier>[]);\r\n        let enumerators = classifiers.filter(dc => dc?.className === DEnumerator.name ) as DEnumerator[];\r\n        return LPointerTargetable.from(enumerators.map(e=> e.id)); }\r\n\r\n    private get_allSubClasses(context: Context): LClass[] {\r\n        const s: IStore = store.getState();\r\n        return this.get_allSubPackages(context, s).flatMap(p => p.classes || []); }\r\n    private get_allSubEnums(context: Context): LEnumerator[] { return this.get_allSubEnumerators(context); }\r\n    private get_allSubEnumerators(context: Context): LEnumerator[] {\r\n        const s: IStore = store.getState();\r\n        return this.get_allSubPackages(context, s).flatMap(p => (p.enums || []));\r\n    }\r\n\r\n    private get_allSubPackages(context: Context, state?: IStore): LPackage[] {\r\n        // return context.data.packages.map(p => LPointerTargetable.from(p));\r\n        state = state || store.getState();\r\n        let tocheck: Pointer<DPackage>[] = context.data.subpackages || [];\r\n        let checked: Dictionary<Pointer, true> = {};\r\n        checked[context.data.id] = true;\r\n        while (tocheck.length) {\r\n            let newtocheck: Pointer<DPackage>[] = [];\r\n            for (let ptr of tocheck) {\r\n                if (checked[ptr]) throw new Error(\"loop in packages containing themselves\");\r\n                checked[ptr] = true;\r\n                let dpackage: DPackage = DPointerTargetable.from(ptr, state);\r\n                U.arrayMergeInPlace(newtocheck, dpackage?.subpackages);\r\n            }\r\n            tocheck = newtocheck;\r\n        }\r\n        return LPointerTargetable.from(Object.keys(checked), state);\r\n    }\r\n\r\n    protected get_children_idlist(context: Context): Pointer<DAnnotation | DPackage | DClassifier, 1, 'N'> {\r\n        return [...super.get_children_idlist(context) as Pointer<DAnnotation | DPackage | DClassifier, 1, 'N'>, ...context.data.subpackages, ...context.data.classifiers]; }\r\n\r\n    protected get_classifiers(context: Context): this[\"classifiers\"] {\r\n        return context.data.classifiers.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n    protected set_classifiers(val: PackArr<this[\"classifiers\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        const oldList = context.data.classifiers;\r\n        const diff = U.arrayDifference(oldList, list);\r\n        //BEGIN();\r\n        SetFieldAction.new(context.data, 'classifiers', list, \"\", true);\r\n        for (let id of diff.added) {\r\n            SetFieldAction.new(id, 'father', context.data.id, '', true);\r\n            SetFieldAction.new(id, 'parent', context.data.id, '+=', true);\r\n        }\r\n        for (let id of diff.removed as Pointer<DModelElement>[]) {\r\n            SetFieldAction.new(id, 'father', undefined, '', true);\r\n            const parent = DPointerTargetable.from(id).parent;\r\n            U.arrayRemoveAll(parent, context.data.id);\r\n            SetFieldAction.new(id, 'parent', parent, '', true);\r\n        }\r\n        //END();\r\n        return true;\r\n    }\r\n\r\n    protected get_subpackages(context: Context): this[\"subpackages\"] {\r\n        return context.data.subpackages.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n    protected set_subpackages(val: PackArr<this[\"subpackages\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        const oldList = context.data.subpackages;\r\n        const diff = U.arrayDifference(oldList, list);\r\n        //BEGIN();\r\n        SetFieldAction.new(context.data, 'subpackages', list, \"\", true);\r\n        for (let id of diff.added) {\r\n            SetFieldAction.new(id, 'father', context.data.id, '', true);\r\n            SetFieldAction.new(id, 'parent', context.data.id, '+=', true);\r\n        }\r\n        for (let id of diff.removed as Pointer<DModelElement>[]) {\r\n            SetFieldAction.new(id, 'father', undefined, '', true);\r\n            const parent = DPointerTargetable.from(id).parent;\r\n            U.arrayRemoveAll(parent, context.data.id);\r\n            SetFieldAction.new(id, 'parent', parent, '', true);\r\n        }\r\n        //END();\r\n        return true;\r\n    }\r\n\r\n    protected get_uri(context: Context): this[\"uri\"] {\r\n        if (context.data.uri) return context.data.uri + \".\" + context.data.name;\r\n        return ('org.jodel-react.') + (context.proxyObject.model?.name || \"username\") + \".\" + context.data.name;\r\n    }\r\n    protected set_uri(val: this[\"uri\"], context: Context): boolean {\r\n        val = val || '';\r\n        let pos = val.lastIndexOf(context.data.name);\r\n        if (pos) val = val.substring(0, pos - 1); // removes final name and dot, to keep the name part dinamically added in the getter.\r\n        SetFieldAction.new(context.data, 'uri', val, \"\", false);\r\n        return true;\r\n    }\r\n    protected get_prefix(context: Context): this[\"uri\"] { return context.data.prefix; }\r\n    protected set_prefix(val: this[\"prefix\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'prefix', val, \"\", false);\r\n        return true;\r\n    }\r\n\r\n    protected get_delete(context: Context): () => void {\r\n        const l = context.proxyObject;\r\n        const ret = () => {\r\n            let canBeDeleted = true;\r\n            for(let me of l.classes) {\r\n                if(!canBeDeleted) break;\r\n                canBeDeleted = me.instances.length === 0;\r\n            }\r\n            if(canBeDeleted) {\r\n                // super.delete(context);\r\n                l.superDelete();\r\n            }\r\n            else { U.alert('error', 'Cannot delete the selected package since there are instances.'); }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n}\r\n// @RuntimeAccessible export class _WPackage extends _WNamedElement { }\r\n// export type WPackage = DPackage | LPackage | _WPackage;\r\nDNamedElement.subclasses.push(DPackage);\r\nLNamedElement.subclasses.push(LPackage);\r\n\r\n\r\n@Leaf\r\n@RuntimeAccessible\r\nexport class DOperation extends DPointerTargetable { // extends DTypedElement\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LOperation;\r\n    // static logic: typeof LOperation;\r\n    // static structure: typeof DOperation;\r\n\r\n    // inherit redefine\r\n    instances!: never[];\r\n    id!: Pointer<DOperation, 1, 1, LObject>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    parent: Pointer<DClass, 0, 'N', LClass> = [];\r\n    father!: Pointer<DClass, 1, 1, LClass>;\r\n    name!: string;\r\n    type!: Pointer<DClassifier, 1, 1, LClassifier>;\r\n    ordered: boolean = true;\r\n    unique: boolean = true;\r\n    lowerBound: number = 0;\r\n    upperBound: number = 1;\r\n    many!: boolean;\r\n    required!: boolean;\r\n    // personal\r\n    exceptions: Pointer<DClassifier, 0, 'N', LClassifier> = [];\r\n    parameters: Pointer<DParameter, 0, 'N', LParameter> = [];\r\n    visibility: AccessModifier = AccessModifier.private;\r\n    implementation!: string;\r\n\r\n    public static new(name?: DNamedElement[\"name\"], type?: DOperation[\"type\"], exceptions: DOperation[\"exceptions\"] = [], father?: DOperation[\"father\"], persist: boolean = true): DOperation {\r\n        if (!name) name = this.defaultname(\"fx_\", father);\r\n        if (!type) type = father;\r\n        return new Constructors(new DOperation('dwc'), father, persist, undefined).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DTypedElement(type).DOperation(exceptions).end();\r\n    }\r\n\r\n    static new2(setter: Partial<ObjectWithoutPointers<DOperation>>, father: DOperation[\"father\"], type?: DOperation[\"type\"], name?: string): DOperation {\r\n        if (!name) name = this.defaultname((name || \"fx_\"), father);\r\n        if (!type) type = father;\r\n        return new Constructors(new DOperation('dwc'), father, true).DPointerTargetable().DModelElement().DTypedElement(type)\r\n            .DNamedElement(name).DTypedElement(type).DOperation().end((d)=> { Object.assign(d, setter); });\r\n    }\r\n\r\n}\r\n\r\n@Node\r\n@RuntimeAccessible\r\nexport class LOperation<Context extends LogicContext<DOperation> = any, C extends Context = Context, D extends DOperation = DOperation>  extends LTypedElement { // extends DTypedElement\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DOperation;\r\n    id!: Pointer<DOperation, 1, 1, LOperation>;\r\n    // static singleton: LOperation;\r\n    // static logic: typeof LOperation;\r\n    // static structure: typeof DOperation;\r\n\r\n    // inherit redefine\r\n    instances!: never[];\r\n    annotations!: LAnnotation[];\r\n    parent!: LClass[];\r\n    father!: LClass;\r\n    name!: string;\r\n    namespace!: string;\r\n    type!: LClassifier;\r\n    ordered: boolean = true;\r\n    unique: boolean = true;\r\n    lowerBound: number = 0;\r\n    upperBound: number = 1;\r\n    many!: boolean;\r\n    required!: boolean;\r\n    // personal\r\n    implementation!: string;\r\n    signatureImplementation!: string; // (param1 /*type*/, param2 = value, ...) => /*return type*/\r\n    exceptions!: LClassifier[];\r\n    parameters!: LParameter[];\r\n    visibility!: AccessModifier;\r\n\r\n\r\n    protected generateEcoreJson_impl(context: Context, loopDetectionObj: Dictionary<Pointer, DModelElement> = {}): Json {\r\n        loopDetectionObj[context.data.id] = context.data;\r\n        const json: Json = {};\r\n        json[ECoreOperation.eParameters] = context.proxyObject.parameters.map( par => par.generateEcoreJson(loopDetectionObj));\r\n        EcoreParser.write(json, ECoreOperation.namee, context.data.name);\r\n        EcoreParser.write(json, ECoreOperation.eType, context.proxyObject.type.typeEcoreString);\r\n        EcoreParser.write(json, ECoreOperation.lowerBound, '' + context.data.lowerBound);\r\n        EcoreParser.write(json, ECoreOperation.upperBound, '' + context.data.upperBound);\r\n        EcoreParser.write(json, ECoreOperation.eexceptions, context.proxyObject.exceptions.map( (l: LClassifier) => l.typeEcoreString).join(' ')); // todo: not really sure it's this format\r\n        EcoreParser.write(json, ECoreOperation.ordered, '' + context.data.ordered);\r\n        EcoreParser.write(json, ECoreOperation.unique, '' + context.data.unique);\r\n        return json; }\r\n\r\n    public duplicate(deep: boolean = true): this { return this.cannotCall( this.constructor.name + \"duplicate()\"); }\r\n    protected get_duplicate(context: Context): ((deep?: boolean) => this) {\r\n        return (deep: boolean = false) => {\r\n            BEGIN()\r\n            let de: D = context.proxyObject.father.addOperation(context.data.name, context.data.type) as D;\r\n            de.many = context.data.many;\r\n            de.lowerBound = context.data.lowerBound;\r\n            de.upperBound = context.data.upperBound;\r\n            de.ordered = context.data.ordered;\r\n            de.required = context.data.required;\r\n            de.unique = context.data.unique;\r\n            de.visibility = context.data.visibility;\r\n            de.exceptions = context.data.exceptions;\r\n            let le: this = LPointerTargetable.fromD(de);\r\n            let we: WOperation = le as any;\r\n            we.annotations = deep ? context.proxyObject.annotations.map(lchild => lchild.duplicate(deep).id) : context.data.annotations;\r\n            we.parameters = deep ? context.proxyObject.parameters.map(lchild => lchild.duplicate(deep).id) : context.data.parameters;\r\n            we.exceptions = context.data.exceptions;\r\n            END()\r\n            return le; }\r\n    }\r\n\r\n    public addParameter(name?: DParameter[\"name\"], type?: DParameter[\"type\"]): DParameter { return this.cannotCall(\"addParameter\"); }\r\n    protected get_addParameter(context: Context): this[\"addParameter\"] {\r\n        return (name?: DParameter[\"name\"], type?: DParameter[\"type\"]) => DParameter.new(name, type, context.data.id, true); }\r\n\r\n    public execute(thiss: LObject, ...params: any): any { return this.cannotCall(\"execute\"); }\r\n    protected get_execute(context: Context): ((thiss: LObject, ...params: any[])=>any) {\r\n        return (thiss: LObject, ...params: any) => {\r\n            let func: Function = eval(this.get_signatureImplementation(context, true) + \" {\\n\"+ context.data.implementation + \"\\n}\");\r\n            func.apply(thiss, params);\r\n        };\r\n    }\r\n    public set_implementation(val: this[\"implementation\"], context: Context): boolean { return SetFieldAction.new(context.data.id, \"implementation\", val, undefined, false); }\r\n    public get_implementation(context: Context): this[\"implementation\"] { return context.data.implementation; }\r\n    public set_signatureImplementation(val: this[\"signatureImplementation\"], context: Context): boolean { return this.cannotSet(\"signatureImplementation\"); }\r\n    public get_signatureImplementation(context: Context, typedComments: boolean = true): this[\"signatureImplementation\"] {\r\n        let operation = context.proxyObject;\r\n        let typedcommentpre = typedComments ? \"/* :\" : ': ' ;\r\n        let typedcommentpost = typedComments ? \" */\" : '';\r\n        return \"(\" +\r\n            operation.parameters.map(\r\n                (p) => p.name + (p.defaultValue !== undefined ? \"=\" + p.defaultValue : typedcommentpre + p.typeToShortString() + typedcommentpost)\r\n            ).join(\", \")\r\n            + \") => \" +typedcommentpre.replace(\":\", \"\") + operation.type + typedcommentpost;\r\n    }\r\n    public get_signature(context: Context): this[\"signatureImplementation\"] { return this.get_signatureImplementation(context, false); }\r\n\r\n    protected get_children_idlist(context: Context): Pointer<DAnnotation | DClassifier | DParameter, 1, 'N'> {\r\n        return [...super.get_children_idlist(context) as Pointer<DAnnotation | DParameter | DClassifier, 1, 'N'>, ...context.data.exceptions, ...context.data.parameters]; }\r\n\r\n    protected get_exceptions(context: Context): this[\"exceptions\"] {\r\n        return context.data.exceptions.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n    protected set_exceptions(val: PackArr<this[\"exceptions\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        SetFieldAction.new(context.data, 'exceptions', list, \"\", true);\r\n        return true;\r\n    }\r\n\r\n    protected get_parameters(context: Context): this[\"parameters\"] {\r\n        return context.data.parameters.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n    protected set_parameters(val: PackArr<this[\"parameters\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        const oldList = context.data.parameters;\r\n        const diff = U.arrayDifference(oldList, list);\r\n        //BEGIN();\r\n        SetFieldAction.new(context.data, 'parameters', list, \"\", true);\r\n        for (let id of diff.added) {\r\n            SetFieldAction.new(id, 'father', context.data.id, '', true);\r\n            SetFieldAction.new(id, 'parent', context.data.id, '+=', true);\r\n        }\r\n        for (let id of diff.removed as Pointer<DModelElement>[]) {\r\n            SetFieldAction.new(id, 'father', undefined, '', true);\r\n            const parent = DPointerTargetable.from(id).parent;\r\n            U.arrayRemoveAll(parent, context.data.id);\r\n            SetFieldAction.new(id, 'parent', parent, '', true);\r\n        }\r\n        //END();\r\n        return true;\r\n    }\r\n\r\n    // protected get_type(context: Context): this[\"type\"] { return context.proxyObject.parameters[0].type; }\r\n    // protected set_type(val: Pack1<this[\"type\"]>, context: Context): this[\"type\"] { return super.set_type(val, context); }\r\n\r\n    _mark(b: boolean, superchildren: LOperation, override: string) {\r\n\r\n    }\r\n\r\n    _canOverride(superchildren: LOperation) {\r\n        return undefined;\r\n    }\r\n\r\n    _canPolymorph(superchildren: LOperation) {\r\n        return undefined;\r\n    }\r\n}\r\nDTypedElement.subclasses.push(DOperation);\r\nLTypedElement.subclasses.push(LOperation);\r\n\r\n\r\n\r\n\r\n@Leaf\r\n@RuntimeAccessible\r\nexport class DParameter extends DPointerTargetable { // extends DTypedElement\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LParameter;\r\n    // static logic: typeof LParameter;\r\n    // static structure: typeof DParameter;\r\n\r\n    // inherit redefine\r\n    instances!: never[];\r\n    id!: Pointer<DParameter, 1, 1, LParameter>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    parent: Pointer<DOperation, 0, 'N', LOperation> = [];\r\n    father!: Pointer<DOperation, 1, 1, LOperation>;\r\n    name!: string;\r\n    type!: Pointer<DClassifier, 1, 1, LClassifier>;\r\n    ordered: boolean = true;\r\n    unique: boolean = true;\r\n    lowerBound: number = 0;\r\n    upperBound: number = 1;\r\n    many!: boolean;\r\n    required!: boolean;\r\n    defaultValue!: any;\r\n    // personal\r\n\r\n    public static new(name?: DNamedElement[\"name\"], type?: DTypedElement[\"type\"], father?: Pointer, persist: boolean = true): DParameter {\r\n        if (!type) type = LPointerTargetable.from(Selectors.getFirstPrimitiveTypes()).id; // default type as string\r\n        if (!name) name = this.defaultname(\"arg\", father);\r\n        return new Constructors(new DParameter('dwc'), father, persist, undefined).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DTypedElement(type).DParameter().end();\r\n    }\r\n\r\n    static new2(setter: Partial<ObjectWithoutPointers<DParameter>>, father: DParameter[\"father\"], type?: DParameter[\"type\"], name?: DParameter[\"name\"]): DParameter {\r\n        if (!name) name = this.defaultname((name || \"arg\"), father);\r\n        return new Constructors(new DParameter('dwc'), father, true).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DTypedElement(type).end((d) => { Object.assign(d, setter); });\r\n    }\r\n}\r\n\r\n@Leaf\r\n@RuntimeAccessible\r\nexport class LParameter<Context extends LogicContext<DParameter> = any, C extends Context = Context, D extends DParameter = DParameter>  extends LTypedElement { // extends DTypedElement\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DParameter;\r\n    id!: Pointer<DParameter, 1, 1, LParameter>;\r\n    // static singleton: LParameter;\r\n    // static logic: typeof LParameter;\r\n    // static structure: typeof DParameter;\r\n\r\n    // inherit redefine\r\n    instances!: never[];\r\n    annotations!: LAnnotation[];\r\n    parent!: LOperation[];\r\n    father!: LOperation;\r\n    name!: string;\r\n    namespace!: string;\r\n    type!: LClassifier;\r\n    ordered: boolean = true;\r\n    unique: boolean = true;\r\n    lowerBound: number = 0;\r\n    upperBound: number = 1;\r\n    many!: boolean;\r\n    required!: boolean;\r\n    // personal\r\n    defaultValue!: any;\r\n\r\n    protected generateEcoreJson_impl(context: Context, loopDetectionObj: Dictionary<Pointer, DModelElement> = {}): Json {\r\n        loopDetectionObj[context.data.id] = context.data;\r\n        const json: Json = {};\r\n        const l = context.proxyObject;\r\n        const d = context.data;\r\n        EcoreParser.write(json, ECoreOperation.lowerBound, '' + d.lowerBound);\r\n        EcoreParser.write(json, ECoreOperation.upperBound, '' + d.upperBound);\r\n        EcoreParser.write(json, ECoreOperation.ordered, '' + d.ordered);\r\n        EcoreParser.write(json, ECoreOperation.unique, '' + d.unique);\r\n        EcoreParser.write(json, ECoreOperation.eType, '' + l.type.typeEcoreString);\r\n        return json; }\r\n\r\n    public duplicate(deep: boolean = true): this { return this.cannotCall( this.constructor.name + \"duplicate()\"); }\r\n    protected get_duplicate(context: Context): ((deep?: boolean) => this) {\r\n        return (deep: boolean = false) => {\r\n            BEGIN()\r\n            let de: D = context.proxyObject.father.addParameter(context.data.name, context.data.type) as D;\r\n            de.many = context.data.many;\r\n            de.lowerBound = context.data.lowerBound;\r\n            de.upperBound = context.data.upperBound;\r\n            de.ordered = context.data.ordered;\r\n            de.required = context.data.required;\r\n            de.unique = context.data.unique;\r\n            let le: this = LPointerTargetable.fromD(de);\r\n            let we: WParameter = le as any;\r\n            we.annotations = deep ? context.proxyObject.annotations.map(lchild => lchild.duplicate(deep).id) : context.data.annotations;\r\n            END()\r\n            return le; }\r\n    }\r\n\r\n    /*\r\n        protected get_delete(context: LogicContext<DParameter>): () => void {\r\n            let ret = () => {};\r\n            const dParameter: DParameter = context.data;\r\n            const dOperation: DOperation = Selectors.getDElement<DOperation>(dParameter.father);\r\n            if (dOperation.parameters.indexOf(dParameter.id) !== 0) {\r\n                const dClassifier: DClassifier | undefined = Selectors.getDElement<DClass>(dParameter.type as string); //first parameter is return type so his type is undefined\r\n                ret = () => {\r\n                    SetFieldAction.new(dOperation,\"parameters\", U.removeFromList(dOperation.parameters, dParameter.id), '', true);\r\n                    if (dClassifier) {\r\n                        // SetFieldAction.new(dClassifier, \"pointedBy\", U.removeFromList(dClassifier.pointedBy, dParameter.id));\r\n                    }\r\n                    // SetRootFieldAction.new(\"parameters\", U.removeFromList(Selectors.getAllParameters(), dParameter.id), '', true);\r\n                    new DeleteElementAction(dParameter);\r\n                }\r\n            } else {\r\n                // when deleting return type (null = void)\r\n                ret = () => {\r\n                    SetFieldAction.new(dParameter, \"type\", null as any); // while reworking .delete(): null = void, questo setta void e deve essere tenuto come azione diversa dal default delete\r\n                };\r\n            }\r\n            ret();\r\n            return ret;\r\n        }\r\n        */\r\n}\r\nDTypedElement.subclasses.push(DParameter);\r\nLTypedElement.subclasses.push(LParameter);\r\n\r\n\r\n@RuntimeAccessible\r\nexport class DClass extends DPointerTargetable { // extends DClassifier\r\n    // static _super = DClassifier;\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LClass;\r\n    // static logic: typeof LClass;\r\n    // static structure: typeof DClass;\r\n\r\n    // inherit redefine\r\n    // instanceClass: EJavaClass // ?\r\n    // isInstance(object: EJavaObject): boolean; ?\r\n    // getClassifierID(): number;\r\n    id!: Pointer<DClass, 1, 1, LClass>;\r\n    instanceClassName!: string;\r\n    parent: Pointer<DPackage, 0, 'N', LPackage> = [];\r\n    father!: Pointer<DPackage, 1, 1, LPackage>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    name!: string;\r\n    defaultValue!: Pointer<DObject, 1, 1, LObject>[];\r\n    // personal\r\n    // isSuperTypeOf(someClass: DClassifier): boolean { return todoret; }\r\n    // getEstructuralFeatureByID(featureID: number): DStructuralFeature { return todoret; }\r\n    // getEstructuralFeature(featureName: string): DStructuralFeature { return todoret; }\r\n    abstract: boolean = false;\r\n    interface: boolean = false;\r\n    instances: Pointer<DObject, 0, 'N', LObject> = [];\r\n    operations: Pointer<DOperation, 0, 'N', LOperation> = [];\r\n    features: Pointer<DStructuralFeature, 0, 'N', LStructuralFeature> = [];\r\n    references: Pointer<DReference, 0, 'N', LReference> = [];\r\n    attributes: Pointer<DAttribute, 0, 'N', LAttribute> = [];\r\n    referencedBy: Pointer<DReference, 0, 'N', LReference> = [];\r\n    extends: Pointer<DClass, 0, 'N', LClass> = [];\r\n    extendedBy: Pointer<DClass, 0, 'N', LClass> = [];\r\n\r\n    // mia aggiunta:\r\n    isPrimitive!: boolean;\r\n    implements: Pointer<DClass, 0, 'N', LClass> = [];\r\n    implementedBy: Pointer<DClass, 0, 'N', LClass> = [];\r\n    partial!: boolean;\r\n    partialdefaultname!: string;\r\n\r\n    // for m1:\r\n    // hideExcessFeatures: boolean = true; // isn't it like partial?? // old comment: se attivo questo e creo una DClass di sistema senza nessuna feature e di nome Object, ho creato lo schema di un oggetto schema-less a cui tutti sono conformi\r\n\r\n    public static new(name?: DNamedElement[\"name\"], isInterface: DClass[\"interface\"] = false, isAbstract: DClass[\"abstract\"] = false, isPrimitive: DClass[\"isPrimitive\"] = false, partial?: DClass[\"partial\"],\r\n                      partialDefaultName?: DClass[\"partialdefaultname\"], father?: Pointer, persist: boolean = true): DClass {\r\n        if (!name) name = this.defaultname(\"concept \", father);\r\n        return new Constructors(new DClass('dwc'), father, persist, undefined).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DClassifier().DClass(isInterface, isAbstract, isPrimitive, partial, partialDefaultName).end();\r\n    }\r\n\r\n    static new2(setter: Partial<ObjectWithoutPointers<DClass>>, father: DClass[\"father\"], name?: DClass[\"name\"]): DClass {\r\n        if (!name) name = this.defaultname((name || \"concept \"), father);\r\n        return new Constructors(new DClass('dwc'), father, true, undefined).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DClassifier().DClass().end((d) => { Object.assign(d, setter); });\r\n    }\r\n\r\n}\r\n\r\n@Instantiable // (LObject)\r\n@Node\r\n@RuntimeAccessible\r\nexport class LClass<D extends DClass = DClass, Context extends LogicContext<DClass> = any, C extends Context = Context>  extends LClassifier{ // extends DClassifier\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DClass;\r\n    id!: Pointer<DClass, 1, 1, LClass>;\r\n    // static singleton: LClass;\r\n    // static logic: typeof LClass;\r\n    // static structure: typeof DClass;\r\n\r\n    // inherit redefine\r\n    // instanceClass: EJavaClass // ?\r\n    // isInstance(object: EJavaObject): boolean; ?\r\n    // getClassifierID(): number;\r\n    instanceClassName!: string;\r\n    parent!: LPackage[];\r\n    father!: LPackage;\r\n    annotations!: LAnnotation[];\r\n    name!: string;\r\n    namespace!: string;\r\n    defaultValue!: LObject[];\r\n    // personal\r\n    // isSuperTypeOf(someClass: DClassifier): boolean { return todoret; }\r\n    // getEstructuralFeatureByID(featureID: number): DStructuralFeature { return todoret; }\r\n    // getEstructuralFeature(featureName: string): DStructuralFeature { return todoret; }\r\n    abstract!: boolean;\r\n    interface!: boolean;\r\n    instances!: LObject[];\r\n    operations!: LOperation[];\r\n    features!: LStructuralFeature[];\r\n    references!: LReference[];\r\n    attributes!: LAttribute[];\r\n    referencedBy!: LReference[];\r\n    extends!: LClass[];\r\n    extendsChain!: LClass[];  // list of all super classes (father, father of father, ...)\r\n    extendedBy!: LClass[];\r\n    nodes!: LGraphElement[]; // ipotesi, non so se tenerlo\r\n\r\n    // mia aggiunta:\r\n    partial!: boolean;\r\n    partialdefaultname!: string;\r\n    isPrimitive!: boolean;\r\n    isClass!: boolean; // false if it's primitive type\r\n    isEnum!: false;\r\n    implements: Pointer<DClass, 0, 'N', LClass> = [];  //todo: interface\r\n    implementedBy: Pointer<DClass, 0, 'N', LClass> = [];\r\n\r\n    ownAttributes!: LAttribute[];\r\n    ownReferences!: LReference[];\r\n    ownOperations!: LOperation[];\r\n    ownChildren!: (LStructuralFeature|LOperation)[];\r\n\r\n    inheritedAttributes!: LAttribute[];\r\n    inheritedReferences!: LReference[];\r\n    inheritedOperations!: LOperation[];\r\n    inheritedChildren!: (LStructuralFeature|LOperation)[];\r\n\r\n    allAttributes!: LAttribute[];\r\n    allReferences!: LReference[];\r\n    allOperations!: LOperation[];\r\n    allChildren!: (LStructuralFeature|LOperation)[];\r\n\r\n\r\n\r\n    // utilities to go down in the tree (plural names)\r\n    exceptions!: LClassifier[] | null;\r\n    parameters!: LParameter[] | null;\r\n    // [`@${string}`]: LModelElement; todo: try to put it\r\n\r\n    protected get_ownAttributes(context: Context): this['ownAttributes'] {\r\n        return LAttribute.fromPointer(context.data.attributes);\r\n    }\r\n    protected get_ownReferences(context: Context): this['ownReferences'] {\r\n        return LReference.fromPointer(context.data.references);\r\n    }\r\n    protected get_ownOperations(context: Context): this['ownOperations'] {\r\n        return LOperation.fromPointer(context.data.operations);\r\n    }\r\n    protected get_ownChildren(context: Context): this['ownChildren'] {\r\n        return U.arrayMergeInPlace<any>(this.get_ownAttributes(context), this.get_ownReferences(context),\r\n            this.get_ownOperations(context));\r\n    }\r\n\r\n    private get_extendsChain(context: Context): this['extendsChain'] {\r\n        let targets: LClass[] = LClass.fromArr(context.data.extends);\r\n        let alreadyParsed: Dictionary<Pointer, LClass> = {};\r\n        while(targets.length) {\r\n            let nextTargets = [];\r\n            for(let target of targets){\r\n                if(alreadyParsed[target.id]) continue;\r\n                alreadyParsed[target.id] = target;\r\n                for(let father of target.extends) nextTargets.push(father);\r\n            }\r\n            targets = nextTargets;\r\n        }\r\n        return [...new Set<LClass>(Object.values(alreadyParsed))];\r\n    }\r\n\r\n    protected get_inheritedAttributes(context: Context): this['inheritedAttributes'] {\r\n        return this.get_extendsChain(context).flatMap((superClass) => superClass.ownAttributes);\r\n    }\r\n    protected get_inheritedReferences(context: Context): this['inheritedReferences'] {\r\n        return this.get_extendsChain(context).flatMap((superClass) => superClass.ownReferences);\r\n    }\r\n    protected get_inheritedOperations(context: Context): this['inheritedOperations'] {\r\n        return this.get_extendsChain(context).flatMap((superClass) => superClass.ownOperations);\r\n    }\r\n    protected get_inheritedChildren(context: Context): this['inheritedChildren'] {\r\n        return U.arrayMergeInPlace<any>(this.get_inheritedAttributes(context), this.get_inheritedReferences(context),\r\n            this.get_inheritedOperations(context));\r\n    }\r\n\r\n    protected get_allAttributes(context: Context): this['allAttributes'] {\r\n        return U.arrayMergeInPlace<any>(this.get_ownAttributes(context), this.get_inheritedAttributes(context));\r\n    }\r\n    protected get_allReferences(context: Context): this['allReferences'] {\r\n        return U.arrayMergeInPlace<any>(this.get_ownReferences(context), this.get_inheritedReferences(context));\r\n    }\r\n    protected get_allOperations(context: Context): this['allOperations'] {\r\n        return U.arrayMergeInPlace<any>(this.get_ownOperations(context), this.get_inheritedOperations(context));\r\n    }\r\n    protected get_allChildren(context: Context): this['allChildren'] {\r\n        return U.arrayMergeInPlace<any>(this.get_ownChildren(context), this.get_inheritedChildren(context));\r\n    }\r\n\r\n    protected generateEcoreJson_impl(context: Context, loopDetectionObj: Dictionary<Pointer, DModelElement> = {}): Json {\r\n        loopDetectionObj[context.data.id] = context.data;\r\n        const json: GObject = {};\r\n        const featurearr: Json[] = [];\r\n        const operationsarr: Json[] = [];\r\n        let supertypesstr = [];\r\n        const d = context.data;\r\n        const l = context.proxyObject;\r\n        for (let att of l.attributes) { featurearr.push(att.generateEcoreJson(loopDetectionObj)); }\r\n        for (let ref of l.references) { featurearr.push(ref.generateEcoreJson(loopDetectionObj)); }\r\n        for (let op of l.operations) { operationsarr.push(op.generateEcoreJson(loopDetectionObj)); }\r\n\r\n        json[ECoreClass.xsitype] = 'ecore:EClass';\r\n        json[ECoreClass.namee] = d.name;\r\n        json[ECoreClass.interface] = U.toBoolString(d.interface, false);\r\n        json[ECoreClass.abstract] = U.toBoolString(d.abstract, false);\r\n        if (d.instanceClassName) json[ECoreClass.instanceTypeName] = d.instanceClassName;\r\n        json[ECoreClass.eSuperTypes] = l.extends.map( superclass => superclass.typeEcoreString).join(\" \");\r\n        if (featurearr) json[ECoreClass.eStructuralFeatures] = featurearr;\r\n        if (operationsarr) json[ECoreClass.eOperations] = operationsarr;\r\n        return json; }\r\n\r\n\r\n    public duplicate(deep: boolean = true): this { return this.cannotCall( this.constructor.name + \"duplicate()\"); }\r\n    protected get_duplicate(context: Context): ((deep?: boolean) => this) {\r\n        return (deep: boolean = false) => {\r\n            BEGIN()\r\n            let de: D = context.proxyObject.father.addClass(context.data.name, context.data.interface, context.data.abstract, context.data.isPrimitive) as D;\r\n            // de.hideExcessFeatures = context.data.hideExcessFeatures;\r\n            let le: this = LPointerTargetable.fromD(de);\r\n            let we: WClass = le as any;\r\n            we.defaultValue = context.data.defaultValue;\r\n            we.extends = context.data.extends;\r\n            we.attributes = deep ? context.proxyObject.attributes.map(lchild => lchild.duplicate(deep).id) : context.data.attributes;\r\n            we.references = deep ? context.proxyObject.references.map(lchild => lchild.duplicate(deep).id) : context.data.references;\r\n            we.operations = deep ? context.proxyObject.operations.map(lchild => lchild.duplicate(deep).id) : context.data.operations;\r\n            END()\r\n            return le; }\r\n    }\r\n\r\n    protected get_children_idlist(context: Context): Pointer<DAnnotation | DStructuralFeature | DOperation, 1, 'N'> {\r\n        return [...super.get_children_idlist(context) as Pointer<DAnnotation | DStructuralFeature, 1, 'N'>, ...context.data.attributes, ...context.data.references, ...context.data.operations];\r\n    }\r\n\r\n\r\n\r\n    protected set_partial(val: D[\"partial\"], context: Context): boolean { return SetFieldAction.new(context.data.id, \"partial\", val); }\r\n    protected get_partial(context: Context): D[\"partial\"] { return context.data.partial; }\r\n    protected set_partialdefaultname(val: D[\"partialdefaultname\"], context: Context): boolean { return SetFieldAction.new(context.data.id, \"partialdefaultname\", val, undefined, false); }\r\n    protected get_partialdefaultname(context: Context): D[\"partialdefaultname\"] { return context.data.partialdefaultname; }\r\n\r\n    public addAttribute(name?: DAttribute[\"name\"], type?: DAttribute[\"type\"]): DAttribute { return this.cannotCall(\"addAttribute\"); }\r\n    protected get_addAttribute(context: Context): this[\"addAttribute\"] {\r\n        return (name?: DAttribute[\"name\"], type?: DAttribute[\"type\"]) => DAttribute.new(name, type, context.data.id, true);\r\n\r\n    }\r\n\r\n    public addReference(name?: DReference[\"name\"], type?: DReference[\"type\"]): DReference { return this.cannotCall(\"addReference\"); }\r\n    protected get_addReference(context: Context): this[\"addReference\"] {\r\n        return (name?: DReference[\"name\"], type?: DReference[\"type\"]) => DReference.new(name, type, context.data.id, true);\r\n    }\r\n\r\n    public addOperation(name?: DOperation[\"name\"], type?: DOperation[\"type\"]): DOperation { return this.cannotCall(\"addOperation\"); }\r\n    protected get_addOperation(context: Context): this[\"addOperation\"] {\r\n        return (name?: DOperation[\"name\"], type?: DOperation[\"type\"]) => DOperation.new(name, type, [], context.data.id, true); }\r\n\r\n\r\n    protected get_abstract(context: Context): this[\"abstract\"] { return context.data.abstract; }\r\n    protected set_abstract(val: this[\"abstract\"], context: Context): boolean {\r\n        const data = context.data;\r\n        if(val && data.instances.length > 0) {\r\n            U.alert('error', 'Cannot change the abstraction level since there are instances.');\r\n        } else {\r\n            SetFieldAction.new(data, 'abstract', val);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    protected set_isPrimitive(val: this[\"isPrimitive\"], context: Context): boolean { SetFieldAction.new(context. data, 'isPrimitive', val); return true; }\r\n    // get is in classifier with all other \"type\"s getter and setter\r\n\r\n    protected get_interface(context: Context): this[\"interface\"] { return context.data.interface; }\r\n    protected set_interface(val: this[\"interface\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'interface', val);\r\n        return true;\r\n    }\r\n\r\n    protected get_instances(context: Context): this[\"instances\"] {\r\n        return context.data.instances.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n    protected set_instances(val: PackArr<this[\"instances\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        SetFieldAction.new(context.data, 'instances', list, \"\", true);\r\n        return true;\r\n    }\r\n\r\n    protected get_operations(context: Context): this[\"operations\"] {\r\n        return context.data.operations.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n    protected set_operations(val: PackArr<this[\"operations\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        const oldList = context.data.operations;\r\n        const diff = U.arrayDifference(oldList, list);\r\n        //BEGIN();\r\n        SetFieldAction.new(context.data, 'operations', list, \"\", true);\r\n        for (let id of diff.added) {\r\n            SetFieldAction.new(id, 'father', context.data.id, '', true);\r\n            SetFieldAction.new(id, 'parent', context.data.id, '+=', true);\r\n        }\r\n        for (let id of diff.removed as Pointer<DModelElement>[]) {\r\n            SetFieldAction.new(id, 'father', undefined, '', true);\r\n            const parent = DPointerTargetable.from(id).parent;\r\n            U.arrayRemoveAll(parent, context.data.id);\r\n            SetFieldAction.new(id, 'parent', parent, '', true);\r\n        }\r\n        //END();\r\n        return true;\r\n    }\r\n\r\n    protected get_features(context: Context): this[\"features\"] {\r\n        return context.data.features.map((pointer) => { return LPointerTargetable.from(pointer) });\r\n    }\r\n    protected set_features(val: PackArr<this[\"features\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        const oldList = context.data.features;\r\n        const diff = U.arrayDifference(oldList, list);\r\n        //BEGIN();\r\n        SetFieldAction.new(context.data, 'features', list, \"\", true);\r\n        for (let id of diff.added) {\r\n            SetFieldAction.new(id, 'father', context.data.id, '', true);\r\n            SetFieldAction.new(id, 'parent', context.data.id, '+=', true);\r\n        }\r\n        for (let id of diff.removed as Pointer<DModelElement>[]) {\r\n            SetFieldAction.new(id, 'father', undefined, '', true);\r\n            const parent = DPointerTargetable.from(id).parent;\r\n            U.arrayRemoveAll(parent, context.data.id);\r\n            SetFieldAction.new(id, 'parent', parent, '', true);\r\n        }\r\n        //END();\r\n        return true;\r\n    }\r\n\r\n    protected get_references(context: Context): this[\"references\"] {\r\n        return context.data.references.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n    protected set_references(val: PackArr<this[\"references\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        const oldList = context.data.references;\r\n        const diff = U.arrayDifference(oldList, list);\r\n        //BEGIN();\r\n        SetFieldAction.new(context.data, 'references', list, \"\", true);\r\n        for (let id of diff.added) {\r\n            SetFieldAction.new(id, 'father', context.data.id, '', true);\r\n            SetFieldAction.new(id, 'parent', context.data.id, '+=', true);\r\n        }\r\n        for (let id of diff.removed as Pointer<DModelElement>[]) {\r\n            SetFieldAction.new(id, 'father', undefined, '', true);\r\n            const parent = DPointerTargetable.from(id).parent;\r\n            U.arrayRemoveAll(parent, context.data.id);\r\n            SetFieldAction.new(id, 'parent', parent, '', true);\r\n        }\r\n        //END();\r\n        return true;\r\n    }\r\n\r\n    protected get_attributes(context: Context): this[\"attributes\"] {\r\n        return context.data.attributes.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n    protected set_attributes(val: PackArr<this[\"attributes\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        const oldList = context.data.attributes;\r\n        const diff = U.arrayDifference(oldList, list);\r\n        //BEGIN();\r\n        SetFieldAction.new(context.data, 'attributes', list, \"\", true);\r\n        for (let id of diff.added) {\r\n            SetFieldAction.new(id, 'father', context.data.id, '', true);\r\n            SetFieldAction.new(id, 'parent', context.data.id, '+=', true);\r\n        }\r\n        for (let id of diff.removed as Pointer<DModelElement>[]) {\r\n            SetFieldAction.new(id, 'father', undefined, '', true);\r\n            const parent = DPointerTargetable.from(id).parent;\r\n            U.arrayRemoveAll(parent, context.data.id);\r\n            SetFieldAction.new(id, 'parent', parent, '', true);\r\n        }\r\n        //END();\r\n        return true;\r\n    }\r\n\r\n    protected get_referencedBy(context: Context): this[\"referencedBy\"] {\r\n        return context.data.referencedBy.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n    protected set_referencedBy(val: PackArr<this[\"referencedBy\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        SetFieldAction.new(context.data, 'referencedBy', list, \"\", true);\r\n        return true;\r\n    }\r\n\r\n    protected get_extends(context: Context): this[\"extends\"] {\r\n        return context.data.extends.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n    protected set_extends(val: PackArr<this[\"extends\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        SetFieldAction.new(context.data, 'extends', list, \"\", true);\r\n        return true;\r\n    }\r\n    protected add_extends(val: PackArr<this[\"extends\"]>, context: Context): void {\r\n        let ptrs: Pointer<DClass> = Pointers.from(val) as any;\r\n        SetFieldAction.new(context.data, 'extends', [...context.data.extends, ...ptrs], '', true);\r\n    }\r\n\r\n    protected remove_extends(val: PackArr<this[\"extends\"]> | number | number[], context: Context): void {\r\n        if (!Array.isArray(val)) val = [val];\r\n        if (!val.length) return;\r\n        let finalVal: D[\"extends\"];\r\n        if (typeof val[0] === \"number\") { finalVal = context.data.extends.filter((elem,index,arr)=> { return (val as any[]).includes(index); }); }\r\n        else {\r\n            finalVal = [...context.data.extends];\r\n            let ptrs: Pointer<DClass> = Pointers.from(val as PackArr<this[\"extends\"]>) as any;\r\n            for (let v of ptrs) { U.arrayRemoveAll(finalVal, v); }\r\n        }\r\n        SetFieldAction.new(context.data, 'extends', finalVal, '', true);\r\n    }\r\n\r\n    protected get_extendedBy(context: Context): this[\"extendedBy\"] {\r\n        return context.data.extendedBy.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n    protected set_extendedBy(val: PackArr<this[\"extendedBy\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        SetFieldAction.new(context.data, 'extendedBy', list, \"\", true);\r\n        return true;\r\n    }\r\n\r\n    protected get_implements(context: Context): this[\"implements\"] { return context.data.implements; }\r\n    protected set_implements(val: this[\"implements\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'implements', val, \"\", true);\r\n        return true;\r\n    }\r\n\r\n    protected get_implementedBy(context: Context): this[\"implementedBy\"] { return context.data.implementedBy; }\r\n    protected set_implementedBy(val: this[\"implementedBy\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'implementedBy', val, \"\", true);\r\n        return true;\r\n    }\r\n\r\n    public superclasses!: LClass[];\r\n    public allSubClasses!: LClass[];\r\n\r\n    public canExtend(superclass: LClass, output: {reason: string, allTargetSuperClasses: LClass[]} = {reason: '', allTargetSuperClasses: []}): boolean {\r\n        this.cannotCall(\"canExtend\"); return false;\r\n    }\r\n\r\n    private get_canExtend(context: Context): (superclass: LClass, output: {reason: string, allTargetSuperClasses: LClass[]}) => boolean {\r\n        return (superclass: LClass, output: {reason: string, allTargetSuperClasses: LClass[]} =\r\n            {reason: '', allTargetSuperClasses: []}) => this._canExtend(context, superclass, output);\r\n    }\r\n\r\n    public isExtending(superclass: LClassifier, output: {reason: string, allTargetSuperClasses: LClass[]} = {reason: '', allTargetSuperClasses: []}): boolean {\r\n        return this.cannotCall(\"isExtending\");\r\n    }\r\n\r\n    private get_isExtending(context: Context): this[\"isExtending\"] {\r\n        return null as any; // todo\r\n    }\r\n\r\n    private get_superclasses(context: Context, plusThis: boolean = false): LClass[] {\r\n        let i: number;\r\n        const thiss: LClass = context.proxyObject;\r\n        const visited: Dictionary<Pointer, LClass> = {};\r\n        let queue: LClass[] = thiss.extends;\r\n        if (plusThis) queue = [thiss, ...queue];\r\n        const ret: LClass[] = [];\r\n        for (i = 0; i < queue.length; i++) {\r\n            let elem: LClass = queue[i];\r\n            if (visited[elem.id]) continue;\r\n            visited[elem.id] = elem;\r\n            ret.push(elem);\r\n            queue.push(...elem.extends);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private get_allSubClasses(context: Context, plusThis: boolean = false): LClass[] {\r\n        const thiss: LClass = context.proxyObject;\r\n        const set: Set<LClass> = plusThis ? new Set<LClass>([thiss]) : new Set();\r\n        for (let i = 0; i < thiss.extendedBy.length; i++) {\r\n            // todo: would this access get_extendedBy 2*N times?? verify and optimize\r\n            U.SetMerge(true, set, thiss.extendedBy[i].allSubClasses); }\r\n        return [...set]; }\r\n\r\n\r\n    private _canExtend(context: Context, superclass: LClass, output: {reason: string, allTargetSuperClasses: LClass[]} = {reason: '', allTargetSuperClasses: []}): boolean {\r\n        if (!superclass) { output.reason = 'Invalid extend target: ' + superclass; return false; }\r\n        const thiss: LClass = context.proxyObject;\r\n        if (superclass.id === thiss.id) { output.reason = 'Classes cannot extend themselves.'; return false; }\r\n        // todo: se diversi proxy dello stesso oggetto sono considerati diversi questo fallisce, in tal caso fai thiss.extends.map( l => l.id).indexof(superclass.id)\r\n        if (thiss.extends.map(sc=>sc.id).indexOf(superclass.id) >= 0) { output.reason = 'Target class is already directly extended.'; return false; }\r\n        output.allTargetSuperClasses = superclass.superclasses;\r\n        if (thiss.superclasses.map(sc=> sc.id).indexOf(superclass.id) >= 0) { output.reason = 'Target class is already indirectly extended.'; return false; }\r\n        if (output.allTargetSuperClasses.map(sc=>sc.id).indexOf(thiss.id) >= 0) { output.reason = 'Cannot set this extend, it would cause a inheritance loop.'; return false; }\r\n        if (thiss.interface && !superclass.interface) { output.reason = 'An interface cannot extend a class.'; return false; }\r\n        // ora verifico se causa delle violazioni di override (attibuti omonimi string e boolean non possono overridarsi)\r\n        let i: number;\r\n        let j: number;\r\n        let children: LOperation[] =  thiss.operations; //[...thiss.getBasicOperations()];\r\n        let superchildren: LOperation[] = superclass.operations; //[...superclass.getBasicOperations()];\r\n        for (i = 0; i < children.length; i++) {\r\n            let op: LOperation = children[i];\r\n            for (j = 0; j < superchildren.length; j++){\r\n                let superchild: LOperation = superchildren[j];\r\n                if (op.name !== superchild.name) continue;\r\n                if (op._canOverride(superchild) || op._canPolymorph(superchild)) continue;\r\n                output.reason = 'Marked homonymous operations cannot override nor polymorph each others.';\r\n                setTimeout( () => {\r\n                    op._mark(true, superchild, 'override'); //  mark op && superchildren\r\n                    setTimeout( () => { op._mark(false, superchild, 'override'); }, 3000); // unmark\r\n                }, 1);\r\n                return false;\r\n            }\r\n        }\r\n        return true; }\r\n\r\n    private _isExtending(context: Context, superclass: LClass, orEqual: boolean = true): boolean {\r\n        if (!superclass) return false;\r\n        return this.get_superclasses(context, orEqual).includes(superclass); }\r\n\r\n    private add_Extends(context: Context, superclass: LClass, force: boolean = false): boolean {\r\n        let out: {reason: string, allTargetSuperClasses: LClass[]} = {reason: '', allTargetSuperClasses: []};\r\n        const thiss: LClass = context.proxyObject;\r\n        if (!force && !this._canExtend(context, superclass, out)) {  return false; }\r\n        SetFieldAction.new(thiss.__raw, 'extends', [superclass.id], '+=', true);\r\n        SetFieldAction.new(superclass.__raw, 'extendedBy', [thiss.id], '+=', true);\r\n        // const extendChildren: LClass[] =  [thiss, ...thiss.superclasses];\r\n        // console.log('calculateViolationsExtend children:'  + extendChildren, this);\r\n        // for (let extChild of extendChildren) { extChild._checkViolations(false); } // after instances have their meta-class changed, they might need to change shape or values.\r\n        return true; }\r\n\r\n    unsetExtends(context: Context, superclass: LClass): void {\r\n        if (!superclass) return;\r\n        console.log('UnsetExtend:', context);\r\n        // todo: when Object is loaded in m3, set him there for easy access.\r\n        //  if (superclass.id === LClass.genericObjectid) { Log.w(true, 'Cannot un-extend \"Object\"'); return; }\r\n        const thiss: LClass = context.proxyObject;\r\n        let index: number = thiss.extends.indexOf(superclass);\r\n        if (index < 0) return;\r\n\r\n        let newextends = thiss.extends.map(l => l.id);\r\n        let newextendedBy = superclass.extendedBy.map(l => l.id);\r\n        U.arrayRemoveAll(newextends, superclass.id)\r\n        U.arrayRemoveAll(newextendedBy, thiss.id)\r\n        SetFieldAction.new(thiss, 'extends', (newextends), '', true); // -=\r\n        SetFieldAction.new(superclass, 'extendedBy', (newextendedBy), '', true); // -=\r\n        // todo: update instances for (i = 0; i < thiss.instances.length; i++) { thiss.instances[i].unsetExtends(superclass); }\r\n        // todo: remove extend edge? here?\r\n\r\n        // todo: check violations\r\n        // const extendedby: LClass[] = [thiss, ...thiss.allSubClasses];\r\n        // for (i = 0; i < extendedby.length; i++) { extendedby[i].checkViolations(true); }\r\n    }\r\n\r\n    public instance(): DObject { return this.cannotCall('instance'); }\r\n    /*private get_instance_old(context: Context): () => DObject {\r\n        return () => {\r\n            const dClass: DClass = context.data;\r\n            const lClass: LClass = LClass.from(dClass);\r\n            const dObject = DObject.new(lClass.name.toLowerCase());\r\n            CreateElementAction.new(dObject);\r\n            BEGIN()\r\n            SetFieldAction.new(dObject, 'instanceof', dClass.id, '', true);\r\n            SetFieldAction.new(dClass, 'instances', dObject.id, '+=', true);\r\n\r\n            let father: LClass|undefined = lClass;\r\n            while(father) {\r\n                for(let dFeature of [...father.attributes, ...father.references]) {\r\n                    const dValue = DValue.new(dFeature.name); dValue.value = [U.initializeValue(dFeature.type)];\r\n                    CreateElementAction.new(dValue);\r\n\r\n                    SetFieldAction.new(dValue, 'father', dObject.id, '', true);\r\n                    SetFieldAction.new(dValue, 'instanceof', dFeature.id, '', true);\r\n                    SetFieldAction.new(dFeature, 'instances', dValue.id, '+=', true);\r\n                    SetFieldAction.new(dObject, 'features', dValue.id, '+=', true);\r\n\r\n                }\r\n                father = (father.extends.length > 0) ? father.extends[0] : undefined;\r\n            }\r\n            END()\r\n            return dObject;\r\n        };\r\n    }*/\r\n\r\n    protected get_delete(context: Context): () => void {\r\n        const data = context.proxyObject;\r\n        const ret = () => {\r\n            const canBeDeleted = data.instances.length === 0;\r\n            if(canBeDeleted) {\r\n                const pointedBy = U.filteredPointedBy(data, 'type');\r\n                for(let me of pointedBy) {\r\n                    if(me) {\r\n                        SetFieldAction.new(me.__raw as DReference, 'type', me.father.id, '', true);\r\n                    }\r\n                }\r\n                for(let me of data.extends) {\r\n                    SetFieldAction.new(me.__raw, 'extendedBy', me.__raw.extendedBy.indexOf(data.id), '-=', true);\r\n                }\r\n                for(let me of data.extendedBy) {\r\n                    SetFieldAction.new(me.__raw, 'extends', me.__raw.extends.indexOf(data.id), '-=', true);\r\n                }\r\n                data.superDelete();\r\n            } else { U.alert('error', 'Cannot delete the selected class since there are instances.'); }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n}\r\nDClassifier.subclasses.push(DClass);\r\nLClassifier.subclasses.push(LClass);\r\n\r\n\r\n@RuntimeAccessible\r\nexport class DDataType extends DPointerTargetable { // extends DClassifier\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LDataType;\r\n    // static logic: typeof LDataType;\r\n    // static structure: typeof DDataType;\r\n\r\n    // inherit redefine\r\n    // instanceClass: EJavaClass // ?\r\n    // isInstance(object: EJavaObject): boolean; ?\r\n    // getClassifierID(): number;\r\n    id!: Pointer<DDataType, 1, 1, LDataType>;\r\n    instanceClassName!: string;\r\n    parent: Pointer<DPackage, 0, 'N', LPackage> = [];\r\n    father!: Pointer<DPackage, 1, 1, LPackage>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    name!: string;\r\n    defaultValue!: Pointer<DObject, 1, 1, LObject>[] | string[];\r\n    // personal\r\n    serializable: boolean = true;\r\n    // usedBy: Pointer<DAttribute, 0, 'N', LAttribute> = [];\r\n\r\n\r\n    public static new(name?: DNamedElement[\"name\"], father?: Pointer, persist: boolean = true): DDataType {\r\n        Log.exx(\"DDataType is abstract, cannot instantiate\");\r\n        return null as any;\r\n        // if (!name) name = this.defaultname(\"datatype_\", father);\r\n        // return new Constructors(new DDataType('dwc'), father, persist, undefined).DPointerTargetable().DModelElement().DNamedElement(name).DClassifier().DDataType().end();\r\n    }\r\n}\r\n\r\n@Abstract\r\n@RuntimeAccessible\r\nexport class LDataType<Context extends LogicContext<DDataType> = any, C extends Context = Context> extends LClassifier { // extends DClassifier\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DDataType;\r\n    id!: Pointer<DDataType, 1, 1, LDataType>;\r\n    // static singleton: LDataType;\r\n    // static logic: typeof LDataType;\r\n    // static structure: typeof DDataType;\r\n\r\n    // inherit redefine\r\n    // instanceClass: EJavaClass // ?\r\n    // isInstance(object: EJavaObject): boolean; ?\r\n    // getClassifierID(): number;\r\n    instanceClassName!: string;\r\n    parent!: LPackage[];\r\n    father!: LPackage;\r\n    annotations!: LAnnotation[];\r\n    name!: string;\r\n    namespace!: string;\r\n    defaultValue!: LObject[] | string[];\r\n    isPrimitive!: false;\r\n    isClass!: false;\r\n    isEnum!: true;\r\n    // personal\r\n    serializable!: boolean;\r\n\r\n\r\n    protected get_serializable(context: Context): this[\"serializable\"] { return context.data.serializable; }\r\n    protected set_serializable(val: this[\"serializable\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'serializable', val);\r\n        return true;\r\n    }\r\n\r\n}\r\n\r\nDClassifier.subclasses.push(DDataType);\r\nLClassifier.subclasses.push(LDataType);\r\n\r\n\r\n\r\n\r\n\r\n@RuntimeAccessible\r\nexport class DStructuralFeature extends DPointerTargetable { // DTypedElement\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LStructuralFeature;\r\n    // static logic: typeof LStructuralFeature;\r\n    // static structure: typeof DStructuralFeature;\r\n\r\n    // inherit redefine\r\n    id!: Pointer<DStructuralFeature, 1, 1, LStructuralFeature>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    parent: Pointer<DClass, 0, 'N', LClass> = [];\r\n    father!: Pointer<DClass, 1, 1, LClass>;\r\n    name!: string;\r\n    type!: Pointer<DClassifier, 1, 1, LClassifier>;\r\n    ordered: boolean = true;\r\n    unique: boolean = true;\r\n    lowerBound: number = 0;\r\n    upperBound: number = 1;\r\n    many!: boolean;\r\n    required!: boolean;\r\n    // personal\r\n    instances: Pointer<DValue, 0, 'N', LValue> = [];\r\n    changeable: boolean = true;\r\n    volatile: boolean = true;\r\n    transient: boolean = false;\r\n    unsettable: boolean = false;\r\n    derived: boolean = false;\r\n    defaultValue!: (Pointer<DObject, 1, 1, LObject> | PrimitiveType)[];\r\n\r\n    public static new(name?: DNamedElement[\"name\"], type?: DTypedElement[\"type\"], father?: Pointer, persist: boolean = true): DStructuralFeature {\r\n        Log.exx(\"DStructuralFeature is abstract, cannot instantiate\");\r\n        return null as any;\r\n        // if (!name) name = this.defaultname(\"feature \", father);\r\n        // return new Constructors(new DStructuralFeature('dwc'), father, persist, undefined).DPointerTargetable().DModelElement().DNamedElement(name).DTypedElement(type).DStructuralFeature().end();\r\n    }\r\n    // getFeatureID(): number;\r\n    // getContainerClass(): EJavaClass\r\n}\r\n\r\n@Abstract\r\n@RuntimeAccessible\r\nexport class LStructuralFeature<Context extends LogicContext<DStructuralFeature> = any, C extends Context = Context>  extends LTypedElement { // DTypedElement\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DStructuralFeature;\r\n    id!: Pointer<DStructuralFeature, 1, 1, LStructuralFeature>;\r\n    // static singleton: LStructuralFeature;\r\n    // static logic: typeof LStructuralFeature;\r\n    // static structure: typeof DStructuralFeature;\r\n\r\n    // inherit redefine\r\n    annotations!: LAnnotation[];\r\n    parent!: LClass[];\r\n    father!: LClass;\r\n    name!: string;\r\n    namespace!: string;\r\n    type!: LClassifier;\r\n    ordered: boolean = true;\r\n    unique: boolean = true;\r\n    lowerBound: number = 0;\r\n    upperBound: number = 1;\r\n    many!: boolean;\r\n    required!: boolean;\r\n    // personal\r\n    instances!: LValue[];\r\n    changeable!: boolean;\r\n    volatile!: boolean;\r\n    transient!: boolean;\r\n    unsettable!: boolean;\r\n    derived!: boolean;\r\n    // defaultValueLiteral!: string;\r\n    defaultValue!: (LObject[] | PrimitiveType[]);\r\n    // getFeatureID(): number;\r\n    // getContainerClass(): EJavaClass\r\n\r\n    protected get_instances(context: Context): this[\"instances\"] {\r\n        return context.data.instances.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n    protected set_instances(val: PackArr<this[\"instances\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        SetFieldAction.new(context.data, 'instances', list, \"\", true);\r\n        return true;\r\n    }\r\n\r\n    protected get_changeable(context: Context): this[\"changeable\"] { return context.data.changeable; }\r\n    protected set_changeable(val: this[\"changeable\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'changeable', val);\r\n        return true;\r\n    }\r\n\r\n    protected get_volatile(context: Context): this[\"volatile\"] { return context.data.volatile; }\r\n    protected set_volatile(val: this[\"volatile\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'volatile', val);\r\n        return true;\r\n    }\r\n\r\n    protected get_transient(context: Context): this[\"transient\"] { return context.data.transient; }\r\n    protected set_transient(val: this[\"transient\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'transient', val);\r\n        return true;\r\n    }\r\n\r\n    protected get_unsettable(context: Context): this[\"unsettable\"] { return context.data.unsettable; }\r\n    protected set_unsettable(val: this[\"unsettable\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'unsettable', val);\r\n        return true;\r\n    }\r\n\r\n    protected get_derived(context: Context): this[\"derived\"] { return context.data.derived; }\r\n    protected set_derived(val: this[\"derived\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'derived', val);\r\n        return true;\r\n    }\r\n\r\n    protected get_delete(context: Context): () => void {\r\n        const data = context.proxyObject;\r\n        const ret = () => {\r\n            for(let instance of data.instances) { instance.delete(); }\r\n            data.superDelete();\r\n        }\r\n        return ret;\r\n    }\r\n    /*\r\n        protected get_defaultValueLiteral(context: Context): this[\"defaultValueLiteral\"] { return context.data.defaultValueLiteral; }\r\n        protected set_defaultValueLiteral(val: this[\"defaultValueLiteral\"], context: Context): boolean {\r\n            SetFieldAction.new(context.data, 'defaultValueLiteral', val, \"\", false);\r\n            return true;\r\n        }*/\r\n}\r\nDTypedElement.subclasses.push(DStructuralFeature);\r\nLTypedElement.subclasses.push(LStructuralFeature);\r\n\r\n\r\n@RuntimeAccessible\r\nexport class DReference extends DPointerTargetable { // DStructuralFeature\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LReference;\r\n    // static logic: typeof LReference;\r\n    // static structure: typeof DReference;\r\n\r\n\r\n    // inherit redefine\r\n    id!: Pointer<DReference, 1, 1, LReference>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    name!: string;\r\n    type!: Pointer<DClass, 1, 1, LClass>;\r\n    ordered: boolean = true;\r\n    unique: boolean = true;\r\n    lowerBound: number = 0;\r\n    upperBound: number = 1;\r\n    many!: boolean;\r\n    required!: boolean;\r\n    changeable: boolean = true;\r\n    volatile: boolean = true;\r\n    transient: boolean = false;\r\n    unsettable: boolean = false;\r\n    derived: boolean = false;\r\n    defaultValueLiteral!: string;\r\n    parent: Pointer<DClass, 0, 'N', LClass> = [];\r\n    father!: Pointer<DClass, 1, 1, LClass>;\r\n    instances: Pointer<DValue, 0, 'N', LValue> = [];\r\n    defaultValue!: Pointer<DObject, 1, 1, LObject>[];\r\n\r\n    // personal\r\n    containment: boolean = false;\r\n    container: boolean = false; // ?\r\n    resolveProxies: boolean = true; // ?\r\n    opposite!: Pointer<DReference, 0, 1, LReference>;\r\n    target: Pointer<DClass, 0, 'N', LClass> = [];\r\n    edges: Pointer<DEdge, 0, 'N', LEdge> = [];\r\n\r\n    public static new(name?: DReference[\"name\"], type?: DReference[\"type\"], father?: DReference[\"father\"], persist: boolean = true): DReference {\r\n        if (!type) type = father // default type is self-reference\r\n        if (!name) name = this.defaultname(\"ref_\", father);\r\n        return new Constructors(new DReference('dwc'), father, persist, undefined).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DTypedElement(type).DStructuralFeature().DReference().end();\r\n    }\r\n\r\n    static new2(setter: Partial<ObjectWithoutPointers<DReference>>, father: DReference[\"father\"], type?: DReference[\"type\"], name?: DReference[\"name\"]): DReference {\r\n        if (!name) name = this.defaultname((name || \"ref_\"), father);\r\n        return new Constructors(new DReference('dwc'), father, true, undefined).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DTypedElement(type).DStructuralFeature().DReference()\r\n            .end((d) => { Object.assign(d, setter); });\r\n    }\r\n\r\n}\r\n\r\n@Instantiable // LValue\r\n@Leaf\r\n@RuntimeAccessible\r\nexport class LReference<Context extends LogicContext<DReference> = any, C extends Context = Context, D extends DReference = DReference>  extends LStructuralFeature {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DReference;\r\n    id!: Pointer<DReference, 1, 1, LReference>;\r\n    // static singleton: LReference;\r\n    // static logic: typeof LReference;\r\n    // static structure: typeof DReference;\r\n\r\n    // inherit redefine\r\n    annotations!: LAnnotation[];\r\n    name!: string;\r\n    namespace!: string;\r\n    type!: LClass;\r\n    ordered!: boolean;\r\n    unique!: boolean;\r\n    lowerBound!: number;\r\n    upperBound!: number;\r\n    many!: boolean;\r\n    required!: boolean;\r\n    changeable!: boolean;\r\n    volatile!: boolean;\r\n    transient!: boolean;\r\n    unsettable!: boolean;\r\n    derived!: boolean;\r\n    defaultValueLiteral!: string;\r\n    parent!: LClass[];\r\n    father!: LClass;\r\n    instances!: LValue[];\r\n    defaultValue!: LObject[];\r\n\r\n    // personal\r\n    containment!: boolean;\r\n    container!: boolean; //??\r\n    resolveProxies!: boolean;\r\n    opposite?: LReference;\r\n    target!: LClass[];\r\n    edges!: LEdge[];\r\n\r\n\r\n\r\n    protected generateEcoreJson_impl(context: Context, loopDetectionObj: Dictionary<Pointer, DModelElement> = {}): Json {\r\n        loopDetectionObj[context.data.id] = context.data;\r\n        const model: GObject = {};\r\n        const d = context.data;\r\n        const l = context.proxyObject;\r\n        model[ECoreReference.xsitype] = 'ecore:EReference';\r\n        model[ECoreReference.eType] = l.type.typeEcoreString;\r\n        model[ECoreReference.namee] = d.name;\r\n        if (d.lowerBound != null && !isNaN(+d.lowerBound)) { model[ECoreReference.lowerbound] = +d.lowerBound; }\r\n        if (d.upperBound != null && !isNaN(+d.upperBound)) { model[ECoreReference.upperbound] = +d.upperBound; }\r\n        if (d.containment != null) { model[ECoreReference.containment] = d.containment; }\r\n        return model; }\r\n\r\n    public duplicate(deep: boolean = true): this { return this.cannotCall( this.constructor.name + \"duplicate()\"); }\r\n    protected get_duplicate(context: Context): ((deep?: boolean) => this) {\r\n        return (deep: boolean = false) => {\r\n            BEGIN()\r\n            let de: D = context.proxyObject.father.addReference(context.data.name, context.data.type) as D;\r\n            de.many = context.data.many;\r\n            de.lowerBound = context.data.lowerBound;\r\n            de.upperBound = context.data.upperBound;\r\n            de.ordered = context.data.ordered;\r\n            de.required = context.data.required;\r\n            de.unique = context.data.unique;\r\n            de.changeable = context.data.changeable;\r\n            de.container = context.data.container;\r\n            de.containment = context.data.containment;\r\n            de.defaultValueLiteral = context.data.defaultValueLiteral;\r\n            de.derived = context.data.derived;\r\n            de.transient = context.data.transient;\r\n            de.unsettable = context.data.unsettable;\r\n            de.volatile = context.data.unsettable;\r\n            let le: this = LPointerTargetable.fromD(de);\r\n            let we: WReference = le as any;\r\n            we.opposite = context.data.opposite || undefined;\r\n            we.defaultValue = context.data.defaultValue;\r\n            we.type = context.data.type;\r\n            we.annotations = deep ? context.proxyObject.annotations.map(lchild => lchild.duplicate(deep).id) : context.data.annotations;\r\n            we.target = deep ? context.proxyObject.target.map(lchild => lchild.duplicate(deep).id) : context.data.target;\r\n            END()\r\n            return le; }\r\n    }\r\n\r\n    protected set_type(val: Pack1<this[\"type\"]>, context: Context): boolean { return super.set_type(val, context); }\r\n\r\n    public addClass(name?: DClass[\"name\"], isInterface?: DClass[\"interface\"], isAbstract?: DClass[\"abstract\"], isPrimitive?: DClass[\"isPrimitive\"],\r\n                    isPartial?: DClass[\"partial\"], partialDefaultName?: DClass[\"partialdefaultname\"]): DClass {\r\n        return this.cannotCall(\"LReference.addClass\"); }\r\n    protected get_addClass(context: Context): this[\"addClass\"] {\r\n        return (name?: DClass[\"name\"], isInterface?: DClass[\"interface\"], isAbstract?: DClass[\"abstract\"], isPrimitive?: DClass[\"isPrimitive\"],\r\n                isPartial?: DClass[\"partial\"], partialDefaultName?: DClass[\"partialdefaultname\"]) => {\r\n            BEGIN()\r\n            let dclass = DClass.new(name, isInterface, isAbstract, isPrimitive, isPartial, partialDefaultName, context.proxyObject.package!.id, true);\r\n            // SetFieldAction.new(context.data.id, \"type\", dclass.id);\r\n            this.set_type(dclass.id as any, context);\r\n            END();\r\n            return dclass;\r\n        } }\r\n\r\n\r\n    protected get_containment(context: Context): this[\"containment\"] { return context.data.containment; }\r\n    protected set_containment(val: this[\"containment\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'containment', val);\r\n        return true;\r\n    }\r\n\r\n    protected get_container(context: Context): this[\"container\"] { return context.data.container; }\r\n    protected set_container(val: this[\"container\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'container', val);\r\n        return true;\r\n    }\r\n\r\n    protected get_resolveProxies(context: Context): this[\"resolveProxies\"] { return context.data.resolveProxies; }\r\n    protected set_resolveProxies(val: this[\"resolveProxies\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'resolveProxies', val);\r\n        return true;\r\n    }\r\n\r\n    protected get_opposite(context: Context): this[\"opposite\"] { return LPointerTargetable.from(context.data.opposite); }\r\n    protected set_opposite(val: Pack<LReference | undefined>, context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'opposite', Pointers.from(val) as any as LAnnotation[\"id\"], \"\", true);\r\n        return true;\r\n    }\r\n\r\n    /// todo: why this exist?  why not type?\r\n    protected get_target(context: Context): this[\"target\"] { return context.data.target.map(pointer => LPointerTargetable.from(pointer)); }\r\n    protected set_target(val: PackArr<this[\"target\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        SetFieldAction.new(context.data, 'target', list, \"\", true);\r\n        return true;\r\n    }\r\n\r\n    protected get_defaultValue(context: Context): this[\"defaultValue\"] { return LPointerTargetable.fromPointer(context.data.defaultValue); }\r\n    protected set_defaultValue(val: PackArr<this[\"defaultValue\"]>, context: Context): boolean {\r\n        // @ts-ignore\r\n        if (!val) (val) = []; else if (!Array.isArray(val)) val = [val];\r\n        let ptrs = Pointers.from(val);\r\n        SetFieldAction.new(context.data, 'defaultValue', ptrs, '', false);\r\n        return true; }\r\n\r\n    protected get_edges(context: Context): this[\"edges\"] {\r\n        return context.data.edges.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n    protected set_edges(val: PackArr<this[\"edges\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        SetFieldAction.new(context.data, 'edges', list, \"\", true);\r\n        return true;\r\n    }\r\n}\r\nDStructuralFeature.subclasses.push(DReference);\r\nLStructuralFeature.subclasses.push(LReference);\r\n\r\n\r\nfunction has_opposite(oppositename: string, ...comments: string[]): any {\r\n    // return (c:Constructor, key:string, ):any =>{}\r\n}\r\nfunction obsolete_attribute(...comments: string[]) {\r\n    return undefined as any; // function(c:Constructor, key:string,): any {}\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class DAttribute extends DPointerTargetable { // DStructuralFeature\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LAttribute;\r\n    // static logic: typeof LAttribute;\r\n    // static structure: typeof DAttribute;\r\n\r\n    // inherit redefine\r\n    id!: Pointer<DAttribute, 1, 1, LAttribute>;\r\n    // @has_opposite(\"father\")\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    name!: string;\r\n    type!: Pointer<DClassifier, 1, 1, LClassifier>;\r\n    ordered: boolean = true;\r\n    unique: boolean = true;\r\n    lowerBound: number = 0;\r\n    upperBound: number = 1;\r\n    many!: boolean;\r\n    required!: boolean;\r\n    changeable: boolean = true;\r\n    volatile: boolean = true;\r\n    transient: boolean = false;\r\n    unsettable: boolean = false;\r\n    derived: boolean = false;\r\n    defaultValueLiteral!: string;\r\n    //@obsolete_attribute()\r\n    parent: Pointer<DClass, 0, 'N', LClass> = [];\r\n\r\n    //@has_opposite(\"attributes\")\r\n    father!: Pointer<DClass, 1, 1, LClass>;\r\n\r\n    //@has_opposite(\"instanceof\")\r\n    instances: Pointer<DValue, 0, 'N', LValue> = [];\r\n    defaultValue!: PrimitiveType[];\r\n\r\n    // personal\r\n    isID: boolean = false; // ? exist in ecore as \"iD\" ?\r\n\r\n    public static new(name?: DAttribute[\"name\"], type?: DAttribute[\"type\"], father?: DAttribute[\"father\"], persist: boolean = true): DAttribute {\r\n        if (!name) name = this.defaultname(\"attr_\", father);\r\n        if (!type) type = LPointerTargetable.from(Selectors.getFirstPrimitiveTypes()).id; // default type as string\r\n        return new Constructors(new DAttribute('dwc'), father, persist, undefined).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DTypedElement(type).DStructuralFeature().DAttribute().end();\r\n    }\r\n    static new2(setter: Partial<ObjectWithoutPointers<DReference>>, father: DAttribute[\"father\"], type?: DAttribute[\"type\"], name?: DAttribute[\"name\"]): DAttribute {\r\n        if (!name) name = this.defaultname((name || \"ref_\"), father);\r\n        return new Constructors(new DAttribute('dwc'), father, true, undefined).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DTypedElement(type).DStructuralFeature().DReference()\r\n            .end((d) => { Object.assign(d, setter); });\r\n    }\r\n}\r\n\r\n@Leaf\r\n@Instantiable // (LValue)\r\n@RuntimeAccessible\r\nexport class LAttribute <Context extends LogicContext<DAttribute> = any, C extends Context = Context, D extends DAttribute = DAttribute> extends LStructuralFeature { // DStructuralFeature\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DAttribute;\r\n    id!: Pointer<DAttribute, 1, 1, LAttribute>;\r\n    // static singleton: LAttribute;\r\n    // static logic: typeof LAttribute;\r\n    // static structure: typeof DAttribute;\r\n\r\n    // inherit redefine\r\n    annotations!: LAnnotation[];\r\n    name!: string;\r\n    namespace!: string;\r\n    type!: LClassifier;\r\n    ordered!: boolean;\r\n    unique!: boolean;\r\n    lowerBound!: number;\r\n    upperBound!: number;\r\n    many!: boolean;\r\n    required!: boolean;\r\n    changeable!: boolean;\r\n    volatile!: boolean;\r\n    transient!: boolean;\r\n    unsettable!: boolean;\r\n    derived!: boolean;\r\n    // defaultValueLiteral!: string;\r\n    defaultValue!: PrimitiveType[];\r\n    parent!: LClass[];\r\n    father!: LClass;\r\n    instances!: LValue[];\r\n\r\n    // personal\r\n    isID: boolean = false; // ? exist in ecore as \"iD\" ?\r\n\r\n    protected generateEcoreJson_impl(context: Context, loopDetectionObj: Dictionary<Pointer, DModelElement> = {}): Json {\r\n        loopDetectionObj[context.data.id] = context.data;\r\n        const model = {};\r\n        const d = context.data;\r\n        const l = context.proxyObject;\r\n        EcoreParser.write(model, ECoreAttribute.xsitype, 'ecore:EAttribute');\r\n        EcoreParser.write(model, ECoreAttribute.eType, l.type.typeEcoreString);\r\n        EcoreParser.write(model, ECoreAttribute.namee, d.name);\r\n        EcoreParser.write(model, ECoreAttribute.lowerbound, '' + d.lowerBound);\r\n        EcoreParser.write(model, ECoreAttribute.upperbound, '' + d.upperBound);\r\n        return model; }\r\n\r\n\r\n    public duplicate(deep: boolean = true): this { return this.cannotCall( this.constructor.name + \"duplicate()\"); }\r\n    protected get_duplicate(context: Context): ((deep?: boolean) => this) {\r\n        return (deep: boolean = false) => {\r\n            BEGIN()\r\n            let de: D = context.proxyObject.father.addAttribute(context.data.name, context.data.type) as D;\r\n            de.many = context.data.many;\r\n            de.lowerBound = context.data.lowerBound;\r\n            de.upperBound = context.data.upperBound;\r\n            de.ordered = context.data.ordered;\r\n            de.required = context.data.required;\r\n            de.unique = context.data.unique;\r\n            de.changeable = context.data.changeable;\r\n            de.defaultValue = context.data.defaultValue;\r\n            de.defaultValueLiteral = context.data.defaultValueLiteral;\r\n            de.derived = context.data.derived;\r\n            de.transient = context.data.transient;\r\n            de.unsettable = context.data.unsettable;\r\n            de.volatile = context.data.volatile;\r\n            de.isID = context.data.isID\r\n            let le: this = LPointerTargetable.fromD(de);\r\n            let we: WAttribute = le as any;\r\n            we.type = context.data.type;\r\n            we.annotations = deep ? context.proxyObject.annotations.map(lchild => lchild.duplicate(deep).id) : context.data.annotations;\r\n            END()\r\n            return le; }\r\n    }\r\n\r\n    public addEnum(...p:Parameters<this[\"addEnumerator\"]>): DEnumerator { return this.addEnumerator(...p); }\r\n    protected get_addEnum(context: Context): this[\"addEnumerator\"] { return this.get_addEnumerator(context); }\r\n    public addEnumerator(name?: DEnumerator[\"name\"], father?: DEnumerator[\"father\"]): DEnumerator { return this.cannotCall(\"Attribute.addEnumerator\"); }\r\n    protected get_addEnumerator(context: Context): this[\"addEnumerator\"] {\r\n        return (name?: DEnumerator[\"name\"], father?: DEnumerator[\"father\"]) => DEnumerator.new(name, context.proxyObject.package?.id, true); }\r\n\r\n    protected get_ID(context: Context): this[\"isID\"] { return context.data.isID; }\r\n    protected set_ID(val: this[\"isID\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'isID', val);\r\n        return true;\r\n    }\r\n    protected get_defaultValue(context: Context): this[\"defaultValue\"] { return context.data.defaultValue; }\r\n    protected set_defaultValue(val: unArr<this[\"defaultValue\"]>, context: Context): boolean {\r\n        // @ts-ignore\r\n        if (!val) (val) = []; else if (!Array.isArray(val)) val = [val];\r\n        SetFieldAction.new(context.data, 'defaultValue', val, '', false);\r\n        return true; }\r\n\r\n}\r\nDStructuralFeature.subclasses.push(DAttribute);\r\nLStructuralFeature.subclasses.push(LAttribute);\r\n\r\n@Leaf\r\n@RuntimeAccessible\r\nexport class DEnumLiteral extends DPointerTargetable { // DNamedElement\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LAttribute;\r\n    // static logic: typeof LAttribute;\r\n    // static structure: typeof DAttribute;\r\n\r\n    // inherit redefine\r\n    id!: Pointer<DEnumLiteral, 1, 1, LEnumLiteral>;\r\n    parent: Pointer<DEnumerator, 0, 'N', LEnumerator> = [];\r\n    father!: Pointer<DEnumerator, 1, 1, LEnumerator>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    name!: string;\r\n    // personal\r\n    value!: number;\r\n    // ordinal: number=1; replaced by value\r\n    literal!: string;\r\n\r\n    public static new(name?: DNamedElement[\"name\"], value?: DEnumLiteral[\"value\"], father?: Pointer, persist: boolean = true): DEnumLiteral { //vv4\r\n        if (!name) name = this.defaultname(\"literal \", father);\r\n        return new Constructors(new DEnumLiteral('dwc'), father, persist, undefined).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DEnumLiteral(value).end();\r\n    }\r\n    static new2(setter: Partial<ObjectWithoutPointers<DEnumLiteral>>, father: DEnumLiteral[\"father\"], name?: DEnumLiteral[\"name\"]): DEnumLiteral {\r\n        if (!name) name = this.defaultname(\"literal \", father);\r\n        return new Constructors(new DEnumLiteral('dwc'), father, true, undefined).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DEnumLiteral()\r\n            .end((d) => { Object.assign(d, setter); });\r\n    }\r\n}\r\n\r\n@Leaf\r\n@RuntimeAccessible\r\nexport class LEnumLiteral<Context extends LogicContext<DEnumLiteral> = any, C extends Context = Context, D extends DEnumLiteral = DEnumLiteral>  extends LNamedElement { // DNamedElement\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DEnumLiteral;\r\n    id!: Pointer<DEnumLiteral, 1, 1, LEnumLiteral>;\r\n    // static singleton: LAttribute;\r\n    // static logic: typeof LAttribute;\r\n    // static structure: typeof DAttribute;\r\n\r\n    // inherit redefine\r\n    parent!: LEnumerator[];\r\n    father!: LEnumerator;\r\n    annotations!: LAnnotation[];\r\n    name!: string;\r\n    namespace!: string;\r\n    // personal\r\n    value!: this[\"ordinal\"];\r\n    ordinal!: number;\r\n    literal!: string;\r\n\r\n    protected generateEcoreJson_impl(context: Context, loopDetectionObj: Dictionary<Pointer, DModelElement> = {}): Json {\r\n        loopDetectionObj[context.data.id] = context.data;\r\n        const json: Json = {};\r\n        const d = context.data;\r\n        json[EcoreLiteral.value] = d.value;\r\n        json[EcoreLiteral.literal] = d.literal;\r\n        json[EcoreLiteral.namee] = d.name;\r\n        return json; }\r\n\r\n    public generateEcoreJsonM1(): this[\"ordinal\"] { return this.cannotCall(\"GenerateEcoreJsonM1\"); }\r\n    protected get_generateEcoreJsonM1(context: Context): () => this[\"ordinal\"] { return this.impl_generateEcoreJsonM1(context); }\r\n    protected impl_generateEcoreJsonM1(context: Context): () => this[\"ordinal\"] {\r\n        // loopDetectionObj[context.data.id] = context.data; no loop detection here, the same literal can be exported multiple times in m1\r\n        // return context.data.literal;\r\n        // return context.data.name;\r\n        return () => context.data.value; }\r\n\r\n\r\n    public duplicate(deep: boolean = true): this { return this.cannotCall( this.constructor.name + \"duplicate()\"); }\r\n    protected get_duplicate(context: Context): ((deep?: boolean) => this) {\r\n        return (deep: boolean = false) => {\r\n            BEGIN()\r\n            let de: D = context.proxyObject.father.addLiteral(context.data.name, context.data.value) as D;\r\n            de.literal = context.data.literal;\r\n            de.value = context.data.value;\r\n            let le: this = LPointerTargetable.fromD(de);\r\n            let we: WEnumLiteral = le as any;\r\n            we.annotations = deep ? context.proxyObject.annotations.map(lchild => lchild.duplicate(deep).id) : context.data.annotations;\r\n            END()\r\n            return le; }\r\n    }\r\n\r\n\r\n    protected get_ordinal(context: Context): this[\"ordinal\"] { return this.get_value(context); }\r\n    protected set_ordinal(val: this[\"ordinal\"], context: Context): boolean { return this.set_value(val, context); }\r\n\r\n    protected get_value(context: Context): this[\"value\"] {\r\n        let ordinalAssumedByPosition = true; // per ottimizzazione forse è disattivabile\r\n        if (!ordinalAssumedByPosition) return context.data.value || 0;\r\n        return context.proxyObject.father.ordinals.map( o => o?.id).indexOf(context.data.id);\r\n    }\r\n    protected set_value(val: this[\"value\"], context: Context): boolean {\r\n        if (val === context.data.value) return true;\r\n        let ordinals = context.proxyObject.father.ordinals;\r\n        if (ordinals[val]) {\r\n            Log.e(\"that ordinal place is already taken by \" + ordinals[val].name, {sameOrdinalLit:ordinals[val], ordinals, thiss:context.data});\r\n            return false; }\r\n        return SetFieldAction.new(context.data, 'value', val); }\r\n\r\n    protected get_literal(context: Context): this[\"literal\"] { return context.data.literal; }\r\n    protected set_literal(val: this[\"literal\"], context: Context): boolean {\r\n        return SetFieldAction.new(context.data, 'literal', val, '', false); }\r\n\r\n\r\n}\r\nDNamedElement.subclasses.push(DEnumLiteral);\r\nLNamedElement.subclasses.push(LEnumLiteral);\r\n\r\n@Leaf\r\n@RuntimeAccessible\r\nexport class DEnumerator extends DPointerTargetable { // DDataType\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LEnumerator;\r\n    // static logic: typeof LEnumerator;\r\n    // static structure: typeof DEnumerator;\r\n\r\n    // inherit redefine\r\n    // instanceClass: EJavaClass // ?\r\n    // isInstance(object: EJavaObject): boolean; ?\r\n    // getClassifierID(): number;\r\n    id!: Pointer<DEnumerator, 1, 1, LEnumerator>;\r\n    instanceClassName!: string;\r\n    parent: Pointer<DPackage, 0, 'N', LPackage> = [];\r\n    father!: Pointer<DPackage, 1, 1, LPackage>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    name!: string;\r\n    defaultValue!: string[];\r\n    serializable: boolean = true;\r\n    // usedBy: Pointer<DAttribute, 0, 'N', LAttribute> = []; obsolete?\r\n    // personal\r\n    literals: Pointer<DEnumLiteral, 0, 'N', LEnumLiteral> = [];\r\n\r\n    public static new(name?: DNamedElement[\"name\"], father?: DEnumerator[\"father\"], persist: boolean = true): DEnumerator {\r\n        if (!name) name = this.defaultname(\"enum \", father);\r\n        return new Constructors(new DEnumerator('dwc'), father, persist, undefined).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DEnumerator().end();\r\n    }\r\n    static new2(setter: Partial<ObjectWithoutPointers<DEnumerator>>, father: DEnumerator[\"father\"], name?: DEnumerator[\"name\"]): DEnumerator {\r\n        if (!name) name = this.defaultname(\"enum \", father);\r\n        return new Constructors(new DEnumerator('dwc'), father, true, undefined).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DEnumerator().end((d) => { Object.assign(d, setter); });\r\n    }\r\n}\r\n\r\n@Node\r\n@RuntimeAccessible\r\nexport class LEnumerator<Context extends LogicContext<DEnumerator> = any, C extends Context = Context, D extends DEnumerator = DEnumerator> extends LDataType { // DDataType\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DEnumerator;\r\n    id!: Pointer<DEnumerator, 1, 1, LEnumerator>;\r\n    // static singleton: LEnumerator;\r\n    // static logic: typeof LEnumerator;\r\n    // static structure: typeof DEnumerator;\r\n\r\n    // inherit redefine\r\n    // instanceClass: EJavaClass // ?\r\n    // isInstance(object: EJavaObject): boolean; ?\r\n    // getClassifierID(): number;\r\n    instanceClassName!: string;\r\n    parent!: LPackage [];\r\n    father!: LPackage;\r\n    annotations!: LAnnotation[];\r\n    name!: string;\r\n    namespace!: string;\r\n    defaultValue!:string[];\r\n    serializable!: boolean;\r\n    // usedBy!: LAttribute[];\r\n    isPrimitive!: false;\r\n    isClass!: false;\r\n    isEnum!: true;\r\n    // personal\r\n    literals!: LEnumLiteral[];\r\n    ordinals!: LEnumLiteral[]; // literal array ordered by ordinal number\r\n\r\n    protected generateEcoreJson_impl(context: Context, loopDetectionObj: Dictionary<Pointer, DModelElement> = {}): Json {\r\n        loopDetectionObj[context.data.id] = context.data;\r\n        const json: Json = {};\r\n        let d = context.data;\r\n        if (d.instanceClassName) json[ECoreEnum.instanceTypeName] = d.instanceClassName;\r\n        json[ECoreEnum.xsitype] = 'ecore:EEnum';\r\n        json[ECoreEnum.namee] = d.name;\r\n        json[ECoreEnum.serializable] = d.serializable ? \"true\" : \"false\";\r\n        json[ECoreEnum.eLiterals] = context.proxyObject.literals.map(l => l.generateEcoreJson(loopDetectionObj));\r\n        return json; }\r\n\r\n    public duplicate(deep: boolean = true): this { return this.cannotCall( this.constructor.name + \"duplicate()\"); }\r\n    protected get_duplicate(context: Context): ((deep?: boolean) => this) {\r\n        return (deep: boolean = false) => {\r\n            BEGIN()\r\n            let de: D = context.proxyObject.father.addEnumerator(context.data.name) as D;\r\n            de.defaultValue = context.data.defaultValue;\r\n            de.serializable = context.data.serializable;\r\n            let le: this = LPointerTargetable.fromD(de);\r\n            let we: WEnumerator = le as any;\r\n            we.annotations = deep ? context.proxyObject.annotations.map(lchild => lchild.duplicate(deep).id) : context.data.annotations;\r\n            we.literals = deep ? context.proxyObject.literals.map(lchild => lchild.duplicate(deep).id) : context.data.literals;\r\n            END()\r\n            return le; }\r\n    }\r\n\r\n\r\n    protected get_children_idlist(context: Context): Pointer<DAnnotation | DEnumLiteral, 1, 'N'> {\r\n        return [...super.get_children_idlist(context) as Pointer<DAnnotation | DEnumLiteral, 1, 'N'>, ...context.data.literals]; }\r\n\r\n    public addLiteral(name?: DEnumLiteral[\"name\"], value?: DEnumLiteral[\"value\"]): DEnumLiteral { return this.cannotCall(\"addLiteral\"); }\r\n    protected get_addLiteral(context: Context): this[\"addLiteral\"] {\r\n        return (name?: DEnumLiteral[\"name\"], value?: DEnumLiteral[\"value\"]) => DEnumLiteral.new(name, value, context.data.id, true); }\r\n\r\n    protected get_literals(context: Context): this[\"literals\"] {\r\n        return context.data.literals.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        }); }\r\n\r\n    protected set_literals(val: PackArr<this[\"literals\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        const oldList = context.data.literals;\r\n        const diff = U.arrayDifference(oldList, list);\r\n        BEGIN();\r\n        SetFieldAction.new(context.data, 'literals', list, \"\", true);\r\n        for (let id of diff.added) {\r\n            SetFieldAction.new(id, 'father', context.data.id, '', true);\r\n            SetFieldAction.new(id, 'parent', context.data.id, '+=', true);\r\n        }\r\n        for (let id of diff.removed as Pointer<DModelElement>[]) {\r\n            SetFieldAction.new(id, 'father', undefined, '', true);\r\n            const parent = DPointerTargetable.from(id).parent;\r\n            U.arrayRemoveAll(parent, context.data.id);\r\n            SetFieldAction.new(id, 'parent', parent, '', true);\r\n        }\r\n        END();\r\n        return true; }\r\n\r\n    protected get_ordinals(context: Context): this[\"ordinals\"]{\r\n        let ret: LEnumLiteral[] = [];\r\n        let literals: LEnumLiteral[] = context.proxyObject.father.literals;\r\n        let dliterals: DEnumLiteral[] = literals.map(d => d.__raw);\r\n        /*\r\n        if it happens like:   second=2, third, fourth=4, fifth=3, sixth.(six would be 4 but 4 already exist)\r\n        there are 2 problems:\r\n        1) [3] is already occupied by third, but fith is correctly being the only one explicitly declaring his ordinal 3.\r\n           fixed by first assigning all known ordinals, then starting with the assumed ordinals.\r\n        2) sixth would get in position fourth, but that is already occupied\r\n         */\r\n\r\n        // adressing 1)\r\n        for (let i = 0; i < dliterals.length; i++) {\r\n            let v = dliterals[i].value;\r\n            if (v) { ret[v] = literals[i]; }\r\n        }\r\n\r\n        // setting assumed literals\r\n        let currentOrdinal = 0;\r\n        for (let i = 0; i < dliterals.length; i++) {\r\n            let v = dliterals[i].value;\r\n            if (v) { currentOrdinal = v; continue; }\r\n            while (ret[currentOrdinal]) currentOrdinal++; // adressing 2)\r\n            ret[currentOrdinal] = literals[i];\r\n        }\r\n        return ret; }\r\n\r\n    protected get_delete(context: Context): () => void {\r\n        const data = context.proxyObject;\r\n        const ret = () => {\r\n            const pointedBy = U.filteredPointedBy(data, 'type');\r\n            for(let me of pointedBy) {\r\n                if (me) {\r\n                    const dString = Selectors.getFirstPrimitiveTypes();\r\n                    SetFieldAction.new(me.__raw as DAttribute, 'type', dString.id, '', true);\r\n                }\r\n            }\r\n            data.superDelete();\r\n        }\r\n        return ret;\r\n    }\r\n}\r\nDDataType.subclasses.push(DEnumerator);\r\nLDataType.subclasses.push(LEnumerator);\r\n\r\n\r\n@RuntimeAccessible\r\nexport class DModelM1 extends DNamedElement{\r\n    name!: string;\r\n    roots!: Pointer<DObject, 1, 'N', LObject> // no package ma LObjects[] (solo quelli isRoot)\r\n    children!: DModelM1[\"roots\"];\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LModelM1 extends LNamedElement{\r\n    name!: string;\r\n    roots!: LObject[];\r\n    children!: LModelM1[\"roots\"];\r\n\r\n}\r\nDModelM1.subclasses.push(DNamedElement);\r\nLModelM1.subclasses.push(LNamedElement);\r\ntype DPrimitiveType = DClass;\r\ntype LPrimitiveType = LClass;\r\n\r\n\r\n// problema: o costringo l'utente a fare sempre .value per ricevere il valore invece dei metadati\r\n// oppure ritorno il valore da subito ma dal valore non posso accedere ai metadati (upperbound...) a meno che non trovi un altor sistema.\r\n\r\n// possibile fix: LValue.toString() che ritorna il .value\r\n\r\n\r\n\r\n\r\n\r\n@RuntimeAccessible\r\nexport class DModel extends DNamedElement { // DNamedElement\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LModel;\r\n    // static logic: typeof LModel;\r\n    // static structure: typeof DModel;\r\n\r\n    // inherit redefine\r\n    id!: Pointer<DModel, 1, 1, LModel>;\r\n    parent: Pointer<DModelElement, 0, 'N', LModelElement> = [];\r\n    father!: Pointer<DModelElement, 1, 1, LModelElement>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    name!: string;\r\n    // personal\r\n    packages: Pointer<DPackage, 0, 'N', LPackage> = [];\r\n    isMetamodel: boolean = true;\r\n    objects: Pointer<DObject, 0, 'N', LObject> = [];\r\n    models: Pointer<DModel, 0, 'N', LModel> = [];\r\n    instanceof!: Pointer<DModel, 0, 1, LModel>;\r\n\r\n    public static new(name?: DNamedElement[\"name\"], instanceoff?: DModel[\"instanceof\"], isMetamodel?: DModel[\"isMetamodel\"], persist: boolean = true): DModel {\r\n        let dmodels: DModel[] = Selectors.getAll(DModel, undefined, undefined, true, false);\r\n        let dmodelnames: string[] = dmodels.map((d: DModel) => d.name);\r\n        if (!name) name = this.defaultname(\"model_\", ((name: string) => dmodelnames.includes(name)));\r\n        return new Constructors(new DModel('dwc'), undefined, persist, undefined).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DModel(instanceoff, isMetamodel).end();\r\n    }\r\n    static new2(setter: Partial<ObjectWithoutPointers<DModel>>, name?: DModel[\"name\"], instanceoff?: DModel[\"instanceof\"]): DModel {\r\n        let dmodels: DModel[] = Selectors.getAll(DModel, undefined, undefined, true, false);\r\n        let dmodelnames: string[] = dmodels.map((d: DModel) => d.name);\r\n        if (!name) name = this.defaultname(\"model_\", ((name: string) => dmodelnames.includes(name)));\r\n        return new Constructors(new DModel('dwc'), undefined, true, undefined).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DModel(instanceoff).end((d) => { Object.assign(d, setter); });\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LModel<Context extends LogicContext<DModel> = any, C extends Context = Context, D extends DModel = DModel> extends LNamedElement {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DModel;\r\n    id!: Pointer<DModel, 1, 1, LModel>;\r\n    // static singleton: LModel;\r\n    // static logic: typeof LModel;\r\n    // static structure: typeof DModel;\r\n\r\n    // inherit redefine\r\n    parent!: LModel[];\r\n    father!: LModel;\r\n    annotations!: LAnnotation[];\r\n    name!: string;\r\n    namespace!: string;\r\n    // personal\r\n    isMetamodel!: boolean;\r\n\r\n    // Metamodel\r\n    packages!: LPackage[];\r\n    models!: LModel[];\r\n\r\n    // Model\r\n    instanceof?: LModel;\r\n    objects!: LObject[];\r\n    roots!: LObject[];\r\n\r\n    // utilities to go down in the tree (plural names)\r\n    enums!: LEnumerator[];\r\n    classes!: LClass[];\r\n    operations!: LOperation[];\r\n    parameters!: LParameter[];\r\n    exceptions!: LClassifier[];\r\n    attributes!: LAttribute[];\r\n    references!: LReference[];\r\n    literals!: LEnumLiteral[];\r\n    allSubAnnotations!: LAnnotation[];\r\n    allSubPackages!: LPackage[];\r\n    allSubObjects!: LObject[];\r\n\r\n    protected generateEcoreJson_impl(context: Context, loopDetectionObj: Dictionary<Pointer, DModelElement> = {}): Json {\r\n        loopDetectionObj[context.data.id] = context.data;\r\n        const json: GObject = {};\r\n\r\n        // if it's M2 metamodel\r\n        if (context.data.isMetamodel) {\r\n            const packageArr: Json[] = [];\r\n            for (let pkg of context.proxyObject.packages) { packageArr.push(pkg.generateEcoreJson(loopDetectionObj)); }\r\n            // return (context.proxyObject.packages[0])?.generateEcoreJson(loopDetectionObj);\r\n            json[ECoreRoot.ecoreEPackage] = packageArr;\r\n            return json;\r\n        }\r\n\r\n        // if it's M1 model\r\n        // let serializeasroot = context.proxyObject.isRoot && loopDetectionObj.length; // if rootobj is nested because you started the serialization from another node, i prevent it generating root content\r\n        for (let obj of context.proxyObject.roots) { json[obj.ecoreRootName] = obj.generateEcoreJson(loopDetectionObj); }\r\n\r\n        return json; }\r\n\r\n    public addPackage(name?: DPackage[\"name\"], uri?: DPackage[\"uri\"], prefix?: DPackage[\"prefix\"]): DPackage { return this.cannotCall(\"addPackage\"); }\r\n    public get_addPackage(context: Context): ((name?: DPackage[\"name\"], uri?: DPackage[\"uri\"], prefix?: DPackage[\"prefix\"]) => DPackage) {\r\n        return (name?: DPackage[\"name\"], uri?: DPackage[\"uri\"], prefix?: DPackage[\"prefix\"]) => DPackage.new(name, uri, prefix, context.data.id, true, DModel); }\r\n\r\n    public addObject(instanceoff?:DObject[\"instanceof\"], name?: DObject[\"name\"]): DObject { return this.cannotCall(\"addObject\"); }\r\n    protected get_addObject(context: Context): this[\"addObject\"] {\r\n        return (instanceoff?:DObject[\"instanceof\"], name?: DObject[\"name\"]) => {\r\n            const dObject = DObject.new(instanceoff, context.data.id, DModel, undefined, true);\r\n            /*\r\n            if(!instanceoff) return dObject;\r\n            let father: LClass|undefined = LClass.fromPointer(instanceoff)?.extends?.[0];\r\n            while(father) {\r\n                for(let lFeature of [...father.attributes, ...father.references])\r\n                    DValue.new(lFeature.name, lFeature.id, undefined, dObject.id);\r\n                father = (father.extends.length > 0) ? father.extends[0] : undefined;\r\n            }\r\n            */\r\n            return dObject;\r\n        }\r\n    }\r\n\r\n    protected get_models(context: Context): LModel[] {\r\n        return LModel.fromPointer(context.data.models);\r\n    }\r\n    protected set_models(val: PackArr<this['models']>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        const oldList = context.data.models;\r\n        const diff = U.arrayDifference(oldList, list);\r\n        BEGIN();\r\n        SetFieldAction.new(context.data, 'models', list, '', true);\r\n        for (let id of diff.added) {\r\n            SetFieldAction.new(id, 'father', context.data.id, '', true);\r\n            SetFieldAction.new(id, 'parent', context.data.id, '+=', true);\r\n        }\r\n        for (let id of diff.removed as Pointer<DModelElement>[]) {\r\n            SetFieldAction.new(id, 'father', undefined, '', true);\r\n            const parent = DPointerTargetable.from(id).parent;\r\n            U.arrayRemoveAll(parent, context.data.id);\r\n            SetFieldAction.new(id, 'parent', parent, '', true);\r\n        }\r\n        END();\r\n        return true;\r\n    }\r\n\r\n    public duplicate(deep: boolean = true): this { throw new Error(\"Model.duplicate(): use export/import ecore instead.\"); }\r\n\r\n    protected set_instanceof(val: Pack1<this[\"instanceof\"]>, context: Context): boolean {\r\n        let ptr = Pointers.from(val);\r\n        SetFieldAction.new(context.data.id, \"instanceof\", ptr, undefined, true);\r\n        // update father's collections (pointedby's here are set automatically)\r\n        // todo: ptr && SetFieldAction.new(ptr, \"instances\", context.data.id, '+=', true);\r\n        return true; }\r\n    protected get_instanceof(context: Context): this[\"instanceof\"] { return context.data.instanceof ? LPointerTargetable.fromPointer(context.data.instanceof) : undefined; }\r\n\r\n    protected set_name(val: this['name'], context: Context): boolean {\r\n        const models: LModel[] = LModel.fromPointer(store.getState()['models']);\r\n        if(models.filter((model) => { return model.name === val }).length > 0) {\r\n            U.alert('error', 'Cannot rename the selected element since this name is already taken.');\r\n        } else {\r\n            SetFieldAction.new(context.data, 'name', val, '', false);\r\n        }\r\n        return true;\r\n    }\r\n    protected get_children_idlist(context: Context): Pointer<DAnnotation | (DPackage|DObject), 1, 'N'> {\r\n        let children: Pointer<(DPackage|DObject), 0, 'N', (LPackage|LObject)>;\r\n        if(context.data.isMetamodel) children = context.data.packages;\r\n        else children = context.data.objects;\r\n        return [...super.get_children_idlist(context) as Pointer<DAnnotation | (DPackage|DObject), 1, 'N'>,\r\n            ...children];\r\n    }\r\n\r\n    protected get_isMetamodel(context: Context): this['isMetamodel'] {\r\n        return context.data.isMetamodel;\r\n    }\r\n    protected set_isMetamodel(val: this['isMetamodel'], context: Context): boolean {\r\n        SetFieldAction.new(context.data, 'isMetamodel', val, '', false);\r\n        return true;\r\n    }\r\n\r\n    protected get_objects(context: Context): this['objects'] {\r\n        return context.data.objects.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n\r\n    protected get_packages(context: Context): this[\"packages\"] {\r\n        return context.data.packages.map((pointer) => {\r\n            return LPointerTargetable.from(pointer)\r\n        });\r\n    }\r\n\r\n    protected set_packages(val: PackArr<this[\"packages\"]>, context: Context): boolean {\r\n        const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        const oldList = context.data.packages;\r\n        const diff = U.arrayDifference(oldList, list);\r\n        BEGIN();\r\n        SetFieldAction.new(context.data, 'packages', list, \"\", true);\r\n        for (let id of diff.added) {\r\n            SetFieldAction.new(id, 'father', context.data.id, '', true);\r\n            SetFieldAction.new(id, 'parent', context.data.id, '+=', true);\r\n        }\r\n        for (let id of diff.removed as Pointer<DModelElement>[]) {\r\n            SetFieldAction.new(id, 'father', undefined, '', true);\r\n            const parent = DPointerTargetable.from(id).parent;\r\n            U.arrayRemoveAll(parent, context.data.id);\r\n            SetFieldAction.new(id, 'parent', parent, '', true);\r\n        }\r\n        END();\r\n        return true;\r\n    }\r\n\r\n    protected get_roots(context: Context): this[\"roots\"] {\r\n        return this.get_objects(context).filter( o => o.isRoot);\r\n    }\r\n    protected get_classes(context: Context): this[\"classes\"] {\r\n        const s: IStore = store.getState();\r\n        return this.get_allSubPackages(context, s).flatMap(p => p.classes || []);\r\n    }\r\n\r\n    protected get_enums(context: Context): this[\"enums\"] {\r\n        return this.get_enumerators(context);\r\n    }\r\n\r\n    protected get_enumerators(context: Context): this[\"enums\"] {\r\n        const s: IStore = store.getState();\r\n        return this.get_allSubPackages(context, s).flatMap(p => (p.enums || []));\r\n    }\r\n\r\n    protected get_allSubPackages(context: Context, state?: IStore): this[\"allSubPackages\"] {\r\n        state = state || store.getState();\r\n        let tocheck: Pointer<DPackage>[] = context.data.packages || [];\r\n        let checked: Dictionary<Pointer, true> = {};\r\n        while (tocheck.length) {\r\n            let newtocheck: Pointer<DPackage>[] = [];\r\n            for (let ptr of tocheck) {\r\n                if (checked[ptr]) throw new Error(\"loop in packages containing themselves\");\r\n                checked[ptr] = true;\r\n                let dpackage: DPackage = DPointerTargetable.from(ptr, state);\r\n                U.arrayMergeInPlace(newtocheck, dpackage?.subpackages);\r\n            }\r\n            tocheck = newtocheck;\r\n        }\r\n        return LPointerTargetable.from(Object.keys(checked), state);\r\n    }\r\n    protected get_allSubObjects(context: Context, state?: IStore): this[\"allSubObjects\"] {\r\n        state = state || store.getState();\r\n        return (Selectors.getAll(DObject, undefined, state, true, true) as LObject[]).filter( (o: LObject) => o.model.id === context.data.id);\r\n        /*\r\n        let tocheck: Pointer<DObject>[] = context.data.objects || [];\r\n        let checked: Dictionary<DObject, true> = {};\r\n        while (tocheck.length) {\r\n            let newtocheck: Pointer<DObject>[] = [];\r\n            for (let ptr of tocheck) {\r\n                if (checked[ptr]) throw new Error(\"loop in packages containing themselves\");\r\n                checked[ptr] = true;\r\n                let dpackage: DObject = DPointerTargetable.from(ptr, state);\r\n                U.arrayMergeInPlace(newtocheck, dpackage?.values.... it's a mess, filter subobjects here);\r\n            }\r\n            tocheck = newtocheck;\r\n        }\r\n        return LPointerTargetable.from(Object.keys(checked), state);*/\r\n    }\r\n\r\n    protected get_delete(context: Context): () => void {\r\n        const ret = () => { U.alert('error', 'In this version of the tool models cannot be deleted.'); }\r\n        return ret;\r\n    }\r\n\r\n    public getClassByNameSpace(namespacedclass: string): LClass | undefined { return this.cannotCall(\"getClassByNameSpace\"); }\r\n    protected get_getClassByNameSpace(context: Context): this[\"getClassByNameSpace\"] {\r\n        return (namespacedclass: string): LClass | undefined => {\r\n            let pos = namespacedclass.lastIndexOf(\":\");\r\n            let pkguri = namespacedclass.substring(0, pos);\r\n            let classname = namespacedclass.substring(pos+1);\r\n            let pkg: LPackage | undefined = this.get_getPackageByUri(context)(pkguri);\r\n            if (!pkg) return undefined;\r\n            // return pkg[\"@\" + classname];\r\n            return pkg.classes.filter((c) => c.name === classname)[0];\r\n        }; }\r\n    public getPackageByUri(uri: string): LPackage | undefined { return this.cannotCall(\"getPackageByUri\"); }\r\n    protected get_getPackageByUri(context: Context): this[\"getPackageByUri\"] {\r\n        return (uri: string)=>context.proxyObject.allSubPackages.filter((p)=>p.uri === uri)[0]; }\r\n\r\n}\r\nDNamedElement.subclasses.push(DModel);\r\nLNamedElement.subclasses.push(LModel);\r\n\r\n\r\n@RuntimeAccessible\r\nexport abstract class DFactory_useless_ extends DPointerTargetable { // DModelElement\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LFactory_useless_;\r\n    // static logic: typeof LFactory_useless_;\r\n    // static structure: typeof DFactory_useless_;\r\n\r\n    // inherit redefine\r\n    id!: Pointer<DFactory_useless_, 1, 1, LFactory_useless_>;\r\n    parent: Pointer<DModelElement, 0, 'N', LModelElement> = [];\r\n    father!: Pointer<DModelElement, 1, 1, LModelElement>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    // personal\r\n    ePackage: Pointer<DPackage, 1, 1, LPackage> = '';\r\n    abstract create(DClass: DClass): DObject;\r\n    abstract createFromString(eDataType: DDataType, literalValue: string): EJavaObject;\r\n    abstract convertFromString(eDataType: DDataType, instanceValue: EJavaObject): string;\r\n    // ********************** my additions inherited ********************* //\r\n    // ********************** my additions personal ********************** //\r\n}\r\n@RuntimeAccessible\r\nexport abstract class LFactory_useless_<Context extends LogicContext<DFactory_useless_> = any, C extends Context = Context>  extends LModelElement {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DFactory_useless_;\r\n    id!: Pointer<DFactory_useless_, 1, 1, LFactory_useless_>;\r\n    // static singleton: LFactory_useless_;\r\n    // static logic: typeof LFactory_useless_;\r\n    // static structure: typeof DFactory_useless_;\r\n\r\n    // inherit redefine\r\n    parent!: LModelElement[];\r\n    father!: LModelElement;\r\n    annotations!: LAnnotation[];\r\n    // personal\r\n    ePackage!: LPackage;\r\n    abstract create(DClass: DClass): DObject;\r\n    abstract createFromString(eDataType: DDataType, literalValue: string): EJavaObject;\r\n    abstract convertFromString(eDataType: DDataType, instanceValue: EJavaObject): string;\r\n    // ********************** my additions inherited ********************* //\r\n    // ********************** my additions personal ********************** //\r\n}\r\n\r\n// DModelElement.subclasses.push('DFactory_useless_'); // because it's abstract and cannot be used as a value, it's pure type definition\r\n// DModelElement.subclasses.push('LFactory_useless_'); // because it's abstract and cannot be used as a value, it's pure type definition\r\n\r\n@RuntimeAccessible\r\nexport class EJavaObject{\r\n\r\n}// ??? EDataType instance?\r\n\r\n\r\n@RuntimeAccessible\r\nexport class DMap extends Object { // DPointerTargetable\r\n    // static logic: typeof LModelElement;\r\n    // static structure: typeof DModelElement;\r\n    // static singleton: LModelElement;\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    __isDMap!: true;\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    // id!: Pointer<DModelElement, 1, 1, LModelElement>;\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LMap<Context extends LogicContext<DMap> = any, C extends Context = Context>  extends LPointerTargetable {\r\n    // static logic: typeof LModelElement;\r\n    // static structure: typeof DModelElement;\r\n    // static singleton: LModelElement;\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    __isLMap!: true;\r\n    // id!: Pointer<DModelElement, 1, 1, LModelElement>;\r\n}\r\nDPointerTargetable.subclasses.push(DMap as any);\r\nLPointerTargetable.subclasses.push(LMap);\r\n\r\n@RuntimeAccessible\r\nexport class DObject extends DPointerTargetable { // extends DNamedElement, m1 class instance\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n\r\n    // inherit redefine\r\n    annotations!: never[];\r\n    id!: Pointer<DObject, 1, 1, LObject>;\r\n    parent: Pointer<DModel | DValue, 0, 'N', LModel | LValue> = [];\r\n    father!: Pointer<DModel, 1, 1, LModel> |  Pointer<DValue, 1, 1, LValue>;\r\n    // annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    name!: string;\r\n\r\n    // personal\r\n    instanceof!: Pointer<DClass, 0, 1, LClass>;\r\n    features: Pointer<DValue, 0, 'N', LValue> = [];\r\n\r\n\r\n    public static new(instanceoff?: DObject[\"instanceof\"], father?: DObject[\"father\"], fatherType?: typeof DModel | typeof DValue, name?: DNamedElement[\"name\"], persist: boolean = true): DObject {\r\n        // if (!name) name = this.defaultname(((meta: LNamedElement) => meta.name + \" \"), father);\r\n        if (!name) name = this.defaultname(((meta: LNamedElement) => (meta?.name || \"obj\") + \"_\"), father, instanceoff);\r\n        let ret = new Constructors(new DObject('dwc'), father, persist, fatherType).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name).DObject(instanceoff).end();\r\n        return ret;\r\n    }\r\n\r\n\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LObject<Context extends LogicContext<DObject> = any, C extends Context = Context, D extends DObject = DObject> extends LNamedElement { // extends DNamedElement, m1 class instance\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DObject;\r\n    id!: Pointer<DObject, 1, 1, LObject>;\r\n\r\n    // inherit redefine\r\n    annotations!: never[];\r\n    children!: LValue[];\r\n    allchildren!: LValue[]; // including hidden values\r\n    truechildren!: LValue[]; // real shape without \"mirage\" values\r\n    parent!: (LModel | LValue)[];\r\n    father!: LModel | LValue;\r\n    model!: LModel;\r\n    // annotations!: LAnnotation[];\r\n    // from LClass\r\n\r\n    name!: string;\r\n    ecoreRootName!: string;\r\n    namespace!: string;\r\n    fullname!:string;\r\n    defaultValue!: DClass[\"defaultValue\"];\r\n    // abstract!: boolean;\r\n    // interface!: boolean;\r\n    // references!: LReference[];\r\n    // attributes!: LAttribute[];\r\n    // operations!: LOperation[];\r\n\r\n    // personal\r\n    deepSubObjects!: LObject[]; // todo: itera features (lvalue[]) deep e vitando di inserire doppioni (salva una mappatura di di già aggiunti e skip se ricompaiono)\r\n    subObjects!: LObject[];\r\n    referenceFeatures!: LValue[]; // subset of features that are references.\r\n    attributeFeatures!: LValue[]; // subset of features that are attributes.\r\n    shapelessFeatures!: LValue[]; // subset of features that are not mapped and can have any kind of values.\r\n    // + tutte le funzioni di comodità navigazionale del modello, trattarlo un pò come se fosse un modello (e quasi può esserlo)\r\n    instanceof!: LClass;\r\n    features!: LValue[];\r\n    referencedBy!: LObject[];\r\n    isRoot!: boolean;\r\n    readonly partial!: boolean;\r\n\r\n    protected get_truechildren(context: Context): this[\"children\"] {\r\n        let childs: LValue[] = super.get_children(context);\r\n        if (!context.data.instanceof) return childs;\r\n        return childs.filter( (c) => !c.isMirage);\r\n    }\r\n\r\n    protected get_allchildren(context: Context): this[\"children\"] { return super.get_children(context); }\r\n\r\n    protected get_children(context: Context, sort: boolean = true): this[\"children\"] {\r\n        let childs: LValue[] = super.get_children(context);\r\n        let meta: LClass = context.proxyObject.instanceof;\r\n        // if (!sort && (!meta || meta.partial)) return childs;\r\n        let conformchildren: undefined | Pointer[] = meta && !meta.partial ? meta.allChildren.map(c => c.id) : undefined;\r\n        if (!sort) {\r\n            // console.log(\"return get features:\", {context, meta, childs, conformchildren, ret:childs.filter((c) => (c.instanceof?.id) && conformchildren!.includes(c.instanceof?.id))});\r\n            if (!conformchildren) return childs;\r\n            return childs.filter((c) => (c.instanceof?.id) && conformchildren!.includes(c.instanceof?.id));\r\n        }\r\n\r\n        let bymetaparent: Dictionary<DocString<\"metaparent pointer\">, LValue[]> = {};\r\n        for (let v of childs) {\r\n            let vmeta = v.instanceof;\r\n            // console.log(\"get features filtering:\", {context, meta, vmeta, v, childs, conformchildren});\r\n\r\n            if (conformchildren && (!vmeta || !conformchildren.includes(vmeta.id))) continue;\r\n            let vmetaid: string = vmeta?.id as string; // undef as key is fine even if compiler complains, so i cast it\r\n            if (!bymetaparent[vmetaid]) bymetaparent[vmetaid] = [v]; else bymetaparent[vmetaid as any].push(v);\r\n        }\r\n        // console.log(\"return get features:\", {context, meta, childs, conformchildren, ret:Object.values(bymetaparent).flat()});\r\n        return Object.values(bymetaparent).flat();\r\n    }\r\n\r\n\r\n    // protected get_fromlclass<T extends keyof (LClass)>(meta: LClass, key: T): LClass[T] { return meta[key]; }\r\n    protected get_model(context: Context): LModelElement[\"model\"] {\r\n        let l: LValue | LObject | LModel = context.proxyObject;\r\n        while (l && l.className !== DModel.name) l = l.father;\r\n        return l as LModel; }\r\n    // protected set_name(val: string, context: Context): boolean { return this.cannotSet(\"name\"); }\r\n    protected get_name(context: Context): LClass[\"name\"] { return context.data.name || context.proxyObject.instanceof.name; }\r\n    protected set_namespace(val: string, context: Context): boolean { return this.cannotSet(\"namespace\"); }\r\n    // protected get_namespace(context: Context): LClass[\"namespace\"] { return context.proxyObject.instanceof.namespace; }\r\n    protected set_fullname(val: string, context: Context): boolean { return this.cannotSet(\"fullname\"); }\r\n    protected get_fullname(context: Context): LClass[\"fullname\"] { return context.proxyObject.instanceof.fullname; }\r\n    protected set_ecoreRootName(val: string, context: Context): boolean { return this.cannotSet(\"ecoreRootName\"); }\r\n    protected get_ecoreRootName(context: Context): LObject[\"ecoreRootName\"] {\r\n        let instanceoff: LClass = context.proxyObject.instanceof;\r\n        if (!instanceoff) return \"schemaless:Object\";\r\n        return this.get_uri(context) + \":\" + instanceoff.name; // optimize later in instanceoff.namespace + \":\" + instanceoff.name; and implement namespace all around\r\n    }\r\n    protected set_partialdefaultname(val: DClass[\"partialdefaultname\"], context: Context): boolean { return this.cannotSet(\"DObject.partialdefaultname()\"); }\r\n    protected get_partialdefaultname(context: Context): DClass[\"partialdefaultname\"] { return context.data.instanceof ? context.proxyObject.instanceof.partialdefaultname : \"val_\"; }\r\n    protected set_partial(val: DClass[\"partial\"], context: Context): boolean { return this.cannotSet(\"DObject.set_partial()\"); }\r\n    protected get_partial(context: Context): DClass[\"partial\"] { return context.data.instanceof ? context.proxyObject.instanceof?.partial : true; }\r\n\r\n    /*    protected set_abstract(val: string, context: Context): boolean { return this.cannotSet(\"abstract\"); }\r\n        protected get_abstract(context: Context): LClass[\"abstract\"] { return context.proxyObject.instanceof.abstract; }\r\n        protected set_interface(val: string, context: Context): boolean { return this.cannotSet(\"interface\"); }\r\n        protected get_interface(context: Context): LClass[\"interface\"] { return context.proxyObject.instanceof.interface; }*/\r\n    protected set_defaultValue(val: string, context: Context): boolean { return this.cannotSet(\"defaultValue\"); }\r\n    protected get_defaultValue(context: Context): LClass[\"defaultValue\"] { return context.proxyObject.instanceof.defaultValue; }\r\n    protected set_referencedBy(val: string, context: Context): boolean { return this.wrongAccessMessage(\"referencedBy cannot be set directly. It should be updated automatically as side effect\"); }\r\n    protected get_referencedBy(context: Context): LObject[\"referencedBy\"] {\r\n        let state: IStore = store.getState();\r\n        let targeting: LObject[] = LPointerTargetable.fromArr(context.data.pointedBy.map( p => {\r\n            let s: GObject = state;\r\n            for (let key of PointedBy.getPathArr(p)) {\r\n                s = s[key];\r\n                if (!s) return null;\r\n                if (s.className === DObject.name) return s.id;\r\n            }\r\n        }));\r\n        return targeting; }\r\n\r\n    protected get_subObjects(context: Context): this[\"subObjects\"] {\r\n        let ref_features: LValue[] = this.get_referenceFeatures(context, false).filter( (f) => (f.instanceof as LReference)!.containment );\r\n        let shapeless_features: LValue[] = this.get_shapelessFeatures(context);\r\n        let vals: LObject[] = [\r\n            ...ref_features.flatMap((f) => (f.values as LObject[])).filter((val)=>!!val),\r\n            ...shapeless_features.flatMap((f) => (f.values as any))\r\n                .filter((val)=>(!!val && val.className === DObject.name)) as LObject[]\r\n        ];\r\n        return vals;\r\n    }\r\n\r\n    protected get_deepSubObjects(context: Context): this[\"deepSubObjects\"] {\r\n        let alreadyparsed: Dictionary<Pointer, LObject> = {};\r\n        let arr: LObject[] = this.get_subObjects(context);\r\n        while(arr.length) {\r\n            let next: LObject[] = [];\r\n            for (let obj of arr) {\r\n                if (alreadyparsed[obj.id]) continue;\r\n                alreadyparsed[obj.id] = obj;\r\n                next.push(...obj.subObjects);\r\n            }\r\n            arr = next;\r\n        }\r\n        return Object.values(alreadyparsed) || [];\r\n    }\r\n\r\n    protected get_referenceFeatures(context: Context, includeshapeless: boolean = false): this[\"referenceFeatures\"] {\r\n        return context.proxyObject.features.filter((f) => (!f.instanceof ? includeshapeless : f.instanceof.className === DReference.name));\r\n    }\r\n    protected get_attributeFeatures(context: Context, includeshapeless: boolean = false): this[\"attributeFeatures\"] {\r\n        return context.proxyObject.features.filter((f) => (!f.instanceof ? includeshapeless : f.instanceof.className === DAttribute.name));\r\n    }\r\n\r\n    protected get_shapelessFeatures(context: Context): this[\"shapelessFeatures\"] {\r\n        return context.proxyObject.features.filter((f) => (!f.instanceof));\r\n    }\r\n\r\n    protected get_isRoot(context: Context): LObject[\"isRoot\"] { return context.proxyObject.father.className === DModel.name; }\r\n    protected set_isRoot(val: never, context: Context): boolean { return this.wrongAccessMessage(\"isRoot cannot be set directly, change father element instead.\"); }\r\n\r\n    public feature(name: string): (PrimitiveType|LObject)|(PrimitiveType|LObject)[] { this.cannotCall('feature'); return null; }\r\n    private get_feature(context: Context): (name: string) => LValue[\"value\"] | LValue[\"values\"] {\r\n        return (name: string) => {\r\n            const lObject = context.proxyObject;\r\n            const features = lObject.features.filter((value) => {\r\n                return value.instanceof?.name === name\r\n            });\r\n            if(features.length > 0) {\r\n                const matchedFeature = features[0];\r\n                switch(matchedFeature.values.length) {\r\n                    case 0: return '';\r\n                    case 1: return matchedFeature.value;\r\n                    default: return matchedFeature.values;\r\n                }\r\n            } return '';\r\n        }\r\n    }\r\n\r\n    public addValue(name?: DValue[\"name\"], instanceoff?: DValue[\"instanceof\"], value?: DValue[\"values\"], isMirage?: boolean): DValue { return this.cannotCall(\"addValue\"); }\r\n\r\n    protected generateEcoreJson_impl(context: Context, loopDetectionObj: Dictionary<Pointer, DModelElement> = {}): Json {\r\n        loopDetectionObj[context.data.id] = context.data;\r\n        let asEcoreRoot = (context.proxyObject.isRoot);\r\n        // todo: actually use this loopdetectionobj\r\n        const json: GObject = {};\r\n        if (asEcoreRoot) {\r\n            console.log(\"generate object ecore\", {context, asEcoreRoot, json});\r\n            const lc: LClass = context.proxyObject.instanceof;\r\n            json[ECorePackage.xmiversion] = '2.0';\r\n            json[ECorePackage.xmlnsxmi] = 'http://www.omg.org/XMI';\r\n            // json[ECorePackage.xmlnsxsi] = 'http://www.w3.org/2001/XMLSchema-instance';\r\n            json[\"xmlns:\" + ( lc ? (lc.father.uri + \".\" +lc.father.name) : \"shapeless.model.uri\")] = 'http://www.eclipse.org/emf/2002/Ecore';\r\n        }\r\n\r\n        let features = context.proxyObject.features || [];\r\n        console.log(\"features\", {features});\r\n        for (let f of features){\r\n            json[f.name] = f.generateEcoreJson(loopDetectionObj);\r\n        }\r\n\r\n\r\n        return json; }\r\n    protected get_addValue(context: Context): this[\"addValue\"] {\r\n        return (name?: DValue[\"name\"], instanceoff?: DValue[\"instanceof\"], value?: DValue[\"values\"], isMirage?: boolean) => DValue.new(name, instanceoff, value, context.data.id, true, isMirage); }\r\n\r\n    protected get_namespace(context: Context): string {\r\n        return context.data.instanceof ? context.proxyObject.instanceof.father.prefix : \"schemaless\"; }\r\n    protected get_uri(context: Context): string {\r\n        if (!context.data.instanceof) return \"schemaless\";\r\n        let pkg = context.proxyObject.instanceof.father;\r\n        return pkg.uri;// + \".\" + pkg.name;\r\n    }\r\n    // protected get_namespace(context: Context): string { if (!context.data.instanceof) return \"schemaless\"; return context.proxyObject.instanceof.namespace; }\r\n\r\n    protected get_children_idlist(context: Context): Pointer<DAnnotation | DValue, 1, 'N'> {\r\n        return [...super.get_children_idlist(context) as Pointer<DAnnotation | DValue, 1, 'N'>,\r\n            ...context.data.features];\r\n    }\r\n\r\n    protected get_instanceof(context: Context): this[\"instanceof\"] {\r\n        const pointer = context.data.instanceof;\r\n        return LPointerTargetable.from(pointer)\r\n    }\r\n    protected set_instanceof(val: Pack1<this[\"instanceof\"]>, context: Context): boolean {\r\n        const metaptr: D[\"instanceof\"] = Pointers.from(val);\r\n        this._removeConformity(context);\r\n        SetFieldAction.new(context.data.id, \"instanceof\", metaptr, undefined, true);\r\n        // update father's collections (pointedby's here are set automatically)\r\n        metaptr && SetFieldAction.new(metaptr as Pointer<DClass>, \"instances\", context.data.id, '+=', true);\r\n        if (metaptr) this._forceConformity(context, metaptr);\r\n        return true;\r\n    }\r\n\r\n    private forceConformity(context: Context, meta: D[\"instanceof\"]): void {\r\n        let oldinstanceof = context.data.instanceof;\r\n        // context.data.instanceof = meta;\r\n        let ret = this._forceConformity(context, meta);\r\n        // context.data.instanceof = oldinstanceof;\r\n        return ret;\r\n    }\r\n    private _forceConformity(context: Context, meta: D[\"instanceof\"]): void {\r\n        let lmeta = meta && LPointerTargetable.wrap(meta) as this[\"instanceof\"];\r\n        if (!lmeta) return;\r\n        let attrs = lmeta.allAttributes;\r\n        let refs = lmeta.allReferences;\r\n        let values = context.proxyObject.allchildren;\r\n        let idmap: Dictionary<string, LAttribute | LReference> = {};\r\n        for (let a of attrs) { idmap[a.id] = a; }\r\n        for (let a of refs) { idmap[a.id] = a; }\r\n        console.log({values, data: context.data, l:context.proxyObject});\r\n        // damiano: todo quando viene cancellato una feature il puntatore in features e values rimane. use pointedby's\r\n        // then remove \"v &&\" \"filter in if\r\n        for (let v of values) { if(v && v.__raw.instanceof) delete idmap[v.__raw.instanceof]; }\r\n        console.log(\"forceconformity\", {attrs, refs, values: values.map(v=> v && v.__raw.instanceof), idmap});\r\n        for (let id in idmap) {\r\n            // let l = idmap[id];\r\n            context.proxyObject.addValue(undefined, id, [],true);\r\n        }\r\n    }\r\n    private _removeConformity(context: Context): void {\r\n        let childs = context.proxyObject.features;\r\n        for (let child of childs) if (child.isMirage) child.delete();\r\n    }\r\n\r\n    protected get_features(context: Context): this['features'] {\r\n        return this.get_children(context);\r\n        // return context.data.features.map((feature) => { return LPointerTargetable.from(feature) });\r\n    }\r\n\r\n    protected get_delete(context: Context): () => void {\r\n        const data = context.proxyObject;\r\n        const ret = () => {\r\n            const pointedBy = U.filteredPointedBy(data, 'values');\r\n            for(let me of pointedBy) {\r\n                if (me) {\r\n                    const lValue = me as LValue;\r\n                    const dFather = lValue.father.__raw as DObject;\r\n                    SetFieldAction.new(lValue.__raw, 'values', dFather.features.indexOf(data.id as string), '-=', true);\r\n                }\r\n            }\r\n            const me = data.instanceof;\r\n            SetFieldAction.new(me.__raw, 'instances', me.__raw.instances.indexOf(data.id), '-=', true);\r\n            data.superDelete();\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public ecorePointer(): string { return this.cannotCall(\"ecorePointer\"); }\r\n    protected get_ecorePointer(context: Context): () => string {\r\n        let lastvisited: Pointer<DObject, 1, 1, LObject> = context.data.id;\r\n        return () => \"@//\" + this.get_fatherList(context).map( (f: LModelElement | LObject | LValue) => {\r\n            if (f.className === DObject.name) { lastvisited = (f as LObject).id; return ''; }\r\n            if (f.className === DModel.name) { return ''; }\r\n            console.log(\"get_ecorepointer\", f, f.__raw, lastvisited);\r\n            return (f as LValue).name + \".\" + ((f as LValue).__raw.values.indexOf(lastvisited));\r\n        }).filter(v=>!!v).join(\"@/\");\r\n    }\r\n\r\n}\r\nDNamedElement.subclasses.push(DObject);\r\nLNamedElement.subclasses.push(LObject);\r\n\r\n@RuntimeAccessible\r\nexport class DValue extends DModelElement { // extends DModelElement, m1 value (attribute | reference)\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LValue;\r\n    // static logic: typeof LModelElement;\r\n    // static structure: typeof DValue;\r\n\r\n    // inherit redefine\r\n    id!: Pointer<DValue, 1, 1, LValue>;\r\n    parent: Pointer<DObject, 0, 'N', LObject> = [];\r\n    father!: Pointer<DObject, 1, 1, LObject>;\r\n    annotations: Pointer<DAnnotation, 0, 'N', LAnnotation> = [];\r\n    name?: string; // nome opzionale solo per modelli schema-less\r\n\r\n    // personal\r\n    // value: PrimitiveType | Pointer<DObject, 1, 1, LObject>; // vv4\r\n    // values: PrimitiveType[] | Pointer<DObject, 1, 'N', LObject> | Pointer<DEnumLiteral, 1, 'N', LEnumLiteral> = []; // vv4\r\n    values: PrimitiveType[] | Pointer<DObject|DEnumLiteral, 1, 'N', LObject|LEnumLiteral> = [];\r\n    instanceof!: Pointer<DAttribute, 1, 1, LAttribute > | Pointer<DReference, 1, 1, LReference> | undefined; // todo: maybe min lowerbound 0 if you want to allow free shape objects chiedere prof\r\n    edges!: Pointer<DEdge, 0, 'N', LEdge>;\r\n    // conformsTo!: Pointer<DStructuralFeature, 0, 'N', LStructuralFeature>; // low priority to do: attributo fittizio controlla a quali elementi m2 è conforme quando viene richiesto\r\n    isMirage!: boolean;\r\n\r\n    public static new(name?: DNamedElement[\"name\"], instanceoff?: DValue[\"instanceof\"], val?: DValue[\"values\"],\r\n                      father?: DValue[\"father\"] | DObject, persist: boolean = true, isMirage: boolean = false): DValue {\r\n        if (!name) name = this.defaultname(\"property_\", father);\r\n        return new Constructors(new DValue('dwc'), (typeof father === \"string\" ? father : (father as DObject)?.id), persist, undefined).DPointerTargetable().DModelElement()\r\n            .DNamedElement(name)\r\n            .DValue(instanceoff, val, isMirage).end();\r\n    }\r\n}\r\n@RuntimeAccessible\r\nexport class LValue<Context extends LogicContext<DValue> = any, C extends Context = Context, D extends DValue = DValue> extends LModelElement { // extends DModelElement, m1 value (attribute | reference)\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    public __raw!: DValue;\r\n    id!: Pointer<DValue, 1, 1, LValue>;\r\n\r\n    // inherit redefine\r\n    parent!: (LObject | LModel)[];\r\n    father!: LObject | LModel;\r\n    model!: LModel;\r\n    // from namedelement\r\n    name!: string;\r\n    namespace!: string;\r\n    fullname!:string;\r\n    type!: LClassifier; // Classifiers describing PrimitiveTypes or the classes that can be pointed.\r\n    primitiveType!: LClass;\r\n    classType!: LClass;\r\n    enumType!: LEnumerator;\r\n// from structuralfeature (ref + attr)\r\n    ordered!: boolean;\r\n    unique!: boolean;\r\n    lowerBound!: number;\r\n    upperBound!: number;\r\n    many!: boolean;\r\n    required!: boolean;\r\n\r\n    changeable!: boolean;\r\n    volatile!: boolean;\r\n    transient!: boolean;\r\n    unsettable!: boolean;\r\n    derived!: boolean;\r\n    defaultValue!: DStructuralFeature[\"defaultValue\"];\r\n    // defaultValueLiteral!: string;\r\n// from reference\r\n    containment!: boolean;\r\n    container!: boolean;\r\n    // resolveProxies!: boolean;\r\n    opposite?: LValue; // if DRef have opposite DRef, when you set a value ref you also set a opposite value ref from target to this src. they are always mirroring.\r\n    // target!: LClass[]; is value[]\r\n    edges!: LEdge[];\r\n\r\n\r\n    // personal\r\n    value!: PrimitiveType | LObject | LEnumLiteral;\r\n    isMirage!: boolean;\r\n    // value!: PrimitiveType | LObject;\r\n    values!: PrimitiveType[] | LObject[] | LEnumLiteral[];\r\n    instanceof!: LAttribute | LReference | undefined;\r\n    conformsTo!:( LAttribute | LReference)[]; // low priority to do: attributo fittizio controlla a quali elementi m2 è conforme quando viene richiesto\r\n\r\n    protected get_edges(context: Context): this[\"edges\"] { return LPointerTargetable.fromPointer(context.data.edges) || []; }\r\n    protected get_fromlfeature<C, T extends keyof (NonNullable<C>)>(meta: C, key: T): NonNullable<C>[T] { return meta ? (meta as any)[key] : undefined; }\r\n    protected get_opposite(context: Context): LReference[\"opposite\"] { return this.get_fromlfeature(context.proxyObject.instanceof as LReference, \"opposite\"); }\r\n    protected get_container(context: Context): LReference[\"container\"] { return this.get_fromlfeature(context.proxyObject.instanceof as LReference, \"container\"); }\r\n    protected get_containment(context: Context): LReference[\"containment\"] {\r\n        let iof = context.proxyObject.instanceof;\r\n        if (!iof) return true; // shapeless\r\n        return this.get_fromlfeature(iof as LReference, \"containment\"); }\r\n    // protected get_defaultValueLiteral(context: Context): LStructuralFeature[\"defaultValueLiteral\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"defaultValueLiteral\"); }\r\n    protected get_defaultValue(context: Context): LStructuralFeature[\"defaultValue\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"defaultValue\"); }\r\n    protected get_defaultderived(context: Context): LStructuralFeature[\"derived\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"derived\"); }\r\n    protected get_defaultunsettable(context: Context): LStructuralFeature[\"unsettable\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"unsettable\"); }\r\n    protected get_defaulttransient(context: Context): LStructuralFeature[\"transient\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"transient\"); }\r\n    protected get_volatile(context: Context): LStructuralFeature[\"volatile\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"volatile\"); }\r\n    protected get_changeable(context: Context): LStructuralFeature[\"changeable\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"changeable\"); }\r\n    protected get_required(context: Context): LStructuralFeature[\"required\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"required\"); }\r\n    protected get_unique(context: Context): LStructuralFeature[\"unique\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"unique\"); }\r\n    protected get_many(context: Context): LStructuralFeature[\"many\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"many\"); }\r\n    protected get_upperBound(context: Context): LStructuralFeature[\"upperBound\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"upperBound\"); }\r\n    protected get_lowerBound(context: Context): LStructuralFeature[\"lowerBound\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"lowerBound\"); }\r\n    protected get_ordered(context: Context): LStructuralFeature[\"ordered\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"ordered\"); }\r\n    protected get_enumType(context: Context): LStructuralFeature[\"enumType\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"enumType\"); }\r\n    protected get_classType(context: Context): LStructuralFeature[\"classType\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"classType\"); }\r\n    protected get_primitiveType(context: Context): LStructuralFeature[\"primitiveType\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"primitiveType\"); }\r\n    protected get_type(context: Context): LStructuralFeature[\"type\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"type\"); }\r\n    protected get_fullname(context: Context): LStructuralFeature[\"fullname\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"fullname\"); }\r\n    protected get_namespace(context: Context): LStructuralFeature[\"namespace\"] { return this.get_fromlfeature(context.proxyObject.instanceof, \"namespace\"); }\r\n    protected get_name(context: Context): LStructuralFeature[\"name\"] { return context.data.instanceof ? this.get_fromlfeature(context.proxyObject.instanceof, \"name\") : context.data.name || ''; }\r\n\r\n    protected get_instanceof(context: Context): this[\"instanceof\"] {\r\n        const pointer = context.data.instanceof;\r\n        if (!pointer) return undefined;\r\n        return LPointerTargetable.from(pointer)\r\n    }\r\n    protected set_instanceof(val: Pack1<this[\"instanceof\"]>, context: Context): boolean {\r\n        // const list = val.map((lItem) => { return Pointers.from(lItem) });\r\n        let ptr = Pointers.from(val);\r\n        SetFieldAction.new(context.data, 'instanceof', ptr, \"\", true);\r\n        return true;\r\n    }\r\n\r\n    protected get_isMirage(context: Context): this[\"isMirage\"] { return context.data.isMirage; }\r\n    protected set_isMirage(val: this[\"isMirage\"], context: Context): boolean { SetFieldAction.new(context.data, 'isMirage', val, \"\", false); return true; }\r\n\r\n    // individual value getters\r\n    protected get_value<T extends boolean>(context: Context, namedPointers: boolean = false, ecorePointers: boolean = false,\r\n                                           shapeless: boolean = false, keepempties: boolean = true, withmetainfo: T = false as T): T extends true ? ValueDetail : this[\"value\"]{\r\n        return this.get_values(context, true, namedPointers, ecorePointers, shapeless, keepempties, withmetainfo, 1)[0] as any;\r\n    }\r\n    public getValue<T extends boolean>(namedPointers: boolean = false, ecorePointers: boolean = false, shapeless: boolean = false, keepempties: boolean = true,\r\n                                       withmetainfo: T = false as T): T extends true ? ValueDetail : this[\"value\"]{ return this.cannotCall(\"getValue\"); }\r\n    protected get_getValue(context: Context): this[\"getValue\"] {\r\n        return function (namedPointers: boolean = false, ecorePointers: boolean = false, shapeless: boolean = false,\r\n                         keepempties: boolean = true, withmetainfo: boolean = false) {\r\n            return LValue.prototype.get_value(context, namedPointers, ecorePointers, shapeless, keepempties, withmetainfo) as any;\r\n        }\r\n    }\r\n\r\n    // multiple value getters\r\n    protected get_values<T extends boolean>(context: Context, fitSize: boolean = true, namedPointers: boolean = false, ecorePointers: boolean = false,\r\n                                            shapeless: boolean = false, keepempties: boolean = true, withmetainfo?: T, maxlimit?: number)\r\n        : (T extends undefined ? this[\"values\"] : T extends false ? this[\"values\"] : ValueDetail[]) & {type?: string}  {\r\n\r\n        let ret: any[] = [...context.data.values] as [];\r\n        let meta: LAttribute | LReference | undefined = shapeless ? undefined : context.proxyObject.instanceof;\r\n        let dmeta: undefined | DAttribute | DReference = meta?.__raw;\r\n\r\n        // if (meta && meta.className === DReference.name) ret = LPointerTargetable.fromArr(ret as DObject[]);\r\n        let typestr: string = meta ? meta.typeToShortString() : \"shapeless\";\r\n        if (!Array.isArray(ret)) ret = [];\r\n        if (dmeta && fitSize && ret.length < dmeta.lowerBound && dmeta.lowerBound > 0) {\r\n            let times = dmeta.lowerBound - ret.length;\r\n            while (times-- > 0) ret.push(undefined);\r\n            // ret.length = meta.lowerBound; not really working for expanding, it says \"emptyx10\" or so. doing .map() only iterates \"existing\" elements. behaves like as it's smaller.\r\n        }\r\n        if (maxlimit !== undefined) ret.length = maxlimit;\r\n        else if (dmeta && fitSize && ret.length > dmeta.upperBound && dmeta.upperBound >= 0) ret.length = dmeta.upperBound;\r\n\r\n        // console.log(\"get_values sizefixed\", {fitSize, arguments, upperbound:dmeta?.upperBound, lowerbound: dmeta?.lowerBound, len: ret.length, len0: context.data.values.length});\r\n        let numbermax = 0, numbermin = 0, round = true;\r\n        // ret is always an array of raw values before this point, eventually padded with lowerbound or trimmed at upperbound\r\n\r\n        let index = 0;\r\n        if (withmetainfo) { ret = ret.map(r => {return {value:r, rawValue: r, index: index++, hidden: false} as ValueDetail}); }\r\n        let mapperfunc: (a:any)=>any = undefined as any;\r\n        let numbercasting = (v: any): number => {\r\n            if (typeof v !== \"number\") {\r\n                if (!v) v = 0;\r\n                else if (v === \"true\") v = 1;\r\n                else if (v.constructor?.name=== \"Date\") v = v.getTime();\r\n                else if (typeof v === \"string\") {\r\n                    console.log(\"number casting:\", v,  U.getFirstNumber(v+'', true), {numbermax, numbermin});\r\n                    v = U.getFirstNumber(v+'', !round);\r\n                } else return NaN;\r\n            }\r\n            v = Math.min(numbermax, Math.max(numbermin, v));\r\n            return round ? Math.round(v) : v;\r\n        };\r\n        switch (typestr) {\r\n            case \"shapeless\":\r\n                let state: IStore = store.getState();\r\n                mapperfunc = (val: any) => {\r\n                    if (!val || typeof val !== \"string\") return val;\r\n                    let l: any = LPointerTargetable.fromPointer(val, state);\r\n                    if (!l) return val;\r\n                    if (l.className === DEnumLiteral.name) { l = (l as DEnumLiteral).literal; } else\r\n                    if (namedPointers) { l = (l.name ? (\"@\" + l.name) : (l as GObject)[\"@\"+l.name]?.__raw?.values?.[0] || (\"#\" + l.className));}\r\n                    else if (ecorePointers){ l = l.ecorePointer(); }\r\n                    return l;\r\n                };\r\n                if (withmetainfo) ret.forEach((struct: ValueDetail) => { struct.value = mapperfunc(struct.value); });\r\n                else ret = ret.map(mapperfunc);\r\n                break;\r\n            default: // it's a reference or enum\r\n                mapperfunc = (r:any) => r && LPointerTargetable.wrap(r);\r\n                if (withmetainfo) ret.forEach((struct: ValueDetail) => { struct.value = mapperfunc(struct.value); });\r\n                else ret = ret.map(mapperfunc);\r\n\r\n                // now ret is pointed DEnumLiteral or DObject or MetaInfoStructure<>\r\n                if ((meta as LAttribute)?.type?.className === DEnumerator.name) {\r\n                    // replace numeric literals, mapped to literal ordinal. can happen with type switches\r\n                    if (true) {\r\n                        mapperfunc = (lit: LEnumLiteral|number) => {\r\n                            numbermax = Number.POSITIVE_INFINITY;\r\n                            numbermin = 0;\r\n                            let ordinal = numbercasting(lit);\r\n                            return isNaN(ordinal) ? lit : (meta!.type as LEnumerator).ordinals[ordinal];\r\n                        }\r\n                        if (withmetainfo) ret.forEach((struct: ValueDetail) => { struct.value = mapperfunc(struct.value); });\r\n                        else ret = ret.map(mapperfunc);\r\n                    }\r\n                    let filterfunc = (l: LEnumLiteral) => { if (!l) return keepempties; return l.father?.id === (meta as LAttribute).type.id; };\r\n                    if (withmetainfo) for(let struct of ret as ValueDetail[]) { struct.hidden = !filterfunc(struct.value as LEnumLiteral); } // && 'literal target is not of the correct type requested by metamodel'; }\r\n                    else ret = ret.filter(filterfunc);\r\n                    // todo: questo comportamento implica che quando importo un literal come testo da .ecore, devo assegnargli\r\n                    //  il puntatore al suo literal se trovato, altrimenti resta val[i] di tipo string/shapeless\r\n\r\n                    if (namedPointers) {\r\n                        mapperfunc = (lit?: LEnumLiteral) => lit?.name;\r\n                        if (withmetainfo) ret.forEach((struct: ValueDetail) => { struct.value = mapperfunc(struct.value); });\r\n                        else ret = ret.map(mapperfunc);\r\n                    }\r\n                    break;\r\n                }\r\n                // is reference with assigned shape (and type) -> filter correct typed targets\r\n                if (meta) {\r\n                    let filterfunc = (l: LObject) => {\r\n                        // hide values with a value that is not a pointer to correct type (but keep empties if requested)\r\n                        //let isExtending = l.instanceof?.isExtending((meta as LReference).type); // damiano: todo test & debug isextending\r\n                        let isExtending = true;\r\n                        return keepempties && !l ? true : isExtending;\r\n                    };\r\n                    if (withmetainfo) for(let struct of ret as ValueDetail[]) { struct.hidden = !filterfunc(struct.value as LObject); } // && \"ref target is not of correct type\"; }\r\n                    else ret = ret.filter(filterfunc);\r\n                }\r\n                // shaped (with m2-reference) but pointing to a shapeless object. can happen\r\n                if (namedPointers) {\r\n                    let mapperfunc = (l:LObject) => l && (l.name ? (\"@\" + l.name) : (l as GObject)[\"@\"+l.name]?.__raw?.values?.[0] || (\"#\" + l.className));\r\n                    if (withmetainfo) ret.forEach((struct: ValueDetail)=>{ struct.value = mapperfunc(struct.value as LObject); });\r\n                    else ret = ret.map(mapperfunc);\r\n                }\r\n                else if (ecorePointers && !(meta as LReference).containment){\r\n                    mapperfunc = (lval: LObject) => lval && lval.ecorePointer();\r\n                    if (withmetainfo) ret.forEach((struct: ValueDetail)=>{ struct.value = mapperfunc(struct.value as LObject); });\r\n                    else ret = ret.map(mapperfunc);\r\n                    // throw new Error(\"values as EcorePointers: todo. for containment do nothing, just nest the obj. for non-containment put the ecore reference string in array vals\")\r\n                }\r\n                break;\r\n            case ShortAttribETypes.EByte:\r\n                numbermin = -128;\r\n                numbermax = 127;\r\n                break;\r\n            case ShortAttribETypes.EShort:\r\n                numbermin = -32768;\r\n                numbermax = 32767;\r\n                break;\r\n            case ShortAttribETypes.EInt:\r\n                numbermin = -2147483648;\r\n                numbermax = 2147483647;\r\n                break\r\n            case ShortAttribETypes.ELong:\r\n                numbermin = -9223372036854775808;\r\n                numbermax = 9223372036854775807;\r\n                break;\r\n            case ShortAttribETypes.EFloat:\r\n            case ShortAttribETypes.EDouble:\r\n                numbermin = Number.NEGATIVE_INFINITY;\r\n                numbermax = Number.POSITIVE_INFINITY;\r\n                round = false;\r\n                break;\r\n            case ShortAttribETypes.EString:\r\n            case ShortAttribETypes.EDate:\r\n                mapperfunc = v => v ? v + '' : ''\r\n                if (withmetainfo) ret.forEach((struct: ValueDetail)=>{ struct.value = mapperfunc(struct.value); });\r\n                else ret = ret.map(mapperfunc);\r\n                break;\r\n            case ShortAttribETypes.EChar:\r\n                mapperfunc = v => v ? (v + '')[0] : 'A';\r\n                if (withmetainfo) ret.forEach((struct: ValueDetail)=>{ struct.value = mapperfunc(struct.value); });\r\n                else ret = ret.map(mapperfunc);\r\n                break;\r\n            case ShortAttribETypes.EBoolean:\r\n                mapperfunc = v => typeof v === \"boolean\" ? v : U.fromBoolString(v+'', v?.length>0, false);\r\n                if (withmetainfo) ret.forEach((struct: ValueDetail)=>{ struct.value = mapperfunc(struct.value); });\r\n                else ret = ret.map(mapperfunc);\r\n                break;\r\n            case ShortAttribETypes.void:\r\n                if (withmetainfo) ret.forEach((struct: ValueDetail)=>struct.hidden = true);\r\n                else ret = [];\r\n                break;\r\n        }\r\n        // some kind of numeric type\r\n        if (numbermax !== 0) {\r\n            if (withmetainfo) ret.forEach((struct: ValueDetail)=>{ struct.value = numbercasting(struct.value); });\r\n            else ret = ret.map(numbercasting);\r\n        }\r\n        (ret as GObject).type = typestr;\r\n        // console.error(\"type value:\", {ret, typestr, meta, fitSize});\r\n        return ret as any;\r\n    }\r\n\r\n    public getValues<T extends boolean>(fitSize: boolean = true, namedPointers: boolean = false, ecorePointers: boolean = false, shapeless: boolean = false,\r\n                                        keepempties: boolean = true, withmetainfo?: T, maxlimit?: number)\r\n        : (T extends undefined ? this[\"values\"] : T extends false ? this[\"values\"] : ValueDetail[]) & {type?: string} {\r\n        return this.cannotCall(\"getValues\"); }\r\n    protected get_getValues(context: Context): this[\"getValues\"] {\r\n        return function (fitSize: boolean = true, namedPointers: boolean = true, ecorePointers: boolean = false,\r\n                         shapeless: boolean = false, keepempties: boolean = false, withmetainfo: any = false, limit?: number) {\r\n            return LValue.prototype.get_values(context, fitSize, namedPointers, ecorePointers, shapeless, keepempties, withmetainfo, limit) as any;\r\n        }\r\n    }\r\n    // stringified value getters\r\n    public valuestring(keepemptyquotes?: boolean): string { return this.cannotCall(\"valuestring\"); }\r\n    private get_valuestring(context: Context): this[\"valuestring\"] { return (keepemptyquotes?: boolean) => this.valuestring_impl(context, keepemptyquotes); }\r\n    private valuestring_impl(context: Context, keepemptyquotes?: boolean): string {\r\n        // console.error(\"valuestring_impl\", {context, data:context.data});\r\n        let val = this.get_values(context, true, true, false, false, true);\r\n        // console.log(\"valuestring_impl\", {val});\r\n        let ret: any;\r\n        switch (val.length) {\r\n            case 0: ret = ''; break;\r\n            case 1: ret = val[0]; break;\r\n            default:\r\n                let havestrings: boolean = val.type === ShortAttribETypes.EString;\r\n                let havechars: boolean = val.type === ShortAttribETypes.EChar;\r\n                let havepointers: boolean = false;\r\n                let haveLelements: boolean = false;\r\n                for (let vall of [val[0]]) {\r\n                    if ((vall as any)?.__isProxy) haveLelements = true;\r\n                    /*else if (typeof vall === \"string\") { havestrings = true; havepointers = havepointers || vall.includes(\"Pointer\"); }}\r\n                     */\r\n                }\r\n                /*if (havepointers) {\r\n                    val = LPointerTargetable.wrapAll(val);\r\n                    haveLelements = true;\r\n                }*//*\r\n                if (haveLelements) {\r\n                    val = val.map( l => l && (l.name ? (\"@\" + l.name) : (\"#\" + l.className)));\r\n                }*/\r\n                if (havestrings || havechars) {\r\n                    let valstr = JSON.stringify(val);\r\n                    if (!keepemptyquotes) valstr = U.replaceAll(valstr, \"\\\"\\\"\", \"\");\r\n                    ret = valstr.substring(1, valstr.length-1);\r\n                    break;\r\n                }\r\n                else ret = val.join(', ');\r\n        }\r\n        // console.error(\"valuestring_impl()\", {ret, context, data:context.data});\r\n        return (ret === undefined || ret === null ? '' : ret) + '';\r\n    }\r\n\r\n    public setValueAtPosition(index: number, val: this[\"values\"][0], info?: Partial<SetValueAtPoisitionInfoType>): {success: boolean, reason?: string} {\r\n        return this.cannotCall(\"setValueAtPosition\"); }\r\n\r\n    // only use through setValueAtPosition\r\n    protected _clearValueAtPosition(context: Context, index: number, info0?: Partial<SetValueAtPoisitionInfoType>, skipSettingUndefined: boolean = false) {\r\n        let info = (info0 || {}) as any as SetValueAtPoisitionInfoType;\r\n        let oldVal = context.data.values[index];\r\n        let oldTarget: LObject | undefined = typeof oldVal === \"string\" ? LObject.fromPointer(oldVal) : undefined;\r\n        /////////////////////// if oldTarget is LObject, update his pointedBy\r\n        // if (oldTarget) SetFieldAction.new(oldTarget, \"pointedBy\" '-=\", ... no need? reducer should do this)\r\n\r\n        /////////////////////// if ref is containment assign oldTarget father to DModel\r\n\r\n        if (info.isContainment === undefined) {\r\n            if (info.instanceof === undefined) info.instanceof = context.proxyObject.instanceof;\r\n            info.isContainment = !info.instanceof || (info.instanceof as LReference).containment;\r\n        }\r\n        if (info.isContainment && oldTarget?.className === \"DObject\") {\r\n            SetFieldAction.new(oldVal as Pointer<DObject>, \"father\", context.proxyObject.model.id, undefined, true);\r\n        }\r\n        if (!skipSettingUndefined) SetFieldAction.new(context.data, 'values.' + index as any, undefined, '', info.isPtr);\r\n    }\r\n    protected get_setValueAtPosition(context: Context): ((index: number, val: this[\"values\"][0], info?: Partial<SetValueAtPoisitionInfoType>) => {success: boolean, reason?: string}) {\r\n        return (index: number, val: this[\"values\"][0] | any, info0?: Partial<SetValueAtPoisitionInfoType>): { success: boolean, reason?: string } => {\r\n            let isPtr: boolean = undefined as any;\r\n            let lval: LObject | LEnumLiteral = undefined as any;\r\n            if (val === null) val = undefined;\r\n            if (context.data.values[index] === val) return { success: false, reason: \"identical assignment\" };\r\n            if ((val as any)?.id && (val as any)?.className) {\r\n                lval = (val.__isProxy ? val : LPointerTargetable.wrap<DObject>(val));\r\n                isPtr = !!lval;\r\n                val = (val as any).id;\r\n            }\r\n            let info = (info0 || {}) as any as SetValueAtPoisitionInfoType;\r\n            if (isPtr === undefined) isPtr = (info.isPtr === undefined ? Pointers.isPointer(val) : info.isPtr);\r\n\r\n            // set sideeffect part\r\n            if ((val !== undefined)) {\r\n                if (isPtr) {\r\n                    if (info.type === undefined) info.type = context.proxyObject.type;\r\n                    if (info.instanceof === undefined) info.instanceof = context.proxyObject.instanceof;\r\n                    if (info.isContainment === undefined) {\r\n                        info.isContainment = !info.instanceof || (info.instanceof.className === DReference.name && (info.instanceof as LReference).containment);\r\n                    }\r\n                    lval = LPointerTargetable.fromPointer(val);\r\n                    if (!lval) return {success: false, reason: \"invalid pointer: \" + lval};\r\n                    // is enum\r\n                    if (lval.className === DEnumLiteral.name) {\r\n                        let lvale: LEnumLiteral = lval as LEnumLiteral;\r\n                        if (info.instanceof && info.type && (lvale.father.id !== info.type.id)) return {success: false, reason: \"target is not of correct literal type\"};\r\n                        // no need to do checks / other sideeffects other than pointedBy i think.\r\n                    }\r\n                    // is ref\r\n                    if (lval.className === DObject.name){\r\n                        let lvalo = lval as LObject;\r\n                        let lvalmeta: LClassifier | undefined = lvalo.instanceof;\r\n                        // if (info.instanceof && info.type && (!(lvalmeta as LClass)?.isExtending(info.type))) return {success: false, reason: \"target is not of correct type\"}; damiano todo: enable and implement isExtending\r\n                        if (info.fatherList === undefined) info.fatherList = context.proxyObject.fatherList;\r\n                        if (info.isContainment) {\r\n                            if ((info.fatherList as LPointerTargetable[]).map(father => father.id).includes(val))\r\n                                return {success: false, reason: \"cannot create a containment loop\"}; // todo: in LReference.set_containment need to forbid setting to true if there is a loop\r\n                            let oldContainer: LValue | LModel = lvalo.father;\r\n                            let oldContainerValue: LValue = (oldContainer.className === DModel.name) ? undefined as any : (oldContainer as LValue);\r\n                            // detach contaied object from old parent\r\n                            if (oldContainerValue) {\r\n                                let valarr: any[] = oldContainerValue.__raw.values;\r\n                                for (let i = 0; i < valarr.length; i++) {\r\n                                    let v = valarr[i];\r\n                                    if (v === val) oldContainerValue.setValueAtPosition(i, undefined as any, undefined);\r\n                                }\r\n                            }\r\n                            SetFieldAction.new(val as Pointer<DObject>, \"father\", context.data.id, undefined, true);\r\n                        }\r\n                    }\r\n                    // automatic? SetFieldAction.new(val as Pointer<DObject>, \"pointedBy\", PointedBy.fromID(context.data.id, \"values.\" + index as any), \"+=\");\r\n                } else {\r\n                    // loose checks, i can assign any primitive to any primitive (will cast on get)\r\n                    if (info.instanceof === undefined) info.instanceof = context.proxyObject.instanceof;\r\n                    let metatype: string = (info.instanceof as LAttribute)?.typeToShortString() || \"shapeless\";\r\n                    if (typeof val === \"object\") {\r\n                        if (val.constructor === Date && (metatype !== \"EString\" && metatype !== \"EDate\" && metatype !== \"shapeless\"))\r\n                            return {\r\n                                success: false,\r\n                                reason: \"dates can only be assigned to values of type string or Date\"\r\n                            };\r\n                        // return {success: false, reason: \"objects are not assignable except for dates\"}; maybe i allow this instead\r\n                    }\r\n                }\r\n            }\r\n\r\n            // clear sideeffect part\r\n            this._clearValueAtPosition(context, index, info, true);\r\n\r\n            // actual set\r\n            SetFieldAction.new(context.data, 'values.' + index as any, val, '', isPtr);\r\n            if (info.setMirage !== false) SetFieldAction.new(context.data, 'isMirage', false, '', false);\r\n\r\n            // assegnato a giordano todo: wrap this and set toaster with failure message if it fails or better launch Log.w and bind toasts of different colors to Log funcs\r\n            return {success: true};\r\n        }\r\n    }\r\n    protected set_values(val: orArr<D[\"values\"]>, context: Context): boolean {\r\n        const list: D[\"values\"] = ((Array.isArray(val)) ? val : [val]) as D[\"values\"];\r\n        let modified = false;\r\n        for (let i = 0; i < list.length; i++) {\r\n            modified = modified || this.get_setValueAtPosition(context)(i, list[i], {setMirage: false} as any).success;\r\n        }\r\n        if (modified) context.data.isMirage && SetFieldAction.new(context.data, 'isMirage', false, '', false);\r\n        return true;\r\n\r\n        // old implementation\r\n        let l = context.proxyObject;\r\n        let instanceoff: LReference | LAttribute | undefined = l.instanceof;\r\n        let isRef: boolean | undefined = (!instanceoff ? undefined : instanceoff?.className === DReference.name);\r\n        SetFieldAction.new(context.data, 'values', list as any, '', false);\r\n        // console.log(\"pre set_values actions\", l, list, val, context);\r\n\r\n        if (!l.instanceof || isRef && (instanceoff as LReference).containment) {\r\n            let i = 0;\r\n\r\n            for (let v0 of list) {\r\n                // console.log(\"loop set_value actions\", v, context.data, isRef, instanceoff, Pointers.isPointer(v));\r\n                i++;\r\n                if ((isRef || instanceoff === undefined) && Pointers.isPointer(v0)) { // if shapeless obj need to check val by val\r\n                    let v = v0 as Pointer<DModelElement> //Pointer<DObject> | Pointer<DEnumLiteral>;\r\n                    // console.log(\"loop set_value actions SET\", {v, data:context.data, isRef, instanceoff, isPtr:Pointers.isPointer(v)});\r\n                    let lval: LObject = LPointerTargetable.fromPointer(v);\r\n                    let oldContainer: LValue | LModel = lval.father;\r\n                    SetFieldAction.new(v, \"pointedBy\", PointedBy.fromID(context.data.id, \"values.\" + i as any), \"+=\");\r\n                    SetFieldAction.new(v, \"father\", context.data.id, undefined, true);\r\n                    if (oldContainer.className === DModel.name) continue;\r\n                    let containerValue = (oldContainer as LValue);\r\n                    // let oldContainerValues = [...containerValue.__raw.value]; U.arrayRemoveAll(oldContainerValues, v);\r\n                    let oldContainerValues: Pointer[] = containerValue.__raw.values.map( va => va===v ? undefined as any : va);\r\n                    SetFieldAction.new(containerValue.id, \"values\", oldContainerValues, \"\", true);\r\n\r\n                    // todo: verify if works: remove val from old container\r\n                    let oldv = context.data.values[i];\r\n                    // if (Pointers.isPointer(oldv)) SetFieldAction.new(context.data.id, \"contains\", U.arrayRemoveAll([...context.data.contains], oldv), '', true);\r\n                    // SetFieldAction.new(context.data.id, \"contains\", oldv as DObject[\"id\"], undefined, true);\r\n\r\n                }\r\n            }\r\n        }\r\n        context.data.isMirage && SetFieldAction.new(context.data, 'isMirage', false, '', false);\r\n        return true;\r\n    }\r\n\r\n    protected set_value(val: D[\"values\"][0], context: Context): boolean {\r\n        let v: ValueDetail = this.get_value(context, false, false, false, true, true);\r\n        let r = this.setValueAtPosition(v?.index || 0, val);\r\n        Log.e(!r.success,  r.reason);\r\n        return r.success;\r\n    }\r\n\r\n    protected generateEcoreJson_impl(context: Context, loopDetectionObj: Dictionary<Pointer, DModelElement> = {}): Json {\r\n        loopDetectionObj[context.data.id] = context.data;\r\n        let values = this.get_values(context, true, false, true, false, false);\r\n        delete values[\"type\"];\r\n        let ret: any = [];\r\n        the_loop: for (let v of values){\r\n            let l: LObject | LEnumLiteral = v as any;\r\n            if (!l?.__isProxy) { ret.push(l); continue; }\r\n            switch (l.className){\r\n                case \"DOperation\": continue the_loop;\r\n                case \"DEnumLiteral\": ret.push((l as LEnumLiteral).generateEcoreJsonM1()); break;\r\n                default: ret.push(l.generateEcoreJson(loopDetectionObj)); break;\r\n            }\r\n        }\r\n        // ret = ret.filter((j: any) => (j !== undefined || j !== ''));\r\n        return (ret.length <= 1) ? ret[0] : ret; }\r\n\r\n    protected get_toString(context: Context): () => string { return () => this._toString(context); }\r\n    protected _toString(context: Context): string {\r\n        let val: any = this.get_values(context, true, true, false, false, true);\r\n        if (!val) return val + '';\r\n        if (!Array.isArray(val)) val = [val];\r\n        // if (!context.proxyObject.instanceof) val = val.map( (e: GObject) => { return  e.name ? \"@\" + e.name : e; });\r\n        // else if (context.proxyObject.instanceof?.className === DReference.name) val = val.map( (e: GObject) => { return e.name ? \"@\" + e.name : e; });\r\n        switch(val.length) {\r\n            case 0: return '';\r\n            case 1: return val[0] + '';\r\n            default: return val + '';\r\n        }\r\n    }\r\n\r\n    public rawValues(): void { super.cannotCall('rawValues'); }\r\n    public get_rawValues(context: Context): this[\"values\"]{\r\n        return (this.get_getValues(context))(false, false, false, true, true, false, undefined);\r\n    }\r\n    protected get_delete(context: Context): () => void {\r\n        const data = context.proxyObject;\r\n        const ret = () => {\r\n            const me = data.instanceof;\r\n            me && SetFieldAction.new(me.__raw, 'instances', me.__raw.instances.indexOf(data.id), '-=', true);\r\n            data.superDelete();\r\n            // super.get_delete(context);\r\n        }\r\n        return ret;\r\n    }\r\n}\r\nDNamedElement.subclasses.push(DValue);\r\nLNamedElement.subclasses.push(LValue);\r\n\r\nexport type ValueDetail = {\r\n    value: LValue[\"value\"];\r\n    rawValue: DValue[\"values\"][0]; // PrimitiveType | Pointer<DObject> | Pointer<DEnumLiteral>\r\n    index: number;\r\n    hidden: boolean;\r\n};\r\nexport type SetValueAtPoisitionInfoType = {setMirage: boolean, isPtr: boolean, type: LValue[\"type\"], instanceof: LValue[\"instanceof\"], isContainment: boolean, fatherList: LValue[\"fatherList\"]};\r\n\r\n\r\nexport type WModelElement = getWParams<LModelElement, DModelElement>;\r\nexport type WModel = getWParams<LModel, DModel>;\r\nexport type WValue = getWParams<LValue, DValue>;\r\nexport type WNamedElement = getWParams<LNamedElement, DNamedElement>;\r\nexport type WObject = getWParams<LObject, DObject>;\r\nexport type WEnumerator = getWParams<LEnumerator, DEnumerator>;\r\nexport type WEnumLiteral = getWParams<LEnumLiteral, DEnumLiteral>;\r\nexport type WAttribute = getWParams<LAttribute, DAttribute>;\r\nexport type WReference = getWParams<LReference, DReference>;\r\nexport type WStructuralFeature = getWParams<LStructuralFeature, DStructuralFeature>;\r\nexport type WClassifier = getWParams<LClassifier, DClassifier>;\r\nexport type WDataType = getWParams<LDataType, DDataType>;\r\nexport type WClass = getWParams<LClass, DClass>;\r\nexport type WParameter = getWParams<LParameter, DParameter>;\r\nexport type WOperation = getWParams<LOperation, DOperation>;\r\nexport type WPackage = getWParams<LPackage, DPackage>;\r\nexport type WTypedElement = getWParams<LTypedElement, DTypedElement>;\r\nexport type WAnnotation = getWParams<LAnnotation, DAnnotation>;\r\n// export type WJavaObject = getWParams<LJavaObject, DJavaObject>;\r\nexport type WMap = getWParams<LMap, DMap>;\r\nexport type WFactory_useless_ = getWParams<LFactory_useless_, DFactory_useless_>;\r\n\r\n\r\n/*\r\nlet alld: GObject = {\r\n    DModelElement,\r\n    DModel,\r\n    DValue,\r\n    DNamedElement,\r\n    DObject,\r\n    DEnumerator,\r\n    DEnumLiteral,\r\n    DAttribute,\r\n    DReference,\r\n    DStructuralFeature,\r\n    DClassifier,\r\n    DDataType,\r\n    DClass,\r\n    DParameter,\r\n    DOperation,\r\n    DPackage,\r\n    DTypedElement,\r\n    DAnnotation,\r\n    DFactory_useless_, DMap};\r\nlet alll: GObject = {\r\n    LModelElement,\r\n    LModel,\r\n    LValue,\r\n    LNamedElement,\r\n    LObject,\r\n    LEnumerator,\r\n    LEnumLiteral,\r\n    LAttribute,\r\n    LReference,\r\n    LStructuralFeature,\r\n    LClassifier,\r\n    LDataType,\r\n    LClass,\r\n    LParameter,\r\n    LOperation,\r\n    LPackage,\r\n    LTypedElement,\r\n    LAnnotation,\r\n    LFactory_useless_, LMap};\r\n*/\r\n","import {\r\n    Json,\r\n    Log,\r\n\r\n\r\n    DModelElement,\r\n    LModelElement,\r\n    DModel,\r\n    LModel,\r\n    DValue,\r\n    LValue,\r\n    DNamedElement,\r\n    LNamedElement,\r\n    DObject,\r\n    LObject,\r\n    DEnumerator,\r\n    LEnumerator,\r\n    DEnumLiteral,\r\n    LEnumLiteral,\r\n    DAttribute,\r\n    LAttribute,\r\n    DReference,\r\n    LReference,\r\n    DStructuralFeature,\r\n    LStructuralFeature,\r\n    DClassifier,\r\n    LClassifier,\r\n    DDataType,\r\n    LDataType,\r\n    DClass,\r\n    LClass,\r\n    DParameter,\r\n    LParameter,\r\n    DOperation,\r\n    LOperation,\r\n    DPackage,\r\n    LPackage,\r\n    DTypedElement,\r\n    LTypedElement,\r\n    DAnnotation,\r\n    LAnnotation,\r\n    EJavaObject,\r\n    DMap,\r\n    LMap,\r\n    DFactory_useless_,\r\n    LFactory_useless_,\r\n    AttribETypes,\r\n    U,\r\n    Pointer,\r\n    CreateElementAction,\r\n    Selectors,\r\n    GObject,\r\n    Dictionary,\r\n    PointedBy,\r\n    LPointerTargetable,\r\n    windoww,\r\n    SetRootFieldAction,\r\n    Constructors,\r\n    DocString,\r\n    store,\r\n    SetFieldAction,\r\n    Pointers,\r\n    DPointerTargetable\r\n\r\n} from \"../joiner\";\r\n\r\ntype RET<T = boolean> = T | Promise<T>;\r\ntype Ret = RET;\r\n\r\nclass SavePack{\r\n    model: string;\r\n    vertexpos: string;\r\n    view: string;\r\n    constructor(model: string='', vertexpos: string='', view:string='') {\r\n        this.model = model;\r\n        this.vertexpos = vertexpos;\r\n        this.view = view;\r\n    }\r\n}\r\n\r\ntype JsonSavePack = {[key in keyof SavePack]: Json | null }\r\n\r\n\r\nexport abstract class IStorage{\r\n    static get():IStorage { return Log.exx(\"IStorage.get (static) should be overridden\"); }\r\n    public prefix: string;\r\n    public autosave: boolean;\r\n    constructor(prefix: string, autosave: boolean) {\r\n        this.prefix = prefix;\r\n        this.autosave = autosave;\r\n    }\r\n\r\n\r\n    public del(key: string | number): boolean{\r\n        let isOverwrite = this.get(key) !== null;\r\n        this.set(key, '');\r\n        return isOverwrite; }\r\n    public abstract set(key: string | number, val: string | any): RET;\r\n    get<T extends boolean>(key: string | number, parse: T = false as any): T extends false ? null | string : null | any{ return Log.exx(\"IStorage.get should be overridden\"); }\r\n\r\n    protected serialize(val: any): string { // serialize\r\n        try { return JSON.stringify(val); } catch(e){ return \"\"+val; }\r\n    }\r\n    protected deserialize(val: string): any{ // de-serialize\r\n        try { return JSON.parse(val); } catch(e){ return val; }\r\n    }\r\n    protected set0(val: any): string { return this.serialize(val); }\r\n    protected get0(val: any): string { return this.deserialize(val); }\r\n    protected parse(val: any): string { return this.deserialize(val); }\r\n}\r\n\r\nexport class LocalStorage extends IStorage{\r\n    public static get():LocalStorage {return new LocalStorage(\"_j\", true); }\r\n    private constructor (prefix: string, autosave: boolean) { super(prefix, autosave); }\r\n\r\n    private static KeyList= {lastOpenedModel: \"lastOpenedModel\",lastOpenedView: \"lastOpenedView\",lastOpenedPosition: \"lastOpenedPosition\",}\r\n\r\n\r\n    get<T extends boolean>(key: string | number, parse: T = false as any): T extends false ? null | string : null | any{\r\n        let val = localStorage.getItem(this.prefix+key);\r\n        return parse ? this.parse(val) : val;\r\n    }\r\n\r\n    set(key?: string | number, val?: string | any): boolean {\r\n        val = this.serialize(val);\r\n        // let isOverwrite = localStorage.getItem(this.prefix+key);\r\n        localStorage.set(this.prefix+key, val);\r\n        return true;\r\n    }\r\n\r\n\r\n    public getLastOpened(modelNumber: 1 | 2): SavePack {\r\n        let modelname = \"m\" + modelNumber + \"_\";\r\n        const ret: SavePack = new SavePack();\r\n        ret.model = this.get(modelname + LocalStorage.KeyList.lastOpenedModel, false) || '';\r\n        ret.view = this.get(modelNumber + LocalStorage.KeyList.lastOpenedView, false) || '';\r\n        ret.vertexpos = this.get(modelNumber + LocalStorage.KeyList.lastOpenedPosition, false) || '';\r\n        return ret; }\r\n\r\n    public deleteLastOpened(modelNumber: 1 | 2): void { this.setLastOpened(modelNumber, '', '', ''); }\r\n\r\n    public setLastOpened(modelNumber: 1 | 2, model: string = '', view: string = '', vertex: string = ''): void {\r\n        let modelname = \"m\" + modelNumber + \"_\";\r\n        if (model) this.set(modelname + LocalStorage.KeyList.lastOpenedModel, model);\r\n        else this.del(modelname +  LocalStorage.KeyList.lastOpenedModel);\r\n        if (view) this.set(modelname + LocalStorage.KeyList.lastOpenedView, view);\r\n        else this.del(modelname +  LocalStorage.KeyList.lastOpenedView);\r\n        if (vertex) this.set(modelname + LocalStorage.KeyList.lastOpenedPosition, vertex);\r\n        else this.del(modelname +  LocalStorage.KeyList.lastOpenedPosition); }\r\n\r\n\r\n}\r\n\r\nexport class EcoreParser{\r\n    static supportedEcoreVersions = [\"http://www.eclipse.org/emf/2002/Ecore\"];\r\n    static prefix:string = '@';\r\n\r\n    static parse(ecorejson: GObject | string | null, isMetamodel: boolean, filename: string | undefined, persist: boolean = true): DModelElement[]{\r\n        if (!ecorejson) return [];\r\n        let parsedjson: GObject;\r\n        if (typeof ecorejson === \"string\") try { parsedjson = JSON.parse(ecorejson); } catch(e) { windoww.temp = ecorejson; Log.exx(\"error while parsing json:\", e, ecorejson.substring(0, 1000)); throw e; }\r\n        else parsedjson = ecorejson;\r\n\r\n        console.log(\"root parse\", ecorejson);\r\n\r\n        isMetamodel = !!parsedjson[ECoreRoot.ecoreEPackage];\r\n\r\n        Constructors.pause();\r\n            let parsedElements: DModelElement[] = isMetamodel ? EcoreParser.parseM2Model(parsedjson, filename) : EcoreParser.parseM1Model(parsedjson, undefined, filename);\r\n            console.warn(\"parse.result D\", parsedElements);\r\n            this.LinkAllNamesToIDs(parsedElements);\r\n            this.fixNamingConflicts(parsedElements);\r\n        Constructors.resume();\r\n        if (persist) {\r\n            CreateElementAction.newBatch(parsedElements);\r\n        }\r\n        // update m1 object pointers (need them to be persistent to navigate .fathers and get ecore pointer strings using LObject)\r\n        setTimeout(() => this.fixObjectPointers(parsedElements), 1);\r\n\r\n        windoww.tmpparse = () => LPointerTargetable.wrapAll(parsedElements);\r\n\r\n        this.tempfix_untilopennewtabisdone(parsedElements, isMetamodel);\r\n\r\n        console.log('parsedElem', parsedElements)\r\n        return parsedElements;\r\n    }\r\n\r\n    private static fixObjectPointers(parsedElements: DModelElement[]): void {\r\n        let dobjects: DObject[] = parsedElements.filter(e=>e.className === DObject.name) as any[];\r\n        let values: DValue[] = parsedElements.filter(e=>e.className === DValue.name) as any[];\r\n        let lobjects: LObject[] = LPointerTargetable.fromArr(dobjects);\r\n        let m1pointermap: Dictionary<string, LObject> = { }; //    \"//@rootrefname.index@/refname.index/@....etc\"\r\n        for (let o of lobjects){ m1pointermap[o.ecorePointer()] = o; }\r\n        for (let v of values) {\r\n            if (v.isMirage) continue;\r\n            let modified = false;\r\n            let newvalues = v.values.map((e) => {\r\n                if (!m1pointermap[e as any]) return e;\r\n                modified = true;\r\n                console.log(\"m1 pointer resolved:\", {from:e, to:m1pointermap[e as any].id});\r\n                return m1pointermap[e as any].id;\r\n            });\r\n            if (!modified) continue;\r\n            let lv: LValue = LPointerTargetable.from(v);\r\n            lv.values = newvalues;\r\n        }\r\n\r\n    }\r\n    private static tempfix_untilopennewtabisdone(parsedElements: DModelElement[], isMetamodel: boolean) {\r\n        // replaces current model with parsed model. this needs to be removed to open a new tab later on.\r\n        let model: DModel = null as any;\r\n        for (let elem of parsedElements) { if (elem.className === DModel.name) { model = elem as any; break; } }\r\n        SetRootFieldAction.new(isMetamodel ? \"m2models\" : \"m1models\", model.id, '+=', false); // it is pointer but no need to update pointedby's this time\r\n    }\r\n\r\n    // resolve eCore pointers to Jodel pointers and set the PointedBy\r\n    private static LinkAllNamesToIDs(parsedElements: DModelElement[]): void {\r\n        // todo: è post-parse che legga i nomi e assegni gli id aggiustando le references e extends settati by name. trova i campi temporanei cercando i @ts-ignore\r\n        // update mref, attribute, parameter type\r\n        // update operation exception\r\n        // replace those names with id's\r\n\r\n        let idMap: Dictionary<Pointer, DModelElement> = {};\r\n        let nameMap: Dictionary<string, DModelElement> = {};\r\n        let replacePrimitiveMap: Dictionary<string, DClassifier> = {};\r\n        let d_Estring: DClassifier = Selectors.getAllPrimitiveTypes()[0];\r\n        replacePrimitiveMap[AttribETypes.EString] = d_Estring;\r\n        // todo: do the same for all other primitives\r\n\r\n        // let longprefixlength = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore'.length;\r\n        const typeprefix = \"#//\";\r\n        for (let shortkey in AttribETypes){\r\n            let longkey: string = (AttribETypes as GObject)[shortkey];\r\n            // fallback for missing type instead of crash\r\n            if (!replacePrimitiveMap[longkey]) replacePrimitiveMap[longkey] = d_Estring;\r\n\r\n            // allow shortcuts to work too\r\n            replacePrimitiveMap[typeprefix + shortkey] = replacePrimitiveMap[longkey];\r\n\r\n        }\r\n\r\n\r\n        for (let ecorename in replacePrimitiveMap) {\r\n            idMap[replacePrimitiveMap[ecorename].id] = replacePrimitiveMap[ecorename];\r\n        }\r\n\r\n        // let prereplace = (name: string) => name.replaceAll(\"#//\", \"\");\r\n        let replaceRules = [\"extends\", /*\"extendedBy\",*/ \"exceptions\", \"type\", \"values\"];\r\n        let dobj: GObject & DModelElement;\r\n\r\n        for (dobj of parsedElements) {\r\n            if (dobj.name) { nameMap[dobj.name] = dobj; nameMap[typeprefix + dobj.name] = dobj;}\r\n            idMap[dobj.id] = dobj;\r\n        }\r\n\r\n        for (let replacekey of replaceRules){\r\n            for (dobj of parsedElements) {\r\n                let valtmp: string | string[] = dobj[replacekey] as string | string[];\r\n                if (valtmp === undefined) continue; // for missing properties in a d-object like looking for extends on a dmodel.\r\n                let values: string[]\r\n                let isArray = Array.isArray(valtmp);\r\n                if (isArray) {\r\n                    values = valtmp as string[];\r\n                    dobj[replacekey] = [];\r\n                }\r\n                else {\r\n                    values = [valtmp as string];\r\n                }\r\n                for (let value of values) {\r\n                    if (!value) continue;\r\n                    // console.log(\"fixalltypes\", {replacekey, dobj, value, values});\r\n                    let target: DModelElement = replacePrimitiveMap[value];\r\n                    if (!target) target = nameMap[value];\r\n                    // if (Pointers.isPointer(value)) { target = value;  if it happen to be a pointer it's a mistake in parser }\r\n                    // (value.indexOf(\"#//\") == 0) && console.log(\"attempt to replace primitive type to his id\", {target, dobj, replacekey, value, replacePrimitiveMap, nameMap, idMap, parsedElements});\r\n\r\n                    if (replacekey === \"extends\") {\r\n                        if (!target) continue;\r\n                        Log.ex(target.className !== DClass.name, \"found a class attempting to extend an object that is not a class\", {target, dobj, replacePrimitiveMap, nameMap, idMap});\r\n                        (target as DClass).extendedBy.push((dobj as DClass).id);\r\n                    }\r\n                    Log.ex(!target, \"LinkAllNames() can't find type target:\", {value, nameMap, replacePrimitiveMap, dobj, replacekey});\r\n                    if (isArray) dobj[replacekey].push(target.id);\r\n                    else dobj[replacekey] = target.id;\r\n                }\r\n            }\r\n        }\r\n\r\n        let idlookup: Dictionary<string, DModelElement> = store.getState().idlookup as any;\r\n\r\n        // fix from ordinals to Pointer<DEnumLiteral>\r\n        function DfromPtr<T extends DPointerTargetable>(id: Pointer<T>|null|undefined): T{ return !id ? undefined as any : (idMap[id] || idlookup[id]); }\r\n        function getLiteral(id: Pointer<DEnumerator>, ordinal: number): DEnumLiteral { return LPointerTargetable.fromD(DfromPtr(id))?.ordinals[ordinal]?.__raw; }\r\n        for (let elem of parsedElements) {\r\n            if (elem.className !== DValue.name) continue;\r\n            let dval: DValue = elem as DValue;\r\n            let meta: DAttribute | DReference = DfromPtr(dval.instanceof as Pointer<DAttribute|DReference>);\r\n            if (!meta) continue;\r\n            let type: DEnumerator = DfromPtr(meta.type) as DEnumerator;\r\n            if (!type || type.className !== DEnumLiteral.name) continue;\r\n            let mapper = (v: unknown): Pointer<DEnumLiteral> => {\r\n                if (typeof v !== \"number\") { Log.e(\"found non-numeric value in a literal value.\", v, dval); return v as any; }\r\n                let l = getLiteral(type.id, v);\r\n                return l ? l.id : v as any;\r\n            }\r\n            dval.values = dval.values.map( mapper );\r\n        }\r\n\r\n        // finally: set all pointedby\r\n        for (let ptrkey of PointedBy.list) for(dobj of parsedElements) {\r\n            let valtmp: string | string[] = dobj[ptrkey] as string | string[];\r\n            let values: string[];\r\n            if (Array.isArray(valtmp)) {\r\n                values = valtmp as string[];\r\n            }\r\n            else {\r\n                if (valtmp === undefined) values = [];\r\n                // if (valtmp === \"modeltmp\") { dobj[ptrkey] = null; values = []; } // because model.father is null, but i want to error check others and let them crash if missing father\r\n                else values = [valtmp as string];\r\n            }\r\n            console.log(\"fixalltypes[]\", {ptrkey, valtmp, dobj, values});\r\n            for (let value of values) {\r\n                if (!value) continue;\r\n                // errore: per operazione.type l'import mi restituisce puntatore a oggetto stringa, ma non è tra gli oggetti parsed\r\n                let target: DModelElement = idMap[value];\r\n                if (target) {\r\n                    target.pointedBy.push(PointedBy.new(\"idlookup.\" + dobj.id + \".\" + ptrkey));\r\n                } else {\r\n                    target = idlookup[value];\r\n                    console.log(\"fixalltypes\", {ptrkey, valtmp, dobj, value, values, target, idMap});\r\n                    if (!target) throw new Error(\"target undefined\");\r\n                    SetFieldAction.new(target, \"pointedBy\", PointedBy.new(\"idlookup.\" + dobj.id + \".\" + ptrkey),'+=', false);\r\n                }\r\n            }\r\n        }\r\n        // update superclasses\r\n        this.updateSuperClasses(parsedElements);\r\n    }\r\n\r\n    private static todoGetPrimitiveTypenope(type: AttribETypes.EString | string): Pointer<DClass, 1, 1, LClass> {\r\n        // akready fixed in LinkAllNamesToID\r\n        return 'todoGetPrimitiveType from parser';\r\n    }\r\n\r\n    private static updateSuperClasses(parsedElements: DModelElement[]): void {\r\n        // todo:3\r\n\r\n    }\r\n    private static fixNamingConflicts(parsedElements: DModelElement[]): void {\r\n        // todo:4 final\r\n    }\r\n\r\n    static parseM2Model(json: Json, filename: string | undefined): DModelElement[] {\r\n        let generated: DModelElement[] = [];\r\n        if (!json) { json = {}; }\r\n        let modelname = json[ECoreNamed.namee] as string;\r\n        if (!modelname && filename) {\r\n            let pos = filename.indexOf(\".\");\r\n            modelname = pos === -1 ? filename : filename.substring(0, pos); }\r\n        let dObject: DModel = DModel.new( modelname || \"imported_metamodel_1\", undefined, true, true);\r\n        console.log(\"made model\", json);\r\n        generated.push(dObject); // dObject.father = 'modeltmp' as any;\r\n        /// *** specific  *** ///\r\n        const children = EcoreParser.getChildren(json);\r\n        const annotations = EcoreParser.getAnnotations(json);\r\n        // dObject.name = json[ECoreNamed.namee] as string || \"imported_metamodel_1\";\r\n        console.log(\"made model 2\", children, annotations);\r\n        for (let child of annotations) {\r\n            EcoreParser.parseDAnnotation(dObject, child, generated);\r\n        }\r\n        console.log(\"made annotations\");\r\n        for (let child of children) {\r\n            EcoreParser.parseDPackage(dObject, child, generated);\r\n        }\r\n        console.log(\"made packages\");\r\n        return generated;\r\n    }\r\n\r\n    static parseM1Model(json: Json, meta?: LModel, filename?: string): DModelElement[] {\r\n        let generated: DModelElement[] = [];\r\n        if (!json) { json = {}; }\r\n        /// *** specific  *** ///\r\n        // this.parseDObject(json, dObject, DModel,undefined, generated);\r\n        let allmodels: DModel[];\r\n        if (!meta && filename) {\r\n            allmodels = Selectors.getAll(DModel);\r\n            allmodels = allmodels.filter( (m) => m.name === filename);\r\n            meta = LPointerTargetable.fromD(allmodels[0]);\r\n        } else allmodels = [];\r\n\r\n        let xmlns =  EcoreParser.XMLinlineMarker + \"xmlns:\";\r\n        let ns: string | undefined = undefined as any;\r\n        function findns(key: string): false | string {\r\n            let pos = key.indexOf(\":\");\r\n            if (pos <= 0) return false;\r\n            return ns = key.substring(0, pos); // through namespace before the name of the root objects;\r\n            // additional method: through xmlns key\r\n            // if (key.indexOf(xmlns)) continue; // \"-xmlns:org.eclipse.example.modelname\": \"https://org/eclipse/example/modelname\",\r\n            // ns = key.substring(xmlns.length); break;\r\n        }\r\n        outerloop: for (let key0 in json) { // ns can be at most in sublevel 3, this is annoying but i need it at beginning of parsing\r\n            if (findns(key0)) break;\r\n            let val0 = json[key0];\r\n            if (typeof val0 === \"object\") for (let key1 in val0) {\r\n                if (findns(key0)) break outerloop;\r\n            }\r\n        }\r\n        if (ns && !meta) {\r\n            let allpkgs: LPackage[] = Selectors.getAll(DPackage, undefined, undefined, true, true);\r\n            let matchpkg: LPackage[] = allpkgs.filter( (d) => d.uri === ns);\r\n            meta = matchpkg[0]?.model;\r\n            // Log.exDev(!meta, \"metamodel not found: \", {ns, json, filename, allmodels, allpkgs, matchpkg}) // todo: after tests remove this check and allow shapeless models.\r\n        }\r\n\r\n        let modelname = '';\r\n        if (!modelname && filename) {\r\n            let pos = filename.indexOf(\".\");\r\n            modelname = (pos === -1 ? filename : filename.substring(0, pos)); }\r\n        let dObject: DModel = DModel.new( modelname || \"imported_model_1\", meta?.id, false, true);\r\n        console.log(\"made model\", json);\r\n        generated.push(dObject);\r\n\r\n        for (let key in json) {\r\n            switch(key) {\r\n                case ECoreObject.xmi_version: // this is only on roots\r\n                    Log.ex(json[key] !== \"2.0\",\"The only supported ecore version is \\\"2.0\\\", found instead: \\\"\"+json[key] +\"\\\"\");\r\n                    break;\r\n                // case ECoreObject.xmlnsecore:\r\n                case ECoreObject.xmlns_xmi:\r\n                    let expected = \"http://www.omg.org/XMI\";\r\n                    Log.ex(json[key] !== expected,\"Unexpected XMI schema. Should be \\\"\"+expected+\"\\\", found instead: \\\"\"+json[key] +\"\\\"\");\r\n                    break;\r\n                default: // a feature name\r\n                    let val = json[key];\r\n                    if (!val) continue;\r\n                    if (key.indexOf(xmlns) === 0) continue; // \"-xmlns:org.eclipse.example.modelname\": \"https://org/eclipse/example/modelname\",\r\n                    if (key[0] === EcoreParser.XMLinlineMarker) key = key.substring(EcoreParser.XMLinlineMarker.length);\r\n\r\n                    const namespacedclass: string = key;\r\n                    const mmclass: LClass | undefined = meta && meta.getClassByNameSpace(namespacedclass);\r\n                    if (!mmclass) console.log(\"failed to get mmclass\", {meta, key, mmclass})\r\n                    const roots_for_this_metaclass: Json[] = Array.isArray(val) ? val : [val]; // there might be N roots of class A, M of type B...\r\n                    for(let rootjson of roots_for_this_metaclass) {\r\n                        // DObject.new(mmclass.id, dObject.id, DModel, undefined, true)\r\n                        EcoreParser.parseDObject(rootjson, dObject, DModel, mmclass, generated);\r\n                    }\r\n            }\r\n        }\r\n        return generated;\r\n    }\r\n    /*\r\n    {\r\n      \"org.eclipse.example.bowling:League\": { <-- :classroot\r\n        \"-xmlns:xmi\": \"http://www.omg.org/XMI\",\r\n        \"-xmlns:org.eclipse.example.bowling\": \"https://org/eclipse/example/bowling\",\r\n        \"-xmi:version\": \"2.0\",\r\n        \"Players\": [\r\n          { \"-name\": \"tizio\" },\r\n          { \"-name\": \"asd\" }\r\n        ]\r\n      }\r\n    }\r\n    */\r\n\r\n\r\n    /// In Ecore parsing when you find a value list, it is possible to recover only the type for the meta-feature,<br>\r\n    /// but an array of Mammals might have some Whales, Pigs, etc mixed in. and you have to get the correct subclass for each\r\n    static getobjectmetaclass(json: Json, metaSuperClass: LClass): LClass {\r\n        return metaSuperClass; // todo: comment this and execute below\r\n        let subclasses: LClass[] | [] = !metaSuperClass ? [] : [metaSuperClass];\r\n        let subclasseshapes: Dictionary<Pointer<DClass>, {l: LClass } & Dictionary<DocString<\"feature name\">,  LTypedElement[\"type\"]/*feature type*/>> = {}\r\n        for (let sc of subclasses) {\r\n            subclasseshapes[sc.id] = {l: sc};\r\n            let row = subclasseshapes[sc.id];\r\n            for (let feat of sc.children) {\r\n                let lfeat: LTypedElement = feat as any;\r\n                let dfeat: DTypedElement = lfeat.__raw as any;\r\n                if (!dfeat.name || !dfeat.type) continue;\r\n                row[dfeat.name] = lfeat.type;\r\n            }\r\n        }\r\n        return this.findBestMatch(subclasseshapes, json);\r\n    }\r\n    static findBestMatch(\r\n        m2classes: Dictionary<Pointer<DClass>,  {l: LClass } & Dictionary<DocString<\"feature name\">, LTypedElement[\"type\"]>>,\r\n        json: Dictionary<DocString<\"feature name\">, any/*actual val instead of type*/>): LClass{\r\n        throw new Error(\"todo\");\r\n        return null as any;\r\n    }\r\n    static parseDObject(json: Json, parent: DModel | DValue, parentType: typeof DModel | typeof DValue, meta: LClass | undefined, generated: DModelElement[]): DModelElement[]{\r\n        if (!json) { json = {}; }\r\n        meta = meta && this.getobjectmetaclass(json, meta);\r\n        // let dObject: DObject = DObject.new(meta?.id, parent.id, parentType, json[\"name\"] as string || \"obj_1\");\r\n        // let data: Partial<DObject> = {};\r\n        let dObject: DObject = DObject.new(meta?.id, parent.id, parentType, json[\"name\"] as string || \"obj_1\");\r\n        generated.push(dObject); dObject.father = parent.id;\r\n        if (parent) {\r\n            if (parentType === DModel) (parent as DModel).objects.push(dObject.id);\r\n            else (parent as DValue).values.push(dObject.id);\r\n        }\r\n        console.log(\"made dobject\", {json, dObject, meta, metaname: meta?.name});\r\n        /// *** specific  *** ///\r\n        for (let key in json) {\r\n            switch(key) {\r\n                case ECoreObject.xmi_version: // this is only on roots\r\n                    Log.ex(json[key] !== \"2.0\",\"The only supported ecore version is \\\"2.0\\\", found instead: \\\"\"+json[key] +\"\\\"\");\r\n                    break;\r\n                // case ECoreObject.xmlnsecore:\r\n                case ECoreObject.xmlns_xmi:\r\n                    let expected = \"http://www.omg.org/XMI\";\r\n                    Log.ex(json[key] !== expected,\"Unexpected XMI schema. Should be \\\"\"+expected+\"\\\", found instead: \\\"\"+json[key] +\"\\\"\");\r\n                    break;\r\n                default: // a feature name\r\n                    let val = json[key];\r\n                    if (!val) continue;\r\n                    if (key[0] === EcoreParser.XMLinlineMarker) key = key.substring(1);\r\n                    if (key.indexOf(\"xmlns:\") === 0) continue; // \"-xmlns:org.eclipse.example.modelname\": \"https://org/eclipse/example/modelname\",\r\n                    let metafeature: LAttribute | LReference | undefined = meta && (meta as any)[\"@\"+key];\r\n                    console.log(\"feature meta\", {json, dObject, key, val, metafeature, classmeta: meta});\r\n                    let values: any[];\r\n                    if (Array.isArray(val)) values = val;\r\n                    else if (val as unknown === undefined) values = [];\r\n                    else values = [val];\r\n                    EcoreParser.parseDValue(key, values, dObject/*father*/, metafeature/*meta*/, generated);\r\n                    // DValue.new(key, metafeature?.id, values, dObject, true, false);\r\n            }\r\n        }\r\n        return generated;\r\n    }\r\n\r\n    private static parseDValue(name:string | undefined, jsonvalues: any[], parent: DObject, meta: LAttribute | LReference | undefined, generated: DModelElement[]): DModelElement[] {\r\n        if (!jsonvalues) { jsonvalues = []; }\r\n        // let dObject: DObject = DObject.new(meta?.id, parent.id, parentType, json[\"name\"] as string || \"obj_1\");\r\n        console.log(\"DValue.new(meta ? undefined : name, meta?.id, jsonvalues, parent.id, true, false)\")\r\n        console.log(\"DValue.new(\", meta ? undefined : name, \",\",meta?.id, \",\",jsonvalues, \",\",parent.id);\r\n        let dValue: DValue = DValue.new(meta ? undefined : name, meta?.id, [], parent.id, true, false);\r\n        generated.push(dValue); dValue.father = parent.id;\r\n        parent.features.push(dValue.id);\r\n        console.log(\"made dValue\", {jsonvalues, dValue, meta, metaname: meta?.name});\r\n        if (meta && meta.className === DAttribute.name) { dValue.values = jsonvalues; return generated; }\r\n\r\n        for (let v of jsonvalues) {\r\n            if (typeof v !== \"object\") { dValue.values.push(v); continue; }\r\n            // let subdObject: DObject = DObject.new((meta as LReference)?.type.id, parent.id, DValue, undefined);\r\n            // generated.push(subdObject);\r\n            EcoreParser.parseDObject(v, dValue, DValue, (meta as LReference)?.type, generated);\r\n        }\r\n        return generated;\r\n    }\r\n\r\n    static parseDAnnotation(parent: DModelElement, json: Json, generated: DModelElement[]): DModelElement[] {\r\n        if (!generated) generated = [];\r\n        if (!json) { json = {}; }\r\n        let dObject: DAnnotation = DAnnotation.new();\r\n        generated.push(dObject); dObject.father = parent.id;\r\n        dObject.father = parent.id;\r\n        if (parent) parent.annotations.push(dObject.id);\r\n\r\n        /// *** specific  *** ///\r\n        let key: string;\r\n        for (key in json){\r\n            const value = json[key];\r\n            switch (key) { //todo\r\n                default: Log.exx('unexpected field in EAnnotation:  ' + key + ' => |' + value + '|'); break;\r\n                case ECoreAnnotation.details: break;\r\n                case ECoreAnnotation.references: break;\r\n                case ECoreAnnotation.source: break;\r\n            }\r\n        }\r\n        // annotation.referencesStr = this.read(json, ECoreAnnotation.source, '#/');\r\n        // annotation.name = this.read(json, ECoreAnnotation.name, 'EAnnotation_1');\r\n        // const details: Json[] = this.getDetails(json);\r\n        // for (let i = 0; i < details.length; i++) { new EAnnotationDetail(this, details[i]); }\r\n        return generated; }\r\n\r\n    static parseDPackage(parent: DModel, json: Json, generated: DModelElement[]): DModelElement[] {\r\n        if (!generated) generated = [];\r\n        if (!json) { json = {}; }\r\n        const childs = this.getChildren(json);\r\n\r\n        console.warn(\"parseDPackage.children\", childs, generated);\r\n        let dObject: DPackage = DPackage.new();\r\n        generated.push(dObject); dObject.father = parent.id;\r\n        if (parent) parent.packages.push(dObject.id);\r\n\r\n        let version = (json[EcoreParser.prefix+\"xmlns:ecore\"] || '') as string;\r\n        // model.xmi = json[EcoreParser.prefix+\"xmlns:xmi\"]; // http://www.omg.org/XMI\r\n        // model.xsi = json[EcoreParser.prefix+\"xmlns:xsi\"]; // http://www.w3.org/2001/XMLSchema-instance\r\n\r\n        console.log(json);\r\n        Log.ex(!EcoreParser.supportedEcoreVersions.includes(version), \"unsupported ecore version, must be one of:\" + EcoreParser.supportedEcoreVersions + \" found instead: \"+version);\r\n\r\n        dObject.name = this.read(json, ECoreNamed.namee, 'defaultPackage');\r\n        /// *** specific start *** ///\r\n        dObject.uri = this.read(json, ECorePackage.nsURI, null);\r\n        dObject.prefix = this.read(json, ECorePackage.nsPrefix, null);\r\n        // if (!parent.uri) parent.uri = dObject.uri;\r\n        // if (!parent.prefix) parent.prefix = dObject.prefix; // namespace\r\n        for (let child of childs) {\r\n            switch (child[ECoreClass.xsitype]) {\r\n                default: Log.exx('unexpected xsitype:', child[ECoreClass.xsitype], ' found in jsonfragment:', child, ', in json:', json, ' package:', dObject); break;\r\n                case 'ecore:EClass': this.parseDClass(dObject, child, generated); break;\r\n                case 'ecore:EEnum': this.parseDEnum(dObject, child, generated); break;\r\n            }\r\n        }\r\n        /// *** specific end *** ///\r\n        return generated; }\r\n\r\n    static parseDClass(parent: DPackage, json: Json, generated: DModelElement[]): DModelElement[] {\r\n        if (!generated) generated = [];\r\n        if (!json) { json = {}; }\r\n        let dObject: DClass = DClass.new();\r\n        generated.push(dObject); dObject.father = parent.id;\r\n        if (parent) parent.classifiers.push(dObject.id);\r\n        dObject.name = this.read(json, ECoreNamed.namee, 'Class_1');\r\n        /// *** specific start *** ///\r\n        for (let key in json) {\r\n            switch (key) {\r\n                default: Log.exx('unexpected field in parseDClass() |' + key + '|', json); break;\r\n                case ECoreClass.instanceTypeName:\r\n                case ECoreClass.eSuperTypes:\r\n                case ECoreClass.xsitype:\r\n                case ECoreClass.eOperations:\r\n                case ECoreClass.eStructuralFeatures:\r\n                case ECoreClass.abstract:\r\n                case ECoreClass.interface:\r\n                case ECoreClass.namee: break; } }\r\n        dObject.instanceClassName = this.read(json, ECoreClass.instanceTypeName, '');\r\n        dObject.interface = this.read(json, ECoreClass.interface, 'false') === 'true';\r\n        dObject.abstract = this.read(json, ECoreClass.abstract, 'false') === 'true';\r\n        let tmps: string = this.read(json, ECoreClass.eSuperTypes, '');\r\n        dObject.extends = tmps.split(' ');\r\n        const features: Json[] = this.getChildren(json);\r\n        const functions: Json[] = this.getChildren(json, false, true);\r\n        for (let child of functions) {\r\n            this.parseDOperation(dObject, json, generated);\r\n        }\r\n        for (let child of features) {\r\n            const xsiType = this.read(child, ECoreAttribute.xsitype);\r\n            switch (xsiType) {\r\n                default: Log.exx( 'unexpected xsi:type: ', xsiType, ' in feature:', child); break;\r\n                case 'ecore:EAttribute':\r\n                    this.parseDAttribute(dObject, child, generated); break;\r\n                case 'ecore:EReference':\r\n                    this.parseDReference(dObject, child, generated); break;\r\n            }\r\n        }\r\n        /// *** specific end *** ///\r\n        return generated; }\r\n\r\n    static parseDEnum(parent: DPackage, json: Json, generated: DModelElement[]): DModelElement[] {\r\n        if (!generated) generated = [];\r\n        if (!json) { json = {}; }\r\n        const childs = this.getChildren(json);\r\n        let dObject: DEnumerator = DEnumerator.new();\r\n        generated.push(dObject); dObject.father = parent.id;\r\n        if (parent) parent.classifiers.push(dObject.id);\r\n        dObject.name = this.read(json, ECoreNamed.namee, 'Enum_1');\r\n        /// *** specific start *** ///\r\n        for (let key in json) {\r\n            const value = json[key];\r\n            switch (key) {\r\n                default: Log.exx('Enum.parse() unexpected key:', key, 'in json:', json); break;\r\n                case ECoreEnum.xsitype: case ECoreNamed.namee: break;\r\n                case ECoreEnum.eLiterals: break;\r\n                case ECoreEnum.serializable: dObject.serializable = value === 'true'; break;\r\n                case ECoreEnum.instanceTypeName: dObject.instanceClassName = value + ''; break;\r\n            }\r\n        }\r\n        for (let child of childs) {\r\n            this.parseDEnumLiteral(dObject, child, generated);\r\n        }\r\n\r\n        /// *** specific end *** ///\r\n        return generated; }\r\n\r\n\r\n\r\n    static parseDEnumLiteral(parent: DEnumerator, json: Json, generated: DModelElement[]): DModelElement[] {\r\n        if (!generated) generated = [];\r\n        if (!json) { json = {}; }\r\n        const childs = this.getChildren(json);\r\n        let dObject: DEnumLiteral = DEnumLiteral.new();\r\n        generated.push(dObject); dObject.father = parent.id;\r\n        if (parent) parent.literals.push(dObject.id);\r\n        /// *** specific start *** ///\r\n        dObject.value = +this.read(json, EcoreLiteral.value, Number.NEGATIVE_INFINITY);//vv4\r\n        dObject.literal = this.read(json, EcoreLiteral.literal, '');\r\n        dObject.name = this.read(json, ECoreNamed.namee,  dObject.literal || 'literal_1');\r\n        /// *** specific end *** ///\r\n        return generated; }\r\n\r\n    static parseDAttribute(parent: DClass, json: Json, generated: DModelElement[]): DModelElement[] {\r\n        if (!generated) generated = [];\r\n        if (!json) { json = {}; }\r\n        const childs = this.getChildren(json);\r\n        let dObject: DAttribute = DAttribute.new();\r\n        generated.push(dObject); dObject.father = parent.id;\r\n        if (parent) parent.attributes.push(dObject.id);\r\n        dObject.name = this.read(json, ECoreNamed.namee, 'attr_1');\r\n        /// *** specific start *** ///\r\n        dObject.lowerBound = +this.read(json, ECoreAttribute.lowerbound, 0);\r\n        dObject.upperBound = +this.read(json, ECoreAttribute.upperbound, 1);\r\n        dObject.type = this.read(json, ECoreAttribute.eType, AttribETypes.EString);\r\n        /// *** specific end *** ///\r\n        return generated; }\r\n\r\n    static parseDReference(parent: DClass, json: Json, generated: DModelElement[]): DModelElement[] {\r\n        if (!generated) generated = [];\r\n        if (!json) { json = {}; }\r\n        const childs = this.getChildren(json);\r\n        let dObject: DReference = DReference.new();\r\n        generated.push(dObject); dObject.father = parent.id;\r\n        if (parent) parent.references.push(dObject.id);\r\n        dObject.name = this.read(json, ECorePackage.namee, 'Ref_1');\r\n        /// *** specific start *** ///\r\n        dObject.containment = U.fromBoolString(this.read(json, ECoreReference.containment, false), false);\r\n        dObject.lowerBound = +this.read(json, ECoreAttribute.lowerbound, 0);\r\n        dObject.upperBound = +this.read(json, ECoreAttribute.upperbound, 1);\r\n\r\n        dObject.type = this.read(json, ECoreReference.eType, this.getEcoreTypeName(parent));\r\n\r\n        console.log(\"attempting to parse dref\", {dObject, json, parent, typekey:  ECoreReference.eType})\r\n\r\n        /// *** specific end *** ///\r\n        return generated; }\r\n\r\n    static parseDParameter(parent: DOperation, json: Json, generated: DModelElement[]): DModelElement[] {\r\n        if (!generated) generated = [];\r\n        if (!json) { json = {}; }\r\n        const childs = this.getChildren(json);\r\n        let dObject: DParameter = DParameter.new();\r\n        generated.push(dObject); dObject.father = parent.id;\r\n        if (parent) parent.parameters.push(dObject.id);\r\n        dObject.name = this.read(json, ECoreNamed.namee, 'arg1');\r\n        /// *** specific start *** ///\r\n        dObject.lowerBound = +this.read(json, ECoreAttribute.lowerbound, 0);\r\n        dObject.upperBound = +this.read(json, ECoreAttribute.upperbound, 1);\r\n        dObject.type = this.read(json, ECoreAttribute.eType, AttribETypes.EString);\r\n        dObject.ordered = U.fromBoolString(this.read(json, ECoreOperation.ordered, 'false'), false);\r\n        dObject.unique = U.fromBoolString(this.read(json, ECoreOperation.unique, 'false'), false);\r\n        /// *** specific end *** ///\r\n        return generated; }\r\n\r\n    static parseDOperation(parent: DClass, json: Json, generated: DModelElement[]): DModelElement[] {\r\n        if (!generated) generated = [];\r\n        if (!json) { json = {}; }\r\n        const childs = this.getChildren(json);\r\n        let dObject: DOperation = DOperation.new();\r\n        generated.push(dObject); dObject.father = parent.id;\r\n        if (parent) parent.operations.push(dObject.id);\r\n        dObject.name = this.read(json, ECoreNamed.namee, 'operation_1');\r\n        /// *** specific start *** ///\r\n        dObject.lowerBound = +this.read(json, ECoreAttribute.lowerbound, 1);\r\n        dObject.upperBound = +this.read(json, ECoreAttribute.upperbound, 1);\r\n        dObject.type = this.read(json, ECoreAttribute.eType, AttribETypes.EString);\r\n        dObject.exceptions = [this.read(json, ECoreOperation.eexceptions, '')];\r\n        dObject.ordered = U.fromBoolString(this.read(json, ECoreOperation.ordered, 'false'));\r\n        dObject.unique = U.fromBoolString(this.read(json, ECoreOperation.unique, 'false'));\r\n        dObject.visibility = AccessModifier.package;\r\n        for (let child of childs) {\r\n            this.parseDParameter(dObject, json, generated);\r\n        }\r\n        /// *** specific end *** ///\r\n        return generated; }\r\n\r\n\r\n    /*\r\n    static parseTEMPLATE(parent: DSomething, json: Json, generated: DModelElement[]): DModelElement[] {\r\n        if (!generated) generated = [];\r\n        if (!json) { json = {}; }\r\n        const childs = this.getChildren(json);\r\n        let dObject: DSomething = DSomething.new();\r\n        generated.push(dObject); dObject.father = parent.id;\r\n        if (parent) parent.CHILDCOLLECTION.push(dObject.id);\r\n        dObject.name = this.read(json, ECoreNamed.namee, defaultNameTODO);\r\n        /// *** specific start *** ///\r\n        for (let child of childs) {\r\n            this.parseDSOMETHING(dObject, json, generated);\r\n        }\r\n        /// *** specific end *** ///\r\n        return generated; }*/\r\n\r\n\r\n\r\n\r\n\r\n    /////////////////////////////////// generic\r\n    static XMLinlineMarker: string = '@';\r\n    static classTypePrefix: string = '#//'\r\n    private static getAnnotations(thiss: Json): Json[] {\r\n        const ret: any = thiss[ECorePackage.eAnnotations];\r\n        if (!ret || $.isEmptyObject(ret)) { return []; }\r\n        if (Array.isArray(ret)) { return ret; } else { return [ret]; } }\r\n\r\n    private static getDetails(thiss: Json): Json[] {\r\n        const ret: any = thiss[ECoreAnnotation.details];\r\n        if (!ret || $.isEmptyObject(ret)) { return []; }\r\n        if (Array.isArray(ret)) { return ret; } else { return [ret]; } }\r\n\r\n    private static getChildren(thiss: Json, throwError: boolean = false, functions: boolean = false): Json[] {\r\n        if (!thiss && !throwError) { return []; }\r\n        const mod = thiss[ECoreRoot.ecoreEPackage];\r\n        const pkg = thiss[ECorePackage.eClassifiers];\r\n        const cla = thiss[functions ? ECoreClass.eOperations : ECoreClass.eStructuralFeatures];\r\n        const fun = thiss[ECoreOperation.eParameters];\r\n        const lit = thiss[ECoreEnum.eLiterals];\r\n\r\n        const ret: any = mod || pkg || cla || fun || lit;\r\n        /*if ( ret === undefined || ret === null ) {\r\n          if (thiss['@name'] !== undefined) { ret = thiss; } // if it's the root with only 1 child arrayless\r\n        }*/\r\n        Log.ex( throwError && !ret, 'getChildren() Failed: ', thiss, ret);\r\n        // console.log('ret = ', ret, ' === ', {}, ' ? ', ($.isEmptyObject(ret) ? [] : [ret]));\r\n        if (!ret || $.isEmptyObject(ret)) { return []; }\r\n        if (Array.isArray(ret)) { return ret; } else { return [ret]; }\r\n    }\r\n\r\n    private static read(json: Json, field: string, valueIfNotFound: any = 'read<T>()CanThrowError'): string {\r\n        let ret: any = json ? json[field] : null;\r\n        if (ret !== null && ret !== undefined && field.indexOf(this.XMLinlineMarker) !== -1) {\r\n            Log.ex(U.isObject(ret, false, false, true), 'inline value |' + field + '| must be primitive.', ret);\r\n            ret = U.multiReplaceAll('' + ret, ['&amp;', '&#38;', '&quot;'], ['&', '\\'', '\"']);\r\n        }\r\n        if ((ret === null || ret === undefined)) {\r\n            Log.ex(valueIfNotFound === 'read<T>()CanThrowError', 'this.read<',  '> failed: field[' + field + '], json: ', json);\r\n            return valueIfNotFound; }\r\n        return ret; }\r\n\r\n    static write(json: Json, field: string, val: string | any[]): string | any[] {\r\n        if (val !== null && field.indexOf(EcoreParser.XMLinlineMarker) !== -1) {\r\n            Log.ex(val !== '' + val, 'inline value |' + field + '| must be a string.', val);\r\n            val = U.multiReplaceAll(val as string, ['&', '\\'', '\"'], ['&amp;', '&#38;', '&quot;']);\r\n        }\r\n        else Log.ex(val !== '' + val || !U.isObject(val, true), 'primitive values should be inserted only inline in the xml:', field, val);\r\n        json[field] = val;\r\n        return val; }\r\n\r\n    private static getEcoreTypeName(parent: DClassifier): string {\r\n        if (parent.className === DEnumerator.name || parent.className === DClass.name) return this.classTypePrefix + this.name;\r\n        // return Type.classTypePrefix + parent.parent.name; problem: need L-object to navigate\r\n        return Log.ex(\"getEcoreTypeName failed\", parent);\r\n    }\r\n\r\n}\r\n\r\nexport enum AccessModifier {\r\n    public = 'public',\r\n    private = 'private',\r\n    protected = 'protected',\r\n    internal = 'internal',\r\n    package = 'package',\r\n    protectedinternal = 'protected internal',\r\n    protectedprivate = 'protected private', }\r\n\r\nexport class ECoreRoot {\r\n    static ecoreEPackage: string;\r\n}\r\n\r\nexport class ECoreAnnotation {\r\n    static source: string;\r\n    static references: string;\r\n    static details: string;}\r\nexport class ECoreNamed {\r\n    static namee: string; }\r\n\r\nexport class ECoreDetail {\r\n    static key: string;\r\n    static value: string; }\r\n\r\nexport class ECorePackage {\r\n    static eAnnotations: string;\r\n    static eClassifiers: string;\r\n    static xmlnsxmi: string;\r\n    static xmlnsxsi: string;\r\n    static xmiversion: string;\r\n    static xmlnsecore: string;\r\n    static nsURI: string;\r\n    static nsPrefix: string;\r\n    static namee: string;\r\n}\r\n\r\n\r\nexport class ECoreClass {\r\n    static eAnnotations: string;\r\n    static eStructuralFeatures: string;\r\n    static xsitype: string;\r\n    static namee: string;\r\n    static eOperations: string;\r\n    static instanceTypeName: string;\r\n    static eSuperTypes: string;\r\n    static abstract: string;\r\n    static interface: string;\r\n\r\n    // static defaultValue = EcoreParser.XMLinlineMarker + 'defaultValue';  // visualizzato in ecore ma mai salvato dentro il file. inutilizzato\r\n    // nelle classi, assume il valore di \"[name] = [NumericValue]\" senza le [] negli enum.\r\n}\r\n\r\nexport class ECoreEnum {\r\n    static eAnnotations: string;\r\n    static xsitype: string;\r\n    static namee: string;\r\n    static instanceTypeName: string;\r\n    static serializable: string;\r\n    static eLiterals: string;\r\n}\r\n\r\nexport class EcoreLiteral {\r\n    static eAnnotations: string;\r\n    static namee: string;\r\n    static value: string;\r\n    static literal: string;\r\n}\r\n\r\n\r\nexport class ECoreReference {\r\n    static eAnnotations: string;\r\n    static xsitype: string;\r\n    static eType: string;\r\n    static containment: string;\r\n    static upperbound: string;\r\n    static lowerbound: string;\r\n    static namee: string; }\r\n\r\nexport class ECoreAttribute {\r\n    static eAnnotations: string;\r\n    static xsitype: string;\r\n    static eType: string;\r\n    static namee: string;\r\n    static lowerbound: string;\r\n    static upperbound: string;\r\n}\r\n\r\nexport class ECoreOperation {\r\n    static eAnnotations: string;\r\n    static eType: string;\r\n    static eexceptions: string;\r\n    static upperBound: string;\r\n    static lowerBound: string;\r\n    static unique: string;\r\n    static ordered: string;\r\n    static namee: string;\r\n    static eParameters: string; }\r\n\r\nexport class ECoreParameter {\r\n    static eAnnotations: string;\r\n    static namee: string;\r\n    static ordered: string;\r\n    static unique: string;\r\n    static lowerBound: string;\r\n    static upperBound: string;\r\n    static eType: string;\r\n}\r\n\r\nexport class ECoreObject{\r\n    static xmlns_xmi: string;\r\n    static xmlns_uri: never; // \"-xmlns:org.eclipse.example.modelname\": \"https://org/eclipse/example/modelname\", <b>key is dynamic</b>\r\n    static xmi_version: string;\r\n}\r\nexport class XMIModel {\r\n    static type: string;\r\n    static namee: string; }\r\n\r\n\r\n///////////////\r\n\r\nECoreRoot.ecoreEPackage = 'ecore:EPackage';\r\nECoreNamed.namee = EcoreParser.XMLinlineMarker + 'name';\r\n\r\nECorePackage.eAnnotations = ECoreClass.eAnnotations = ECoreEnum.eAnnotations = EcoreLiteral.eAnnotations =\r\n    ECoreReference.eAnnotations = ECoreAttribute.eAnnotations = ECoreOperation.eAnnotations = ECoreParameter.eAnnotations = 'eAnnotations';\r\n\r\nECoreAnnotation.source = EcoreParser.XMLinlineMarker + 'source';\r\nECoreAnnotation.references = EcoreParser.XMLinlineMarker + 'references'; // \"#/\" for target = package.\r\nECoreAnnotation.details = 'details'; // arr\r\nECoreDetail.key = EcoreParser.XMLinlineMarker + 'key'; // can have spaces\r\nECoreDetail.value = EcoreParser.XMLinlineMarker + 'value';\r\n\r\nECorePackage.eClassifiers = 'eClassifiers';\r\nECorePackage.xmlnsxmi = EcoreParser.XMLinlineMarker + 'xmlns:xmi'; // typical value: http://www.omg.org/XMI\r\nECorePackage.xmlnsxsi = EcoreParser.XMLinlineMarker + 'xmlns:xsi'; // typical value: http://www.w3.org/2001/XMLSchema-instance\r\nECorePackage.xmiversion = EcoreParser.XMLinlineMarker + 'xmi:version'; // typical value: \"2.0\"\r\nECorePackage.xmlnsecore = EcoreParser.XMLinlineMarker + 'xmlns:ecore';\r\nECorePackage.nsURI = EcoreParser.XMLinlineMarker + 'nsURI'; // typical value: \"http://org/eclipse/example/modelname\"\r\nECorePackage.nsPrefix = EcoreParser.XMLinlineMarker + 'nsPrefix'; // typical value: org.eclipse.example.modelname\r\nECorePackage.namee = EcoreParser.XMLinlineMarker + 'name';\r\n\r\nECoreClass.eStructuralFeatures = 'eStructuralFeatures';\r\nECoreClass.eOperations = 'eOperations';\r\nECoreClass.xsitype = EcoreParser.XMLinlineMarker + 'xsi:type'; // \"ecore:EClass\"\r\nECoreClass.namee = ECorePackage.namee;\r\nECoreClass.eSuperTypes = EcoreParser.XMLinlineMarker + 'eSuperTypes'; // space separated: \"#name1 #name2\"...\r\nECoreClass.instanceTypeName = EcoreParser.XMLinlineMarker + 'instanceTypeName';  // raw str\r\nECoreClass.instanceTypeName = EcoreParser.XMLinlineMarker + 'instanceTypeName';\r\nECoreClass.abstract = EcoreParser.XMLinlineMarker + 'abstract'; // bool\r\nECoreClass.interface = EcoreParser.XMLinlineMarker + 'interface'; // bool\r\n\r\nECoreEnum.instanceTypeName = ECoreClass.instanceTypeName;\r\nECoreEnum.serializable = 'serializable'; // \"false\", \"true\"\r\nECoreEnum.xsitype = ECoreClass.xsitype; // \"ecore:EEnum\"\r\nECoreEnum.eLiterals = 'eLiterals';\r\nECoreEnum.namee = ECorePackage.namee;\r\n\r\nEcoreLiteral.literal = 'literal';\r\nEcoreLiteral.namee = ECorePackage.namee;\r\nEcoreLiteral.value = 'value'; // any integer (-inf, +inf), not null. limiti = a type int 32 bit? vv4\r\n\r\nECoreReference.xsitype = EcoreParser.XMLinlineMarker + 'xsi:type'; // \"ecore:EReference\"\r\nECoreReference.eType = EcoreParser.XMLinlineMarker + 'eType'; // \"#//Player\"\r\nECoreReference.containment = EcoreParser.XMLinlineMarker + 'containment'; // \"true\"\r\nECoreReference.upperbound = EcoreParser.XMLinlineMarker + 'upperBound'; // \"@1\"\r\nECoreReference.lowerbound = EcoreParser.XMLinlineMarker + 'lowerBound'; // does even exists?\r\nECoreReference.namee = EcoreParser.XMLinlineMarker + 'name';\r\n\r\nECoreAttribute.xsitype = EcoreParser.XMLinlineMarker + 'xsi:type'; // \"ecore:EAttribute\",\r\nECoreAttribute.eType = EcoreParser.XMLinlineMarker + 'eType'; // \"ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EString\"\r\nECoreAttribute.namee = EcoreParser.XMLinlineMarker + 'name';\r\nECoreAttribute.lowerbound = EcoreParser.XMLinlineMarker + 'lowerBound';\r\nECoreAttribute.upperbound = EcoreParser.XMLinlineMarker + 'upperBound';\r\n\r\n\r\nECoreOperation.eParameters = 'eParameters';\r\nECoreOperation.namee = EcoreParser.XMLinlineMarker + 'name'; // \"EExceptionNameCustom\",\r\nECoreOperation.ordered = EcoreParser.XMLinlineMarker + 'ordered'; // \"false\",\r\nECoreOperation.unique = EcoreParser.XMLinlineMarker + 'unique'; // \"false\",\r\nECoreOperation.lowerBound = EcoreParser.XMLinlineMarker + 'lowerBound'; // \"5\", ma che senso ha su una funzione?? è il return?\r\nECoreOperation.upperBound = EcoreParser.XMLinlineMarker + 'upperBound';\r\nECoreOperation.eType = EcoreParser.XMLinlineMarker + 'eType'; // \"#//Classname\",\r\nECoreOperation.eexceptions = EcoreParser.XMLinlineMarker + 'eExceptions';\r\n// \"#//ClassnameException1 #//ClassNameException2 (also custom classes) ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EInt\r\n\r\nECoreParameter.namee = EcoreParser.XMLinlineMarker + 'name';\r\nECoreParameter.ordered = EcoreParser.XMLinlineMarker + 'ordered'; // \"false\";\r\nECoreParameter.unique = EcoreParser.XMLinlineMarker + 'unique'; // \"false\"\r\nECoreParameter.lowerBound = EcoreParser.XMLinlineMarker + 'lowerBound'; // \"1\"\r\nECoreParameter.upperBound = EcoreParser.XMLinlineMarker + 'upperBound'; // \"2\"\r\nECoreParameter.eType = EcoreParser.XMLinlineMarker + 'eType'; // \"ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EDoubl\r\n\r\nECoreObject.xmlns_xmi = EcoreParser.XMLinlineMarker + 'xmlns:xmi'; // \"http://www.omg.org/XMI\"\r\n// ECoreObject.xmlns_uri = EcoreParser.XMLinlineMarker + 'xmlns:org.eclipse.example.modelname'; // \"https://org/eclipse/example/modelname\"\r\nECoreObject.xmi_version = EcoreParser.XMLinlineMarker + 'xmi:version'; // \"2.0\"\r\n\r\nXMIModel.type = EcoreParser.XMLinlineMarker + 'type';\r\nXMIModel.namee = EcoreParser.XMLinlineMarker + 'name';\r\n\r\n","import type {\r\n    DAttribute,\r\n    DClass,\r\n    DGraph,\r\n    DClassifier,\r\n    DEnumerator,\r\n    DGraphElement,\r\n    DRefEdge,\r\n    DVoidVertex,\r\n    GObject,\r\n    IStore,\r\n    LClass,\r\n    LEnumerator,\r\n    LGraphElement,\r\n    LOperation,\r\n    LPackage,\r\n    LRefEdge,\r\n    LViewElement,\r\n    LVoidVertex,\r\n    Pointer,\r\n} from \"../../joiner\";\r\nimport {\r\n    AbstractConstructor,\r\n    Constructor,\r\n    LModelElement,\r\n    DModel, LModel,\r\n    DModelElement, DNamedElement, DObject,\r\n    DPointerTargetable, DValue,\r\n    DViewElement, LNamedElement, LObject,\r\n    Log,\r\n    LPointerTargetable, LValue,\r\n    MyProxyHandler, OCL,\r\n    RuntimeAccessible,\r\n    RuntimeAccessibleClass,\r\n    store,\r\n    U, windoww, Pointers,\r\n} from \"../../joiner\";\r\nimport {EdgeOptions} from \"../store\";\r\nimport {DViewPoint, LViewPoint} from \"../../view/viewPoint/viewpoint\";\r\n\r\nenum ViewEClassMatch { // this acts as a multiplier for explicit priority\r\n    MISMATCH = 0,\r\n    IMPLICIT_MATCH = 1,\r\n    INHERITANCE_MATCH = 2,\r\n    EXACT_MATCH = 3,\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class Selectors{\r\n\r\n    static getActiveModel(): null|LModel {\r\n        let metamodel: null|LModel;\r\n        let state: IStore & GObject = store.getState();\r\n        const selected = state._lastSelected?.modelElement;\r\n        if(selected) {\r\n            const me = LModelElement.fromPointer(selected)\r\n            metamodel = (me) ? me.model : null;\r\n        } else metamodel = null;\r\n        return metamodel;\r\n    }\r\n\r\n    public static getLastSelectedModel<RET extends {m1?:LModel, m2?:LModel, model?:LModel, element?:LModelElement}>(state? :IStore): RET {\r\n        state = state || store.getState();\r\n        let me = state._lastSelected?.modelElement;\r\n        if (!me) return {} as RET;\r\n        let ret: RET = {element: LPointerTargetable.fromPointer(me, state)} as RET;\r\n        ret.model = ret.element!.model\r\n        if (ret.model.isMetamodel) ret.m2 = ret.model;\r\n        else {\r\n            ret.m1 = ret.model;\r\n            ret.m2 = ret.m1.instanceof;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    static getAllViewElements(): DViewElement[] {\r\n        // return Object.values(store.getState().idlookup).filter(v => v.className === DViewElement.name) as DViewElement[];\r\n        let state: IStore & GObject = store.getState();\r\n        const ptrs: Pointer<DViewElement, 0, 'N'> = Object.values((state).viewelements);\r\n        let views: DViewElement[] = ptrs.map<DViewElement>( (ptr) => state.idlookup[ptr] as DViewElement);\r\n        return views;\r\n    }\r\n    //Giordano: start\r\n\r\n    public static getViewpoints() : LViewPoint[] {\r\n        const state: IStore & GObject = store.getState();\r\n        return LViewPoint.fromPointer(state.viewpoints);\r\n    }\r\n    public static getViewpoint() : LViewPoint  {\r\n        const state: IStore & GObject = store.getState();\r\n        return LViewPoint.fromPointer(state.viewpoint);\r\n    }\r\n\r\n    public static getObjects(): LObject[] {\r\n        let state: IStore & GObject = store.getState();\r\n        const ptrs: Pointer<DObject, 0, 'N'> = Object.values((state).objects);\r\n        const dObjects: DObject[] = ptrs.map<DObject>( (ptr) => state.idlookup[ptr] as DObject);\r\n        const lObjects: LObject[] = [];\r\n        for(let dObject of dObjects) {\r\n            lObjects.push(LObject.fromPointer(dObject.id));\r\n        }\r\n        return lObjects;\r\n    }\r\n    public static getValues(): LValue[] {\r\n        let state: IStore & GObject = store.getState();\r\n        const ptrs: Pointer<DValue, 0, 'N'> = Object.values((state).values);\r\n        const dValues: DValue[] = ptrs.map<DValue>( (ptr) => state.idlookup[ptr] as DValue);\r\n        const lValues: LValue[] = [];\r\n        for(let dValue of dValues) {\r\n            if(dValue?.id) {\r\n                lValues.push(LValue.fromPointer(dValue.id));\r\n            }\r\n        }\r\n        return lValues;\r\n    }\r\n\r\n    public static getDeleted(): string [] {\r\n        const state: IStore & GObject = store.getState();\r\n        return state.deleted;\r\n    }\r\n\r\n    public static getState(): any {\r\n        const state: IStore & GObject = store.getState();\r\n        return state;\r\n    }\r\n\r\n    static removeEdge(id: number): EdgeOptions[] {\r\n        const state: IStore & GObject = store.getState();\r\n        const edges: EdgeOptions[] = [];\r\n        for(let edge of state.edges) {\r\n            if(edge.id !== id) {\r\n                edges.push(edge);\r\n            }\r\n        }\r\n        return edges;\r\n    }\r\n\r\n    static getAllPrimitiveTypes(): DClassifier[] {\r\n        let state: IStore & GObject = store.getState();\r\n        const ptrs: Pointer<DClassifier, 0, 'N'> = Object.values((state).primitiveTypes);\r\n        const classifiers: DClassifier[] = ptrs.map<DClassifier>( (ptr) => state.idlookup[ptr] as DClassifier);\r\n        return classifiers;\r\n    }\r\n    static getFirstPrimitiveTypes(): DClassifier {\r\n        return Selectors.getAllPrimitiveTypes()[0];\r\n    }\r\n    static getRefEdges(): DRefEdge[] {\r\n        const state: IStore & GObject = store.getState();\r\n        const pointers: Pointer<DRefEdge, 0, 'N', LRefEdge> = Object.values((state).refEdges);\r\n        const dRefEdges: DRefEdge[] = pointers.map<DRefEdge>( (ptr) => state.idlookup[ptr] as DRefEdge);\r\n        return dRefEdges;\r\n    }\r\n    static getField(field: string): string[] {\r\n        let state: IStore & GObject = store.getState();\r\n        const pointers: Pointer<DModelElement, 0, 'N'> = Object.values((state)[field]);\r\n        return pointers;\r\n    }\r\n\r\n    static getAllAttributes(): string[] {\r\n        const state: IStore = store.getState();\r\n        return Object.values((state).attributes);\r\n    }\r\n    static getAllEnumLiterals(): string[] {\r\n        const state: IStore = store.getState();\r\n        return Object.values((state).enumliterals);\r\n    }\r\n    static getAllReferences(): string[] {\r\n        const state: IStore = store.getState();\r\n        return Object.values((state).references);\r\n    }\r\n    static getAllReferenceEdges(): string[] {\r\n        const state: IStore = store.getState();\r\n        return Object.values((state).refEdges);\r\n    }\r\n    static getAllClasses(): string[] {\r\n        const state: IStore = store.getState();\r\n        return Object.values((state).classs);\r\n    }\r\n    static getReturnTypes(): LClass[] {\r\n        const state: IStore = store.getState();\r\n        return LPointerTargetable.from(Object.values((state).returnTypes));\r\n    }\r\n\r\n    static getAllClassesWithoutPrimitive(): string[] {\r\n        // this solution does not look good. what if a primitive type is inserted at runtime in between?\r\n        // coould reach the same goal by taking all Classes of a model (m2), excluding classes from other models (types are classes from m3 model)\r\n        const state: IStore = store.getState();\r\n        const classList: string[] = Object.values((state).classs);\r\n        classList.splice(0, Selectors.getAllPrimitiveTypes().length);\r\n        /* todo: need to change it in something like this once cross-references between models and instances are implemented\r\n        const m2: LModel;\r\n        m2.isInstanceOf = m3 as LModel;\r\n        m2.isInstanceOf.classes;*/\r\n\r\n        return classList;\r\n    }\r\n\r\n    static getAllEnumerators(flag = false): string[] {\r\n        const state: IStore = store.getState();\r\n        return Object.values((state).enumerators);\r\n    }\r\n    static getAllPackages(): string[] {\r\n        const state: IStore = store.getState();\r\n        return Object.values((state).packages);\r\n    }\r\n\r\n    static getAllParameters(): string[] {\r\n        const state: IStore = store.getState();\r\n        return Object.values((state).parameters);\r\n    }\r\n    static getAllOperations(): string[] {\r\n        const state: IStore = store.getState();\r\n        return Object.values((state).operations);\r\n    }\r\n\r\n    static getDElement<T extends DModelElement>(pointer: string): T {\r\n        const state: IStore & GObject = store.getState();\r\n        const dElement: T = state.idlookup[pointer] as T;\r\n        return dElement;\r\n    }\r\n\r\n    static getAllMetamodels(): LModel[] {\r\n        const state: IStore = store.getState();\r\n        const dModels = Object.values((state).m2models);\r\n        return LModel.fromPointer(dModels);\r\n    }\r\n\r\n    static getAllModels(): LModel[] {\r\n        const state: IStore = store.getState();\r\n        const dModels = Object.values((state).m1models);\r\n        return LModel.fromPointer(dModels);\r\n    }\r\n\r\n    //Giordano: end\r\n\r\n    static getVertex<W extends boolean = true, RP extends boolean = true>(wrap?: W /* = true */, resolvePointers?: RP /**/):\r\n        W extends false ? (RP extends false ? Pointer<DVoidVertex, 1, 1, LVoidVertex>[] : DVoidVertex[]) : LVoidVertex[] {\r\n        const state: IStore = store.getState();\r\n        let ptrs: Pointer<DVoidVertex>[] = [];\r\n\r\n        U.ArrayMerge0(false, ptrs,\r\n            // Object.values(state.graphs || {}),\r\n            Object.values(state.voidvertexs || {}),\r\n            Object.values(state.vertexs || {}),\r\n            Object.values(state.graphvertexs || {}),\r\n            Object.values(state.edgepoints || {}));\r\n\r\n        console.log('selector getvertex: ', {ptrs, g: Object.values(state.graphs || {}), vv:Object.values(state.voidvertexs || {}), v:Object.values(state.vertexs || {}), gv:Object.values(state.graphvertexs || {}), ep:Object.values(state.edgepoints || {})});\r\n        if (wrap === undefined || wrap === true) return ptrs.map( p => DPointerTargetable.wrap(p)) as any[];\r\n        if (resolvePointers === undefined || resolvePointers === true) return ptrs.map( r => state.idlookup[r]) as any[];\r\n        return ptrs as any[];\r\n    }\r\n\r\n    static getAll<D extends DPointerTargetable, L extends LPointerTargetable, DT extends typeof DPointerTargetable = typeof DPointerTargetable,\r\n        W extends undefined | true | false = false, RP extends undefined | true | false = true, RET = W extends false ? (RP extends false ? Pointer<D, 1, 1, L> : D) : L>\r\n        (Classe?: DT, condition?: (e:RET) => boolean, state?: IStore, resolvePointers?: RP /**/, wrap?: W /* = true */): RET[] {\r\n        if (!state) state = store.getState();\r\n        let GClass = (Classe as GObject) || {name:\"idlookup\"};\r\n        const className: string = (GClass?.staticClassName || GClass.name).toLowerCase();\r\n        const allIdByClassName: Pointer<D, 1, 1, L>[]\r\n            = (state as GObject)[className]\r\n            || (state as GObject)[className.substr(1)]\r\n            || (state as GObject)[className + 's']\r\n            || (state as GObject)[className.substr(1) + 's'];\r\n        Log.exDev(!allIdByClassName, 'cannot find store key:', {state, className, Classe});\r\n        let allDByClassName: D[] | null = null;\r\n        let allLByClassName: L[] | null = null;\r\n        if (resolvePointers || wrap) {\r\n            allDByClassName = allIdByClassName.map( (e) => (state as IStore).idlookup[e] ) as D[];\r\n            if (wrap) {\r\n                allLByClassName = allDByClassName.map( e => DPointerTargetable.wrap(e)) as any as L[];\r\n            }\r\n        }\r\n        let ret: RET[] = (resolvePointers || wrap ? (wrap ? allLByClassName : allDByClassName) : allIdByClassName) as any[] as RET[];\r\n        if (!Array.isArray(ret)) ret = Object.values(ret).filter(e => e instanceof Object) as RET[];\r\n        if (condition) return ret.filter( e => condition(e));\r\n        return ret;\r\n    }\r\n/*\r\n    static getModels(condition?: (m: DModel) => boolean): DModel[] {\r\n        /*\r\n        const className: Pointer<DPointerTargetable, 1, 1> = DViewElement.name.substr(1).toLowerCase() + 's';\r\n        const allByClassName: DPointerTargetable[] = state[className as string];\r\n        let models: DModel[] = state[className as string].map((mid) => state.idlookup[mid as string]) as DModel[];\r\n        if (condition) models = models.filter(condition);\r\n        return models; * /\r\n        return Selectors.getAll(DModel, undefined, undefined, resolvePointers, wrap); }*/\r\n\r\n    static getModel(name: string, caseSensitive: boolean = false, wrap: boolean = false): DModel | LModel | null {\r\n        if (!caseSensitive) name = name.toLowerCase();\r\n        let ret = Selectors.getAll<DModel, LModel>(DModel, (d) => (caseSensitive ? d.name : d.name.toLowerCase()) === name, undefined, true, wrap as any)[0];\r\n        return ret;\r\n    }\r\n\r\n    static getByName(classe: typeof DPointerTargetable, name: string, caseSensitive: boolean = false, wrap: boolean = false): DPointerTargetable | LPointerTargetable | null {\r\n        return Selectors.getByField(classe, 'name', name, caseSensitive, wrap); }\r\n\r\n    static getByField(classe: typeof DPointerTargetable, field: string, value: string, caseSensitive: boolean = false, wrap: boolean = false): DPointerTargetable | LPointerTargetable | null {\r\n        if (!caseSensitive) value = value.toLowerCase();\r\n        let condition = (d: any) => {\r\n            let ret = (caseSensitive ? d[field] : d[field]?.toLowerCase()) === value;\r\n            console.log('filtering getall by field:', {d, dfield:d[field], value, ret});\r\n            return ret;\r\n        }\r\n        let ret = Selectors.getAll(classe, condition, undefined, true, wrap as any)[0];\r\n        return ret; }\r\n\r\n    static getViews(condition?: (m: DModel) => boolean): DViewElement[] { return Selectors.getAll(DViewElement); }\r\n\r\n\r\n\r\n    private static queryJS(model: LModel, query: string): LPointerTargetable[] {\r\n        try {\r\n            return eval(query);\r\n        } catch (e) { return []; }\r\n    }\r\n    /*static getCurrentView(data: LModelElement): DViewElement {\r\n        Log.exDevv('todo');\r\n        return undefined as any;\r\n    }*/\r\n\r\n\r\n    // 2 = explicit exact match (===), 1 = matches a subclass, 0 = implicit match (any *), -1 = not matches\r\n    private static matchesOclCondition(v: DViewElement, data: DModelElement | LModelElement): ViewEClassMatch.MISMATCH | ViewEClassMatch.IMPLICIT_MATCH | ViewEClassMatch.EXACT_MATCH {\r\n        if (!v.query) return ViewEClassMatch.IMPLICIT_MATCH;\r\n        const query = v.query;\r\n        const viewpoint = Selectors.getViewpoint();\r\n        if(v.viewpoint !== viewpoint.id) { return ViewEClassMatch.IMPLICIT_MATCH; }\r\n        let constructors: Constructor[] = RuntimeAccessibleClass.getAllClasses() as (Constructor|AbstractConstructor)[] as Constructor[];\r\n        try {\r\n            const flag = OCL.filter(false, \"src\", [data], query, constructors);\r\n            console.clear(); console.log(flag)\r\n            if(flag.length > 0) return ViewEClassMatch.EXACT_MATCH + v.explicitApplicationPriority;\r\n            else return ViewEClassMatch.MISMATCH;\r\n        } catch (e) { console.error('invalid ocl query'); }\r\n        return ViewEClassMatch.MISMATCH;\r\n    }\r\n\r\n\r\n    private static matchesMetaClassTarget(v: DViewElement, data: DModelElement): ViewEClassMatch {\r\n        if (!v.appliableToClasses || !v.appliableToClasses.length) return ViewEClassMatch.IMPLICIT_MATCH;\r\n        if (!data) return ViewEClassMatch.MISMATCH;\r\n        let ThisClass: typeof DPointerTargetable = RuntimeAccessibleClass.get(data?.className);\r\n        Log.exDev(!ThisClass, 'unable to find class type:', {v, data}); // todo: v = view appliable to DModel, data = proxy<LModel>\r\n        let gotSubclassMatch: boolean = false;\r\n        for (let classtarget of v.appliableToClasses) {\r\n            const ClassTarget: typeof DPointerTargetable = RuntimeAccessibleClass.get(classtarget);\r\n            if (ThisClass === ClassTarget) return ViewEClassMatch.EXACT_MATCH; // explicit exact match\r\n            if (!gotSubclassMatch && U.classIsExtending(ThisClass, ClassTarget)) gotSubclassMatch = true; // explicit subclass match\r\n            if (gotSubclassMatch) return ViewEClassMatch.INHERITANCE_MATCH;\r\n        }\r\n        return ViewEClassMatch.MISMATCH;\r\n }\r\n\r\n    private static isOfSubclass(data: DPointerTargetable, classTarget: string | typeof DPointerTargetable, acceptEquality: boolean = false): boolean {\r\n        let ThisClass: typeof DPointerTargetable = RuntimeAccessibleClass.get(data.className);\r\n        Log.exDev(!ThisClass, 'isOfSubclass() unable to find class type:', {data});\r\n        const ClassTarget: typeof DPointerTargetable = typeof classTarget === \"string\"? RuntimeAccessibleClass.get(classTarget) : classTarget;\r\n        if (ThisClass === ClassTarget) return acceptEquality;\r\n        return U.classIsExtending(ThisClass, ClassTarget);\r\n    }\r\n\r\n\r\n\r\n    private static scoreView(v1: DViewElement, data: LModelElement, hisnode: DGraphElement | undefined, graph: LGraphElement, sameViewPointViews: Pointer<DViewElement, 1, 1>[] = []): number {\r\n        // 1° priority: matching by EClass type\r\n        let v1MatchingEClassScore: ViewEClassMatch = this.matchesMetaClassTarget(v1, data?.__raw);\r\n        // Log.l('score view:', {v1, data, v1MatchingEClassScore});\r\n        if (v1MatchingEClassScore === ViewEClassMatch.MISMATCH) return ViewEClassMatch.MISMATCH;\r\n        // 2° priority: by ocl condition matching\r\n        let v1OclScore = Selectors.matchesOclCondition(v1, data);\r\n        if (v1OclScore === ViewEClassMatch.MISMATCH) return ViewEClassMatch.MISMATCH;\r\n        // 3° priority by sub-view\r\n        let v1SubViewScore = Selectors.matchesOclCondition(v1, data);\r\n        if (v1SubViewScore === ViewEClassMatch.MISMATCH) return ViewEClassMatch.MISMATCH;\r\n        // second priority: matching by viewpoint / subViews\r\n        return (v1MatchingEClassScore * v1OclScore * v1SubViewScore) * v1.explicitApplicationPriority; }\r\n\r\n\r\n    static getAppliedViews(data: LModelElement, hisnode: DGraphElement | undefined, graph: LGraphElement,\r\n                           selectedViewId: Pointer<DViewElement, 0, 1, LViewElement>, parentViewId: Pointer<DViewElement, 0, 1, LViewElement>): Scored<DViewElement>[] {\r\n        const state : IStore = store.getState();\r\n        const allViews: DViewElement[] = [...Selectors.getAllViewElements()];\r\n        const selectedView: DViewElement | null = null; // selectedViewId ? state.idlookup[selectedViewId] as DViewElement : null;\r\n        const parentView: DViewElement | null = parentViewId ? state.idlookup[parentViewId] as DViewElement : null;\r\n        const sameViewPointSubViews: Pointer<DViewElement, 1, 1>[] = parentView ? parentView.subViews : []; // a viewpoint is a simple view that is targeting a model\r\n        if (selectedView) U.arrayRemoveAll(allViews, selectedView);\r\n        let sortedPriority: Scored<DViewElement>[] = allViews.map(\r\n            // v => new Scored<DViewElement>(Selectors.scoreView(v, data as any as DModelElement, hisnode, graph, sameViewPointSubViews), v)) as Scored<DViewElement>[];\r\n            (v) => {\r\n                return new Scored<DViewElement>(Selectors.scoreView(v, data, hisnode, graph, sameViewPointSubViews), v);}\r\n        ) as Scored<DViewElement>[];\r\n        sortedPriority.sort( (e1, e2) => e2.score - e1.score);\r\n        // todo: prioritize views \"children\" of the view of the graph, so they will display differnet views for the same element in different graphs\r\n        // then sort by  view selector matching: on classtype (eattribute, eoperation, eclass...), on values, upperbound...\r\n        if (selectedView) sortedPriority = [new Scored<DViewElement>('manually assigned' as any, selectedView), ...sortedPriority];\r\n        // sortedPriority = sortedPriority.map( s=> s.element) as any] : sortedPriority.map( s=> s.element) as any;\r\n\r\n        // Log.exDevv('viewscores', {data, sp:sortedPriority});\r\n        return sortedPriority;\r\n    }\r\n\r\n    static getAllMP(state?: IStore): DModelElement[] {\r\n        if (!state) state = store.getState();\r\n        let allD: DPointerTargetable[] = Object.values(state.idlookup);\r\n        return allD.filter( (d: DPointerTargetable) => U.isObject(d) && Selectors.isOfSubclass(d, DModelElement)) as DModelElement[]; }\r\n\r\n    static toObject<D extends DPointerTargetable>(ptrs: Pointer<D>[], state?: IStore):D[] {\r\n        if (!state) state = store.getState();\r\n        return ptrs.map(p => (state as IStore).idlookup[p]) as D[]; }\r\n\r\n    static wrap<D extends DPointerTargetable, L extends LPointerTargetable>(arr: (Pointer<D, 1, 1, L> | D)[], state?: IStore): L[] {\r\n        if (!arr.length) return [];\r\n        if (!state) state = store.getState();\r\n        let objarr: D[];\r\n        if (typeof arr[0] === \"string\") { objarr = Selectors.toObject(arr as string[], state); }\r\n        else objarr = arr as D[];\r\n        return objarr.map(p => RuntimeAccessibleClass.wrap(p)) as L[]; }\r\n\r\n    static unwrap<D extends DPointerTargetable, L extends LPointerTargetable>(arr:L[]): D[] { return arr.map( (a)=> a.__raw) as any[]; }\r\n    static getSubNodeElements(forGraph: Pointer<DGraph, 1, 1>, asPointers: boolean = false, wrap: boolean = false): Pointer<DGraphElement>[] | DGraphElement[] | LGraphElement[] {\r\n        const state : IStore = store.getState();\r\n        const g: DGraph = state.idlookup[forGraph] as DGraph;\r\n        if (asPointers) return g.subElements;\r\n        const subelements: DGraphElement[] = g.subElements.map( geid => state.idlookup[geid]) as DGraphElement[];\r\n        if (wrap) return subelements.map<LGraphElement>( (ge) => MyProxyHandler.wrap(ge));\r\n        return subelements; }\r\n\r\n\r\n\r\n\r\n    //// giordano part\r\n\r\n\r\n\r\n    public static getAllPackageClasses(id: string): LClass[] {\r\n        const data = MyProxyHandler.wrap(id) as GObject;\r\n        let lPackage : LPackage | undefined;\r\n        const classes: LClass[] = [];\r\n        if (data.className === \"DReference\") {\r\n            const lClass: LClass = MyProxyHandler.wrap(data.father);\r\n            lPackage = MyProxyHandler.wrap(lClass.father);\r\n        }\r\n        if (data.className === \"DParameter\") {\r\n            const lOperation: LOperation = MyProxyHandler.wrap(data.father);\r\n            const lClass: LClass = MyProxyHandler.wrap(lOperation.father);\r\n            lPackage = MyProxyHandler.wrap(lClass.father);\r\n        }\r\n        if (data.className === \"DOperation\") {\r\n            const lClass: LClass = MyProxyHandler.wrap(data.father);\r\n            lPackage = MyProxyHandler.wrap(lClass.father);\r\n        }\r\n        if (lPackage) {\r\n            for(let classifier of lPackage.classifiers) {\r\n                const lClassifier: LClass | LEnumerator = MyProxyHandler.wrap(classifier);\r\n                if(lClassifier.className === \"DClass\") classes.push(lClassifier as LClass);\r\n            }\r\n        }\r\n        return classes;\r\n    }\r\n    public static getAllPackageEnumerators(id: string): LEnumerator[] {\r\n        const data = MyProxyHandler.wrap(id) as GObject;\r\n        let lPackage : LPackage | undefined;\r\n        const enumerators: LEnumerator[] = [];\r\n        if(data.className === \"DAttribute\") {\r\n            const lClass: LClass = MyProxyHandler.wrap(data.father);\r\n            lPackage = MyProxyHandler.wrap(lClass.father);\r\n        }\r\n        if(data.className === \"DParameter\") {\r\n            const lOperation: LOperation = MyProxyHandler.wrap(data.father);\r\n            const lClass: LClass = MyProxyHandler.wrap(lOperation.father);\r\n            lPackage = MyProxyHandler.wrap(lClass.father);\r\n        }\r\n        if(data.className === \"DOperation\") {\r\n            const lClass: LClass = MyProxyHandler.wrap(data.father);\r\n            lPackage = MyProxyHandler.wrap(lClass.father);\r\n        }\r\n        if(lPackage) {\r\n            for(let classifier of lPackage.classifiers) {\r\n                const lClassifier: LClass | LEnumerator = MyProxyHandler.wrap(classifier);\r\n                if(lClassifier.className === \"DEnumerator\") enumerators.push(lClassifier as LEnumerator);\r\n            }\r\n        }\r\n        return enumerators;\r\n    }\r\n}\r\n\r\nclass Scored<T extends GObject> {\r\n    constructor(public score: number, public element: T) {}\r\n}\r\n","// import {Mixin} from \"ts-mixer\";\r\nimport {isDeepStrictEqual} from \"util\";\r\nimport {\r\n    BEGIN,\r\n    Constructors,\r\n    Dictionary,\r\n    DMap,\r\n    DModelElement,\r\n    DocString,\r\n    DPointerTargetable,\r\n    DUser, END,\r\n    getWParams,\r\n    GObject,\r\n    GraphPoint,\r\n    GraphSize,\r\n    IStore,\r\n    Leaf,\r\n    LMap,\r\n    LModelElement,\r\n    LogicContext,\r\n    LPointerTargetable,\r\n    MixOnlyFuncs,\r\n    Node, Pack1, PackArr, Point,\r\n    Pointer,\r\n    Pointers,\r\n    RuntimeAccessible,\r\n    RuntimeAccessibleClass,\r\n    SetFieldAction, Size,\r\n    store,\r\n    TargetableProxyHandler,\r\n    U\r\n} from \"../../joiner\";\r\n\r\n\r\nconsole.warn('ts loading graphDataElement');\r\n\r\nlet lgraph: LGraphElement = null /* this.node */ as any;\r\n\r\n\r\n@Node\r\n@RuntimeAccessible\r\nexport class DGraphElement extends DPointerTargetable {\r\n    // static _super = DPointerTargetable;\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LGraphElement;\r\n    // static logic: typeof LGraphElement;\r\n    // static structure: typeof DGraphElement;\r\n    id!: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    graph!: Pointer<DGraph, 1, 1, LGraph>; // todo: cerca graphID e rimpiazza / adatta\r\n    model?: Pointer<DModelElement, 0, 1, LModelElement>;\r\n    isSelected: Dictionary<DocString<Pointer<DUser>>, boolean> = {};\r\n    // containedIn!: Pointer<DGraphElement, 0, 1, LGraphElement>;\r\n    subElements!: Pointer<DGraphElement, 0, 'N', LGraphElement>;\r\n    state: DMap = {} as any;\r\n    father!: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    x: number = 0;\r\n    y: number = 0;\r\n    zIndex:number = 100;\r\n    w: number=300;\r\n    h: number=500;\r\n    // width: number = 300;\r\n    // height: number = 400;\r\n\r\n    public static new(model: DGraphElement[\"model\"], parentNodeID: DGraphElement[\"father\"], graphID: DGraphElement[\"graph\"], nodeID?: DGraphElement[\"id\"]): DGraphElement {\r\n        return new Constructors(new DGraphElement('dwc')).DPointerTargetable().DGraphElement(model, parentNodeID, graphID, nodeID).end();\r\n    }\r\n\r\n}\r\n@RuntimeAccessible\r\nexport class LGraphElement <Context extends LogicContext<DGraphElement> = any, C extends Context = Context> extends LPointerTargetable {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LGraphElement;\r\n    // static logic: typeof LGraphElement;\r\n    // static structure: typeof DGraphElement;\r\n    __raw!: DGraphElement;\r\n    id!: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    father!: LGraphElement;\r\n    graph!: LGraph; //???\r\n    model?: LModelElement;\r\n    isSelected!: Dictionary<DocString<Pointer<DUser>>, boolean>;\r\n    // containedIn?: LGraphElement;\r\n    subElements!: LGraphElement[]; // shallow, direct subelements\r\n    state!: LMap;\r\n    allSubNodes!: LGraphElement[]; // deep, nested subelements\r\n    x!: number;\r\n    y!: number;\r\n    width!: number;\r\n    height!: number\r\n    zIndex!: number;\r\n    zoom!: GraphPoint;\r\n    html!: Element;\r\n\r\n    // fittizi\r\n    w!:number;\r\n    h!:number;\r\n    size!: GraphSize;\r\n    position!: GraphPoint;\r\n    htmlSize!: Size; // size and position in global document coordinates.\r\n    htmlPosition!: Point;\r\n\r\n    get_graph(context: Context): LGraph {\r\n        return TargetableProxyHandler.wrap(context.data.graph); }\r\n\r\n    get_x(context: Context): this[\"x\"] { return context.data.x; }\r\n    set_x(val: this[\"x\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data.id, \"x\", val, undefined, false);\r\n        return true; }\r\n    get_y(context: Context): this[\"y\"] { return context.data.y; }\r\n    set_y(val: this[\"y\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data.id, \"y\", val, undefined, false);\r\n        return true; }\r\n\r\n    get_w(context: Context): this[\"w\"] { return context.data.w; }\r\n    set_w(val: this[\"w\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data.id, \"w\", val, undefined, false);\r\n        return true; }\r\n    get_h(context: Context): this[\"h\"] { return context.data.h; }\r\n    set_h(val: this[\"h\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data.id, \"h\", val, undefined, false);\r\n        return true; }\r\n\r\n    get_width(context: Context): this[\"w\"] { return this.get_w(context); }\r\n    set_width(val: this[\"w\"], context: Context): boolean { return this.set_w(val, context); }\r\n    get_height(context: Context): this[\"h\"] { return this.get_h(context); }\r\n    set_height(val: this[\"h\"], context: Context): boolean { return this.set_h(val, context); }\r\n\r\n    get_position(context: Context): this[\"position\"] { return new GraphPoint(context.data.x, context.data.y); }\r\n    set_position(val: this[\"position\"], context: Context): boolean {\r\n        BEGIN()\r\n        SetFieldAction.new(context.data.id, \"x\", val.x, undefined, false);\r\n        SetFieldAction.new(context.data.id, \"y\", val.y, undefined, false);\r\n        END()\r\n        return true; }\r\n\r\n    get_size(context: Context): this[\"size\"] { return new GraphSize(context.data.x, context.data.y, context.data.w, context.data.h); }\r\n    set_size(val: this[\"size\"], context: Context): boolean {\r\n        BEGIN()\r\n        SetFieldAction.new(context.data.id, \"x\", val.x, undefined, false);\r\n        SetFieldAction.new(context.data.id, \"y\", val.y, undefined, false);\r\n        SetFieldAction.new(context.data.id, \"w\", val.w, undefined, false);\r\n        SetFieldAction.new(context.data.id, \"h\", val.h, undefined, false);\r\n        END()\r\n        return true; }\r\n\r\n    get_html(context: Context): this[\"html\"] { return $(\"[node-id='\" + context.data.id + \"']\")[0]; }\r\n    set_html(val: this[\"htmlSize\"], context: Context): boolean { return this.cannotSet(\"set_html(). html is generated through jsx. edit the view instead.\"); }\r\n\r\n    get_htmlSize(context: Context): this[\"htmlSize\"] { let html = this.get_html(context); return Size.of(html); }\r\n    set_htmlSize(val: this[\"htmlSize\"], context: Context): boolean {\r\n        // might be useful for fixed display size/location elements that stay in place even if you move tab or change zoom. debatable if needed\r\n        this.cannotSet(\"set_htmlSize(): todo extra low priority. set GraphSize through set_size instead.\");\r\n        return true; }\r\n    get_htmlPosition(context: Context): this[\"htmlPosition\"] { return this.get_htmlSize(context).tl(); }\r\n    set_htmlPosition(val: this[\"htmlPosition\"], context: Context): boolean {\r\n        // might be useful for fixed display size/location elements that stay in place even if you move tab or change zoom. debatable if needed\r\n        this.cannotSet(\"set_htmlPosition(): todo extra low priority. set graph position through set_position instead.\");\r\n        return true; }\r\n\r\n    get_zIndex(context: Context): this[\"zIndex\"] { return context.data.zIndex; }\r\n    set_zIndex(val: this[\"zIndex\"], context: Context): boolean {\r\n        SetFieldAction.new(context.data.id, \"zIndex\", val, undefined, false);\r\n        return true; }\r\n    get_z(context: Context): this[\"zIndex\"] { return context.data.zIndex; }\r\n    set_z(val: this[\"zIndex\"], context: Context): boolean { return this.set_zIndex(val, context); }\r\n/*\r\n    get_containedIn(context: Context): this[\"containedIn\"] {\r\n        return context.data.containedIn ? LPointerTargetable.fromPointer(context.data.containedIn) : undefined; }\r\n    set_containedIn(val: Pack1<this[\"containedIn\"]>, context: LogicContext<DGraphElement>): boolean {\r\n        let ptr: DGraphElement[\"containedIn\"] = Pointers.from(val) as any;\r\n        SetFieldAction.new(context.data, 'containedIn', ptr, undefined, true);\r\n        if (ptr) SetFieldAction.new(ptr as any, 'subElements+=', context.data.id);\r\n        return true; }*/\r\n\r\n    get_subElements(context: Context): this[\"subElements\"] { return LPointerTargetable.fromArr(context.data.subElements); }\r\n    set_subElements(val: PackArr<this[\"subElements\"]>, context: LogicContext<DGraphElement>): boolean {\r\n        if (isDeepStrictEqual(context.data.subElements, val)) return true;\r\n        let pointers: Pointer<DGraphElement, 0, 'N', LGraphElement> = Pointers.from(val) || [];\r\n        SetFieldAction.new(context.data, 'subElements', pointers, '', true);\r\n        const idlookup = store.getState().idlookup;\r\n        // new subelements\r\n        for (let newsubelementid of pointers) {\r\n            let subelement: DGraphElement = (newsubelementid && idlookup[newsubelementid]) as DGraphElement;\r\n            if (subelement.father === context.data.id) continue;\r\n            LPointerTargetable.from(subelement).father = context.data.id as any; // trigger side-action\r\n        }\r\n        // old subelements\r\n        for (let oldsubelementid of context.data.subElements) {\r\n            let subelement: DGraphElement = (oldsubelementid && idlookup[oldsubelementid]) as DGraphElement;\r\n            if (subelement.father !== context.data.id) continue;\r\n            LPointerTargetable.from(subelement).father = null as any; // todo: can this happen? è transitorio o causa vertici senza parent permanenti?\r\n        }\r\n        return true;\r\n    }\r\n\r\n    get_model(context: Context): this[\"model\"] {\r\n        const modelElementId = $('[id=\"' + context.data.id + '\"]')[0].dataset.dataid;\r\n        const lModelElement: LModelElement = LPointerTargetable.from(modelElementId as string);\r\n        return lModelElement;\r\n    }\r\n\r\n    private get_allSubNodes(context: Context, state?: IStore): this[\"allSubNodes\"] {\r\n        // return context.data.packages.map(p => LPointerTargetable.from(p));\r\n        state = state || store.getState();\r\n        let tocheck: Pointer<DGraphElement>[] = context.data.subElements || [];\r\n        let checked: Dictionary<Pointer, true> = {};\r\n        checked[context.data.id] = true;\r\n        while (tocheck.length) {\r\n            let newtocheck: Pointer<DGraphElement>[] = [];\r\n            for (let ptr of tocheck) {\r\n                if (checked[ptr]) throw new Error(\"loop in GraphElements containing themselves\");\r\n                checked[ptr] = true;\r\n                let subnode: DGraphElement = DPointerTargetable.from(ptr, state);\r\n                U.arrayMergeInPlace(newtocheck, subnode?.subElements);\r\n            }\r\n            tocheck = newtocheck;\r\n        }\r\n        return LPointerTargetable.from(Object.keys(checked), state);\r\n    }\r\n\r\n\r\n    get_father(context: Context): this[\"father\"] { return LPointerTargetable.fromPointer(context.data.father); }\r\n    set_father(val: Pack1<this[\"father\"]>, context: Context): boolean {\r\n        let ptr: DGraphElement[\"father\"] = Pointers.from(val) as any;\r\n        SetFieldAction.new(context.data, 'father', ptr, undefined, true);\r\n        if (ptr) SetFieldAction.new(ptr as any, 'subElements+=', context.data.id);\r\n        return true; }\r\n\r\n    get_isSelected(context: LogicContext<DGraphElement>): this[\"isSelected\"] { return context.data.isSelected; }\r\n    set_isSelected(val: this[\"isSelected\"], context: LogicContext<DGraphElement>): boolean {\r\n        return this.cannotSet(\"graphElement.isSelected(): todo\"); }\r\n\r\n    get_state(context: LogicContext<DGraphElement>): this[\"state\"] {\r\n        let state: GObject = context.data.state;\r\n        for (let key in state) {\r\n            switch(key) {\r\n                case \"id\": break;\r\n                default: state[key] = LPointerTargetable.wrap(state[key]); break;\r\n            }\r\n        }\r\n        return state as any;\r\n    }\r\n    set_state(val: this[\"state\"], context: LogicContext<DGraphElement>): boolean {\r\n        return this.cannotSet(\"graphElement.isSelected(): todo\"); }\r\n\r\n}\r\nDPointerTargetable.subclasses.push(DGraphElement);\r\nLPointerTargetable.subclasses.push(LGraphElement);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n@RuntimeAccessible\r\nexport class DGraph extends DGraphElement {\r\n    // static _super = DGraphElement;\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LGraph;\r\n    // static logic: typeof LGraph;\r\n    // static structure: typeof DGraph;\r\n\r\n    // inherit redefine\r\n    father!: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    id!: Pointer<DGraph, 1, 1, LGraph>;\r\n    graph!: Pointer<DGraph, 1, 1, LGraph>;\r\n    model!: Pointer<DModelElement, 1, 1, LModelElement>;\r\n    isSelected: Dictionary<DocString<Pointer<DUser>>, boolean> = {};\r\n    // containedIn!: Pointer<DGraphElement, 0, 1, LGraphElement>;\r\n    subElements!: Pointer<DGraphElement, 0, 'N', LGraphElement>;\r\n    state: DMap = {} as any;\r\n    // personal attributes\r\n    zoom!: GraphPoint;\r\n    graphSize!: GraphSize; // internal size of the graph. can be huge even if the sub-graph is in a small window (scroll)\r\n\r\n    public static new(model: DGraph[\"model\"],\r\n                      parentNodeID?: DGraphElement[\"father\"], // immediate parent\r\n                      parentgraphID?: DGraphElement[\"graph\"], // graph containing this subgraph (redudant? could get it from father chain)\r\n                      nodeID?: DGraphElement[\"id\"] // this id\r\n    ): DGraph {\r\n        return new Constructors(new DGraph('dwc'), parentNodeID, true, DGraphElement).DPointerTargetable()\r\n            .DGraphElement(model, parentNodeID, parentgraphID, nodeID).DGraph(model, nodeID).end();\r\n    }\r\n\r\n\r\n    static getNodes(dmp: import(\"../logicWrapper/LModelElement\").DModelElement[], out: {$matched: JQuery<HTMLElement>; $notMatched: JQuery<HTMLElement>; }): JQuery<HTMLElement> {\r\n        let $allnodes = $('[data-dataid]');\r\n        let matchedids: Pointer[] = (dmp || []).map(d => d.id);\r\n        let matchedidmap:Dictionary<string, boolean> = U.objectFromArrayValues(matchedids);\r\n        if (!out) out = {} as any;\r\n\r\n        let allnodesarr = [...$allnodes];\r\n        let filternode = (d: HTMLElement) => {\r\n            if (!d?.dataset?.dataid) return false;\r\n            let id: string = ''+d?.dataset?.dataid;\r\n            return matchedidmap[id]; };\r\n        out.$matched = $(allnodesarr.filter(filternode));\r\n        out.$notMatched = $(allnodesarr.filter((n) => !filternode(n)));\r\n        console.error(\"getnodes\", {dmp, out, matchedidmap, matchedids, allnodesarr});\r\n        return out.$matched;\r\n        // throw new Error(\"Method not implemented.\");\r\n    }\r\n\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LGraph extends LGraphElement {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LGraph;\r\n    // static logic: typeof LGraph;\r\n    // static structure: typeof DGraph;\r\n\r\n    // inherit redefine\r\n    __raw!: DGraph;\r\n    id!: Pointer<DGraph, 1, 1, LGraph>;\r\n    graph!: LGraph;\r\n    model?: LModelElement;\r\n    isSelected: Dictionary<DocString<Pointer<DUser>>, boolean> = {};\r\n    // containedIn?: LGraphElement;\r\n    subElements!: LGraphElement[];\r\n    state!: LMap;\r\n    // personal attributes\r\n    zoom!: GraphPoint;\r\n    graphSize!: GraphSize; // size internal to the graph, while \"size\" is instead external size of the vertex holding the graph in GraphVertexes\r\n\r\n    get_size(context: LogicContext<DGraph>): GraphSize { return context.data.graphSize; }\r\n    get_graphSize(context: LogicContext<DGraph>): GraphSize { return context.data.graphSize; }\r\n    get_zoom(context: LogicContext<DGraph>): GraphPoint {\r\n        const zoom: GraphPoint = context.data.zoom;\r\n        (zoom as any).debug = {rawgraph: context.data, zoomx: context.data.zoom.x, zoomy: context.data.zoom.y}\r\n        return context.data.zoom; }\r\n}\r\nDGraphElement.subclasses.push(DGraph);\r\nLGraphElement.subclasses.push(LGraph);\r\n\r\nexport const defaultVSize: GraphSize = new GraphSize(0, 0, 300, 160); // useless?\r\nexport const defaultEPSize: GraphSize = new GraphSize(0, 0, 15, 15); // useless?\r\n\r\n@RuntimeAccessible\r\nexport class DVoidVertex extends DGraphElement {\r\n    // static _super = DGraphElement;\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LVoidVertex;\r\n    // static logic: typeof LVoidVertex;\r\n    // static structure: typeof DVoidVertex;\r\n\r\n    // inherit redefine\r\n    id!: Pointer<DVoidVertex, 1, 1, LVoidVertex>;\r\n    graph!: Pointer<DGraph, 1, 1, LGraph>;\r\n    model!: Pointer<DModelElement, 0, 1, LModelElement>;\r\n    isSelected: Dictionary<DocString<Pointer<DUser>>, boolean> = {};\r\n    // containedIn!: Pointer<DGraphElement, 0, 1, LGraphElement>;\r\n    subElements!: Pointer<DGraphElement, 0, 'N', LGraphElement>;\r\n    state: DMap = {} as any;\r\n    zoom!: GraphPoint;\r\n    // personal attributes\r\n    x!: number;\r\n    y!: number;\r\n    w!: number;\r\n    h!: number;\r\n    // size!: GraphSize; // virtual, gets extracted from this. x and y are stored directly here as it extends GraphSize\r\n\r\n    public static new(model: DGraphElement[\"model\"], parentNodeID: DGraphElement[\"father\"], graphID: DGraphElement[\"graph\"], nodeID?: DGraphElement[\"id\"],\r\n                      size: GraphSize = defaultVSize): DVoidVertex {\r\n        return new Constructors(new DVoidVertex('dwc')).DPointerTargetable().DGraphElement(model, parentNodeID, graphID, nodeID)\r\n            .DVoidVertex(size).end();\r\n    }\r\n\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LVoidVertex extends LGraphElement {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LVoidVertex;\r\n    // static logic: typeof LVoidVertex;\r\n    // static structure: typeof DVoidVertex;\r\n\r\n    // inherit redefine\r\n    __raw!: DVoidVertex;\r\n    id!: Pointer<DVoidVertex, 1, 1, LVoidVertex>;\r\n    graph!: LGraph;\r\n    model?: LModelElement;\r\n    isSelected: Dictionary<DocString<Pointer<DUser>>, boolean> = {};\r\n    // containedIn?: LGraphElement;\r\n    subElements!: LGraphElement[];\r\n    state!: LMap;\r\n    zoom!: GraphPoint;\r\n\r\n    // personal attributes\r\n    x!: number;\r\n    y!: number;\r\n    w!: number;\r\n    h!: number;\r\n    size!: GraphSize; // virtual, gets extracted from this. x and y are stored directly here as it extends GraphSize\r\n\r\n    get_size(context: LogicContext<DVoidVertex>): GraphSize {\r\n        return context.proxyObject as any; // new GraphSize(context.data.x, context.data.y, context.data.w, context.data.h);\r\n    }\r\n\r\n    // todo: devo settare che il primo parametro delle funzioni che iniziano con set_ non può essere un logicContext\r\n    set_size(val: GraphSize, context: LogicContext<DVoidVertex>): boolean {\r\n        // SetFieldAction.new(context.data, 'size', val, Action.SubType.vertexSize);\r\n        if (!val) { val = defaultVSize; }\r\n        console.trace('setsize:', {context, val});\r\n        if (context.data.x !== val.x) SetFieldAction.new(context.data, 'x', val.x);\r\n        if (context.data.y !== val.y) SetFieldAction.new(context.data, 'y', val.y);\r\n        if (context.data.w !== val.w) SetFieldAction.new(context.data, 'w', val.w);\r\n        if (context.data.h !== val.h) SetFieldAction.new(context.data, 'h', val.h);\r\n        // (context.proxy as unknown as LGraphElement).graph.graphSize\r\n        // update graph boundary too\r\n        console.log('setsize2, graph:', {context, val});\r\n        const graph: LGraph = this.get_graph(context); // (context.proxyObject as this).get_graph(context);\r\n        const gsize = graph.graphSize;\r\n        val.boundary(gsize);\r\n        if (val.equals(gsize)) return true;\r\n        graph.graphSize = val;\r\n        return true;\r\n    }\r\n\r\n    get_isSelected(context: LogicContext<DVoidVertex>): GObject {\r\n        return DPointerTargetable.mapWrap(context.data.isSelected, context.data, 'idlookup.' + context.data.id + '.isSelected', []);\r\n    }\r\n}\r\nDGraphElement.subclasses.push(DVoidVertex);\r\nLGraphElement.subclasses.push(LVoidVertex);\r\n\r\n@RuntimeAccessible\r\nexport class DEdgePoint extends DVoidVertex { // DVoidVertex\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LEdgePoint;\r\n    // static logic: typeof LEdgePoint;\r\n    // static structure: typeof DEdgePoint;\r\n\r\n    // inherit redefine\r\n    id!: Pointer<DEdgePoint, 1, 1, LEdgePoint>;\r\n    father!: Pointer<DVoidEdge, 1, 1, LVoidEdge>;\r\n    graph!: Pointer<DGraph, 1, 1, LGraph>;\r\n    // model!: Pointer<DModelElement, 0, 1, LModelElement>; gets model from this.father (edge)\r\n    isSelected: Dictionary<DocString<Pointer<DUser>>, boolean> = {};\r\n    // containedIn!: Pointer<DGraphElement, 0, 1, LGraphElement>;\r\n    subElements!: Pointer<DGraphElement, 0, 'N', LGraphElement>;\r\n    zoom!: GraphPoint;\r\n    x!: number;\r\n    y!: number;\r\n    w!: number;\r\n    h!: number;\r\n    size!: GraphSize; // virtual, gets extracted from this. x and y are stored directly here as it extends GraphSize\r\n    // personal attributes\r\n    __isDEdgePoint!: true;\r\n\r\n    public static new(model: undefined, parentNodeID: DEdgePoint[\"father\"], graphID?: DEdgePoint[\"graph\"], nodeID?: DGraphElement[\"id\"],\r\n                      size: GraphSize = defaultEPSize): DEdgePoint {\r\n        return new Constructors(new DEdgePoint('dwc'), parentNodeID, true).DPointerTargetable().DGraphElement(undefined, parentNodeID, graphID, nodeID)\r\n            .DVoidVertex(size).DEdgePoint().end();\r\n    }\r\n\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LEdgePoint extends LVoidVertex {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LEdgePoint;\r\n    // static logic: typeof LEdgePoint;\r\n    // static structure: typeof DEdgePoint;\r\n\r\n    // inherit redefine\r\n    // __raw!: DEdgePoint;\r\n    id!: Pointer<DEdgePoint, 1, 1, LEdgePoint>;\r\n    graph!: LGraph;\r\n    model?: LModelElement;\r\n    isSelected: Dictionary<DocString<Pointer<DUser>>, boolean> = {};\r\n    // containedIn?: LGraphElement;\r\n    subElements!: LGraphElement[];\r\n    zoom!: GraphPoint;\r\n    x!: number;\r\n    y!: number;\r\n    w!: number;\r\n    h!: number;\r\n    size!: GraphSize; // virtual, gets extracted from this. x and y are stored directly here as it extends GraphSize\r\n    // personal attributes\r\n    __isLEdgePoint!: true;\r\n}\r\nDVoidVertex.subclasses.push(DEdgePoint);\r\nLVoidVertex.subclasses.push(LEdgePoint);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n@RuntimeAccessible\r\nexport class DVertex extends DGraphElement { // DVoidVertex\r\n    // static _super = DVoidVertex;\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LVertex;\r\n    // static logic: typeof LVertex;\r\n    // static structure: typeof DVertex;\r\n\r\n    // inherit redefine\r\n    id!: Pointer<DVertex, 1, 1, LVertex>;\r\n    graph!: Pointer<DGraph, 1, 1, LGraph>;\r\n    model!: Pointer<DModelElement, 0, 1, LModelElement>;\r\n    isSelected: Dictionary<DocString<Pointer<DUser>>, boolean> = {};\r\n    // containedIn!: Pointer<DGraphElement, 0, 1, LGraphElement>;\r\n    subElements!: Pointer<DGraphElement, 0, 'N', LGraphElement>;\r\n    zoom!: GraphPoint;\r\n    x!: number;\r\n    y!: number;\r\n    w!: number;\r\n    h!: number;\r\n    // size!: GraphSize; // virtual, gets extracted from this. x and y are stored directly here as it extends GraphSize\r\n    // personal attributes\r\n    __isDVertex!: true;\r\n\r\n    public static new(model: DGraphElement[\"model\"], parentNodeID: DGraphElement[\"father\"], graphID: DGraphElement[\"graph\"], nodeID?: DGraphElement[\"id\"], size: GraphSize = defaultVSize): DVertex {\r\n        return new Constructors(new DVertex('dwc')).DPointerTargetable().DGraphElement(model, parentNodeID, graphID, nodeID)\r\n            .DVoidVertex(size).DVertex().end();\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LVertex extends LVoidVertex {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LVertex;\r\n    // static logic: typeof LVertex;\r\n    // static structure: typeof DVertex;\r\n\r\n    // inherit redefine\r\n    __raw!: DVertex;\r\n    id!: Pointer<DVertex, 1, 1, LVertex>;\r\n    graph!: LGraph;\r\n    model?: LModelElement;\r\n    isSelected!: Dictionary<DocString<Pointer<DUser>>, boolean>;\r\n    // containedIn?: LGraphElement;\r\n    subElements!: LGraphElement[];\r\n    zoom!: GraphPoint;\r\n    x!: number;\r\n    y!: number;\r\n    w!: number;\r\n    h!: number;\r\n    size!: GraphSize; // virtual, gets extracted from this. x and y are stored directly here as it extends GraphSize\r\n    // personal attributes\r\n    __isLVertex!: true;\r\n}\r\n\r\nDGraphElement.subclasses.push(DVertex);\r\nLGraphElement.subclasses.push(LVertex);\r\n\r\n\r\n@Leaf\r\n@RuntimeAccessible\r\nexport class DGraphVertex extends DGraphElement { // MixOnlyFuncs(DGraph, DVertex)\r\n    // static _super1 = DGraph;\r\n    // static _super2 = DVertex;\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LGraphVertex;\r\n    // static logic: typeof LGraphVertex;\r\n    // static structure: typeof DGraphVertex;\r\n\r\n    // inherit redefine\r\n    id!: Pointer<DGraphVertex, 1, 1, LGraphVertex>;\r\n    graph!: Pointer<DGraph, 1, 1, LGraph>;\r\n    model!: Pointer<DModelElement, 1, 1, LModelElement>;\r\n    isSelected: Dictionary<DocString<Pointer<DUser>>, boolean> = {};\r\n    // containedIn!: Pointer<DGraphElement, 0, 1, LGraphElement>;\r\n    subElements!: Pointer<DGraphElement, 0, 'N', LGraphElement>;\r\n    // from graph\r\n    zoom!: GraphPoint;\r\n    graphSize!: GraphSize; // internal size of the graph. can be huge even if the sub-graph is in a small window (scroll)\r\n\r\n    // from VoidVertex\r\n    x!: number;\r\n    y!: number;\r\n    w!: number;\r\n    h!: number;\r\n    // size!: GraphSize; // virtual\r\n\r\n    // personal attributes\r\n    __isDVertex!: true;\r\n    __isDGraph!: true;\r\n    __isDGraphVertex!: true;\r\n\r\n    public static new(model: DGraph[\"model\"], parentNodeID: DGraphElement[\"father\"], graphID: DGraphElement[\"graph\"], nodeID?: DGraphElement[\"id\"], size: GraphSize = defaultVSize): DGraphVertex {\r\n        return new Constructors(new DGraphVertex('dwc')).DPointerTargetable().DGraphElement(model, parentNodeID, graphID, nodeID)\r\n            .DVoidVertex(size).DVertex().DGraph(model, nodeID).end();\r\n    }\r\n\r\n\r\n/*\r\n    static init_constructor(thiss: DGraphVertex, isUser: boolean = false, nodeID: string | undefined, graphID: string | undefined, model: Pointer<DModel>): void {\r\n        DGraph.init_constructor(thiss, isUser, nodeID, graphID, model);\r\n//isUser: boolean = false, nodeID: string | undefined, graphID: string, model?: Pointer<DModel>\r\n        DVertex.init_constructor(thiss, isUser, nodeID, graphID as string, model);\r\n        thiss.className = this.name;\r\n    }*/\r\n}\r\n@RuntimeAccessible\r\nexport class LGraphVertex extends MixOnlyFuncs(LGraph, LVertex) { // MixOnlyFuncs(LGraph, LVertex)\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LGraphVertex;\r\n    // static logic: typeof LGraphVertex;\r\n    // static structure: typeof DGraphVertex;\r\n\r\n    // inherit redefine\r\n    __raw!: DGraphVertex;\r\n    id!: Pointer<DGraphVertex, 1, 1, LGraphVertex>;\r\n    graph!: LGraph;\r\n    model?: LModelElement;\r\n    isSelected!: Dictionary<DocString<Pointer<DUser>>, boolean>;\r\n    // containedIn?: LGraphElement;\r\n    subElements!: LGraphElement[];\r\n    // from graph\r\n    zoom!: GraphPoint;\r\n    graphSize!: GraphSize; // internal size of the graph. can be huge even if the sub-graph is in a small window (scroll)\r\n\r\n    // from VoidVertex\r\n    x!: number;\r\n    y!: number;\r\n    w!: number;\r\n    h!: number;\r\n    size!: GraphSize; // virtual\r\n\r\n\r\n    // personal attributes\r\n    __isLVertex!: true;\r\n    __isLGraph!: true;\r\n    __isLGraphVertex!: true;\r\n}\r\n\r\nDGraph.subclasses.push(DGraphVertex);\r\nDVertex.subclasses.push(DGraphVertex);\r\nLGraph.subclasses.push(LGraphVertex);\r\nLVertex.subclasses.push(LGraphVertex);\r\n\r\n\r\n\r\n\r\n\r\n@RuntimeAccessible\r\nexport class DVoidEdge extends DGraphElement {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LVoidEdge;\r\n    // static logic: typeof LVoidEdge;\r\n    // static structure: typeof DVoidEdge;\r\n    id!: Pointer<DVoidEdge, 1, 1, LVoidEdge>;\r\n    graph!: Pointer<DGraph, 1, 1, LGraph>;\r\n    model!: Pointer<DModelElement, 0, 1, LModelElement>;\r\n    isSelected: Dictionary<DocString<Pointer<DUser>>, boolean> = {};\r\n    // containedIn!: Pointer<DGraphElement, 0, 1, LGraphElement>;\r\n    subElements!: Pointer<DGraphElement, 0, 'N', LGraphElement>;\r\n\r\n    // personal attributes\r\n    start!: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    end!: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    __isDVoidEdge!: true;\r\n    midnodes!: Pointer<DEdgePoint, 1, 1, LEdgePoint>[];\r\n\r\n    public static new(model?: DGraphElement[\"model\"], parentNodeID?: DGraphElement[\"father\"], graphID?: DGraphElement[\"graph\"], nodeID?: DGraphElement[\"id\"],): DVoidEdge {\r\n        return new Constructors(new DVoidEdge('dwc'), graphID, true).DPointerTargetable().DGraphElement(model, parentNodeID, graphID, nodeID)\r\n            .DVoidEdge().end();\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LVoidEdge<Context extends LogicContext<DEdge> = any, D extends DEdge = DEdge> extends LGraphElement {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LVoidEdge;\r\n    // static logic: typeof LVoidEdge;\r\n    // static structure: typeof DVoidEdge;\r\n    __raw!: DVoidEdge;\r\n    id!: Pointer<DVoidEdge, 1, 1, LVoidEdge>;\r\n    graph!: LGraph;\r\n    model?: LModelElement;\r\n    isSelected!: Dictionary<DocString<Pointer<DUser>>, boolean>;\r\n    // containedIn?: LGraphElement;\r\n    subElements!: LGraphElement[];\r\n    start!: LGraphElement;\r\n    end!: LGraphElement;\r\n    __isLVoidEdge!: true;\r\n    midnodes!: LEdgePoint[];\r\n\r\n\r\n    protected get_midnodes(context: Context): this[\"midnodes\"] {\r\n        return LPointerTargetable.wrapAll(context.data.midnodes);\r\n    }\r\n    protected get_start(context: Context): this[\"start\"] { return LPointerTargetable.from(context.data.start); }\r\n    protected get_end(context: Context): this[\"end\"] { return LPointerTargetable.from(context.data.end); }\r\n}\r\nDGraphElement.subclasses.push(DVoidEdge);\r\nLGraphElement.subclasses.push(LVoidEdge);\r\n\r\n\r\n\r\n\r\n@RuntimeAccessible\r\nexport class DEdge extends DVoidEdge { // DVoidEdge\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LGraphElement;\r\n    // static logic: typeof LGraphElement;\r\n    // static structure: typeof DGraphElement;\r\n    id!: Pointer<DEdge, 1, 1, LEdge>;\r\n    graph!: Pointer<DGraph, 1, 1, LGraph>;\r\n    model!: Pointer<DModelElement, 0, 1, LModelElement>;\r\n    isSelected: Dictionary<DocString<Pointer<DUser>>, boolean> = {};\r\n    // containedIn!: Pointer<DGraphElement, 0, 1, LGraphElement>;\r\n    subElements!: Pointer<DGraphElement, 0, 'N', LGraphElement>;\r\n    state: DMap = {} as any;\r\n    start!: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    end!: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    __isDEdge!: true;\r\n    __isDVoidEdge!: true;\r\n    midnodes!: Pointer<DEdgePoint, 1, 1, LEdgePoint>[];\r\n\r\n    public static new(model: DGraph[\"model\"], parentNodeID: DGraphElement[\"father\"], graphID: DGraphElement[\"graph\"], nodeID?: DGraphElement[\"id\"], size: GraphSize = defaultVSize): DEdge {\r\n        return new Constructors(new DEdge('dwc')).DPointerTargetable().DGraphElement(model, parentNodeID, graphID, nodeID)\r\n            .DVoidEdge().DEdge().end();\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LEdge<Context extends LogicContext<DEdge> = any, D extends DEdge = DEdge> extends LVoidEdge {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LGraphElement;\r\n    // static logic: typeof LGraphElement;\r\n    // static structure: typeof DGraphElement;\r\n    __raw!: DEdge;\r\n    id!: Pointer<DEdge, 1, 1, LEdge>;\r\n    graph!: LGraph;\r\n    model?: LModelElement;\r\n    isSelected!: Dictionary<DocString<Pointer<DUser>>, boolean>;\r\n    // containedIn!: LGraphElement;\r\n    subElements!: LGraphElement[];\r\n    state!: LMap;\r\n    start!: LGraphElement;\r\n    end!: LGraphElement;\r\n    midnodes!: LEdgePoint[];\r\n    __isLEdge!: true;\r\n    __isLVoidEdge!: true;\r\n\r\n}\r\nDVoidEdge.subclasses.push(DEdge);\r\nLVoidEdge.subclasses.push(LEdge);\r\n\r\n\r\n\r\n@Leaf\r\n@RuntimeAccessible\r\nexport class DExtEdge extends DEdge { // etends DEdge\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LGraphElement;\r\n    // static logic: typeof LGraphElement;\r\n    // static structure: typeof DGraphElement;\r\n    id!: Pointer<DExtEdge, 1, 1, LExtEdge>;\r\n    graph!: Pointer<DGraph, 1, 1, LGraph>;\r\n    model!: Pointer<DModelElement, 0, 1, LModelElement>;\r\n    isSelected: Dictionary<DocString<Pointer<DUser>>, boolean> = {};\r\n    // containedIn!: Pointer<DGraphElement, 0, 1, LGraphElement>;\r\n    subElements!: Pointer<DGraphElement, 0, 'N', LGraphElement>;\r\n    state: DMap = {} as any;\r\n    start!: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    end!: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    __isDExtEdge!: true;\r\n    __isDEdge!: true;\r\n    __isDVoidEdge!: true;\r\n\r\n    public static new(model: DGraph[\"model\"], parentNodeID: DGraphElement[\"father\"], graphID: DGraphElement[\"graph\"], nodeID?: DGraphElement[\"id\"], size: GraphSize = defaultVSize): DExtEdge {\r\n        return new Constructors(new DExtEdge('dwc')).DPointerTargetable().DGraphElement(model, parentNodeID, graphID, nodeID)\r\n            .DVoidEdge().DEdge().DExtEdge().end();\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LExtEdge extends LEdge{\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LGraphElement;\r\n    // static logic: typeof LGraphElement;\r\n    // static structure: typeof DGraphElement;\r\n    __raw!: DExtEdge;\r\n    id!: Pointer<DExtEdge, 1, 1, LExtEdge>;\r\n    graph!: LGraph;\r\n    model?: LModelElement;\r\n    isSelected!: Dictionary<DocString<Pointer<DUser>>, boolean>;\r\n    // containedIn!: LGraphElement;\r\n    subElements!: LGraphElement[];\r\n    state!: LMap;\r\n    start!: LGraphElement;\r\n    end!: LGraphElement;\r\n    __isLExtEdge!: true;\r\n    __isLEdge!: true;\r\n    __isLVoidEdge!: true;\r\n}\r\nDEdge.subclasses.push(DExtEdge);\r\nLEdge.subclasses.push(LExtEdge);\r\n\r\n\r\n\r\n@Leaf\r\n@RuntimeAccessible\r\nexport class DRefEdge extends DEdge { // extends DEdge\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    start!: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    end!: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    __isDRefEdge!: true;\r\n\r\n    public static new(model: DGraph[\"model\"], parentNodeID: DGraphElement[\"father\"], graphID: DGraphElement[\"graph\"], nodeID?: DGraphElement[\"id\"]): DRefEdge {\r\n        return new Constructors(new DRefEdge('dwc')).DPointerTargetable().DGraphElement(model, parentNodeID, graphID, nodeID)\r\n            .DVoidEdge().DEdge().DRefEdge().end();\r\n    }\r\n\r\n}\r\n@RuntimeAccessible\r\nexport class LRefEdge extends LEdge {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // __raw!: DRefEdge;\r\n    start!: LGraphElement;\r\n    end!: LGraphElement;\r\n    __isLRefEdge!: true;\r\n}\r\nDEdge.subclasses.push(DRefEdge);\r\nLEdge.subclasses.push(LRefEdge);\r\n\r\n\r\n// for edges without a modelling element\r\n\r\n\r\n/*\r\n\r\nlet a = `DExtEdge, DRefEdge, DVoidEdge, LGraphVertex, LRefEdge, LEdgePoint, DVoidVertex, DGraphVertex, DEdgePoint, DVertex, DEdge, LVertex, LGraph, DGraph, LVoidVertex, LVoidEdge, LEdge, LGraphElement, LExtEdge, DGraphElement`; // // ... get from export in index.ts\r\na = a.replaceAll(',,', \",\")\r\nlet aa = a.split(\",\").map(a => a.trim().substring(1));\r\n\r\nfunction onlyUnique(value, index, self) { return self.indexOf(value) === index; }\r\n\r\naa = aa.filter(onlyUnique).filter( a=> !!a)\r\nlet r = aa.filter(onlyUnique).filter( a=> !!a).map( a=> `export type W${a} = getWParams<L${a}, D${a}>;`).join('\\n')\r\ndocument.body.innerText = r;\r\n*/\r\nexport type WExtEdge = getWParams<LExtEdge, DExtEdge>;\r\nexport type WRefEdge = getWParams<LRefEdge, DRefEdge>;\r\nexport type WVoidEdge = getWParams<LVoidEdge, DVoidEdge>;\r\nexport type WGraphVertex = getWParams<LGraphVertex, DGraphVertex>;\r\nexport type WEdgePoint = getWParams<LEdgePoint, DEdgePoint>;\r\nexport type WVoidVertex = getWParams<LVoidVertex, DVoidVertex>;\r\nexport type WVertex = getWParams<LVertex, DVertex>;\r\nexport type WEdge = getWParams<LEdge, DEdge>;\r\nexport type WGraph = getWParams<LGraph, DGraph>;\r\nexport type WGraphElement = getWParams<LGraphElement, DGraphElement>;\r\n\r\nconsole.warn('ts loading graphDataElement');\r\n","import {\r\n    Dictionary,\r\n    DocString,\r\n    DPointerTargetable,\r\n    IStore,\r\n    Log,\r\n    LPointerTargetable,\r\n    orArr,\r\n    Pack1,\r\n    Pointer,\r\n    RuntimeAccessible,\r\n    RuntimeAccessibleClass,\r\n    store,\r\n    U,\r\n    unArr,\r\n    windoww\r\n} from \"../../joiner\";\r\n\r\n// transactional-like start of storage modification\r\n// todo: nested transaction che conti quanti begin hai effettuato e crei una matrice di pendingActions una per ogni livello nested?\r\n\r\n/*\r\n// let nestedlevel: number = 0;\r\nclass NestedLevel{\r\n    level: number;\r\n    actions: Action[] = [];\r\n    up:NestedLevel[] = [];\r\n    down?:NestedLevel;\r\n\r\n    constructor(prevLevel?: NestedLevel, actions: Action[] = []) {\r\n        // this.prev = prev;\r\n        this.down = prevLevel;\r\n        this.actions = actions;\r\n        this.level = prevLevel ? prevLevel.level + 1 : 0;\r\n    }\r\n\r\n    add1(a:Action){ this.actions.push(a); }\r\n    add(a:Action[]){ this.actions.push(...a); }\r\n    push(actions:Action[]=[]){\r\n        this.up.push(new NestedLevel(this, actions));\r\n    }\r\n}\r\n// @Singleton\r\nclass NestedTransactionManager{\r\n    // private levels: NestedLevel[] = [];\r\n    public currentLevel?: NestedLevel;\r\n    // simple array is not good i can have spikes as russian mountains going up and down in deepness it's kinda a matrix or a pile of dishes like below'\r\n\r\n\r\n    /*\r\n    todo: to debug missing END paired with a begin, seve stack trace of begins and ends\r\n    * every level must have his own array?\r\n    * Begin0, Begin1, Begin2, End2, End1, Begin1.1 Begin 1.2....\r\n    it's a tree!\r\n    *\r\n    *\r\n    * ______begin lv2                              _______Begin1.2\r\n    * _________________________begin lv1           ___________________Begin1.1\r\n    * ____________________________________________________________________________________________________ a begin lv0\r\n    * * /\r\n    constructor() {}\r\n    begin(actions: Action[]=[]): void { this.pushLevel(actions); }\r\n    pushLevel(actions: Action[]=[]): void {\r\n        if (!this.currentLevel) { this.currentLevel = new NestedLevel(undefined, actions); return; }\r\n        this.currentLevel.push(actions); }\r\n    end(){\r\n        if (!this.currentLevel) return this.finalEnd();\r\n        this.currentLevel = this.currentLevel?.down; }\r\n    finalEnd(){\r\n\r\n    }\r\n    // current(): NestedLevel { return this.currentLevel; }\r\n    addActions(a:Action[]): void { this.currentLevel!.add(a); }\r\n    addAction(a:Action): void { this.currentLevel!.add1(a); }\r\n}\r\nlet transactionmanager = new NestedTransactionManager();\r\nfunction BEGIN2(){\r\n    transactionmanager.pushLevel();\r\n}\r\nfunction ABORT2(){\r\n    transactionmanager.end();\r\n}\r\nfunction END2(){\r\n\r\n}*/\r\n\r\nexport function BEGIN_OLD() {\r\n    pendingActions = [];\r\n    hasBegun = true;\r\n}\r\nexport function ABORT_OLD() {\r\n    hasBegun = false;\r\n    pendingActions = [];\r\n}\r\nexport function END_OLD(actionstoPrepend: Action[] = []): boolean | IStore {\r\n    hasBegun = false;\r\n    // for (let action of pendingActions) { }\r\n    const ca: CompositeAction = new CompositeAction( actionstoPrepend?.length ? [...actionstoPrepend, ...pendingActions] : pendingActions, false);\r\n    pendingActions = [];\r\n    return ca.fire();\r\n}\r\n\r\nlet pendingActions: Action[] = [];\r\nlet hasBegun = false;\r\nlet deepnessLevel = 0;\r\n\r\nexport function BEGIN() {\r\n    hasBegun = true; // redundant but actions are reading this, minimize changes\r\n    deepnessLevel++;\r\n}\r\nexport function ABORT() {\r\n    deepnessLevel--;\r\n    pendingActions = [];\r\n}\r\nexport function END(actionstoPrepend: Action[] = []): boolean {\r\n    deepnessLevel--;\r\n    if (actionstoPrepend.length) pendingActions = [...actionstoPrepend, ...pendingActions];\r\n\r\n    if (deepnessLevel < 0) { console.error(\"mismatching END()\"); deepnessLevel = 0; }\r\n    if (deepnessLevel === 0) return FINAL_END();\r\n    return false;\r\n}\r\nexport function FINAL_END(): boolean{\r\n    hasBegun = false;\r\n    const ca: CompositeAction = new CompositeAction(pendingActions, false);\r\n    pendingActions = [];\r\n    return ca.fire();\r\n}\r\n\r\n// make class isinstorage e mettici il path studia annotazioni per annotare gli oggett in modo che vengano rwappati prima di farli ritornare se sono annotati\r\n// minor todo: type as (...args: infer P) => any) ?\r\nexport function TRANSACTION<F extends ((...args: any) => any)>(func: F, ...params: Parameters<F>): boolean | IStore {\r\n    BEGIN();\r\n    // minor todo: potrei fare l'override di Error() per fare in modo che gli errori vengano presi anche se non uso TRANSACTION o try-catch ?\r\n    try { func(...params); } catch(e) { Log.ee('Transaction failed:', e); ABORT(); return false; }\r\n    return END();\r\n}\r\n\r\n@RuntimeAccessible\r\nexport abstract class Action extends RuntimeAccessibleClass{\r\n    static type = 'ACTION';\r\n    static SubType: {\r\n        vertexSubElements: 'vertexSubElements',\r\n        vertexSize: 'vertexSize'\r\n    };\r\n    hasFired: number = 0;\r\n    // targetID: string | undefined;\r\n    // target: IClass = null as any;\r\n    consoleTargetSelector: string = '';\r\n    // field: string = ''; // es: ID_58\r\n    // value: any; // es: lowerbound, name, namespace, values (for attrib-ref)...\r\n    type: string;\r\n    public field: string;\r\n    public value: any;\r\n    private src?: string[];\r\n    private stack?: string[];\r\n    subType?: string; //?\r\n    protected constructor(field: string, value: any, subType?: string){\r\n        super();\r\n        this.field = field;\r\n        this.value = value;\r\n        this.type = (this.constructor as any).type;\r\n        this.src = new Error().stack?.split('\\n').splice( 4);\r\n        this.subType = subType;\r\n        this.className = this.constructor.name;\r\n    }\r\n\r\n    fire(forceRelaunch: boolean = false): boolean {\r\n        if (this.hasFired && !forceRelaunch) return false;\r\n        if (hasBegun) {\r\n            pendingActions.push(this);\r\n        } else {\r\n            this.hasFired++;\r\n            let storee = store || windoww.store;\r\n            console.log('firing action:', {field: this.field, val: this.value, stack:this.src, thiss:this});\r\n            storee.dispatch({...this});\r\n        }\r\n        return true;\r\n    }\r\n\r\n    public static possibleInconsistencies: Dictionary<DocString<'subtype'>, Pointer[]> = {};\r\n    private static parse1(action: Action): ParsedAction {\r\n        const ret: ParsedAction = action as any;\r\n        ret.path = action.field; // normalize the path\r\n        ret.pathArray = ret.path.split('.');\r\n        ret.executionCount = 0;\r\n        if (!action.subType) return ret;\r\n        if (!Action.possibleInconsistencies[action.subType]) Action.possibleInconsistencies[action.subType] = [ action.value ];\r\n        else Action.possibleInconsistencies[action.subType].push(action.value);\r\n        return ret;\r\n    }\r\n\r\n    static parse<T extends Action | Action[], RET extends T extends any[] ? ParsedAction[] : ParsedAction>(actions: T): RET {\r\n        if ((actions as Action).className === CompositeAction.name) throw new Error(\"Composite action cannot be parsed directly, parse composite.actions instead\");\r\n        if (!Array.isArray(actions)) return Action.parse1(actions) as RET;\r\n        return actions.map( Action.parse1 ) as RET;\r\n    }\r\n}\r\n@RuntimeAccessible\r\nexport class LoadAction extends Action {\r\n    static type = 'LOAD';\r\n    static new(state: IStore): boolean {  return state && new LoadAction(state).fire(); }\r\n    constructor(state: IStore, fire: boolean = true) {\r\n        super('', state, '');\r\n        this.className = this.constructor.name;\r\n        if (fire) this.fire();\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class SetRootFieldAction extends Action {\r\n    static type = 'SET_ROOT_FIELD';\r\n    isPointer: boolean;\r\n\r\n\r\n\r\n    static new(fullpath: string, val: string | string[], accessModifier: AccessModifier | undefined, isPointer: boolean): boolean;\r\n    static new<\r\n        VAL extends any,\r\n        PATH extends VAL extends string | string[] ? 'must specify \"isPointer\" parameter' : string,\r\n        // VAL extends (AM extends undefined | '' ? D[T] : (AM extends '-=' ? number[] : (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<D[T]> | D[T] | D[T][] : '_error_'))),\r\n        /*VAL extends (AM extends undefined | '' ? (D[T] extends any[] ? StrictExclude<D[T], string[]> : StrictExclude<D[T], string>) :\r\n            (AM extends '-=' ?\r\n                number[] :\r\n                (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<StrictExclude<D[T], string>> | StrictExclude<D[T], string> | (StrictExclude<D[T], string>)[] : '_error_'))),\r\n        */\r\n        ISPOINTER extends boolean,\r\n        AM extends AccessModifier | undefined = undefined,\r\n        // T extends arrayFieldNameTypes<D> = any\r\n        >(fullpath: PATH, val: VAL, accessModifier?: AM | undefined, isPointer?: ISPOINTER): boolean;\r\n    static new<\r\n        T extends string,\r\n        VAL extends any,\r\n        ISPOINTER extends boolean,\r\n        AM extends AccessModifier | undefined = undefined,\r\n        // T extends arrayFieldNameTypes<D> = any\r\n        >(fullpath: T, val: VAL, accessModifier: AM | undefined = undefined, isPointer?: ISPOINTER): boolean {\r\n        if (accessModifier) (fullpath as any) += accessModifier;\r\n        return new SetRootFieldAction(fullpath, val, false, isPointer).fire();\r\n    }\r\n\r\n    protected constructor(fullpath: string, value: any = undefined, fire: boolean = true, isPointer: boolean = false) {\r\n        super(fullpath, value, undefined);\r\n        this.className = this.constructor.name;\r\n        this.isPointer = isPointer;\r\n        if (fire) this.fire();\r\n    }\r\n\r\n    static create<\r\n        T extends string,\r\n        VAL extends any,\r\n        ISPOINTER extends boolean,\r\n        AM extends AccessModifier | undefined = undefined,\r\n        // T extends arrayFieldNameTypes<D> = any\r\n        >(fullpath: T, val: VAL, accessModifier: AM | undefined = undefined, isPointer?: ISPOINTER): SetRootFieldAction {\r\n        return new SetRootFieldAction(fullpath + (accessModifier || ''), val, false, isPointer);\r\n    }\r\n}\r\n\r\n// todo: ma non so come, fare in modo che [], +=, -=, siano disponibili solo se la chiave è il nome di un attributo di tipo array\r\ntype arrayFieldNameTypes<D> = keyof D | `${string & keyof D}[]` | `${string & keyof D}+=` | `${string & keyof D}-=` | `${string & keyof D}.${number}` | `${string & keyof D}[${number}]`;\r\ntype AccessModifier = '' | '[]' | '+=' | '-=' | `.${number}` | `[${number}]` | undefined;\r\n\r\n\r\ntype StrictExclude<T, U> = T extends U ? U extends T ? never : T : T;\r\n\r\n@RuntimeAccessible\r\nexport class SetFieldAction extends SetRootFieldAction {\r\n    static type = 'SET_ME_FIELD';\r\n/*\r\n    static new<\r\n        D extends DPointerTargetable,\r\n        T extends (keyof D),\r\n        AM extends AccessModifier | undefined = ''\r\n        >(me: D | Pointer<D>,\r\n          field: T,\r\n          val: string | string[],\r\n          accessModifier: AM | undefined,\r\n          isPointer: boolean): boolean;*/\r\n    static new<\r\n        D extends DPointerTargetable,\r\n        T extends (keyof D),\r\n        VAL extends\r\n            D[T] extends string | string[] ? 'must specify \"isPointer\" parameter' :\r\n            (AM extends undefined | '' ? D[T] : (AM extends '-=' ? number[] : (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<D[T]> | D[T] | D[T][] : '_error_'))),\r\n        // VAL extends (AM extends undefined | '' ? D[T] : (AM extends '-=' ? number[] : (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<D[T]> | D[T] | D[T][] : '_error_'))),\r\n        /*VAL extends (AM extends undefined | '' ? (D[T] extends any[] ? StrictExclude<D[T], string[]> : StrictExclude<D[T], string>) :\r\n            (AM extends '-=' ?\r\n                number[] :\r\n                (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<StrictExclude<D[T], string>> | StrictExclude<D[T], string> | (StrictExclude<D[T], string>)[] : '_error_'))),\r\n        */\r\n        ISPOINTER extends boolean | \"todo: ISPOINTER type = boolean but required only if val is UnArr< string > = string | string[], maybe do with override\",\r\n        AM extends AccessModifier | undefined = undefined,\r\n        // T extends arrayFieldNameTypes<D> = any\r\n        >(me: D | Pointer<D>,\r\n          field: T,\r\n          val: VAL,\r\n          accessModifier?: AM | undefined,\r\n          isPointer?: ISPOINTER): boolean;\r\n    static new<\r\n        D extends DPointerTargetable,\r\n        T extends (keyof D),\r\n        VAL extends AM extends '' | undefined ? orArr<string | null | undefined> :\r\n            (AM extends '-=' ? orArr<number> :\r\n                (AM extends '+=' ? orArr<string | null | undefined> : '_am_typeerror_')),\r\n        AM extends AccessModifier | undefined = undefined,\r\n        >(me: D | Pointer<D>, field: T,\r\n          val: VAL,\r\n          accessModifier: AM,\r\n          isPointer: boolean): boolean;\r\n\r\n    static new<\r\n        D extends DPointerTargetable,\r\n        T extends string & (keyof D),\r\n        VAL extends (AM extends undefined | '' ? D[T] : (AM extends '-=' ? number[] : (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<D[T]> | D[T] | D[T][] : '_error_'))),\r\n        ISPOINTER extends boolean | \"todo: ISPOINTER type = boolean but required only if val is UnArr< string > = string | string[], maybe do with override\",\r\n        AM extends AccessModifier | undefined = undefined,\r\n    // T extends arrayFieldNameTypes<D> = any\r\n        >(me: D | Pointer<D>, field: T, val: VAL, accessModifier: AM | undefined = undefined, isPointer?: ISPOINTER): boolean {\r\n        if (accessModifier) (field as any) += accessModifier;\r\n        return new SetFieldAction(me, field, val, false, isPointer as boolean).fire();\r\n    }\r\n\r\n\r\n    // field can end with \"+=\", \"[]\", or \"-1\" if it's array\r\n    protected constructor(me: DPointerTargetable | Pointer, field: string, val: any, fire: boolean = true, isPointer: boolean = false) {\r\n        Log.exDev(!me, 'BaseObject missing in SetFieldAction', {me, field, val});\r\n        super('idlookup.' + ((me as DPointerTargetable).id || me) + ( field ? '.' + field : ''), val, false, isPointer);\r\n        this.className = this.constructor.name;\r\n        if (fire) this.fire();\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n/*\r\ntodo: showcase this\r\nlet dclass: DClass = null as any;\r\nSetFieldAction.new(dclass, 'namek', '') // non è un attributo di \"DCLass\"\r\nSetFieldAction.new(dclass, 'parent', '') // val (stringa) non è assegnabile a parent (array di puntatori)\r\nSetFieldAction.new(dclass, 'name.5k', '') // non è un indice array valido\r\nSetFieldAction.new(dclass, 'name[4k]', '') // non è un indice array valido\r\nSetFieldAction.new(dclass, 'name[4]', '') // ok, anche se non dovrebbe accettare la dicitura array per name che è un primitivo (check non implementato, troppo difficile)\r\nSetFieldAction.new(dclass, 'name.5', '') // ok, equivale a dicitura array\r\n*/\r\n\r\n@RuntimeAccessible\r\nexport class RedoAction extends Action {\r\n    static type = 'RedoAction';\r\n    public static new<F extends boolean = true>(amount: number = 1, notfire?: F): (F extends false ? boolean : RedoAction) {\r\n        let act = new RedoAction(amount);\r\n        if (!notfire) return act.fire() as any;\r\n        return act as any;\r\n    }\r\n    private constructor(amount: number = 1) {\r\n        super('', amount);\r\n        this.className = this.constructor.name;\r\n    }\r\n}\r\n@RuntimeAccessible\r\nexport class UndoAction extends Action {\r\n    static type = 'UndoAction';\r\n    public static new<F extends boolean = true>(amount: number = 1, notfire?: F): (F extends false ? boolean : UndoAction) {\r\n        let act = new UndoAction(amount);\r\n        if (!notfire) return act.fire() as any;\r\n        return act as any;\r\n    }\r\n    private constructor(amount: number = 1) {\r\n        super('', amount);\r\n        this.className = this.constructor.name;\r\n    }\r\n}\r\n@RuntimeAccessible\r\nexport class CombineHistoryAction extends Action {\r\n    static type = 'CombineHistoryAction';\r\n    public static new<F extends boolean = true>(notfire?: F): (F extends false ? boolean : CombineHistoryAction) {\r\n        let act = new CombineHistoryAction();\r\n        if (!notfire) return act.fire() as any;\r\n        return act as any;\r\n    }\r\n    private constructor() {\r\n        super('', '');\r\n        this.className = this.constructor.name;\r\n    }\r\n}\r\n@RuntimeAccessible\r\nexport class CreateElementAction extends Action {\r\n    static type = 'CREATE_ELEMENT';\r\n    value!: DPointerTargetable;\r\n    public static newBatch<F extends boolean = true>(me: DPointerTargetable[], notfire?: F): (F extends false ? boolean : CreateElementAction)[]{\r\n        return me.map( (e) => CreateElementAction.new(e, notfire));\r\n    }\r\n\r\n    public static new<F extends boolean = true>(me: DPointerTargetable , notfire?: F): (F extends false ? boolean : CreateElementAction) {\r\n        if ((me as LPointerTargetable).__raw) me = (me as LPointerTargetable).__raw;\r\n        let act = new CreateElementAction(me, !notfire);\r\n        if (!notfire) return act.fire() as any;\r\n        return act as any;\r\n    }\r\n    private constructor(me: DPointerTargetable, fire: boolean = true) {\r\n        super('idlookup.' + me.id, me);\r\n        this.className = this.constructor.name;\r\n        this.value = me;\r\n        if (fire) this.fire();\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class DeleteElementAction extends SetFieldAction {\r\n    static type = 'DELETE_ELEMENT';\r\n    public static new(me: Pack1<LPointerTargetable>): boolean {\r\n        return new DeleteElementAction(me as any).fire(); }\r\n    constructor(me: DPointerTargetable | Pointer) {\r\n        super((me as DPointerTargetable).id || me, '', undefined);\r\n        this.className = this.constructor.name;\r\n        this.fire();\r\n    }\r\n}\r\n/*\r\n\r\n@RuntimeAccessible\r\nexport class IDLinkAction extends Action{\r\n    constructor() {\r\n        super(IDLinkAction.name,\r\n    }\r\n    nope, uso un proxy\r\n}*/\r\n\r\n@RuntimeAccessible\r\nexport class CompositeAction extends Action {\r\n    static type: string = 'COMPOSITE_ACTION';\r\n    actions: Action[] = [];\r\n\r\n    public static new(actions: Action[], launch: boolean = true): CompositeAction { return new CompositeAction(actions, launch); }\r\n    constructor(actions: Action[], launch: boolean = false) {\r\n        super('', '');\r\n        this.actions = actions;\r\n        this.className = this.constructor.name;\r\n        if (launch) this.fire();\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class ParsedAction extends SetRootFieldAction {\r\n    path!: string; // path to a property in the store \"something.like.this\"\r\n    pathArray!: string[]; // path splitted \"like.1.this\"\r\n    executionCount!: number;\r\n\r\n}\r\n","import React, {Dispatch, ReactElement, ReactNode} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {IStore} from \"../../redux/store\";\r\nimport {DPointerTargetable, GObject, LPointerTargetable, Pointer} from \"../../joiner\";\r\n\r\n\r\nfunction TextAreaComponent(props: AllProps) {\r\n    const data = props.data;\r\n    const field = props.field;\r\n    const value = (data[field] !== undefined) ? data[field] : 'undefined';\r\n    const label: string|undefined = props.label;\r\n    const jsxLabel: ReactNode|undefined = props.jsxLabel;\r\n    const tooltip = props.tooltip;\r\n    let css = 'my-auto input ';\r\n    css += (jsxLabel) ? 'ms-1' : (label) ? 'ms-auto' : '';\r\n    css += (props.hidden) ? ' hidden-input' : '';\r\n\r\n    const change = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        const target: string = evt.target.value;\r\n        data[field] = target;\r\n    }\r\n\r\n    return(<div style={{display: (jsxLabel || label) ? 'flex' : 'block'}} className={'p-1'}>\r\n        {(label && !jsxLabel) && <label className={'my-auto'}>\r\n            {label}\r\n        </label>}\r\n        {(jsxLabel && !label) && <label className={'my-auto'}>\r\n            {jsxLabel}\r\n        </label>}\r\n        <textarea spellCheck={false} readOnly={props.readonly} className={css}\r\n               onChange={change} value={value} />\r\n    </div>);\r\n}\r\ninterface OwnProps {\r\n    obj: LPointerTargetable | DPointerTargetable | Pointer<DPointerTargetable, 1, 1, LPointerTargetable>;\r\n    field: string;\r\n    label?: string;\r\n    jsxLabel?: ReactNode;\r\n    readonly?: boolean;\r\n    tooltip?: string;\r\n    hidden?: boolean;\r\n}\r\ninterface StateProps { data: LPointerTargetable & GObject; }\r\ninterface DispatchProps { }\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    const pointer: Pointer = typeof ownProps.obj === 'string' ? ownProps.obj : ownProps.obj.id;\r\n    ret.data = LPointerTargetable.fromPointer(pointer);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const TextAreaConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(TextAreaComponent);\r\n\r\nexport const TextArea = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <TextAreaConnected {...{...props, children}} />;\r\n}\r\nexport default TextArea;\r\n","import React, {Dispatch, ReactElement, ReactNode} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {IStore} from \"../../redux/store\";\r\nimport {LPointerTargetable, GObject, Pointer, LEnumerator, Selectors, LModelElement} from \"../../joiner\";\r\nimport type {LClass, DPointerTargetable} from \"../../joiner\";\r\nimport toast, {Toaster} from \"react-hot-toast\";\r\n\r\n\r\nfunction SelectComponent(props: AllProps) {\r\n    const data = props.data;\r\n    if(!data) return(<></>);\r\n    const field = props.field;\r\n    const value = (data[field]?.id) ? data[field].id : 'undefined';\r\n    const label: string|undefined = props.label;\r\n    const jsxLabel: ReactNode|undefined = props.jsxLabel;\r\n    const tooltip = props.tooltip;\r\n    let css = 'my-auto select ';\r\n    css += (jsxLabel) ? 'ms-1' : 'ms-auto';\r\n    css += (props.hidden) ? ' hidden-input' : '';\r\n\r\n    const notify = () => toast((t: GObject) => (\r\n        <div onClick={() => toast.dismiss(t.id)}>\r\n            <label className={'ms-1'}>{tooltip}</label>\r\n        </div>\r\n    ));\r\n\r\n    function SelectChange(evt: React.ChangeEvent<HTMLSelectElement>) {\r\n        const target = evt.target.value;\r\n        console.log(\"setting:\", {data, field, target});\r\n        data[field] = target;\r\n    }\r\n\r\n    let hasReturn = false; let hasPrimitive = false; let hasClasses = false; let hasEnumerators = false;\r\n    if(field === 'type') {\r\n        switch (data.className) {\r\n            case 'DAttribute': hasPrimitive = hasEnumerators = true; break;\r\n            case 'DReference': hasClasses = true; break;\r\n            case 'DOperation': hasPrimitive = hasClasses = hasEnumerators = hasReturn = true; break;\r\n            case 'DParameter': hasPrimitive = hasClasses = hasEnumerators = true; break;\r\n        }\r\n    }\r\n    const returns = props.returns;\r\n    const primitives = props.primitives;\r\n    const classes: LClass[] = data.model.classes;\r\n    const enumerators: LEnumerator[] = data.model.enumerators;\r\n\r\n    return(<div className={'d-flex p-1'}>\r\n        {(label && !jsxLabel) && <label className={'my-auto'} onClick={() => {if(tooltip) notify()}}>\r\n            {label}\r\n        </label>}\r\n        {(jsxLabel && !label) && <label className={'my-auto'} onClick={() => {if(tooltip) notify()}}>\r\n            {jsxLabel}\r\n        </label>}\r\n        <select className={css} value={value} onChange={SelectChange}>\r\n            {(hasReturn && returns.length > 0) && <optgroup label={'Defaults'}>\r\n                {returns.map((returnType, i) => {\r\n                    return <option key={i} value={returnType.id}>{returnType.name}</option>\r\n                })}\r\n            </optgroup>}\r\n            {(hasPrimitive && primitives) && <optgroup label={'Primitives'}>\r\n                {primitives.map((primitive, i) => {\r\n                    return <option key={i} value={primitive.id}>{primitive.name}</option>\r\n                })}\r\n            </optgroup>}\r\n            {(hasEnumerators && enumerators.length > 0) && <optgroup label={'Enumerators'}>\r\n                {enumerators.map((enumerator, i) => {\r\n                    return <option key={i} value={enumerator.id}>{enumerator.name}</option>\r\n                })}\r\n            </optgroup>}\r\n            {(hasClasses && classes.length > 0) && <optgroup label={'Classes'}>\r\n                {classes.map((classifier, i) => {\r\n                    return <option key={i} value={classifier.id}>{classifier.name}</option>\r\n                })}\r\n            </optgroup>}\r\n            {props.options}\r\n        </select>\r\n        {(tooltip) && <Toaster position={'bottom-center'} />}\r\n    </div>);\r\n}\r\ninterface OwnProps {\r\n    obj: DPointerTargetable | Pointer<DPointerTargetable, 1, 1, LPointerTargetable>;\r\n    field: string;\r\n    label?: string;\r\n    jsxLabel?: ReactNode;\r\n    tooltip?: string;\r\n    hidden?: boolean;\r\n    options?: JSX.Element;\r\n}\r\ninterface StateProps { data: LPointerTargetable & GObject; primitives: LClass[]; returns: LClass[]; }\r\ninterface DispatchProps { }\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    const pointer: Pointer = typeof ownProps.obj === 'string' ? ownProps.obj : ownProps.obj.id;\r\n    ret.data = LPointerTargetable.fromPointer(pointer);\r\n    ret.primitives = LPointerTargetable.fromPointer(state.primitiveTypes);\r\n    ret.returns = LPointerTargetable.fromPointer(state.returnTypes);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const SelectConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(SelectComponent);\r\n\r\nexport const Select = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <SelectConnected {...{...props, children}} />;\r\n}\r\nexport default Select;\r\n","import React, {Dispatch, ReactElement} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {IStore} from \"../../redux/store\";\r\n\r\n\r\nfunction ImageComponent(props: AllProps) {\r\n    let link;\r\n    if (props.code && props.name){\r\n        link = 'https://www.svgrepo.com/show/';\r\n        link += props.code + '/';\r\n        link += props.name + '.svg';\r\n    } else {\r\n        link = (props as any).src;\r\n    }\r\n    return <img className={'h-100 w-100'} src={link} />; // damiano: what's this? added to read src if provided\r\n}\r\ninterface OwnProps { code: string; name: string; }\r\ninterface StateProps { }\r\ninterface DispatchProps { }\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const ImageConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ImageComponent);\r\n\r\nexport const Image = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <ImageConnected {...{...props, children}} />;\r\n}\r\nexport default Image;\r\n","import React, {Dispatch, ReactElement} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {IStore} from \"../../redux/store\";\r\nimport Xarrow from \"react-xarrows\";\r\n\r\n\r\nfunction EdgeComponent(props: AllProps) {\r\n    const source = props.source;\r\n    const target = props.target;\r\n    const label = (props.label) ? props.label : '';\r\n\r\n    return(<Xarrow start={source} end={target} labels={label} />);\r\n}\r\ninterface OwnProps {\r\n    source: string,\r\n    target: string,\r\n    label?: string\r\n}\r\ninterface StateProps { }\r\ninterface DispatchProps { }\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const EdgeConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(EdgeComponent);\r\n\r\nexport const Edge = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <EdgeConnected {...{...props, children}} />;\r\n}\r\nexport default Edge;\r\n","import React, {PureComponent, ReactNode} from \"react\";\r\nimport ReactJson from 'react-json-view' // npm i react-json-view\r\nimport './logger.scss'\r\nimport {GObject} from \"../../joiner\";\r\n\r\n// private\r\ninterface ThisState { }\r\n\r\nexport class DataOutputComponent extends PureComponent<AllProps, ThisState>{\r\n    render(): ReactNode {\r\n        {/* themes:\r\n                                        export interface ThemeObject {\r\n                                            base00: string;\r\n                                            base01: string;\r\n                                            base02: string;\r\n                                            base03: string;\r\n                                            base04: string;\r\n                                            base05: string;\r\n                                            base06: string;\r\n                                            base07: string;\r\n                                            base08: string;\r\n                                            base09: string;\r\n                                            base0A: string;\r\n                                            base0B: string;\r\n                                            base0C: string;\r\n                                            base0D: string;\r\n                                            base0E: string;\r\n                                            base0F: string;\r\n                                        }\r\n\r\n                                            export type ThemeKeys =\r\n                                              | 'apathy'\r\n                                              | 'apathy:inverted'\r\n                                              | 'ashes'\r\n                                              | 'bespin'\r\n                                              | 'brewer'\r\n                                              | 'bright:inverted'\r\n                                              | 'bright'\r\n                                              | 'chalk'\r\n                                              | 'codeschool'\r\n                                              | 'colors'\r\n                                              | 'eighties'\r\n                                              | 'embers'\r\n                                              | 'flat'\r\n                                              | 'google'\r\n                                              | 'grayscale'\r\n                                              | 'grayscale:inverted'\r\n                                              | 'greenscreen'\r\n                                              | 'harmonic'\r\n                                              | 'hopscotch'\r\n                                              | 'isotope'\r\n                                              | 'marrakesh'\r\n                                              | 'mocha'\r\n                                              | 'monokai'\r\n                                              | 'ocean'\r\n                                              | 'paraiso'\r\n                                              | 'pop'\r\n                                              | 'railscasts'\r\n                                              | 'rjv-default'\r\n                                              | 'shapeshifter'\r\n                                              | 'shapeshifter:inverted'\r\n                                              | 'solarized'\r\n                                              | 'summerfruit'\r\n                                              | 'summerfruit:inverted'\r\n                                              | 'threezerotwofour'\r\n                                              | 'tomorrow'\r\n                                              | 'tube'\r\n                                              | 'twilight'; */}\r\n        return <ReactJson src={this.props.data}\r\n                          collapsed={1}\r\n                          collapseStringsAfterLength={20}\r\n                          displayDataTypes={true}\r\n                          displayObjectSize={true}\r\n                          enableClipboard={true}\r\n                          groupArraysAfterLength={100}\r\n                          indentWidth={4}\r\n                          iconStyle={\"triangle\"}\r\n                          name={this.props.rootName}\r\n                          quotesOnKeys={true} shouldCollapse={ false /*((field: CollapsedFieldProps) => { return Object.keys(field.src).length > 3;*/ }\r\n                          sortKeys={false}\r\n                          theme={\"rjv-default\"}\r\n        >{this.props.children}</ReactJson>;\r\n    };\r\n\r\n}\r\n\r\n// private\r\ninterface OwnProps {\r\n    data: GObject;\r\n    rootName?: string;\r\n}\r\n// private\r\ntype AllProps = OwnProps;\r\n/*\r\nif (!windoww.mycomponents) windoww.mycomponents = {};\r\nwindoww.mycomponents.DataOutput = DataOutputComponent;\r\nwindoww.mycomponents.DataOutputComponent = DataOutputComponent;*/\r\n////// mapper func\r\n\r\n","import React, {PureComponent, ReactNode} from \"react\";\r\nimport './logger.scss';\r\nimport {DataOutputComponent, DDate, Dictionary, GObject, Log, MyInputComponent, U, UnixTimestamp} from \"../../joiner\";\r\n\r\n// private\r\ninterface ThisState {\r\n    messages: Dictionary<string, Dictionary<string, any[]>>\r\n    filters: {category: ((cat: string) => boolean) | null, tag: ((tag: string) => boolean) | null, datafilter: ((data: any[]) => boolean) | null};\r\n    categoriesActive: Dictionary<string, boolean>;\r\n    searchTag: string;\r\n    searchTagAsRegExp: boolean;\r\n    id: number;\r\n    minDate: UnixTimestamp;\r\n    maxDate: UnixTimestamp;\r\n}\r\n\r\nexport class LoggerComponent extends PureComponent<AllProps, ThisState>{\r\n    public static loggers: LoggerComponent[] = [];\r\n    private static max_id: number = 0;\r\n    public static Log(category: string, key: string, data: any[]): void{\r\n        for (let logger of LoggerComponent.loggers) { logger.log(category, key, data); }\r\n    }\r\n\r\n    constructor(props: AllProps, context: any) {\r\n        super(props, context);\r\n        this.state = {\r\n            id: LoggerComponent.max_id++,\r\n            messages: {},\r\n            searchTag: '',\r\n            searchTagAsRegExp: false,\r\n            categoriesActive: {},\r\n            minDate: DDate.addYear(new Date(), -1, true).getTime(),\r\n            maxDate: DDate.addYear(new Date(), +1, true).getTime(),\r\n            filters: {category: null, tag: null, datafilter: null}};\r\n        LoggerComponent.loggers.push(this);\r\n        Log.registerLogger(this, Log.e);\r\n    }\r\n\r\n    private isCatActive(cat: string): boolean {\r\n        return !!(this.state.categoriesActive[cat] && this.state.filters.category?.(cat));\r\n    }\r\n\r\n    private changeSearchTag = (e: React.ChangeEvent<HTMLInputElement>): void => {\r\n        this.setState({...this.state, searchTag: e.target.value});\r\n    }\r\n    private changeRegexpTag = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.setState({...this.state, searchTagAsRegExp: e.target.checked});\r\n\r\n    }\r\n    private changeMinDate = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.setState({...this.state, minDate: new Date(e.target.value).getTime() });\r\n\r\n    }\r\n    private changeMaxDate = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.setState({...this.state, maxDate: new Date(e.target.value).getTime() });\r\n    }\r\n\r\n    render(): ReactNode {\r\n        const allCategories: string[] = Object.keys(this.state.messages);\r\n        const activeCategories: string[] = allCategories.filter( cat => this.isCatActive(cat));\r\n        const allTags: string[] = U.arrayUnique(activeCategories.flatMap( (cat) => Object.keys(this.state.messages[cat])))\r\n        const activeTags: string[] = allTags.filter( (tag: string) => (this.state.searchTagAsRegExp ? tag.match(this.state.searchTag) : tag === this.state.searchTag));\r\n        return (<>\r\n            <div>\r\n                <h1>Search by tag</h1>\r\n                <datalist>\r\n                    { allTags.map(tag => <option key={tag} value={tag}>{tag}</option>) }\r\n                </datalist>\r\n                <input list={\"#logger_\" + this.state.id + \"_keylist\"} value={this.state.searchTag} onChange={ this.changeSearchTag } />\r\n                <MyInputComponent label={\"as RegExp\"} type=\"checkbox\" checked={this.state.searchTagAsRegExp} onChange={this.changeRegexpTag} />\r\n                <MyInputComponent label={\"from\"} type=\"datetime-local\" value={ new Date(this.state.minDate).toString()} onChange={this.changeMinDate} />\r\n                <MyInputComponent label={\"to\"} type=\"datetime-local\" value={ new Date(this.state.maxDate).toString()} onChange={this.changeMaxDate} />\r\n            </div>\r\n            <ul className={\"categories\"}>\r\n                { allCategories.map((cat, i) => <li className={\"category cat_\"+ i + \" \" + cat} key={cat} data-active={this.isCatActive(cat)}>{cat}</li>) }\r\n            </ul>\r\n            <ul className={\"entries\"}>\r\n                {\r\n                    activeCategories.flatMap( (cat) => {\r\n                        return Object.keys(this.state.messages[cat]).map( (tag) => {\r\n                            let entries = this.state.messages[cat][tag]\r\n                            return <li><span className={\"tag\"}>{tag}</span>{\r\n                                entries.map( (parameter) => <span className=\"parameter\">\r\n                                    <DataOutputComponent data={parameter} rootName={tag} />\r\n                                </span>)\r\n                            }</li>;\r\n                        });\r\n                    })\r\n                }\r\n            </ul>\r\n        </>); }\r\n\r\n\r\n\r\n    public log = (category: string, key: string, data: any[], fullconcat?: string): void => {\r\n        if (!this.state.categoriesActive.hasOwnProperty(category)) {\r\n            this.setState({categoriesActive: { ...this.state.categoriesActive, category: true}});\r\n            const category: GObject = {};\r\n            category[key] = data;\r\n            this.setState({messages: { ...this.state.messages, category} });\r\n        }\r\n\r\n        const messages: GObject = { ...this.state.messages};\r\n        messages[category] = messages[category] ? { ...messages[category]} : {};\r\n        messages[category][key] = messages[category][key] ? [ ...messages[category][key], data] : [data];\r\n        this.setState( {messages});\r\n    }// .bind(this);\r\n\r\n    componentWillUnmount(): void {\r\n        U.arrayRemoveAll(LoggerComponent.loggers, this);\r\n    }\r\n}\r\n\r\n// private\r\ninterface OwnProps {\r\n    // propsRequestedFromHtmlAsAttributes: string;\r\n}\r\n// private\r\ninterface StateProps {\r\n    // propsFromReduxStateOrOtherKindOfStateManagement: boolean; // flux or custom things too, unrelated to this.state of react.\r\n}\r\n\r\n// private\r\ninterface DispatchProps {\r\n    // propsFromReduxActions: typeof funzioneTriggeraAzioneDaImportare;\r\n}\r\n\r\n\r\n// private\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n////// mapper func\r\n\r\n/*\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    /// to fill\r\n    return ret; }\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {} as any;\r\n    /// to fill\r\n    return ret; }\r\n\r\nexport const LoggerComponentConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(LoggerComponent);*/\r\n","import React, {PureComponent, ReactNode} from \"react\";\r\nimport './myInput.scss';\r\n\r\n\r\nexport class MyInputComponent extends PureComponent<AllProps, ThisState>{\r\n    render(): ReactNode {\r\n        return (<>\r\n            <label className={\"myinput-root \"} data-type={this.props.type || \"text\"}>\r\n                {this.props.childrenAlignment === \"pre\" ? this.props.children : null}\r\n                <span className=\"myinput-label\">{this.props.label}</span>\r\n                {this.props.childrenAlignment === \"middle\" ? this.props.children : null}\r\n                <input {...this.props} className={ (this.props.className || \"\") + \"myinput-input\"} />\r\n                {this.props.childrenAlignment === \"post\" || !this.props.childrenAlignment ? this.props.children : null}\r\n            </label>\r\n        </>); }\r\n}\r\n\r\n// private\r\ninterface ThisState {}\r\n// private\r\ninterface OwnProps {\r\n    label: string | ReactNode;\r\n    childrenAlignment?: \"pre\" | \"middle\" | \"post\";\r\n}\r\n\r\n// private\r\ntype AllProps = React.DetailedHTMLProps<React.InputHTMLAttributes<HTMLInputElement>, HTMLInputElement> & OwnProps;\r\n\r\n\r\n// export default MyInputComponent;\r\n","import React, {CSSProperties, PureComponent, ReactChild, ReactNode} from \"react\";\r\n// import { connect } from \"react-redux\";\r\n// import {IStore} from \"../../redux/store\";\r\nimport './overlap.scss';\r\n\r\n// private\r\ninterface ThisState {\r\n}\r\n\r\nexport class Overlap extends PureComponent<AllProps, ThisState>{\r\n    render(): ReactNode {\r\n        console.log('overlap childs:', this.props.children);\r\n        if (!this.props.children || !Array.isArray(this.props.children)) return this.props.children;\r\n        const children = this.props.children; // ? (Array.isArray(this.props.children) ? this.props.children : [this.props.children]) : [];\r\n        return (<>\r\n            {/*trouble on svg: G elements cannot be styled and rect cannot be nested, i cannot force a container to take size of children unless set size with plain js*/}\r\n            <div className={\"overlap-parent\" + (this.props.autosizex ? \" overlap-child-chooses-width\" : \"\") + (this.props.autosizex ? \" overlap-child-chooses-height\" : \"\")} style={{...this.props.style}}>\r\n                {React.Children.map(children, cc => {\r\n                        return <div className={\"overlap-child-wrapper\" + (!this.props.autosizex ? \" overlap-parent-chooses-width\" : \"\") + (!this.props.autosizey ? \" overlap-parent-chooses-height\" : \"\")}>{cc}</div>\r\n                    })}\r\n            </div>\r\n        </>); }\r\n}\r\n\r\n// private\r\ninterface OwnProps {\r\n    children: ReactChild[] | ReactChild;\r\n    // sizefollows: \"parent\" | \"child\";\r\n    autosizex?: boolean;\r\n    autosizey?: boolean;\r\n    style?: CSSProperties;\r\n    // propsRequestedFromHtmlAsAttributes: string;\r\n}\r\n// private\r\ninterface StateProps {\r\n    // propsFromReduxStateOrOtherKindOfStateManagement: boolean; // flux or custom things too, unrelated to this.state of react.\r\n}\r\n\r\n// private\r\ninterface DispatchProps {\r\n    // propsFromReduxActions: typeof funzioneTriggeraAzioneDaImportare;\r\n}\r\n\r\n\r\n// private\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n////// mapper func\r\n/*\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    /// to fill\r\n    return ret; }\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {} as any;\r\n    /// to fill\r\n    return ret; }\r\n*/\r\n\r\n(Overlap as React.ComponentClass).defaultProps = {\r\n  autosizex: true,\r\n  autosizey: true,\r\n  style: undefined,\r\n  children: [],\r\n} as OwnProps; // todo: se esporto con connect fose devo farlo al risultato della connect\r\nexport default Overlap;\r\n/*connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(Overlap);*/\r\n","import React, {Dispatch, PureComponent, ReactNode} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport type {DGraph, Dictionary, DocString, IStore, Pointer} from \"../../joiner\";\r\nimport './defaultColorScheme.scss';\r\n\r\n// private\r\ninterface ThisState {\r\n}\r\n\r\nclass ColorSchemeComponent extends PureComponent<AllProps, ThisState>{\r\n    constructor(props: AllProps, context: any) {\r\n        super(props, context);\r\n    }\r\n\r\n    render(): ReactNode {\r\n        let userColorSchemeCss = '';\r\n        for (let graphid in this.props.userMadeColorScheme) {\r\n            userColorSchemeCss += \"\\n\\n #graph_\" + graphid + \"{ \\n\" + this.props.userMadeColorScheme[graphid] + \"\\n}\";\r\n        }\r\n        // NB: default styles are in scss file and are not editable.\r\n        return <style>{userColorSchemeCss}</style>; }\r\n}\r\n\r\n// private\r\ninterface OwnProps {\r\n    // propsRequestedFromJSX_AsAttributes: string;\r\n}\r\n// private\r\ninterface StateProps {\r\n    userMadeColorScheme: Dictionary<Pointer<DGraph>, DocString<'CSS variables'>>;\r\n    // propsFromReduxStateOrOtherKindOfStateManagement: boolean; // flux or custom things too, unrelated to this.state of react.\r\n}\r\n\r\n// private\r\ninterface DispatchProps {\r\n    // propsFromReduxActions: typeof funzioneTriggeraAzioneDaImportare;\r\n}\r\n\r\n\r\n// private\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n////// mapper func\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    ret.userMadeColorScheme = {};\r\n    return ret; }\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {} as any;\r\n    /// to fill\r\n    return ret; }\r\n\r\nexport const ColorScheme = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ColorSchemeComponent);\r\nexport default ColorScheme;\r\n","import React, {ReactElement} from \"react\";\r\nimport {connect} from \"react-redux\";\r\n\r\nimport {\r\n    DGraph,\r\n    GraphElementComponent,\r\n    GraphElementDispatchProps,\r\n    GraphElementOwnProps,\r\n    GraphElementReduxStateProps,\r\n    GraphElementStatee,\r\n    IStore,\r\n    RuntimeAccessibleClass\r\n} from \"../../joiner\";\r\n// import {GraphElementStatee, GraphElementDispatchProps, GraphElementReduxStateProps, GraphElementOwnProps} from  \"../graphElement/sharedTypes/sharedTypes\";\r\n\r\nconsole.info('GraphComponent loading');\r\n\r\nclass GraphStatee extends GraphElementStatee {\r\n    /*graphid!: string\r\n    constructor(preRenderFunc: string | undefined, evalContext: GObject, templatefunc: () => React.ReactNode, id: string) {\r\n        super(preRenderFunc, evalContext, templatefunc);\r\n        this.graphid = id;\r\n    }*/\r\n}\r\n\r\nconst superclass = RuntimeAccessibleClass.classes.GraphElementComponent as any as typeof GraphElementComponent;\r\nexport class GraphComponent<AllProps extends AllPropss, GraphState extends GraphStatee>\r\n    // extends GraphElementRaw<AllProps, GraphState>\r\n    // @ts-ignore\r\n    extends superclass<AllProps, GraphState>{\r\n\r\n    static mapStateToProps(state: IStore, ownProps: GraphOwnProps): GraphReduxStateProps {\r\n        // console.log('dragx vertex mapstate', {DVoidVertex});\r\n        return GraphElementComponent.mapStateToProps(state, ownProps, DGraph);\r\n    }\r\n    // obsoleta? usa Vertex con isGraph = true e cambiagli nome\r\n\r\n}\r\n// todo: devo permettere agli elementi di: multi-selezionare, resize, drag, rotate, drop (outside-inside container)\r\n// private\r\nclass GraphOwnProps extends GraphElementOwnProps {\r\n    onclick?: (e: React.MouseEvent<HTMLDivElement>) => void;\r\n    // propsRequestedFromHtmlAsAttributes: string;\r\n}\r\n// private\r\nclass GraphReduxStateProps extends GraphElementReduxStateProps{\r\n    /*nodeid!: string;\r\n    graphid!: string;*/\r\n    // propsFromReduxStateOrOtherKindOfStateManagement: boolean; // flux or custom things too, unrelated to this.state of react.\r\n}\r\n\r\n// private\r\nclass GraphDispatchProps extends GraphElementDispatchProps {\r\n    // propsFromReduxActions: typeof funzioneTriggeraAzioneDaImportare;\r\n}\r\n\r\n\r\n// private\r\ntype AllPropss = GraphOwnProps & GraphReduxStateProps & GraphDispatchProps;\r\n\r\n\r\nconst GraphConnected = connect<GraphReduxStateProps, GraphDispatchProps, GraphOwnProps, IStore>(\r\n    GraphComponent.mapStateToProps,\r\n    GraphComponent.mapDispatchToProps\r\n)(GraphComponent as any);\r\n\r\n// nb: necessario per usarlo a runtime\r\nexport const Graph = (props: GraphOwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <GraphConnected {...{...props, children}} />; }\r\n\r\n// DModel.defaultComponent = Graph;\r\n// DPackage.defaultComponent = Graph;\r\n\r\n/*\r\nif (!windoww.mycomponents) windoww.mycomponents = {};\r\nwindoww.mycomponents.Graph = GraphRaw;*/\r\nconsole.info('GraphComponent loaded');\r\n","import React, {Dispatch, ReactElement, ReactNode} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {\r\n    DGraph,\r\n    DGraphElement,\r\n    DGraphVertex,\r\n    DVoidVertex,\r\n    GraphElementComponent,\r\n    GraphElementDispatchProps,\r\n    GraphElementOwnProps,\r\n    GraphElementReduxStateProps,\r\n    GraphElementStatee,\r\n    IStore,\r\n    LClass,\r\n    LModelElement,\r\n    LPointerTargetable,\r\n    LUser,\r\n    LVoidVertex,\r\n    RuntimeAccessibleClass,\r\n    U,\r\n} from \"../../joiner\";\r\nimport RootVertex from \"./RootVertex\";\r\nimport {LViewPoint} from \"../../view/viewPoint/viewpoint\";\r\n\r\nconst superclassGraphElementComponent: typeof GraphElementComponent = RuntimeAccessibleClass.classes.GraphElementComponent as any as typeof GraphElementComponent;\r\nclass ThisStatee extends GraphElementStatee {}\r\n\r\nexport class VertexComponent<AllProps extends AllPropss = AllPropss, ThisState extends ThisStatee = ThisStatee>\r\n    extends superclassGraphElementComponent<AllProps, ThisState> {\r\n\r\n    /*\r\n    shouldComponentUpdate(newProps: Readonly<AllProps>, newState: Readonly<ThisState>, newContext: any): boolean {\r\n        const oldProps = this.props;\r\n        const newData = newProps.data; const oldData = oldProps.data;\r\n        const newNode = newProps.node; const oldNode = oldProps.node;\r\n        const newViewpoint = newProps.viewpoint; const oldViewpoint = oldProps.viewpoint;\r\n        const newEdgePending = newProps.isEdgePending; const oldEdgePending = oldProps.isEdgePending;\r\n\r\n        if(newData.__raw !== oldData.__raw) return true;\r\n        if(newNode?.__raw !== oldNode?.__raw) return true;\r\n        if(newViewpoint.__raw !== oldViewpoint.__raw) return true;\r\n        if(newEdgePending !== oldEdgePending) return true;\r\n        return false;\r\n    }\r\n     */\r\n\r\n    constructor(props: AllProps, context: any) {\r\n        super(props, context);\r\n    }\r\n    render(): ReactNode {\r\n        return(<RootVertex props={this.props} render={super.render()} />);\r\n    }\r\n}\r\n\r\nclass OwnProps extends GraphElementOwnProps {\r\n    onclick?: (e: React.MouseEvent<HTMLDivElement>) => void;\r\n    onmousedown?: (e: React.MouseEvent<HTMLDivElement>) => void;\r\n    isGraph?: boolean = false;\r\n    isVertex?: boolean = true;\r\n}\r\n\r\nclass StateProps extends GraphElementReduxStateProps {\r\n    node!: LVoidVertex;\r\n    lastSelected!: LModelElement | null;\r\n    isEdgePending!: { user: LUser, source: LClass };\r\n    viewpoint!: LViewPoint\r\n}\r\n\r\nclass DispatchProps extends GraphElementDispatchProps {\r\n}\r\n\r\nexport type AllPropss = OwnProps & StateProps & DispatchProps;\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    let DGraphElementClass: typeof DGraphElement;\r\n    if (ownProps.isVertex && ownProps.isGraph) DGraphElementClass = DGraphVertex;\r\n    else if (ownProps.isVertex && !ownProps.isGraph) DGraphElementClass = DVoidVertex;\r\n    else if (!ownProps.isVertex && ownProps.isGraph) DGraphElementClass = DGraph;\r\n    else DGraphElementClass = DGraphElement;\r\n    const superret: StateProps = GraphElementComponent.mapStateToProps(state, ownProps, DGraphElementClass) as StateProps;\r\n    //superret.lastSelected = state._lastSelected?.modelElement;\r\n    superret.lastSelected = state._lastSelected ? LPointerTargetable.from(state._lastSelected.modelElement) : null;\r\n    superret.isEdgePending = {\r\n        user: LPointerTargetable.from(state.isEdgePending.user),\r\n        source: LPointerTargetable.from(state.isEdgePending.source)\r\n    };\r\n    superret.viewpoint = LViewPoint.fromPointer(state.viewpoint);\r\n    const ret: StateProps = new StateProps();\r\n    U.objectMergeInPlace(superret, ret);\r\n    U.removeEmptyObjectKeys(superret);\r\n    return superret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const superret: GraphElementDispatchProps = GraphElementComponent.mapDispatchToProps(dispatch);\r\n    const ret: GraphElementDispatchProps = new GraphElementDispatchProps();\r\n    U.objectMergeInPlace(superret, ret);\r\n    U.removeEmptyObjectKeys(superret);\r\n    return superret;\r\n}\r\n\r\n\r\nexport const VertexConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(VertexComponent as any);\r\n\r\nexport const Vertex = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <VertexConnected {...{...props, children}} isGraph={false} isVertex={true} />;\r\n}\r\n\r\nexport const Graph = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => { // doesn't work?\r\n    return <VertexConnected {...{...props, children}} isGraph={true} isVertex={false} />;\r\n}\r\n\r\nexport const GraphVertex = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <VertexConnected {...{...props, children}} isGraph={true} isVertex={true} />;\r\n}\r\n\r\nexport const Field = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <VertexConnected {...{...props, children}} isGraph={false} isVertex={false} />;\r\n}\r\n\r\nlet windoww = window as any;\r\n\r\nwindoww.Vertex = Vertex;\r\nwindoww.Graph = Graph;\r\nwindoww.GraphVertex = GraphVertex;\r\nwindoww.Field = Field;\r\n\r\nwindoww.VertexComponent = Vertex;\r\nwindoww.GraphComponent = Graph;\r\nwindoww.GraphVertexComponent = GraphVertex;\r\nwindoww.FieldComponent = Field;\r\n\r\n","import React, {ReactElement, ReactNode} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {\r\n    DClassifier,\r\n    DEnumerator,\r\n    Dictionary,\r\n    DModel,\r\n    DModelElement,\r\n    DPackage, DV,\r\n    GObject,\r\n    GraphElementComponent,\r\n    GraphElementDispatchProps,\r\n    GraphElementOwnProps,\r\n    GraphElementReduxStateProps,\r\n    GraphElementStatee,\r\n    IStore,\r\n    LModelElement,\r\n    Log,\r\n    LViewElement,\r\n    RuntimeAccessibleClass, SetRootFieldAction,\r\n    Vertex,\r\n    windoww,\r\n} from \"../../joiner\";\r\nimport {Field, Graph, GraphVertex} from \"../vertex/Vertex\";\r\n\r\nconst superclass: typeof GraphElementComponent = RuntimeAccessibleClass.classes.GraphElementComponent as any as typeof GraphElementComponent;\r\n\r\n// private\r\nclass DefaultNodeStatee extends GraphElementStatee { }\r\n\r\n// from ownstateprops function getVertexID(props: AllPropss): Pointer<DVoidVertex, 0, 1, LVoidVertex> { return props.vertex?.id; }\r\n\r\n\r\n// Giordano: add ignore for webpack\r\n//@ts-ignore\r\nexport class DefaultNodeComponent<AllProps extends AllPropss = AllPropss, NodeState = DefaultNodeStatee> extends superclass<AllProps, NodeState>{\r\n\r\n    static mapStateToProps(state: IStore, ownProps: GraphElementOwnProps): GraphElementReduxStateProps {\r\n        let ret: GraphElementReduxStateProps = {} as GraphElementReduxStateProps; // NB: cannot use a constructor, must be pojo\r\n        GraphElementComponent.mapLModelStuff(state, ownProps, ret); // not necessary either?\r\n        // GraphElementComponent.mapLGraphElementStuff(state, ownProps, ret, dGraphDataClass); not necessary, it's demanded to sub-components\r\n        try{\r\n            GraphElementComponent.mapViewStuff(state, ret, ownProps);\r\n            (ret as any).skiparenderforloading = false;\r\n        } catch(e) {\r\n            (ret as any).skiparenderforloading = true; // model id is updated, but he's still trying to load old model which got replaced and is not in state.\r\n            /* crashes on loading because old model and new model have different timestamps? looks by id of old model with same number and diffferent timestamp\r\n        Log.ex(!ret.data, \"can't find model data:\", {meid, state, ownpropsdata:ownProps.data, ownProps});*/ }\r\n        return ret; }\r\n\r\n    constructor(props: AllProps, context: any) { super(props, context); }\r\n\r\n    render(): ReactNode {\r\n        if ((this.props as any).skiparenderforloading) {\r\n            console.log(\"realoading render: \", {thiss:this, data:this.props.data});\r\n            windoww.bugged = this;\r\n            console.log(\"realoading render: \", {thiss:this, data:this.props.data});\r\n            SetRootFieldAction.new(\"rerenderforloading\", new Date().getTime()); return <div>loading...</div>;}\r\n        const view: LViewElement = this.props.view;\r\n        const modelElement: LModelElement = this.props.data;\r\n        if (!view) { Log.exx({props: this.props, thiss:this}); }\r\n        // if (!view) { SetRootFieldAction.new(\"uselessrefresh_afterload\", new Date().getTime()); return <div>Loading...</div>; }\r\n\r\n        let componentMap: Dictionary<string, (props: GObject, children?: (string | React.Component)[]) => ReactElement> = windoww.components;\r\n        let dmodelMap: Dictionary<string, typeof DModelElement> = RuntimeAccessibleClass.classes as any;\r\n\r\n        let serializableProps = {...this.props, data: this.props.data?.id, view: this.props.view?.id, views: this.props.views?.map( v => v.id )};\r\n        // console.log('dnode render', {props: {...this.props}, serializableProps});\r\n        let componentfunction: typeof Graph = null as any;\r\n        if (view.forceNodeType) {\r\n            switch (view.forceNodeType) {\r\n                default: Log.exDevv('unrecognized View.forceNodeType:' + view.forceNodeType, {view, modelElement});\r\n                return <div>dev error</div>\r\n                case windoww.GraphComponent.name: componentfunction = Graph; break;\r\n                // case windoww.GraphElementComponent.name:\r\n                case windoww.VertexComponent.name: componentfunction = Vertex; break;\r\n                case windoww.FieldComponent.name: componentfunction = Field; break;\r\n                case windoww.GraphVertexComponent.name: componentfunction = GraphVertex; break; }\r\n            // console.log(\"force node type\", {requested:view.forceNodeType, G:  windoww.GraphComponent.name, GE: windoww.GraphElementComponent.name, GV: windoww.GraphVertexComponent.name, V: windoww.VertexComponent.name, F:windoww.FieldComponent.name})\r\n            return componentfunction(serializableProps, this.props.children);}\r\n\r\n        if (modelElement?.className) switch(modelElement.className) {\r\n            case \"DModel\": componentfunction = Graph; break;\r\n            case \"DPackage\": componentfunction = GraphVertex; break;\r\n            case \"DClassifier\":\r\n            case \"DEnumerator\":\r\n            case \"DObject\":\r\n            case \"DClass\": componentfunction = Vertex; break;\r\n            case \"DAnnotation\":\r\n            case \"DAttribute\":\r\n            case \"DOperation\":\r\n            case \"DParameter\":\r\n            case \"DReference\":\r\n            case \"DEnumLiteral\":\r\n            case \"DValue\":\r\n            case \"DModelElement\": componentfunction = Field; break;\r\n            default:\r\n                Log.exDevv('invalid model class, add a case in the switch', {modelElement, view, dmodelMap, componentMap});\r\n                // const dmodel: typeof DModelElement = dmodelMap[modelElement.className];\r\n                // Log.exDev(!dmodel || !dmodel.defaultComponent, 'invalid model class:', {dmodel, modelElement, view, dmodelMap, componentMap});\r\n                // return dmodel.defaultComponent(serializableProps, this.props.children);\r\n        }\r\n        if (componentfunction) return componentfunction(serializableProps, this.props.children);\r\n        // errore: questoon passa gli id correttamente al sottoelemento vertex o field\r\n        return DV.errorView(\"Error: DefaultNode is missing both view and model, please state node type explicitly: Graph, GraphVertex, Vertex or Field\");\r\n    }\r\n\r\n}\r\n\r\n// private\r\nclass DefaultNodeOwnProps extends GraphElementOwnProps {}\r\nclass DefaultNodeReduxStateProps  extends GraphElementReduxStateProps {}\r\nclass DefaultNodeDispatchProps extends GraphElementDispatchProps {}\r\ntype AllPropss = DefaultNodeOwnProps & DefaultNodeReduxStateProps & DefaultNodeDispatchProps;\r\n\r\n\r\nconst DefaultNodeConnected = connect<DefaultNodeReduxStateProps, DefaultNodeDispatchProps, DefaultNodeOwnProps, IStore>(\r\n    DefaultNodeComponent.mapStateToProps,\r\n    DefaultNodeComponent.mapDispatchToProps\r\n)(DefaultNodeComponent as any);\r\n// export const Vertex = VertexConnected;\r\n\r\n\r\nexport const DefaultNode = (props: DefaultNodeOwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <DefaultNodeConnected {...{...props, children}} />; }\r\n","import React, {Dispatch, PureComponent, ReactElement, ReactNode} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport './graph.scss';\r\nimport {DGraph, DModel, DPointerTargetable, IStore, LGraph, LModel} from \"../../joiner\";\r\n\r\n\r\n// private\r\ninterface ThisState { }\r\n\r\nexport class GraphsContainerComponent extends PureComponent<AllProps, ThisState>{\r\n    constructor(props: AllProps, context: any) {\r\n        super(props, context);\r\n    }\r\n\r\n    // todo: per ogni vista crea un set di opzioni {enableAutocorrect: \"boolean(true)\", displayEdges: \"boolean(true)\", maximumGraphWidth: \"number(2000)\"} specificate dall\\'utente che deve specificare sia il tipo (Come se osse una funzione) che il valore predefinito\r\n    // il grafo deve leggere l'oggetto di opzioni e creare un menù che consente di cambiarle (una checkbox al posto dell'enableAutocorrect (bool), uno spinner per maximumGraphWidth (number...)\r\n\r\n    render(): ReactNode {\r\n        // const editinput = \"<input onChange={(e) => this.data.name = e.target.value } value={this.data.name} />\";\r\n        // const editinput = \"\";\r\n        // todo: rendi opzionale obj = this.data.id se non è specificato.\r\n        // const editinput = \"<Input obj={this.data.id} field={'name'} getter={val => val.toUpperCase()} setter={(val) => val.toLowerCase()} />\";\r\n        // \"<Input obj={this.data} field={'name'} getter={val => val.toUpperCase()} setter={(val) => val.toLowerCase()} />\";\r\n        return (<>\r\n            {\r\n                this.props.graphs.map( (m: LGraph) => (\r\n                    <>\r\n                        {/*<svg style={{backgroundColor: 'red'}}>\r\n                        <Overlap style={{width: '100px'}}>\r\n                            success, now i can test resize handler overlayed to content and dragndrop dnd\r\n                            <foreignObject className={\"rectangle\"} />\r\n                            <foreignObject className={\"ellipse\"} />\r\n                            <foreignObject className={\"point\"} />\r\n                        </Overlap>\r\n                        </svg><svg style={{backgroundColor: 'red'}}>\r\n                            <Overlap>\r\n                                <foreignObject className={\"rectangle\"} style={{width: '100px'}}/>\r\n                                <foreignObject className={\"ellipse\"} style={{width: '300px'}}/>\r\n                                <foreignObject className={\"point\"} />\r\n                            </Overlap>\r\n                        </svg>* /}\r\n                        <GraphElement data={m} />*/}\r\n                        {/*\r\n                            Giordano comment this problem with model's children\r\n                            <Graph graphid={m.id} data={m.model} view={undefined}>\r\n                                <Vertex data={m.model}/>\r\n                            </Graph>\r\n\r\n                        */}\r\n                        {this.props.children/*<QA />*/}\r\n                    </>)\r\n                )\r\n            }\r\n        </>); }\r\n}\r\n\r\n// private\r\ninterface OwnProps {\r\n    // propsRequestedFromHtmlAsAttributes: string;\r\n}\r\n// private\r\ninterface StateProps {\r\n    models: LModel[];\r\n    graphs: LGraph[];\r\n    // propsFromReduxStateOrOtherKindOfStateManagement: boolean; // flux or custom things too, unrelated to this.state of react.\r\n}\r\n\r\n// private\r\ninterface DispatchProps {\r\n    // propsFromReduxActions: typeof funzioneTriggeraAzioneDaImportare;\r\n}\r\n\r\n\r\n// private\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n////// mapper func\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    console.log('mapStateToProps', {ret, state, ownProps, models: state.models})\r\n    ret.models = state.models.length ? state.models.map( (mid) => mid && DPointerTargetable.wrap(state.idlookup[mid] as DModel)) as LModel[] : [];\r\n    ret.graphs = state.graphs.length ? state.graphs.map( (mid) => mid && LGraph.wrap(state.idlookup[mid] as DGraph)) as LGraph[] : [];\r\n    /// to fill\r\n    return ret; }\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {} as any;\r\n    /// to fill\r\n    return ret; }\r\n\r\n\r\nconst GraphsContainerConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(GraphsContainerComponent);\r\n\r\nexport const GraphsContainer = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <GraphsContainerConnected {...{...props, children}} />; }\r\n\r\n","import {IStore} from \"../../redux/store\";\r\nimport React, {Dispatch, ReactElement, useEffect} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {LGraphElement} from \"../../model/dataStructure\";\r\nimport Xarrow, {xarrowPropsType, Xwrapper} from \"react-xarrows\";\r\nimport {SetRootFieldAction} from \"../../redux/action/action\";\r\nimport {GObject, LClass, LReference, Selectors} from \"../../joiner\";\r\nimport {useEffectOnce} from \"usehooks-ts\";\r\nimport { useStateIfMounted } from \"use-state-if-mounted\";\r\nimport $ from \"jquery\";\r\n\r\nconst crypto = require(\"crypto\");\r\ninterface ThisState {}\r\nfunction EdgeComponent(props: AllProps, state: ThisState) {\r\n    const sourceNode = props.source;\r\n    let source: LClass|LReference|undefined = sourceNode.model as any;\r\n    const targetNode = props.target;\r\n    let target: LClass|LReference|undefined = targetNode.model as any;\r\n\r\n    const show = props.showAnchor;\r\n    const size = props.size;\r\n    const color = props.color;\r\n\r\n    const [middleAnchor, setMiddleAnchor] = useStateIfMounted('');\r\n\r\n    const firstOptions: xarrowPropsType = {\r\n        start: sourceNode.id, end: middleAnchor,\r\n        path: \"grid\", color: color, strokeWidth: size,\r\n        showHead: false, zIndex: 100\r\n    };\r\n    const lastOptions: xarrowPropsType = {\r\n        start: middleAnchor, end: targetNode.id,\r\n        path: \"grid\", color: color, strokeWidth: size, zIndex: 100\r\n    };\r\n\r\n    if(source?.className == \"DReference\") {\r\n        source = source as LReference;\r\n        firstOptions.start = source.father.nodes[0].id;\r\n        lastOptions.showHead = false;\r\n        if(source.containment) {\r\n            firstOptions.showTail = true;\r\n            firstOptions.tailSize = 15;\r\n            firstOptions.tailShape = {svgElem: <rect style={{\r\n                    rotate: \"45deg\", fill: \"white\", strokeWidth: \"0.1\", stroke: color,\r\n                }} width=\".5pt\" height=\".5pt\" />, offsetForward: 1};\r\n        }\r\n    }\r\n    if(source?.className == \"DClass\") {\r\n        source = source as LClass;\r\n        lastOptions.showHead = true;\r\n        lastOptions.headSize = 15;\r\n        lastOptions.headColor = 'white';\r\n        lastOptions.headShape = {svgElem:<svg><path strokeWidth={0.1} stroke={color} d=\"M 0 0 L 1 0.5 L 0 1 L 0 0 z\"/></svg>};\r\n    }\r\n\r\n    useEffectOnce(() => {\r\n        setMiddleAnchor(crypto.randomBytes(20).toString('hex'));\r\n    })\r\n\r\n    useEffect(() => {\r\n        const middleware: GObject = $('[id=\"' + middleAnchor + '\"]');\r\n        if(middleware) {\r\n            middleware.draggable({\r\n                cursor: \"grabbing\",\r\n                containment: \"window\",\r\n                drag: function (event: GObject, obj: GObject) {\r\n                    SetRootFieldAction.new(\"dragging\", {})\r\n                }\r\n            });\r\n        }\r\n    })\r\n\r\n    const click = (event: React.MouseEvent<HTMLDivElement>) => {\r\n        if(source) {\r\n            SetRootFieldAction.new('_lastSelected', {\r\n                node: sourceNode.id,\r\n                view: undefined,\r\n                modelElement: source.id\r\n            });\r\n        }\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n    }\r\n\r\n    const contextMenu = (event: React.MouseEvent<HTMLDivElement>) => {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n    }\r\n\r\n    return(<div onClick={click} onContextMenu={contextMenu}>\r\n        <div style={{borderColor: color}} id={middleAnchor} className={\"middle-anchor\"}></div>\r\n        <Xarrow {...firstOptions} />\r\n        <Xarrow {...lastOptions} />\r\n    </div>);\r\n}\r\ninterface OwnProps { source: LGraphElement; target: LGraphElement; }\r\ninterface StateProps { showAnchor: boolean, size: number, color: string }\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const edgeSettings = state._edgeSettings;\r\n    const showAnchor = false //edgeSettings.showAnchor;\r\n    const size = edgeSettings.strokeWidth;\r\n    const color = edgeSettings.color;\r\n    const ret: StateProps = { showAnchor, size, color };\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const EdgeConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(EdgeComponent);\r\n\r\nexport const Edge = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <EdgeConnected {...{...props, children}} />;\r\n}\r\nexport default Edge;\r\n","import {IStore} from \"../../redux/store\";\r\nimport React, {Dispatch, ReactElement} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {LClass, LGraphElement, LModelElement, LReference, MyProxyHandler,} from \"../../joiner\";\r\nimport Edge from \"./Edge\";\r\n\r\n\r\ninterface ThisState {}\r\n\r\nfunction EdgesComponent(props: AllProps, state: ThisState) {\r\n    const me = props.source.model;\r\n    if(props.targets && props.targets.length <= 0) {\r\n        return <></>;\r\n    }\r\n    if(me?.className === \"DReference\") {\r\n        const lReference: LReference = me as any;\r\n        const lTarget: LModelElement = MyProxyHandler.wrap(lReference?.type);\r\n        return <>\r\n            {(props.targets) ? props.targets.map((targetNode) => {\r\n                return <Edge source={props.source} target={targetNode} />\r\n            }) : <Edges source={props.source} targets={(lTarget) ? lTarget.nodes : []} />}\r\n        </>;\r\n    }\r\n    if(me?.className === \"DClass\") {\r\n        const lClass: LClass = me as any;\r\n        if(lClass.extends.length > 0) {\r\n            const lTarget: LModelElement = MyProxyHandler.wrap(lClass?.extends[0]);\r\n            return <>\r\n                {(props.targets) ? props.targets.map((targetNode) => {\r\n                    return <Edge source={props.source} target={targetNode} />\r\n                }) : <Edges source={props.source} targets={(lTarget) ? lTarget.nodes : []} />}\r\n            </>;\r\n        }\r\n    }\r\n    return <></>;\r\n}\r\ninterface OwnProps { source: LGraphElement; targets?: LGraphElement[] }\r\ninterface StateProps {}\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {};\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const EdgesConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(EdgesComponent);\r\n\r\nexport const Edges = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <EdgesConnected {...{...props, children}} />;\r\n}\r\nexport default Edges;\r\n","export {Input} from \"../components/forEndUser/Input\";\r\nexport {TextArea} from \"../components/forEndUser/TextArea\";\r\nexport {Select} from \"../components/forEndUser/Select\";\r\nexport {Image} from \"../components/forEndUser/Image\";\r\nexport {Edge} from \"../components/forEndUser/Edge\";\r\n\r\n\r\nexport {DataOutputComponent} from \"../components/logger/DataOutput\";\r\nexport {LoggerComponent} from \"../components/logger/loggerComponent\";\r\nexport {MyInputComponent} from \"../components/abstract/MyInput\";\r\n\r\n/// import components that must save themselves to global variable to be accessible for user\r\n\r\nexport {Overlap} from \"../components/forEndUser/Overlap\";\r\nexport {ColorScheme} from \"../components/colorScheme/colorScheme\";\r\nexport {GraphElement, GraphElementComponent} from \"../graph/graphElement/graphElement\";\r\nexport {Graph, GraphComponent} from \"../graph/graph/graph\"; // require graphelement\r\nexport {DefaultNode, DefaultNodeComponent} from \"../graph/defaultNode/DefaultNode\"; // require graphelement\r\nexport {Vertex, VertexComponent, GraphVertex, Field} from \"../graph/vertex/Vertex\"; // require overlap, graphelement\r\nexport {GraphsContainer, GraphsContainerComponent} from \"../graph/graph/graphContainer\"; // require vertex, graph\r\n//export {DockLayoutComponent} from \"../components/abstract/DockLayoutComponent\";\r\nexport {Edges} from \"../graph/edge/Edges\";\r\n\r\nconsole.info('components loaded');\r\n","import {EdgeOptions, IStore} from \"../../redux/store\";\r\nimport React, {Dispatch, ReactElement, ReactNode, RefObject, useEffect, useRef} from \"react\";\r\nimport {useStateIfMounted} from \"use-state-if-mounted\";\r\nimport {connect} from \"react-redux\";\r\nimport {\r\n    BEGIN,\r\n    DClass,\r\n    Dictionary,\r\n    DUser, END,\r\n    GObject,\r\n    LClass, LGraphElement,\r\n    LPointerTargetable,\r\n    LViewElement,\r\n    Pointer,\r\n    SetFieldAction,\r\n    SetRootFieldAction,\r\n    U\r\n} from \"../../joiner\";\r\nimport {AllPropss as VertexProps} from \"./Vertex\";\r\nimport $ from \"jquery\";\r\nimport \"jqueryui\";\r\nimport \"jqueryui/jquery-ui.css\";\r\nimport { useEffectOnce } from \"usehooks-ts\";\r\n\r\ninterface ThisState {\r\n    // resized: boolean;\r\n    classes: string[];\r\n}\r\n\r\nfunction GraphElement(props: AllProps){}\r\n\r\n\r\nfunction RootVertexComponent(props: AllProps, state: ThisState) {\r\n    const rootProps = props.props;\r\n    const node: LGraphElement = rootProps.node || LPointerTargetable.wrap(rootProps.nodeid);\r\n    const data = rootProps.data;\r\n    const isEdgePending = !!(rootProps.isEdgePending?.source);\r\n    const user = rootProps.isEdgePending.user;\r\n    const source = rootProps.isEdgePending.source;\r\n    const extendError: {reason: string, allTargetSuperClasses: LClass[]} = {reason: '', allTargetSuperClasses: []}\r\n    const canBeExtend = isEdgePending &&\r\n                        rootProps.data.className === \"DClass\" &&\r\n                        source.canExtend(rootProps.data as any as LClass, extendError);\r\n    const view: LViewElement|undefined = rootProps.view;\r\n    let initialclasses: Dictionary<string, boolean> = {};\r\n    initialclasses[data.className] = true;\r\n    let [stateClasses, setClasses] = useStateIfMounted<Dictionary<string, boolean>>(initialclasses);\r\n    let classes = {...stateClasses};\r\n    let currentClonedCounter: number = (view as any)?.clonedCounter;\r\n    let [viewClonedCounter, setViewClonedCounter] = useStateIfMounted<number>(-1);\r\n    let viewIsChanged = viewClonedCounter !== currentClonedCounter;\r\n    if (viewIsChanged) setViewClonedCounter(currentClonedCounter);\r\n    // let [resized, setResized] = useStateIfMounted<boolean>(false);\r\n\r\n    let nodeType = \"NODE_TYPE_ERROR\";\r\n    if ( props.props.isGraph &&  props.props.isVertex) nodeType = \"GraphVertex\";\r\n    if ( props.props.isGraph && !props.props.isVertex) nodeType = \"Graph\";\r\n    if (!props.props.isGraph &&  props.props.isVertex) nodeType = \"Vertex\";\r\n    if (!props.props.isGraph && !props.props.isVertex) nodeType = \"Field\";\r\n    classes[nodeType] = true;\r\n    if (Array.isArray(props.props.className)) { for (let c of props.props.className) classes[c] = true; }\r\n    else if (props.props.className) { classes[props.props.className] = true; }\r\n    if (Array.isArray(props.props.class)) { for (let c of props.props.class) classes[c] = true; }\r\n    else if (props.props.class) { classes[props.props.class] = true; }\r\n\r\n    /// EVENT TRIGGER FUCTIONS START\r\n    const select = (forUser:Pointer<DUser, 0, 1> = null) => {\r\n        if (!forUser) forUser = DUser.current;\r\n        console.log(\"crash\", {props, rootProps, node});\r\n        node.isSelected[forUser] = true;\r\n        SetRootFieldAction.new('_lastSelected', {\r\n            node: rootProps.nodeid,\r\n            view: rootProps.view.id,\r\n            modelElement: rootProps.data?.id\r\n        });\r\n    }\r\n    const onClick = (e: React.MouseEvent<HTMLDivElement>) => {\r\n        if (isEdgePending) {\r\n            const user = rootProps.isEdgePending.user;\r\n            const source = rootProps.isEdgePending.source;\r\n            if (canBeExtend) {\r\n                const lClass: LClass = LPointerTargetable.from(rootProps.data.id);\r\n                // SetFieldAction.new(lClass.id, \"extendedBy\", source.id, \"\", true); // todo: this should throw a error for wrong type.\r\n                // todo: use source.addExtends(lClass); or something (source is LClass)\r\n                SetFieldAction.new(lClass.id, \"extendedBy\", source.id, \"+=\", true);\r\n                SetFieldAction.new(source.id, \"extends\", lClass.id, \"+=\", true);\r\n            }\r\n            SetRootFieldAction.new('isEdgePending', { user: '',  source: '' });\r\n        } else { select(); }\r\n        SetRootFieldAction.new(\"contextMenu\", {display: false, x: 0, y: 0});\r\n        e.stopPropagation();\r\n    }\r\n    const onContextMenu = (e: React.MouseEvent<HTMLDivElement>) => {\r\n        select();\r\n        SetRootFieldAction.new(\"contextMenu\", {\r\n            display: true,\r\n            x: e.clientX,\r\n            y: e.clientY\r\n        });\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n    }\r\n    const onEnter = (e: React.MouseEvent<HTMLDivElement>) => {\r\n        if (isEdgePending && rootProps.data.className === \"DClass\") {\r\n            stateClasses = {...stateClasses};\r\n            stateClasses[ canBeExtend ? \"class-can-be-extended\" : \"class-cannot-be-extended\" ] = true;\r\n            setClasses(stateClasses);\r\n        }\r\n    }\r\n    const onLeave = (e: React.MouseEvent<HTMLDivElement>) => {\r\n        if(rootProps.data.className === \"DClass\") {\r\n            stateClasses = {...stateClasses};\r\n            delete stateClasses[\"class-can-be-extended\"];\r\n            delete stateClasses[\"class-cannot-be-extended\"];\r\n            setClasses(stateClasses);\r\n        }\r\n    }\r\n    /// EVENT TRIGGER FUCTIONS END\r\n\r\n\r\n    /*const sizeStyle: CSSProperties = {};\r\n    if(rootProps.isVertex) { sizeStyle.position = \"absolute\"; }\r\n\r\n    const edgeRefresh = () => {\r\n        const nodeid = rootProps.nodeid;\r\n        if(nodeid) {\r\n            const sources : LeaderLine[] = (window as any).leaderline.bySource[nodeid] || [];\r\n            const targets : LeaderLine[] = (window as any).leaderline.byTarget[nodeid] || [];\r\n            for(let ll of sources) { ll.position(); }\r\n            for(let ll of targets) { ll.position(); }\r\n            const subNodes = rootProps.data.subNodes;\r\n            if(subNodes) {\r\n                for(let node of subNodes) {\r\n                    const sources : LeaderLine[] = (window as any).leaderline.bySource[node.id] || [];\r\n                    const targets : LeaderLine[] = (window as any).leaderline.byTarget[node.id] || [];\r\n                    for(let ll of sources) { ll.position(); }\r\n                    for(let ll of targets) { ll.position(); }\r\n                }\r\n            }\r\n        }\r\n    }*/\r\n\r\n\r\n    const htmlRef: RefObject<HTMLDivElement> = useRef(null);\r\n\r\n    useEffect(() => {\r\n        if (!htmlRef.current) return;\r\n        if (!viewIsChanged) return; // run this only if view is different from old render\r\n        console.log(\"useeffect\", {htmlRef, name:(props.props.data as any).name, view});\r\n        const element: GObject<\"JQuery + ui plugin\"> = $(htmlRef.current); // todo: install typings\r\n        switch(nodeType) {\r\n            case \"GraphVertex\":\r\n            case \"Vertex\":\r\n                element.draggable({\r\n                    cursor: 'grabbing',\r\n                    containment: 'parent',\r\n                    // disabled: !(view.draggable),\r\n                    start: function(event: GObject, obj: GObject) {\r\n                        select();\r\n                        SetRootFieldAction.new(\"contextMenu\", { display: false, x: 0, y: 0 });\r\n                        if(view.onDragStart) {\r\n                            try{ eval(view.onDragStart); }\r\n                            catch (e) { console.log(e) }\r\n                        }\r\n                    },\r\n                    drag: function(event: GObject, obj: GObject) {\r\n                        // SetRootFieldAction.new(\"dragging\", {})\r\n                    },\r\n                    stop: function (event: GObject, obj: GObject) {\r\n                        if(node) {\r\n                            node.y = obj.position.top;\r\n                            node.x = obj.position.left;\r\n                        }\r\n                        if(view.onDragEnd) {\r\n                            try{ eval(view.onDragEnd); }\r\n                            catch (e) { console.log(e) }\r\n                        }\r\n                    }\r\n                });\r\n                element.resizable({\r\n                    containment: 'parent',\r\n                    // disabled: !(view.resizable),\r\n                    start: function(event: GObject, obj: GObject) {\r\n                        select();\r\n                        SetRootFieldAction.new(\"contextMenu\", { display: false, x: 0, y: 0 });\r\n                        if(view.onResizeStart) {\r\n                            try{ eval(view.onResizeStart); }\r\n                            catch (e) { console.log(e) }\r\n                        }\r\n                    },\r\n                    resize: function(event: GObject, obj: GObject) {\r\n                        // SetRootFieldAction.new(\"resizing\", {})\r\n                    },\r\n                    stop: function(event: GObject, obj: GObject) {\r\n                        if (!classes[\"resized\"]) {\r\n                            stateClasses = {...stateClasses};\r\n                            stateClasses[\"resized\"] = true;\r\n                            setClasses(stateClasses);\r\n                        }\r\n                        if(node) {\r\n                            node.width = obj.size.width;\r\n                            node.height = obj.size.height;\r\n                        }\r\n                        if(view.onResizeEnd) {\r\n                            try{ eval(view.onResizeEnd); }\r\n                            catch (e) { console.log(e) }\r\n                        }\r\n                    }\r\n                });break;\r\n            case \"Graph\":\r\n            case \"Field\":\r\n        }\r\n    }, )\r\n\r\n    let viewStyle: GObject = {};\r\n    viewStyle.overflow = 'hidden';\r\n    // viewStyle.position = 'relative'; // 'absolute';\r\n    viewStyle.display = rootProps.view?.display;\r\n    viewStyle.zIndex = node?.zIndex;\r\n    if (view.adaptWidth) viewStyle.width = view.adaptWidth; // '-webkit-fill-available';\r\n    else viewStyle.height = (rootProps.view.height) && rootProps.view.height + 'px';\r\n    if (view.adaptHeight) viewStyle.height = view.adaptHeight; //'fit-content'; // '-webkit-fill-available'; if needs to actually fill all it's not a vertex but a field.\r\n    else viewStyle.width = (rootProps.view.width) && rootProps.view.width + 'px';\r\n\r\n    viewStyle = {};\r\n    return(\r\n        <div ref={htmlRef}\r\n             id={rootProps.nodeid}\r\n             data-nodeid={rootProps.nodeid}\r\n             data-dataid={rootProps.data?.id}\r\n             data-viewid={rootProps.view?.id}\r\n             data-modelname={rootProps.data?.className}\r\n             data-userselecting={JSON.stringify(node?.__raw.isSelected || {})}\r\n             data-nodetype={nodeType}\r\n             style={{...viewStyle}}\r\n             className={Object.keys(classes).join(' ')}\r\n             onClick={onClick}\r\n             onContextMenu={onContextMenu}\r\n             onMouseEnter={onEnter}\r\n             onMouseLeave={onLeave}\r\n             key={rootProps.key || rootProps.nodeid}\r\n        >\r\n            {props.render}\r\n        </div>\r\n\r\n    );\r\n\r\n}\r\ninterface OwnProps {props: VertexProps, render: ReactNode}\r\ninterface StateProps {}\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const props = ownProps.props;\r\n    const selected = props.data.id === props.lastSelected?.id;\r\n    const ret: StateProps = {selected};\r\n    return ret;\r\n\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {} as any;\r\n    return ret;\r\n}\r\n\r\n\r\nexport const RootVertexConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(RootVertexComponent);\r\n\r\nexport const RootVertex = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <RootVertexConnected {...{...props, children}} />;\r\n}\r\nexport default RootVertex;\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import type {Overlap, GObject, Pointer, IStore, DPointerTargetable} from \"../../joiner\";\r\nimport React, {Dispatch, ReactElement, ReactNode} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport toast, {Toaster} from 'react-hot-toast';\r\nimport {LPointerTargetable} from \"../../joiner\";\r\n\r\nfunction InputComponent(props: AllProps) {\r\n    const data = props.data;\r\n    if(!data) return(<></>);\r\n    const field = props.field;\r\n    const value = (data[field] !== undefined) ? data[field] : 'undefined';\r\n    const type = (props.type) ? props.type : 'text';\r\n    const label: string|undefined = props.label;\r\n    const jsxLabel: ReactNode|undefined = props.jsxLabel;\r\n    const tooltip = props.tooltip;\r\n    let css = 'my-auto input ';\r\n    let inputClassName = (props.inputClassName || '');\r\n    css += (jsxLabel) ? 'ms-1' : (label) ? 'ms-auto' : '';\r\n    css += (props.hidden) ? ' hidden-input' : '';\r\n    let autosize: boolean = props.autosize === undefined ? false : props.autosize; // props.type===\"text\"\r\n    css += autosize ? ' autosize-input' : '';\r\n\r\n    const notify = () => toast((t: GObject) => (\r\n        <div onClick={() => toast.dismiss(t.id)}>\r\n            <label className={'ms-1'}>{tooltip}</label>\r\n        </div>\r\n    ));\r\n\r\n    const change = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let val;\r\n        switch (evt.target.type) {\r\n            case \"checkbox\":\r\n            case \"radio\": val = evt.target.checked; break;\r\n            case \"number\": val = +evt.target.value; break;\r\n            default: val = evt.target.value; break;\r\n        }\r\n        data[field] = val;\r\n    }\r\n\r\n    let className = (props as any).className || '';\r\n    let style = (props as any).style || {};\r\n    props = {...props, className:'', style:{}} as any;\r\n    let input = <input spellCheck={false} readOnly={props.readonly} className={css + inputClassName}\r\n                       type={type} value={value} onChange={change}\r\n                       checked={(['checkbox', 'radio'].includes(type)) ? !!value : undefined} />\r\n\r\n    return(<div style={{...{display: (jsxLabel || label) ? 'flex' : 'block', cursor: (tooltip) ? 'help' : 'auto'}, ...style}}\r\n                className={'p-1 ' + className}>\r\n        {(label && !jsxLabel) && <label className={'my-auto'} onClick={() => {if(tooltip) notify()}}>\r\n            {label}\r\n        </label>}\r\n        {(jsxLabel && !label) && <label className={'my-auto'} onClick={() => {if(tooltip) notify()}}>\r\n            {jsxLabel}\r\n        </label>}\r\n        { autosize ? <div className={ (autosize ? \"autosize-input-container\" : \"\") + (props.asLabel ? \" labelstyle\" : \"\")}\r\n                          data-value={value}>{input}</div> : input}\r\n        {tooltip && <Toaster position={'bottom-center'} /> }\r\n    </div>);\r\n}\r\ninterface OwnProps {\r\n    obj: LPointerTargetable | DPointerTargetable | Pointer<DPointerTargetable, 1, 1, LPointerTargetable>;\r\n    field: string;\r\n    label?: string;\r\n    jsxLabel?: ReactNode;\r\n    type?: 'checkbox'|'color'|'date'|'datetime-local'|'email'|'file'|'image'|'month'|\r\n        'number'|'password'|'radio'|'range'|'tel'|'text'|'time'|'url'|'week';\r\n    readonly?: boolean;\r\n    tooltip?: string;\r\n    hidden?: boolean;\r\n    autosize?: boolean;\r\n    inputClassName?: string;\r\n    asLabel?: boolean\r\n}\r\ninterface StateProps { data: LPointerTargetable & GObject; }\r\ninterface DispatchProps { }\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    const pointer: Pointer = typeof ownProps.obj === 'string' ? ownProps.obj : ownProps.obj.id;\r\n    ret.data = LPointerTargetable.fromPointer(pointer);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const InputConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(InputComponent);\r\n\r\nexport const Input = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <InputConnected {...{...props, children}} />;\r\n}\r\nexport default Input;\r\n","import {\r\n    Constructor,\r\n    Constructors,\r\n    DPointerTargetable,\r\n    LPointerTargetable,\r\n    Pointer,\r\n    RuntimeAccessible,\r\n    RuntimeAccessibleClass\r\n} from \"../../joiner\";\r\n\r\n\r\n@RuntimeAccessible\r\nexport class DViewPoint extends DPointerTargetable {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n\r\n    id!: Pointer<DViewPoint, 1, 1, LViewPoint>;\r\n    name!: string;\r\n\r\n    public static new(name: string, persist: boolean = false): DViewPoint {\r\n        return new Constructors(new DViewPoint('dwc'), undefined, persist, undefined).DPointerTargetable().DViewPoint(name).end();\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LViewPoint extends LPointerTargetable {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n\r\n    public __raw!: DViewPoint;\r\n    id!: Pointer<DViewPoint, 1, 1, LViewPoint>;\r\n    name!: string;\r\n}\r\n\r\nDPointerTargetable.subclasses.push(DViewPoint);\r\nLPointerTargetable.subclasses.push(LViewPoint);\r\n\r\n","// import * as detectzoooom from 'detect-zoom'; alternative: https://www.npmjs.com/package/zoom-level\r\nimport React, {ReactElement} from \"react\";\r\n// import {Mixin} from \"ts-mixer\";\r\nimport type {AbstractConstructor, Constructor, Dictionary, GObject, Pointer, Temporary} from \"../joiner\";\r\nimport {\r\n    CreateElementAction,\r\n    DAttribute,\r\n    DClassifier,\r\n    DLog,\r\n    DModelElement,\r\n    DPointerTargetable,\r\n    DRefEdge,\r\n    DReference,\r\n    IStore,\r\n    Json,\r\n    JsType,\r\n    LClassifier,\r\n    LModelElement,\r\n    LNamedElement,\r\n    LogicContext,\r\n    MyError,\r\n    RuntimeAccessible,\r\n    Selectors,\r\n    TODO,\r\n    windoww\r\n} from \"../joiner\";\r\nimport Swal from \"sweetalert2\";\r\n// import KeyDownEvent = JQuery.KeyDownEvent; // https://github.com/tombigel/detect-zoom broken 2013? but works\r\n\r\nconsole.warn('loading ts U log');\r\n\r\n\r\n@RuntimeAccessible\r\nexport class U{\r\n\r\n    public static alert(title: string, text: string) {\r\n        let color = 'text-';\r\n        switch(title.toLowerCase()) {\r\n            case 'error': color += 'danger'; break;\r\n            default: color += 'primary'\r\n        }\r\n        let html = '<style>body.swal2-no-backdrop .swal2-container {background-color: rgb(0 0 0 / 60%) !important}</style>';\r\n        html += `<div><b><label class='fs-5 mb-2 text-uppercase ${color}'>${title}</label></b><hr/>`;\r\n        html += `<label class='fs-6 mt-3'>${text}</label><br/>`;\r\n        const result = Swal.fire({\r\n            html: html,\r\n            backdrop: false,\r\n            showCloseButton: true,\r\n            showConfirmButton: false\r\n            //confirmButtonText: 'GOT IT'\r\n        })\r\n    }\r\n\r\n    public static filteredPointedBy(data: LModelElement, label: string): LModelElement[] {\r\n        const models: LModelElement[] = [];\r\n        for(let dict of data.pointedBy) {\r\n            const pointedBy = dict.source.split('.');\r\n            if(pointedBy.length === 3 && pointedBy[2] === label) {\r\n                models.push(LModelElement.fromPointer(pointedBy[1]));\r\n            }\r\n        }\r\n        return models;\r\n    }\r\n\r\n    public static getFatherFieldToDelete(data: LModelElement): keyof DModelElement|null {\r\n        const father = data.father;\r\n        let field = '';\r\n        switch(father.className + '|' + data.className) {\r\n            // DPackage\r\n            case 'DModel|DPackage': field = 'packages'; break;\r\n            case 'DPackage|DPackage': field = 'subpackages'; break;\r\n            // DEnumerator and DClass\r\n            case 'DPackage|DEnumerator':\r\n            case 'DPackage|DClass': field = 'classifiers'; break;\r\n            // DAttribute\r\n            case 'DClass|DAttribute': field = 'attributes'; break;\r\n            // DReference\r\n            case 'DClass|DReference': field = 'references'; break;\r\n            // DOperation\r\n            case 'DClass|DOperation': field = 'operations'; break;\r\n            // DEnumLiteral\r\n            case 'DEnumerator|DEnumLiteral': field = 'literals'; break;\r\n            // DObject\r\n            case 'DModel|DObject': field = 'objects'; break;\r\n            // DParameter\r\n            case 'DOperation|DParameter': field = 'parameters'; break;\r\n            // DValue\r\n            case 'DObject|DValue': field = 'features'; break;\r\n            // Error\r\n            default: return null;\r\n        }\r\n        return field as keyof DModelElement;\r\n    }\r\n\r\n    public static getReduxFieldToDelete(data: LModelElement): keyof IStore|null {\r\n        let field = '';\r\n        switch(data.className) {\r\n            // DPackage\r\n            case 'DPackage': field = 'packages'; break;\r\n\r\n            // DClass\r\n            case 'DClass': field = 'classs'; break;\r\n            // DEnumerator\r\n            case 'DEnumerator': field = 'enumerators'; break;\r\n            // DAttribute\r\n            case 'DAttribute': field = 'attributes'; break;\r\n            // DReference\r\n            case 'DReference': field = 'references'; break;\r\n            // DOperation\r\n            case 'DOperation': field = 'operations'; break;\r\n            // DParameter\r\n            case 'DParameter': field = 'parameters'; break;\r\n            // DEnumLiteral\r\n            case 'DEnumLiteral': field = 'enumliterals'; break;\r\n            // DObject\r\n            case 'DObject': field = 'objects'; break;\r\n            // DValue\r\n            case 'DValue': field = 'values'; break;\r\n\r\n            // Error\r\n            default: return null;\r\n        }\r\n        return field as keyof IStore;\r\n    }\r\n\r\n    public static initializeValue(typeclassifier: undefined|DClassifier|LClassifier|Pointer<DClassifier, 1, 1, LClassifier>): string {\r\n        // if(!classifier) return 'null';\r\n        const pointer: Pointer = typeof typeclassifier === 'string' ? typeclassifier : (typeclassifier as DClassifier)?.id;\r\n        const me: LNamedElement = LNamedElement.fromPointer(pointer);\r\n        switch(me?.name) {\r\n            default:\r\n            case 'EString': return '';\r\n            case 'EChar':  return 'a';\r\n            case 'EInt': return '0';\r\n            case 'ELong': return '0';\r\n            case 'EShort': return '0';\r\n            case 'Byte': return '0';\r\n            case 'EFloat': return '0';\r\n            case 'EDouble': return '0';\r\n            case 'EBoolean': return 'false';\r\n            case 'EDate': return new Date().toJSON().slice(0,10);\r\n        }\r\n        return 'null';\r\n    }\r\n\r\n    public static orderChildrenByTimestamp(context: LogicContext): LModelElement[] {\r\n        const children = context.proxyObject.children;\r\n        if(children && children.length > 0) {\r\n            let orderedChildren = new Map<number, LModelElement>();\r\n            for(let child of children) {\r\n                let timestamp = child.id.slice(-13);\r\n                orderedChildren.set(+timestamp, child);\r\n            }\r\n            orderedChildren = new Map([...orderedChildren.entries()].sort());\r\n            return [...orderedChildren.values()];\r\n        } else return [];\r\n    }\r\n\r\n\r\n    public static followPath(base: GObject, path: string): {chain: GObject[], lastObject: GObject, keys:string[], lastkey: string, lastval: any, failedRemainingPath: string[]} {\r\n        let patharr = path.split('.');\r\n        let base0 = base;\r\n        let ret: {chain: GObject[], lastObject: GObject, keys: string[], lastkey: string, lastval: any, failedRemainingPath: string[]}  = {} as any;\r\n        ret.keys = patharr;\r\n        ret.chain = [base];\r\n        let lastObject = base;\r\n\r\n        for (let i = 0; i < patharr.length; i++) {\r\n            let path = ret.lastkey = patharr[i];\r\n            lastObject = base;\r\n            base = base[path];\r\n            ret.chain.push(base);\r\n            if (typeof base !== \"object\" || i + 1 === patharr.length) {\r\n                ret.failedRemainingPath = patharr.slice(i);\r\n                ret.lastval = base;\r\n                ret.lastObject = lastObject;\r\n                return ret;\r\n            }\r\n        }\r\n        throw new Error(\"followPath should never reach here\");\r\n        return ret;\r\n    }\r\n\r\n    static multiReplaceAllKV(a: string, kv: string[][] = []): string {\r\n        const keys: string[] = [];\r\n        const vals: string[] = [];\r\n        let i: number;\r\n        for (i = 0; i < kv.length; i++) { keys.push(kv[i][0]); vals.push(kv[i][0]); }\r\n        return U.multiReplaceAll(a, keys, vals); }\r\n\r\n    static multiReplaceAll(a: string, searchText: string[] = [], replacement: string[] = []): string {\r\n        Log.ex(searchText.length !== replacement.length, 'search and replacement must be have same length: ' + searchText.length + \"vs\" + replacement.length + \" \" +JSON.stringify(searchText) + \"   \" + JSON.stringify(replacement));\r\n        let i = -1;\r\n        while (++i < searchText.length) { a = U.replaceAll(a, searchText[i], replacement[i]); }\r\n        return a; }\r\n\r\n    static replaceAll(str: string, searchText: string, replacement: string, debug: boolean = false, warn: boolean = true): string {\r\n        if (!str) { return str; }\r\n        return str.split(searchText).join(replacement); }\r\n\r\n    static toFileName(a: string = 'nameless.txt'): string {\r\n        if (!a) { a = 'nameless.txt'; }\r\n        a = U.multiReplaceAll(a.trim(), ['\\\\', '//', ':', '*', '?', '<', '>', '\"', '|'],\r\n            ['[lslash]', '[rslash]', ';', '°', '_', '{', '}', '\\'', '!']);\r\n        return a;\r\n    }\r\n\r\n\r\n    // warn: this check if the scope containing the function is strict, to check if a specific external scope-file is strict\r\n    // you have to write inline the code:        var isStrict = true; eval(\"var isStrict = false\"); if (isStrict)...\r\n    // @ts-ignore\r\n    public static isStrict: boolean = ( function() { return !this; })();\r\n\r\n    // merge properties with first found first kept (first parameters have priority on override). only override null|undefined values, not (false|0|'') values\r\n    static objectMergeInPlace<A extends object, B extends object>(output: A, ...objarr: B[]): void {\r\n        const out: GObject = output;\r\n        for (let o of objarr) for (let key in o) {\r\n            // noinspection BadExpressionStatementJS,JSUnfilteredForInLoop\r\n            out[key] ?? (out[key] = o[key]);\r\n        }\r\n    }\r\n\r\n    public static log(log: any) {\r\n        console.clear();\r\n        console.log(\"###\", log);\r\n    }\r\n\r\n    static removeEmptyObjectKeys(obj: GObject): void{\r\n        for (let key of Object.keys(obj)) {\r\n            if (obj[key] === null || obj[key] === undefined) delete obj[key];\r\n        }\r\n    }\r\n\r\n    // usage example: objectMergeInPlace_conditional(baseobj, (out, key, current) => !out[key] && current[key];\r\n    // culprit of \"couldn't find intersection\" problem: condition type: (out:A&B, key: string | number, current:B, objarr?: B[], indexOfCurrent?: number) => boolean\r\n    static objectMergeInPlace_conditional<A extends GObject, B extends GObject>(output: A, condition: (...a:any)=>any, ...objarr: B[]): A & B {\r\n        const out: GObject<\"A & B\"> = output;\r\n        let i: number = 0;\r\n        for (let o of objarr) for (let key in o) { if (condition(out, key, o, objarr, i++)) out[key] = o[key]; }\r\n        return out as  A & B; }\r\n\r\n    static buildFunctionDocumentation(f: Function): {parameters: {name: string, defaultVal: string | undefined, typedesc: string | null}[], returns: string | undefined, f: Function, fname: string | undefined, isLambda: boolean, signature: string} {\r\n        Log.e(!JsType.isFunction(f), 'getFunctionSignature() parameter must be a function');\r\n        // let parameters: {name: string, defaultVal: string, typedesc: string}[] = []; //{name: '', defaultVal: undefined, typedesc: ''};\r\n        let ret: {parameters: {name: string, defaultVal: string | undefined, typedesc: string | null}[], returns: string | undefined, f: Function, fname: string | undefined, isLambda: boolean, signature: string}\r\n            = {parameters: [], returns: undefined, f: f, fname: undefined, isLambda: null as Temporary, signature: ''};\r\n        let str: string = f.toString();\r\n        let starti: number = str.indexOf('(');\r\n        let endi: number;\r\n        let parcounter: number = 1;\r\n        for (endi = starti + 1; endi < str.length; endi++) {\r\n            if (str[endi] === ')' && --parcounter === 0) break;\r\n            if (str[endi] === '(') parcounter++; }\r\n\r\n        let parameterStr = str.substring(starti + 1, endi);\r\n        // console.log('getfuncsignature starti:', starti, 'endi', endi, 'fname:', str.substr(0, starti), 'parameterStr:', parameterStr);\r\n        ret.fname = str.substr(0, starti).trim();\r\n        ret.fname = ret.fname.substr(0, ret.fname.indexOf(' ')).trim();\r\n        // 2 casi: anonimo \"function (par1...){}\" e \"() => {}\", oppure nominato: \"function a1(){}\"\r\n        if (ret.fname === '' || ret.fname === 'function') ret.fname = undefined; // 'anonymous function';\r\n\r\n\r\n\r\n        let returnstarti: number = str.indexOf('/*', endi + 1);\r\n        let returnendi: number = -1;\r\n        let bodystarti: number = str.indexOf('{', endi + 1);\r\n        if (returnstarti === -1 || bodystarti !== -1 && bodystarti < returnstarti) {\r\n            // no return type or comment is past body\r\n            ret.returns = undefined;\r\n        } else {\r\n            returnendi = str.indexOf('*/', returnstarti + 2);\r\n            ret.returns = str.substring(returnstarti + 2, returnendi).trim();\r\n            bodystarti = str.indexOf('{', returnendi); }\r\n        if (ret.returns === '') ret.returns = undefined;\r\n\r\n        // is lambda if do not have curly body or contains => between return comment and body\r\n        // console.log('isLambda:', bodystarti, str.substring(Math.max(endi, returnendi)+1, bodystarti));\r\n        ret.isLambda =  bodystarti === -1 || str.substring((window as any).Math.max(endi, returnendi)+1, bodystarti).trim() === '=>';\r\n\r\n        let regexp = /([^=\\/\\,]+)(=?)([^,]*?)(\\/\\*[^,]*?\\*\\/)?,/g; // only problem: the last parameter won't match because it does not end with \",\", so i will append it everytime.\r\n        let match;\r\n        while ((match = regexp.exec(parameterStr + ','))) {\r\n            // match[0] is always the full match (not a capture group)\r\n            // match[2] can only be \"=\" or empty string\r\n            // nb: match[4] can be \"/*something*/\" or \",\" a single , without spaces.\r\n            let par: {name: string, defaultVal: string | undefined, typedesc: string | null} = {name: match[1], defaultVal: match[3], typedesc: match[4] && match[4].length > 1 ? match[4] : null};\r\n            par.name = par.name.trim();\r\n            par.defaultVal = par.defaultVal ? par.defaultVal.trim() : undefined;\r\n            par.typedesc = par.typedesc && par.typedesc && par.typedesc.length > 1 ? par.typedesc.substring(2, par.typedesc.length - 2).trim() || null : null;\r\n            ret.parameters.push(par); }\r\n        // set signature\r\n\r\n        ret.signature = '' + (ret.fname ? '/*' + ret.fname + '*/' : '') + '(';\r\n        let i: number;\r\n        for (i = 0; i < ret.parameters.length; i++) {\r\n            let par = ret.parameters[i];\r\n            ret.signature += (i === 0 ? '' : ', ') + par.name + (par.typedesc ? '/*' + par.typedesc + '*/' : '') + (par.defaultVal ? ' = ' + par.defaultVal : '');\r\n        }\r\n        ret.signature += ')' + (ret.returns ? '/*' + ret.returns + '*/' : '');\r\n        return ret; }\r\n\r\n    // warn: if return is not explicitly inserted (if that's the case set imlicitReturn = false) with a scope and the code have multiple statemepts it will fail.\r\n    // can modify scope AND context\r\n    // warn: can access external scope (from the caller)\r\n    // if the context (this) is missing it will take the scope as context.\r\n    // warn: cannot set different scope and context, \"this\" della funzione sovrascrive anche il \"this\" interno allo scope come chiave dell'oggetto\r\n    // warn: if you modify\r\n    public static evalInContextAndScope<T = any>(codeStr: string, scope?: GObject, context?: GObject): T {\r\n        // console.log('evalInContextAndScope', {codeStr, scope, context});\r\n        // scope per accedere a variabili direttamente \"x + y\"\r\n        // context per accedervi tramite this, possono essere impostati come diversi.\r\n        if (!scope && !context) { Log.ex(true, 'evalInContextAndScope: must specify at least one of scope || context', {codeStr, scope, context}); }\r\n        if (!context) context = scope; // se creo un nuovo contesto pulisco anche lo scope dalle variabili locali di questa funzione.\r\n\r\n        // scope.this = scope.this || context || scope; non funziona\r\n        // console.log('\"with(this){ return eval( \\'\" + codeStr + \"\\' ); }\"', \"with(this){ return eval( '\" + codeStr + \"' ); }\");\r\n        // eslint-disable-next-line no-restricted-syntax,no-with\r\n        // if (allowScope && allowContext) { return function(){ with(this){ return eval( '\" + codeStr + \"' ); }}.call(scopeAndContext); }\r\n        // if (allowScope && allowContext) { return new Function( \"with(this){ return eval( '\" + codeStr + \"' ); }\").call(scopeAndContext); }\r\n        let _ret: T = null as any;\r\n        if (context) context = {...context};\r\n        if (scope) scope = {...scope};\r\n        const _eval = {codeStr, context, scope};\r\n\r\n        /*\r\n        if (allowScope && allowContext) { return new Function( \"with(this){ return eval( '\" + codeStr.replace(/'/g, \"\\\\'\") + \"' ); }\").call(scopeAndContext); }\r\n        if (!allowScope && allowContext) { return new Function( \"return eval( '\" + codeStr + \"' );\").call(scopeAndContext); }\r\n        if (allowScope && !allowContext) { return eval(\"with(scopeAndContext){ \" + codeStr + \" }\"); }*/\r\n//      U.pe(!!scope && U.isStrict(), 'cannot change scope while in strict mode (\"use strict\")');\r\n        let prefixDeclarations: string = \"\", postfixDeclarations: string = '';\r\n        if (scope) {\r\n            if (U.isStrict) {\r\n                for (let key in scope) {\r\n                    // anche se li assegno non cambiano i loro valori nel contesto fuori dall'eval, quindi lancio eccezioni con const.\r\n                    prefixDeclarations += \"const \" + key + \" = this.\" + key + \"; \";\r\n                    postfixDeclarations = \"\";\r\n                }\r\n            } else {\r\n                prefixDeclarations = \"with(\" + (context ? \"this._eval.\" : \"\") + \"scope){ \";\r\n                postfixDeclarations = \" }\";\r\n            }\r\n        }\r\n        if (scope && context) {\r\n            (context as any)._eval = _eval;\r\n            //console.log('pre eval jsx:', context, 'body:', {codeStr, Input: windoww.Input});\r\n            _ret = new (Function as any)(prefixDeclarations + \"return eval( this._eval.codeStr );\" + postfixDeclarations).call(context);\r\n            delete (context as any)._eval; } else\r\n        if (!scope && context) { _ret = new (Function as any)( \"return eval( this._eval._codeStr );\").call(context); } else\r\n        if (scope && !context) {\r\n            // NB: potrei creare lo scope con \"let key = value;\" per ogni chiave, ma dovrei fare json stringify e non è una serializzazione perfetta e può dare eccezioni(circolarità)\r\n            // console.log({isStrict: U.isStrict, eval: \"eval(\" + prefixDeclarations + codeStr + postfixDeclarations + \")\"});\r\n            _ret = eval(prefixDeclarations + codeStr + postfixDeclarations); }\r\n        return _ret; }\r\n\r\n    //T extends ( ((...args: any[]) => any) | (() => any)\r\n    public static execInContextAndScope<T extends (...args: any) => any>(func: T, parameters: Parameters<T>, scope?: GObject, context?: GObject): ReturnType<T>{\r\n        Log.l(false, 'execInCtxScope', {func, parameters, scope, context});\r\n        let ret: any;\r\n        const _eval = {context, scope, func, parameters: parameters || []};\r\n        let prefixDeclarations: string = \"\", postfixDeclarations: string = '';\r\n        if (scope) {\r\n            if (U.isStrict) {\r\n                for (let key in scope) {\r\n                    // anche se li assegno non cambiano i loro valori nel contesto fuori dall'eval, quindi lancio eccezioni con const.\r\n                    prefixDeclarations += \"const \" + key + \" = this.\" + key + \"; \";\r\n                    postfixDeclarations = \"\";\r\n                }\r\n            } else {\r\n                prefixDeclarations = \"with(\" + (context ? \"this._eval.\" : \"\") + \"scope){ \";\r\n                postfixDeclarations = \" }\";\r\n            }\r\n        }\r\n        if (!scope && !context) { Log.ex(true, 'execInContextAndScope: must specify at least one of scope || context', {func, scope, context}); }\r\n        if (!context) context = scope; // se creo un nuovo contesto pulisco anche lo scope dalle variabili locali di questa funzione.\r\n        if (scope && context) {\r\n            context._eval = _eval;\r\n            // will the scope work with \"with\" outside the function body?\r\n            ret = new Function( prefixDeclarations + \"return this._eval.func.apply(this._eval.context, this._eval.parameters);\" + postfixDeclarations).call(context);\r\n            delete context._eval;\r\n        }\r\n        if (!scope && context) { return _eval.func.apply(_eval.context, _eval.parameters); }\r\n        if (scope && !context) {\r\n            // todo: non credo funzioni, _eval non dovrebbe essere accessibile dopo la \"with\" forse devo fare scope._eval = _eval;\r\n            return eval(prefixDeclarations + \"return _eval.func(..._eval.parameters);\" + postfixDeclarations); }\r\n        return ret; }\r\n\r\n    // warn: aggiunge un layer di scope ma ha accesso anche agli scope precedenti (del chiamante della funzione e superiori)\r\n    // warn2: può modificare lo scope internamente all'eval ma ogni cambiamento è perso all'uscita dell'esecuzione (modifica copie)\r\n    // warn3: gli oggetti nested variabili dentro oggetti dello scope) sono modificabili con modifiche persistenti perchè vengono pasate per puntatore.\r\n    // warn4: richiede un return per leggere il valore\r\n    // insomma: sta funzione fa schifo ma non c'è di meglio e non puoi nè permettere nè vietare completamente le modifiche allo scope.\r\n    private static execInScope_DO_NOT_USE(codeStr: string, scope: GObject) {\r\n        return (new Function(...Object.keys(scope), codeStr))(...Object.values(scope));\r\n    }\r\n\r\n    // can modify context in-place, requires \"this\" before variable\r\n    private static evalInContext(js: string, context: GObject): unknown {\r\n        //# Return the results of the in-line anonymous function we .call with the passed context\r\n        return function() { return eval(js); }.call(context);\r\n    }/*\r\n    / *\r\n    // NO: ha 2 problemi: il contesto non è persistente e puoi accedere al contesto solo con \"this\" ma non direttamente usando i nomi delle variabili\r\n    public static evalInContext(contextObj: GObject, code: string): any{\r\n        return U.evalContextFunction.call(contextObj || {}, code);\r\n    }\r\n\r\n    // only create a context for \"this\", wich is bound by .call(), should never be called without .call()\r\n    private static evalContextFunction(code: string): any { eval(code); }\r\n*/\r\n    public static highOrderFunctionExampleTyped<T extends (...args: any[]) => ReturnType<T>>(func: T): (...funcArgs: Parameters<T>) => ReturnType<T> {\r\n        const funcName = func.name;\r\n\r\n        // Return a new function that tracks how long the original took\r\n        return (...args: Parameters<T>): ReturnType<T> => {\r\n            console.time(funcName);\r\n            const results = func(...args);\r\n            console.timeEnd(funcName);\r\n            return results; };\r\n    }\r\n\r\n    static asClass<T extends Function>(obj: any, classe: T, elseReturn: T | null = null): null | T { return obj instanceof classe ? obj as any as T: elseReturn; }\r\n    static asString<T>(propKey: unknown, elseReturn: T | null = null): string | null | T { return typeof propKey === 'string' ? propKey : elseReturn; }\r\n    static isString(propKey: unknown): boolean { return typeof propKey === 'string'; }\r\n\r\n    static loadScript(path: string, useEval: boolean = false): void {\r\n        const script = document.createElement('script');\r\n        script.src = path;\r\n        script.type = 'text/javascript';\r\n        Log.eDev(useEval, 'loadScript', 'useEval','useEval todo. potrebbe essere utile per avviare codice fuori dalle funzioni in futuro.');\r\n        document.body.append(script); }\r\n\r\n    static ancestorArray<T extends Element>(domelem: T, stopNode?: Node, includeSelf: boolean = true): Array<T> {\r\n        // [0]=element, [1]=father, [2]=grandfather... [n]=document\r\n        if (domelem === null || domelem === undefined) { return []; }\r\n        const arr = includeSelf ? [domelem] : [];\r\n        let tmp: T = domelem.parentNode as T;\r\n        while (tmp !== null && tmp !== stopNode) {\r\n            arr.push(tmp);\r\n            tmp = tmp.parentNode as T; }\r\n        return arr; }\r\n\r\n    static toHtml<T extends Element>(html: string, container?: Element, containerTag: string = 'div'): T {\r\n        if (!container) { container = document.createElement(containerTag); }\r\n        Log.e(!html || html === '', 'toHtml', 'require a non-empty string', html);\r\n        container.innerHTML = html;\r\n        const ret: T = container.firstChild as any;\r\n        if (ret) container.removeChild(ret);\r\n        return ret; }\r\n\r\n    public static levenshtein(a: string, b: string): number {\r\n        if (!a.length) return b.length;\r\n        if (!b.length) return a.length;\r\n        let cost = (a.charAt(a.length - 1) === b.charAt(b.length - 1)) ? 0 : 1;\r\n        return (window as any).Math.min(\r\n            U.levenshtein(a.substring(0, a.length - 1), b) + 1,\r\n            U.levenshtein(a, b.substring(0, b.length - 1)) + 1,\r\n            U.levenshtein(a.substring(0, a.length - 1), b.substring(0, b.length - 1)) + cost,\r\n        );\r\n    }\r\n\r\n    public static getClosestPropertyName(names: string[], name: string): string {\r\n        let lowest = Infinity;\r\n        return names.reduce(function(previous, current) {\r\n            let distance = U.levenshtein(current, name);\r\n            if (distance < lowest) {\r\n                lowest = distance;\r\n                return current;\r\n            }\r\n            return previous;\r\n        }, '');\r\n    }\r\n    public static getClosestPropertyNames(names: string[], name: string): string[] {\r\n        let distances: {distance: number, value: string}[] = names.map( value => { return {distance: U.levenshtein(value, name), value}; });\r\n        return distances.sort( (a, b) => a.distance - b.distance).map( e => e.value);\r\n    }\r\n\r\n    //todo for console\r\n    public static autoCorrectProxy<T extends GObject>(target: T, recursive: boolean, logger: Console): ProxyHandler<T> {\r\n        return new Proxy(target, {\r\n            get: function(target, name) {\r\n                let namestr = U.asString(name, null);\r\n                if (!namestr) return undefined;\r\n                if (name in target) return target[namestr];\r\n                const suggestions: string[] = U.getClosestPropertyNames(Object.getOwnPropertyNames(target), namestr);\r\n                logger.warn(`${namestr} is not defined, did you meant ${suggestions[0]}?\\t\\nother suggestions:`, suggestions);\r\n                return namestr && target[suggestions[0]];\r\n            },\r\n        });\r\n    }\r\n\r\n    static arrayRemoveAll<T>(arr: Array<T>, elem: T, debug: boolean = false): void {\r\n        let index;\r\n        if (!arr) return;\r\n        while (true) {\r\n            index = arr.indexOf(elem);\r\n            Log.l(debug, 'ArrayRemoveAll: index: ', index, '; arr:', arr, '; elem:', elem);\r\n            if (index === -1) { return; }\r\n            arr.splice(index, 1);\r\n            Log.l(debug, 'ArrayRemoveAll RemovedOne:', arr);\r\n        }\r\n    }\r\n\r\n    static arrayUnique<T>(arr: T[]): Array<T> { return [ ...new Set<T>(arr)]; }\r\n\r\n    static fileReadContent(file: File, callback: (content :string) => void): void {\r\n        const textType = /text.*/;\r\n        try { if (!file.type || file.type.match(textType)) {\r\n            let reader = new FileReader();\r\n            reader.onload = function(e) { callback( '' + reader.result ); };\r\n            reader.readAsText(file);\r\n            return;\r\n        } } catch(e) { Log.e(true, \"Exception while trying to read file as text. Error: |\", e, \"|\", file); }\r\n        Log.e(true, \"Wrong file type found: |\", file ? file.type : null, \"|\", file); }\r\n\r\n    static fileRead(onChange: (e: Event, files: FileList | null, contents?: string[]) => void, extensions: string[] | FileReadTypeEnum[], readContent: boolean): void {\r\n        // $(document).on('change', (e) => console.log(e));\r\n        console.log(\"importEcore: pre file reader\");\r\n        myFileReader.show(onChange, extensions, readContent);\r\n    }\r\n\r\n    public static clear(htmlNode: Element): void {\r\n        if (htmlNode) while (htmlNode.firstChild) { htmlNode.removeChild(htmlNode.firstChild); }\r\n    }\r\n\r\n    static clearAllTimeouts(): void {\r\n        const highestTimeoutId: number = setTimeout(() => {}, 1) as any;\r\n        for (let i = 0 ; i < highestTimeoutId ; i++) { clearTimeout(i); }\r\n    }\r\n\r\n   static getStackTrace(sliceCalls: number = 2): string[] {\r\n        const ret: string | undefined = Error().stack;\r\n        // try { var a = {}; a.debug(); } catch(ex) { ret = ex.stack; }\r\n        // if (Array.isArray(ret)) return ret;\r\n        if (!ret) return ['UnknownStackTrace'];\r\n        const arr: string[] = ret.split('\\n');\r\n        // first 2 entries are \"Erorr\" and \"getStackTrace()\"\r\n        return sliceCalls > 0 ? arr.slice( sliceCalls ) : arr; }\r\n\r\n    // 0 for caller, 1 for caller of caller, -1 for current function, up to -4 to see internal layers (useless)\r\n    public static getCaller(stacksToSkip: number = 0): string {\r\n        const stack: string[] = this.getStackTrace(4);\r\n        // erase getStackTrace() and isFirstTimeCalled() + Error() first stack + n° of layer the caller wants.\r\n        return stack[stacksToSkip]; }\r\n\r\n    private static gotcalledby: Dictionary<string, boolean> = {};\r\n\r\n    // todo: use in Log.once\r\n    // returns true only the first time this line is reached, false in loops >1 loop, false in recursion >1 recursion, false even days after the first execution unless the page is reloaded\r\n    public static isFirstTimeCalledByThisLine(stacksToSkip: number = 0): boolean {\r\n        const caller: string = this.getCaller(stacksToSkip);\r\n        if (U.gotcalledby[caller]) return false;\r\n        return U.gotcalledby[caller] = true; }\r\n\r\n    public static lineKey(): string { return this.getCaller(0); }\r\n\r\n    // Prevent the backspace key from navigating back.\r\n    static preventBackSlashHistoryNavigation(event: JQuery.KeyDownEvent): boolean {\r\n        if (!event || !event.key || event.key.toLowerCase() !== 'backspace') { return true; }\r\n        const types: string[] = ['text', 'password', 'file', 'search', 'email', 'number', 'date',\r\n            'color', 'datetime', 'datetime-local', 'month', 'range', 'search', 'tel', 'time', 'url', 'week'];\r\n        const srcElement: JQuery<any> = $((event as any)['srcElement'] || event.target);\r\n        const disabled = srcElement.prop('readonly') || srcElement.prop('disabled');\r\n        if (!disabled) {\r\n            if (srcElement[0].isContentEditable || srcElement.is('textarea')) { return true; }\r\n            if (srcElement.is('input')) {\r\n                const type = srcElement.attr('type');\r\n                if (!type || types.indexOf(type.toLowerCase()) > -1) { return true; }\r\n            }\r\n        }\r\n        event.preventDefault();\r\n        return false; }\r\n\r\n    static SetMerge<T>(modifyFirst: boolean = true, ...iterables: Iterable<T>[]): Set<T> {\r\n        const set: Set<T> = modifyFirst ? iterables[0] as Set<T>: new Set<T>();\r\n        Log.e(!(set instanceof Set), 'U.SetMerge() used with modifyFirst = true requires the first argument to be a set');\r\n        for (let iterable of iterables) { for (let item of iterable) { set.add(item); } }\r\n        return set; }\r\n\r\n    // merge with unique elements\r\n    static ArrayMergeU(arr1: any[], ...arr2: any[]): void { U.ArrayMerge0(true, arr1, arr2); }\r\n    // merge without unique check\r\n    static ArrayMerge(arr1: any[], ...arr2: any[]): void { U.ArrayMerge0(false, arr1, arr2); }\r\n    // implementation\r\n    static ArrayMerge0(unique: boolean, arrtarget: any[], ...arrays: any[]): void {\r\n        if (!arrtarget || !arrays) return;\r\n\r\n        if (unique) { for (let arri of arrays) for (let e of arri) U.ArrayAdd(arrtarget, e); }\r\n        else { for (let arri of arrays) Array.prototype.push.apply(arrtarget, arri); }\r\n    }\r\n\r\n    static ArrayAdd<T>(arr: Array<T>, elem: T, unique: boolean = true, throwIfContained: boolean = false): boolean {\r\n        Log.ex(!arr || !Array.isArray(arr), 'ArrayAdd arr null or not array:', arr);\r\n        if (!unique) { arr.push(elem); return true; }\r\n        if (arr.indexOf(elem) === -1) { arr.push(elem); return true; }\r\n        Log.ex(throwIfContained, 'ArrayAdd element already contained:', arr, elem);\r\n        return false; }\r\n\r\n\r\n    private static maxID: number = 0;\r\n    public static idPrefix: string = '';\r\n    // static getID(): string { return U.idPrefix + U.maxID++; }\r\n    static getID: Generator<number> = function* idgenerator(): Generator<number> { let i: number = 0; while(true) yield i++; }();\r\n\r\n\r\n\r\n    static ReactNodeAsElement(e: React.ReactNode): React.ReactElement | null { return e && (e as ReactElement).type ? e as ReactElement : null; }\r\n\r\n    static getType(param: any): string {\r\n        switch (typeof param) {\r\n            default: return typeof param;\r\n            case 'object':\r\n                return param?.constructor?.name || param?.className || \"{_rawobject_}\";\r\n            case 'function': // and others\r\n                return \"geType for function todo: distinguish betweeen arrow and classic\";\r\n        }\r\n    }\r\n\r\n    static stringCompare(s1: string, s2: string): -1 | 0 | 1 { return (s1 < s2) ? -1 : (s1 > s2) ? 1 : 0; }\r\n\r\n    static endsWith(str: string, suffix: string | string[]): boolean {\r\n        if (Array.isArray(suffix)) {\r\n            for (let suf of suffix) {\r\n                if (U.endsWith(str, suf)) return true;\r\n            }\r\n            return false;\r\n        }\r\n        return str.length >= suffix.length && str.lastIndexOf(suffix) === str.length - suffix.length;\r\n    }\r\n\r\n\r\n    static arrayMergeInPlace<T>(arr1: T[], ...otherArrs: T[][]): T[] {\r\n        for (const arr of otherArrs) arr1.push.apply(arr1, arr || []);\r\n        return arr1; }\r\n\r\n    static getEndingNumber(s: string, ignoreNonNumbers: boolean = false, allowDecimal: boolean = false): number {\r\n        let i = s.length;\r\n        let numberEnd = -1;\r\n        while (--i > 0) {\r\n            if (!isNaN(+s[i])) { if (numberEnd === -1) { numberEnd = i; } continue; }\r\n            if (s[i] === '.' && !allowDecimal) { break; }\r\n            if (s[i] === '.') { allowDecimal = false; continue; }\r\n            if (!ignoreNonNumbers) { break; }\r\n            if (numberEnd !== -1) { ignoreNonNumbers = false; }\r\n        }\r\n        s = numberEnd === -1 ? '1' : s.substring(i, numberEnd);\r\n        return +parseFloat(s); }\r\n\r\n    static increaseEndingNumber(s: string, allowLastNonNumberChars: boolean = false, allowDecimal: boolean = false, increaseWhile?: ((x: string) => boolean)): string {\r\n        let regexpstr = '([0-9]+' + (allowDecimal ? '|[0-9]+\\\\.[0-9]+' : '') + ')' + (allowLastNonNumberChars ? '[^0-9]*' : '') + '$';\r\n        const matches: RegExpExecArray | null = new RegExp(regexpstr, 'g').exec(s); // Global (return multi-match) Single line (. matches \\n).\r\n        // S flag removed for browser support (firefox), should work anyway.\r\n        let prefix: string;\r\n        let num: number;\r\n        if (!matches) {\r\n            prefix = s;\r\n            num = 2;\r\n        } else {\r\n            Log.ex(matches.length > 2, 'parsing error: /' + regexpstr + '/gs.match(' + s + ')');\r\n            let i = s.length - matches[0].length;\r\n            prefix = s.substring(0, i);\r\n            num = 1 + (+matches[1]);\r\n        }\r\n        if (increaseWhile) while (increaseWhile(prefix + num)) { num++; }\r\n        return prefix + num; }\r\n\r\n\r\n    public static shallowEqual(objA: GObject, objB: GObject): boolean {\r\n        if (objA === objB) { return true; }\r\n\r\n        if (!objA || !objB || typeof objA !== 'object' || typeof objB !== 'object') { return false; }\r\n\r\n        var keysA = Object.keys(objA);\r\n        var keysB = Object.keys(objB);\r\n\r\n        // if (keysA.length !== keysB.length) { return false; }\r\n        // Test for A's keys different from B.\r\n        // var bHasOwnProperty = hasOwnProperty.bind(objB);\r\n        for (let keya in objA) if (objA[keya] !== objB[keya]) return false;\r\n\r\n        // for (var i = 0; i < keysA.length; i++) if (!bHasOwnProperty(keysA[i]) || objA[keysA[i]] !== objB[keysA[i]]) { return false; }\r\n        return true;\r\n    }\r\n\r\n    // returns true only if parameter is already a number by type. UU.isNumber('3') will return false\r\n    static isNumber(o: any): boolean { return +o === o && !isNaN(o); }\r\n\r\n    public static getAllPrototypes(constructor: Constructor, chainoutoutrecursive: GObject[] = [], currentRecursion = 0, maxRecursion = 20, cache: boolean = true): GObject[] {\r\n        // console.log('getAllPrototypes:', {name: constructor.name, currentRecursion, constructor, chainoutoutrecursive});\r\n        if (cache && (constructor as any).__allprototypes) return (constructor as any).__allprototypes;\r\n        let prototype = (constructor.prototype?.name) && constructor.prototype;\r\n        let __proto__ = (constructor.__proto__?.name) && constructor.__proto__;\r\n        if (!prototype && !__proto__ || currentRecursion >= maxRecursion) return chainoutoutrecursive;\r\n        if (prototype) chainoutoutrecursive.push(prototype);\r\n        if (__proto__) chainoutoutrecursive.push(__proto__);\r\n        if (prototype) U.getAllPrototypes(prototype, chainoutoutrecursive, currentRecursion + 1, maxRecursion);\r\n        if (__proto__) U.getAllPrototypes(__proto__, chainoutoutrecursive, currentRecursion + 1, maxRecursion);\r\n        if (cache) (constructor as any).__allprototypes = chainoutoutrecursive;\r\n        return chainoutoutrecursive;\r\n    }\r\n\r\n    public static classIsExtending(subconstructor: Constructor | AbstractConstructor, superconstructor: Constructor | AbstractConstructor): boolean {\r\n        return (superconstructor as typeof DPointerTargetable)?._extends?.includes(subconstructor as any) || false;\r\n        // return U.getAllPrototypes(subconstructor).includes(superconstructor);\r\n    }\r\n\r\n    static isObject(v: GObject|any, returnIfNull: boolean = true, returnIfUndefined: boolean = false, retIfArray: boolean = false): boolean {\r\n        if (v === null) { return returnIfNull; }\r\n        if (v === undefined) { return returnIfUndefined; }\r\n        if (Array.isArray(v)) { return retIfArray; }\r\n        // nb: mind that typeof [] === 'object'\r\n        return typeof v === 'object'; }\r\n\r\n    static objectFromArrayValues(arr: (string | number)[]): Dictionary<string | number, boolean> {\r\n        let ret: Dictionary = {};\r\n        // todo: improve efficiency\r\n        for (let val of arr) { ret[val] = true; }\r\n        return ret;\r\n    }\r\n\r\n    static toBoolString(bool: boolean, ifNotBoolean: boolean = false): string { return bool === true ? 'true' : (bool === false ? 'false' : '' + ifNotBoolean); }\r\n    static fromBoolString<T extends any>(str: string | boolean): boolean;\r\n    static fromBoolString<T extends any>(str: string | boolean, defaultVal?: T): boolean | T;\r\n    static fromBoolString<T extends any>(str: string | boolean, defaultVal?: T, allowNull?: boolean): boolean | null | T;\r\n    static fromBoolString<T extends any>(str: string | boolean, defaultVal: T = false as any, allowNull: boolean = false, allowUndefined: boolean = false): boolean | null | undefined | T {\r\n        str = ('' + str).toLowerCase();\r\n        if (allowNull && (str === 'null')) return null;\r\n        if (allowUndefined && (str === 'undefined')) return undefined;\r\n\r\n        if (str === \"true\" || str === 't' || str === '1') return true;\r\n        // if (defaultVal === true) return str === \"false\" || str === 'f' || str === '0'; // false solo se è esplicitamente false, true se ambiguo.\r\n        if (str === \"false\" || str === 'f' || str === '0') return false;\r\n        return defaultVal;\r\n    }\r\n\r\n    static arrayDifference<T>(starting: T[], final: T[]): {added: T[], removed: T[], starting: T[], final: T[]} {\r\n        let ret: {added: T[], removed: T[], starting: T[], final: T[]} = {} as any;\r\n        ret.starting = starting;\r\n        ret.final = final;\r\n        if (!starting) starting = [];\r\n        if (!final) final = [];\r\n        ret.removed = Uarr.arraySubtract(starting, final, false); // start & !end\r\n        ret.added = Uarr.arraySubtract(final, starting, false); // end & !start\r\n        return ret;\r\n    }\r\n\r\n    // returns <\"what changed from old to neww\"> and in nested objects recursively\r\n    // todo: how can i tell at what point it's the fina lvalue (might be a nestedobj) and up to when it's a delta to follow and unroll?   using __isAdelta:true ?\r\n    // NB: this returns the delta that generates the future. if you want the delta that generate the past one, invert parameter order.\r\n    public static objectDelta<T extends object>(old: T, neww: T, deep: boolean = true): Partial<T>{\r\n        let newwobj: GObject = neww;\r\n        let oldobj: GObject = old;\r\n        if (old === neww) return {};\r\n        let diff = U.objdiff(old, neww); // todo: optimize this, remove the 3 loops below and add those directly in U.objdiff(old, neww, ret); writing inside the obj in third parameter\r\n\r\n        let ret: GObject = {}; // {__isAdelta:true};\r\n        for (let key in diff.added) { ret[key] = newwobj[key]; }\r\n        for (let key in diff.changed) {\r\n            let subold = oldobj[key];\r\n            let subnew = newwobj[key];\r\n            if (typeof subold === typeof subnew && typeof subold === \"object\") { ret[key] = deep ? U.objectDelta(subold, subnew, true) : subnew; }\r\n            else ret[key] = subnew;\r\n        }\r\n        // todo: add to variable naming rules: can't start with \"_-\", like in \"_-keyname\", it means \"keyname\" removed in undo delta\r\n        let removedprefix = \"\"; // \"_-\";\r\n        for (let key in diff.removed) { ret[removedprefix + key] = undefined; } //newwobj[key]; }\r\n        // console.log(\"objdiff\", {old, neww, diff, ret});\r\n        return ret as Partial<T>;\r\n    }\r\n\r\n    // difference react-style. lazy check by === equality field by field\r\n    public static objdiff<T extends GObject>(old:T, neww: T): {removed: Partial<T>, added: Partial<T>, changed: Partial<T>} {\r\n        // let ret: GObject = {removed:{}, added:{}, changed:{}};\r\n        let ret: {removed: Partial<T>, added: Partial<T>, changed: Partial<T>}  = {removed:{}, added:{}, changed:{}};\r\n        if (!neww && !old) { return ret; }\r\n        if (!neww) { ret.removed = old; return ret; }\r\n        if (!old) { ret.added = neww; return ret; }\r\n        let oldkeys: string[] = Object.keys(old);\r\n        let newkeys: string[] = Object.keys(neww);\r\n\r\n        let key: any;\r\n        for (key in old) {\r\n            // if (neww[key] === undefined){\r\n            if (!(key in neww)){ // if neww have a key with undefined value, it counts (and should) as having that property key defined\r\n                (ret.removed as GObject)[key] = old[key]; continue;\r\n                // if (old[key] === undefined) { continue; }\r\n                // continue;\r\n            }\r\n            if (neww[key] === old[key]) continue;\r\n            (ret.changed as GObject)[key] = old[key];\r\n        }\r\n        for (let key in neww) {\r\n            if (!(key in old)){ (ret.added as GObject)[key] = neww[key]; }\r\n        }\r\n        return ret;\r\n    }\r\n   /*  {a: { b: { c1: 1, c2:2, c3:3 } }, d: 1 }     ---->  {\"a.b.c1\":1, \"a.b.c2\":2, \"a.b.c3\":3. \"d\":1}*/\r\n    public static flattenObjectToRoot(obj: GObject, prefix: string = '', pathseparator: string = '.'): GObject{\r\n        return Object.keys(obj).reduce((acc: GObject, k: string) => {\r\n            const pre = prefix.length ? prefix + pathseparator : '';\r\n            if (typeof obj[k] === 'object') Object.assign(acc, U.flattenObjectToRoot(obj[k], pre + k, pathseparator));\r\n            else acc[pre + k] = obj[k];\r\n            return acc;\r\n        }, {});\r\n    }\r\n\r\n    // from {a:{aa:true, ab:\"ab\"}, b:4} to [\"a.aa = true\", \"a.ab = \\\"ab\\\"\", \"a.b = 4\"]\r\n    // maxkeylength is max length of any individual key, after it it will become: superlongpath --> supe...path\r\n    // maxsubpaths is how many subpaths are displayed at most. after it it will be: super.rea.lly.long.pa.th --> super.rea.pa.th\r\n    public static ObjectToAssignementStrings<R extends {str: string, fullstr: string, path:string[], fullpath:string[], val: string, fullvalue: string, pathlength?: number}>\r\n    (obj: GObject, maxkeylength: number = 10, maxsubpaths: number = 6, maxvallength: number = 20, toolongreplacer: string = \"…\", out?:{best: R}&R[], quotestrings: boolean = true): {best: string}&string[] {\r\n        const pathseparator = \".\";\r\n        const valueseparator = \" = \";\r\n        const filterrow = (rowpaths: string[]) => { return (!rowpaths.includes(\"clonedCounter\") && !rowpaths.includes(\"pointedBy\")); };\r\n        let flatten = U.flattenObjectToRoot(obj, '', pathseparator);\r\n        let i = -1;\r\n        let tmp;\r\n        let ret: {best: string} & string[] = [] as GObject as {best: string} & string[];\r\n        tmp = (maxkeylength - toolongreplacer.length)/2;\r\n        let halfpath = { start: (window as any).Math.floor(tmp), end: (window as any).Math.ceil(tmp) };\r\n        tmp = (maxvallength - toolongreplacer.length)/2;\r\n        let halfval = { start: (window as any).Math.floor(tmp), end: (window as any).Math.ceil(tmp) };\r\n        tmp = (maxsubpaths - toolongreplacer.length)/2;\r\n        let halfsubpaths = { start: (window as any).Math.floor(tmp), end: (window as any).Math.ceil(tmp) };\r\n\r\n\r\n        let bestpathsize = 0;\r\n        let best: R | null = null;\r\n        let countsize = (total: number, arrelem: string): number => total + arrelem.length;\r\n        const filterbest = (row: R) => {\r\n            row.pathlength = row.fullstr.length; // row.fullpath.reduce<number>(countsize, 0);\r\n            if (!best || bestpathsize < row.pathlength && filterrow(row.fullpath)) {\r\n                best = row; bestpathsize = row.pathlength;\r\n                if (out) out.best = best;\r\n                ret.best = best.str;\r\n            }\r\n        }\r\n        console.log(\"u get assignements\", {flatten, obj});\r\n\r\n        for (let key in flatten) {\r\n            let row: R = {fullpath: key.split(pathseparator), fullstr: key} as R;\r\n            // if (!filterrow(row.fullpath)) continue;\r\n            // stringify(undefined) = undefined, so i add + \"\"\r\n            try {\r\n                if (!quotestrings && typeof flatten[key] === \"string\") row.fullvalue = flatten[key];\r\n                else row.fullvalue = JSON.stringify(flatten[key]) + \"\";\r\n            } catch(e) { row.fullvalue = \"⁜not serializable⁜\"; }\r\n            console.log(\"U get assignements loop\", {row, key, flatten, obj});\r\n            row.val = row.fullvalue.length <= maxvallength ? row.fullvalue : row.fullvalue.substring(0, halfval.start) + toolongreplacer + row.fullvalue.substring(halfval.start);\r\n            if (row.fullpath.length > maxsubpaths) {\r\n                row.path = [...row.fullpath];\r\n                row.path.splice( halfsubpaths.start, row.fullpath.length - halfsubpaths.start - halfsubpaths.end, toolongreplacer);\r\n            } else row.path = row.fullpath;\r\n\r\n            // row.path = row.fullpath.length <= maxsubpaths ? row.fullpath : [...row.fullpath.slice(0, halfsubpaths.start), ...row.fullpath.toomanyarraycopies];\r\n            row.path = row.path.map((p: string) => (p.length <= maxkeylength ? p : p.substring(0, halfpath.start) + toolongreplacer + p.substring(p.length - halfpath.end)));\r\n            if (out) { out.push(row); }\r\n            row.str = row.path.join(pathseparator) + valueseparator + row.val;\r\n            ret.push( row.str );\r\n            filterbest(row);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n\r\n    static download(filename: string = 'nameless.txt', text: string = '', debug: boolean = true): void {\r\n        if (!text) { return; }\r\n        filename = U.toFileName(filename);\r\n        const htmla: HTMLAnchorElement = document.createElement('a');\r\n        const blob: Blob = new Blob([text], {type: 'text/plain', endings: 'native'});\r\n        const blobUrl: string = URL.createObjectURL(blob);\r\n        Log.l(debug, text + '|\\r\\n| <-- rn, |\\n| <--n.');\r\n        htmla.style.display = 'none';\r\n        htmla.href = blobUrl;\r\n        htmla.download = filename;\r\n        document.body.appendChild(htmla);\r\n        htmla.click();\r\n        window.URL.revokeObjectURL(blobUrl);\r\n        document.body.removeChild(htmla); }\r\n\r\n    static formatXml(xml: string): string {\r\n        const reg = /(>)\\s*(<)(\\/*)/g;\r\n        const wsexp = / *(.*) +\\n/g;\r\n        const contexp = /(<.+>)(.+\\n)/g;\r\n        xml = xml.replace(reg, '$1\\n$2$3').replace(wsexp, '$1\\n').replace(contexp, '$1\\n$2');\r\n        const pad: string = '' || '\\t';\r\n        let formatted = '';\r\n        const lines = xml.split('\\n');\r\n        let indent = 0;\r\n        let lastType = 'other';\r\n        // 4 types of tags - single, closing, opening, other (text, doctype, comment) - 4*4 = 16 transitions\r\n        const transitions: GObject = {\r\n            'single->single': 0,\r\n            'single->closing': -1,\r\n            'single->opening': 0,\r\n            'single->other': 0,\r\n            'closing->single': 0,\r\n            'closing->closing': -1,\r\n            'closing->opening': 0,\r\n            'closing->other': 0,\r\n            'opening->single': 1,\r\n            'opening->closing': 0,\r\n            'opening->opening': 1,\r\n            'opening->other': 1,\r\n            'other->single': 0,\r\n            'other->closing': -1,\r\n            'other->opening': 0,\r\n            'other->other': 0\r\n        };\r\n        let i = 0;\r\n        for (i = 0; i < lines.length; i++) {\r\n            const ln = lines[i];\r\n\r\n            // Luca Viggiani 2017-07-03: handle optional <?xml ... ?> declaration\r\n            if (ln.match(/\\s*<\\?xml/)) {\r\n                formatted += ln + '\\n';\r\n                continue;\r\n            }\r\n            // ---\r\n\r\n            const single = Boolean(ln.match(/<.+\\/>/)); // is this line a single tag? ex. <br />\r\n            const closing = Boolean(ln.match(/<\\/.+>/)); // is this a closing tag? ex. </a>\r\n            const opening = Boolean(ln.match(/<[^!].*>/)); // is this even a tag (that's not <!something>)\r\n            const type = single ? 'single' : closing ? 'closing' : opening ? 'opening' : 'other';\r\n            const fromTo = lastType + '->' + type;\r\n            lastType = type;\r\n            let padding = '';\r\n\r\n            indent += transitions[fromTo];\r\n            let j: number;\r\n            for (j = 0; j < indent; j++) {\r\n                padding += pad;\r\n            }\r\n            if (fromTo === 'opening->closing') {\r\n                formatted = formatted.substr(0, formatted.length - 1) + ln + '\\n'; // substr removes line break (\\n) from prev loop\r\n            } else {\r\n                formatted += padding + ln + '\\n';\r\n            }\r\n        }\r\n\r\n        return formatted.trim(); }\r\n\r\n\r\n    // https://stackoverflow.com/questions/13861254/json-stringify-deep-objects  implementation with depth\r\n    static circularStringify(obj: GObject, replacer?: null | ((key: string, value: any) => any), space?: string | number, maxDepth_unsupported: number = 100): string {\r\n        const cache: any[] = [];\r\n        return JSON.stringify(obj, (key, value: any) => {\r\n            if (typeof value === 'object' && value !== null) {\r\n                // Duplicate reference found, discard key\r\n                if (cache.includes(value)) return \"[Circular Reference]\"; // might happen both before and after the replacer func\r\n                if (replacer){\r\n                    value = replacer(key, value);\r\n                    if (cache.includes(value)) return \"[Circular Reference]\"; // might happen both before and after the replacer func\r\n                }\r\n                // Store value in our collection\r\n                cache.push(value);\r\n            }\r\n            return value;\r\n        }, space);\r\n    }\r\n\r\n    static getFirstNumber(s: string, allowDecimalDot: boolean = true, allowDecimalComma: boolean = true, valueifmismatch: any = null): number {\r\n        let commamode = (allowDecimalComma ? (allowDecimalDot ?\"(\\\\.|\\\\,)\" : \"\\\\,\") : (allowDecimalDot ? \"\\\\.\" : \"will not use this regex\"));\r\n        let floatregex = new RegExp(\"-?\" + commamode  + \"?\\\\d+(\" + commamode + \"\\\\d{1,2})?\");\r\n        let intregex = /-?\\d+/;\r\n        let ret: any;\r\n        if (allowDecimalDot || allowDecimalComma) ret = floatregex.exec(s);\r\n        else ret = intregex.exec(s);\r\n        console.log({ret, floatregex, intregex, s});\r\n        ret = ret && ret[0]; // first match\r\n        if (ret === null) return valueifmismatch;\r\n\r\n        let tmpindex:number;\r\n        if (allowDecimalComma) ret = U.replaceAll(ret, \",\", \".\");\r\n        // while (allowDecimalComma && (tmpindex = ret.indexOf(\",\")) !== ret.lastIndexOf(\",\")) ret.substring(tmp+1) // ret.indexOf(.)\r\n        while ((allowDecimalDot || allowDecimalComma) && (tmpindex = ret.indexOf(\".\")) !== ret.lastIndexOf(\".\")) ret = ret.substring(tmpindex+1) // ret.indexOf(.)\r\n        // if (ret[0]===\"-\" && (ret[1]===\",\" || ret[1]===\".\")) ret = \"-0.\"+ret.substring(2); automatically done bu js.    +\"-.5\" = -0.5\r\n        return +ret;\r\n    }\r\n\r\n}\r\nexport class DDate{\r\n\r\n    public static addDay(date: Date, offset: number, inplace: boolean): Date {\r\n        const ret: Date = inplace ? date : new Date(date);\r\n        ret.setDate(date.getDate() + offset);\r\n        return ret;\r\n    }\r\n    public static addMonth(date: Date, offset: number, inplace: boolean): Date {\r\n        const ret: Date = inplace ? date : new Date(date);\r\n        ret.setMonth(date.getMonth() + offset);\r\n        return ret;\r\n    }\r\n    public static addYear(date: Date, offset: number, inplace: boolean): Date {\r\n        const ret: Date = inplace ? date : new Date(date);\r\n        ret.setFullYear(date.getFullYear() + offset);\r\n        return ret;\r\n    }\r\n}\r\n\r\nexport class myFileReader {\r\n    private static input: HTMLInputElement = null as any;\r\n    private static fileTypes: string[] = null as any;\r\n    private static onchange: (e: Event) => void = null as any;\r\n    // constructor(onchange: (e: ChangeEvent) => void = null, fileTypes: FileReadTypeEnum[] | string[] = null) { myFileReader.setinfos(fileTypes, onchange); }\r\n    private static setinfos(fileTypes: undefined | FileReadTypeEnum[] | string[], onchange: (e: Event, files: FileList | null, contents: string[] | undefined ) => void, readcontent: boolean) {\r\n        myFileReader.fileTypes = (fileTypes || myFileReader.fileTypes) as string[];\r\n        const debug: boolean = false;\r\n        debug&&console.log('fileTypes:', myFileReader.fileTypes, fileTypes);\r\n        myFileReader.input = document.createElement('input');\r\n        const input: HTMLInputElement = myFileReader.input;\r\n        myFileReader.onchange = function (e: Event): void {\r\n            if (!readcontent) { onchange(e, input.files, undefined); return; }\r\n            let contentObj: Dictionary<number, string> = {};\r\n            let fileLetti: number = 0;\r\n            for (let i: number = 0; input.files && i <input.files.length; i++) {\r\n                const f: File = input.files[i];\r\n                debug&&console.log('filereadContent['+i+']( file:', f, ')');\r\n                U.fileReadContent(f, (content: string) => {\r\n                    debug&&console.log('file['+i+'] read complete. done: ' + ( 1 + fileLetti) + ' / ' + input.files?.length, 'contentObj:', contentObj);\r\n                    contentObj[i] = content; // cannot use array, i'm not sure the callbacks will be called in order. using push is safer but could alter order.\r\n                    // this is last file to read.\r\n                    if (input.files && ++fileLetti === input.files.length) {\r\n                        const contentArr: string[] = [];\r\n                        for (let j: number = 0; j < input.files.length; j++) { contentArr.push(contentObj[j]); }\r\n                        onchange(e, input.files, contentArr);\r\n                    }\r\n                });\r\n            }\r\n        } || myFileReader.onchange;\r\n    }\r\n    private static reset(): void {\r\n        myFileReader.fileTypes = undefined as any;\r\n        myFileReader.onchange = undefined as any;\r\n        myFileReader.input = undefined as any;\r\n    }\r\n    public static show(onChange: (e: Event, files: FileList | null, contents?: string[]) => void, extensions: undefined | string[] | FileReadTypeEnum[] = undefined, readContent: boolean): void {\r\n        console.log(\"importEcore: pre file reader\", myFileReader.input);\r\n        myFileReader.setinfos(extensions, onChange, readContent);\r\n        //if (!myFileReader.input) return;\r\n        myFileReader.input.setAttribute('type', 'file');\r\n        if (myFileReader.fileTypes) {\r\n            myFileReader.input.setAttribute('accept', myFileReader.fileTypes.join(','));\r\n        }\r\n        //console.log('fileTypes:', myFileReader.fileTypes, 'input:', myFileReader.input);\r\n        $(myFileReader.input).on('change.custom' as any, myFileReader.onchange).trigger('click');\r\n        myFileReader.reset();\r\n    }\r\n\r\n}\r\n\r\nexport class Uarr{\r\n    public static arrayIntersection<T>(arr1: T[], arr2: T[]): T[]{\r\n        if (!arr1 || ! arr2) return null as any;\r\n        return arr1.filter( e => arr2.indexOf(e) >= 0);\r\n    }\r\n\r\n     static arraySubtract(arr1: any[], arr2: any[], inPlace: boolean): any[]{\r\n         let i: number;\r\n         const ret: any[] = inPlace ? arr1 : [...arr1];\r\n         for (i = 0; i < arr2.length; i++) { U.arrayRemoveAll(ret, arr2[i]); }\r\n         return ret; }\r\n\r\n}\r\n\r\nexport class FocusHistoryEntry {\r\n    time: Date;\r\n    evt: JQuery.FocusInEvent;\r\n    element: Element;\r\n    constructor(e: JQuery.FocusInEvent, element?: Element, time?: Date) {\r\n        this.evt = e;\r\n        this.element = element || e.target;\r\n        this.time = time || new Date();\r\n    }\r\n}\r\n\r\nexport enum ShortAttribETypes {\r\n    void = 'void',\r\n    EChar  = 'EChar',\r\n    EString  = 'EString',\r\n    EDate  = 'EDate',\r\n    EBoolean = 'EBoolean',\r\n    EByte  = 'EByte',\r\n    EShort  = 'EShort',\r\n    EInt  = 'EInt',\r\n    ELong  = 'ELong',\r\n    EFloat  = 'EFloat',\r\n    EDouble  = 'EDouble',\r\n    /*\r\n  ECharObj  = 'ECharObj',\r\n  EStringObj  = 'EStringObj',\r\n  EDateObj  = 'EDateObj',\r\n  EFloatObj  = 'EFloatObj',\r\n  EDoubleObj  = 'EDoubleObj',\r\n  EBooleanObj = 'EBooleanObj',\r\n  EByteObj  = 'EByteObj',\r\n  EShortObj  = 'EShortObj',\r\n  EIntObj  = 'EIntObj',\r\n  ELongObj  = 'ELongObj',\r\n  EELIST  = 'EELIST',*/\r\n\r\n}\r\nwindoww.ShortAttribETypes = ShortAttribETypes;\r\n\r\nexport const ShortAttribSuperTypes: Dictionary<ShortAttribETypes, ShortAttribETypes[]> = {\r\n    \"void\"     : [],\r\n    \"EChar\"    : [ShortAttribETypes.EString],\r\n    \"EString\"  : [],\r\n    \"EDate\"    : [],\r\n    \"EBoolean\" : [ShortAttribETypes.EByte, ShortAttribETypes.EShort, ShortAttribETypes.EInt, ShortAttribETypes.ELong, ShortAttribETypes.EFloat, ShortAttribETypes.EDouble],\r\n    \"EByte\"    : [ShortAttribETypes.EShort, ShortAttribETypes.EInt, ShortAttribETypes.ELong, ShortAttribETypes.EFloat, ShortAttribETypes.EDouble],\r\n    \"EShort\"   : [ShortAttribETypes.EInt, ShortAttribETypes.ELong, ShortAttribETypes.EFloat, ShortAttribETypes.EDouble],\r\n    \"EInt\"     : [ShortAttribETypes.ELong, ShortAttribETypes.EFloat, ShortAttribETypes.EDouble],\r\n    \"ELong\"    : [ShortAttribETypes.EFloat, ShortAttribETypes.EDouble],\r\n    \"EFloat\"   : [ShortAttribETypes.EDouble],\r\n    \"EDouble\"  : []\r\n};\r\n\r\nexport class SelectorOutput {\r\n    jqselector!: string;\r\n    attrselector!: string;\r\n    attrRegex!: RegExp;\r\n    exception!: any;\r\n    resultSetAttr!: Attr[];\r\n    resultSetElem!: JQuery<Element>;\r\n}\r\nexport enum Keystrokes {\r\n    escape = 'Escape',\r\n    capsLock = 'CapsLock',\r\n    shift = 'Shift',\r\n    tab = 'Tab',\r\n    alt = 'Alt',\r\n    control = 'Control',\r\n    end = 'End',\r\n    home = 'Home',\r\n    pageUp = 'PageUp',\r\n    pageDown = 'PageDown',\r\n    enter = 'Enter', // event.code = 'NumpadEnter' se fatto da numpad, oppure \"numpad3\", \"NumpadMultiply\", ShiftLeft, etc...\r\n    numpadEnter = 'NumpadEnter',\r\n    audioVolumeMute = 'AudioVolumeMute',\r\n    audioVolumeUp = 'AudioVolumeUp',\r\n    audioVolumeDown = 'AudioVolumeDown',\r\n    mediaTrackPrevious = 'MediaTrackPrevious',\r\n    delete = 'Delete', // canc\r\n    backspace = 'Backspace',\r\n    space = ' ',\r\n    altGraph = 'AltGraph',\r\n    arrowLeft = 'ArrowLeft',\r\n    arrowRight = 'ArrowRight',\r\n    arrowUp = 'ArrowUp',\r\n    arrowDown = 'ArrowDown',\r\n    insert = 'Insert',\r\n    f1 = 'F1',\r\n    // weird ones:\r\n    meta = 'Meta', // f1, or other f's with custom binding and windows key\r\n    unidentified = 'Unidentified', // brightness\r\n    __NotReacting__ = 'fn, print, maybe others', // not even triggering event?\r\n}\r\n\r\n\r\nexport enum AttribETypes {\r\n    void = '???void',\r\n    EChar = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EChar',\r\n    EString = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EString',\r\n    EDate = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EDate',\r\n    EFloat = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EFloat',\r\n    EDouble = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EDouble',\r\n    EBoolean = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EBoolean',\r\n    EByte = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EByte',\r\n    EShort = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EShort',\r\n    EInt = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EInt',\r\n    ELong = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//ELong',\r\n    /*\r\n  ECharObj = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//ECharObject',\r\n  EStringObj = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EStringObject',\r\n  EDateObj = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EDateObject',\r\n  EFloatObj = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EFloatObject',\r\n  EDoubleObj = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EDoubleObject',\r\n  EBooleanObj = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EBooleanObj',\r\n  EByteObj = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EByteObject',\r\n  EShortObj = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EShortObject',\r\n  EIntObj = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EIntegerObject',\r\n  ELongObj = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//ELongObject', */\r\n    // EELIST = 'ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EEList', // List<E> = List<?>\r\n}\r\n\r\n// export type Json = object;\r\n\r\nexport class ParseNumberOrBooleanOptions{\r\n    defaultValue?: any;\r\n    allowNull?: boolean; nullValue?: any;\r\n    allowUndefined?: boolean; undefinedValue?: any;\r\n    allowedNan?: boolean; nanValue?: any;\r\n    allowBooleans?: boolean; trueValue?: any; falseValue?: any;\r\n    constructor(\r\n        defaultValue: any = null, allowNull: boolean = false, nullValue: any = null,\r\n        allowUndefined: boolean = false, undefinedValue: any = undefined,\r\n        allowedNan: boolean = false, nanValue: any = NaN,\r\n        allowBooleans: boolean = true, trueValue : any = 1, falseValue: any = 0) {\r\n        this.defaultValue = defaultValue; this.allowNull = allowNull; this.nullValue = nullValue;\r\n        this.allowUndefined = allowUndefined; this.undefinedValue = undefinedValue;\r\n        this.allowedNan = allowedNan; this.nanValue = nanValue;\r\n        this.allowBooleans = allowBooleans; this.trueValue = trueValue; this.falseValue = falseValue;\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class Log{\r\n    constructor() { }\r\n    // public static history: Dictionary<string, Dictionary<string, any[]>> = {}; // history['pe']['key'] = ...parameters\r\n    public static lastError: any[];\r\n    private static loggerMapping: Dictionary<string, LoggerInterface[]> = {} // takes function name returns logger list\r\n    public static registerLogger(logger: LoggerInterface, triggerAt: (typeof windoww.U.pe) & {name: string}) {\r\n        if (!Log.loggerMapping[triggerAt.name]) Log.loggerMapping[triggerAt.name] = [];\r\n        Log.loggerMapping[triggerAt.name].push(logger);\r\n    }\r\n\r\n    static disableConsole(){\r\n        // @ts-ignore\r\n        console['logg'] = console.log;\r\n        console.log = () => {}; }\r\n\r\n    static enableConsole() {\r\n        // @ts-ignore\r\n        if (console['logg']) console.log = console['logg']; }\r\n\r\n    private static log(prefix: string, category: string, originalFunc: typeof console.log, b: boolean, ...restArgs: any[]): string {\r\n        if (!b) { return ''; }\r\n        const key: string = windoww.U.getCaller(1);\r\n        if (restArgs === null || restArgs === undefined) { restArgs = []; }\r\n        let str = '[' + prefix + ']' + key + ': ';\r\n        for (let i = 0; i < restArgs.length; i++) {\r\n            // console.log(prefix, {i, restArgs, curr:restArgs[i]});\r\n            str += '' +\r\n                (typeof restArgs[i] === 'symbol' ?\r\n                    '' + String(restArgs[i]) :\r\n                    restArgs[i])\r\n                + '\\t\\r\\n'; }\r\n        if (Log.loggerMapping[category]) for (const logger of Log.loggerMapping[category]) { logger.log(category, key, restArgs, str); }\r\n        originalFunc(key, ...restArgs);\r\n        return str; }\r\n\r\n    public static e(b: boolean, ...restArgs: any[]): string {\r\n        if (!b) return '';\r\n        const str = Log.log('Error', 'e', console.error, b, ...restArgs);\r\n        Log.lastError = restArgs;\r\n        return str;\r\n        // throw new Error(str);\r\n    }\r\n\r\n    public static eDev(b: boolean, ...restArgs: any[]): string {\r\n        if (!b) return '';\r\n        const str = Log.log('Dev Error','eDev', console.error, b, ...restArgs);\r\n        Log.lastError = restArgs;\r\n        return str;\r\n        // throw new Error(str);\r\n    }\r\n\r\n    public static ex(b: boolean, ...restArgs: any[]): null | never | any {\r\n        if (!b) return null;\r\n        const str = Log.log('Error', 'e', console.error, b, ...restArgs);\r\n        Log.lastError = restArgs;\r\n        windoww.ee = restArgs;\r\n        windoww.e1 = restArgs[1];\r\n        throw new MyError(str, ...restArgs); }\r\n\r\n    public static exDev(b: boolean, ...restArgs: any[]): null | never | any {\r\n        if (!b) return null;\r\n        const str = Log.log('Dev Error','eDev', console.error, b, ...restArgs);\r\n        Log.lastError = restArgs;\r\n        windoww.ee = restArgs;\r\n        windoww.e1 = restArgs[1];\r\n        throw new MyError(str, ...restArgs); }\r\n\r\n    public static i(b: boolean, ...restArgs: any[]): string { return Log.log('Info', 'i', console.log, b, ...restArgs); }\r\n    public static l(b: boolean, ...restArgs: any[]): string { return Log.log('Log', 'l', console.log, b, ...restArgs); }\r\n    public static w(b: boolean, ...restArgs: any[]): string { return Log.log('Warn', 'w', console.warn, b, ...restArgs); }\r\n\r\n\r\n    public static eDevv<T extends any = any>(firstParam?: NotBool<T>, ...restAgs: any): string { return Log.eDev(true, ...[firstParam, ...restAgs]); }\r\n    public static ee(...restAgs: any): string { return Log.e(true, ...restAgs); }\r\n    public static exDevv<T extends any = any>(firstParam?: NotBool<T>, ...restAgs: any): never | any { return Log.exDev(true, ...[firstParam, ...restAgs]); }\r\n    public static exx(...restAgs: any): never | any { return Log.ex(true, ...restAgs); }\r\n    public static ii(...restAgs: any): string { return Log.i(true, ...restAgs); }\r\n    public static ll(...restAgs: any): string { return Log.l(true, ...restAgs); }\r\n    public static ww(...restAgs: any): string { return Log.w(true, ...restAgs); }\r\n}\r\n\r\ntype NotBool<T> = Exclude<T, boolean>;\r\n\r\ninterface LoggerInterface{\r\n    log: (category: string, key: string, data: any[], fullconcat?: string) => any;\r\n}\r\n\r\n\r\n\r\nexport class FileReadTypeEnum {\r\n    public static image: FileReadTypeEnum = \"image/*\" as any;\r\n    public static audio: FileReadTypeEnum = \"audio/*\" as any;\r\n    public static video: FileReadTypeEnum = \"video/*\" as any;\r\n    /// a too much huge list https://www.iana.org/assignments/media-types/media-types.xhtml\r\n    public static AndManyOthersButThereAreTooMuch: string = \"And many others... https://www.iana.org/assignments/media-types/media-types.xhtml\";\r\n    public static OrJustPutFileExtension: string = \"OrJustPutFileExtension\";\r\n}\r\n\r\nconsole.warn('loaded ts U');\r\n","import {\r\n    Constructor,\r\n    Constructors,\r\n    DocString,\r\n    DPointerTargetable,\r\n    EdgeBendingMode,\r\n    getWParams,\r\n    GraphSize,\r\n    LogicContext,\r\n    LPointerTargetable,\r\n    MyProxyHandler,\r\n    Pointer,\r\n    RuntimeAccessible,\r\n    RuntimeAccessibleClass,\r\n    SetFieldAction\r\n} from \"../../joiner\";\r\nimport {DViewPoint, LViewPoint} from \"../viewPoint/viewpoint\";\r\n\r\n\r\n@RuntimeAccessible\r\nexport class DViewElement extends DPointerTargetable {\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LViewElement;\r\n    // static logic: typeof LViewElement;\r\n    // static structure: typeof DViewElement;\r\n\r\n    // inherited redefine\r\n    // public __raw!: DViewElement;\r\n    id!: Pointer<DViewElement, 1, 1, LViewElement>;\r\n\r\n\r\n    // own properties\r\n    bindVertexSizeToView: boolean = true;\r\n    name!: string;\r\n    constants?: string; // evalutate 1 sola volta all'applicazione della vista o alla creazione dell'elemento.\r\n    preRenderFunc?: string; // evalutate tutte le volte che l'elemento viene aggiornato (il model o la view cambia)\r\n    jsxString!: string; // l'html template\r\n    usageDeclarations?: string;\r\n    forceNodeType?: DocString<'component name (Vertex, Field, GraphVertex, Graph)'>;\r\n    scalezoomx: boolean = false; // whether to resize the element normally using width-height or resize it using zoom-scale css\r\n    scalezoomy: boolean = false;\r\n    // not persistent, some not shared. deve essere diverso da utente ad utente perchè dipende dal pan e zoom nel grafo dell'utente attuale.\r\n    // facendo pan su grafo html sposti gli elementi, per simulare uno spostamento del grafo e farlo sembrare illimitato.\r\n    // __transient: DViewTransientProperties;\r\n    storeTemporaryPositions: boolean = false; // if true updates vertex position every X millisecond while dragging, if false updates it once when the vertex is released.\r\n    appliableToClasses!: string[]; // class names: DModel, DPackage, DAttribute...\r\n    subViews!: Pointer<DViewElement, 0, 'N', LViewElement>;\r\n    oclApplyCondition!: string; // ocl selector\r\n    explicitApplicationPriority!: number; // priority of the view, if a node have multiple applicable views, the view with highest priority is applied.\r\n    defaultVSize!: GraphSize;\r\n    adaptHeight!: boolean | 'fit-content' | '-webkit-fill-available';\r\n    adaptWidth!: boolean | 'fit-content' | '-webkit-fill-available';\r\n    width!: number;\r\n    height!: number;\r\n    draggable!: boolean;\r\n    resizable!: boolean;\r\n    query!: string;\r\n    viewpoint: Pointer<DViewPoint, 0, 1, LViewElement> = '';\r\n    display!: 'block'|'contents'|'flex'|string;\r\n    onDragStart: string = '';\r\n    onDragEnd: string = '';\r\n    onResizeStart: string = '';\r\n    onResizeEnd: string = '';\r\n    bendingMode!: EdgeBendingMode;\r\n\r\n    public static new(name: string, jsxString: string, defaultVSize?: GraphSize, usageDeclarations: string = '', constants: string = '',\r\n                      preRenderFunc: string = '', appliableToClasses: string[] = [], oclApplyCondition: string = '', priority: number = 1 , persist: boolean = false): DViewElement {\r\n        return new Constructors(new DViewElement('dwc'), undefined, persist, undefined).DPointerTargetable().DViewElement(name, jsxString, defaultVSize, usageDeclarations, constants,\r\n            preRenderFunc, appliableToClasses, oclApplyCondition, priority).end();\r\n    }\r\n    public static new2(name: string, jsxString: string, callback?: (d:DViewElement)=>void, persist: boolean = true): DViewElement {\r\n        return new Constructors(new DViewElement('dwc'), undefined, persist, undefined)\r\n            .DPointerTargetable().DViewElement(name, jsxString).end(callback);\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LViewElement<Context extends LogicContext<DViewElement> = any, D extends DViewElement = any>\r\n    extends LPointerTargetable { // MixOnlyFuncs(DViewElement, LPointerTargetable)\r\n\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    // static singleton: LViewElement;\r\n    // static logic: typeof LViewElement;\r\n    // static structure: typeof DViewElement;\r\n\r\n    // inherited redefine\r\n    public __raw!: DViewElement;\r\n    id!: Pointer<DViewElement, 1, 1, LViewElement>;\r\n\r\n\r\n    // own properties\r\n    bindVertexSizeToView!: boolean;\r\n    name!: string;\r\n    constants?: string; // evalutate 1 sola volta all'applicazione della vista o alla creazione dell'elemento.\r\n    preRenderFunc?: string; // evalutate tutte le volte che l'elemento viene aggiornato (il model o la view cambia)\r\n\r\n    jsxString!: string; // l'html template\r\n    usageDeclarations?: string; // example: state\r\n    forceNodeType?: DocString<'component name'>;\r\n    scalezoomx!: boolean; // whether to resize the element normally using width-height or resize it using zoom-scale css\r\n    scalezoomy!: boolean;\r\n    // not persistent, some not shared. deve essere diverso da utente ad utente perchè dipende dal pan e zoom nel grafo dell'utente attuale.\r\n    // facendo pan su grafo html sposti gli elementi, per simulare uno spostamento del grafo e farlo sembrare illimitato.\r\n    // __transient: DViewTransientProperties;\r\n    storeTemporaryPositions!: boolean; // if true updates vertex position every X millisecond while dragging, if false updates it once when the vertex is released.\r\n    appliableToClasses!: string[]; // class names: DModel, DPackage, DAttribute...\r\n    subViews!: LViewElement[];\r\n    oclApplyCondition!: string; // ocl selector\r\n    explicitApplicationPriority!: number; // priority of the view, if a node have multiple applicable views, the view with highest priority is applied.\r\n    defaultVSize!: GraphSize;\r\n    adaptHeight!: boolean;\r\n    adaptWidth!: boolean;\r\n    width!: number;\r\n    height!: number;\r\n    draggable!: boolean;\r\n    resizable!: boolean;\r\n    query!: string;\r\n    viewpoint!: LViewPoint;\r\n    display!: 'block'|'contents';\r\n    onDragStart!: string;\r\n    onDragEnd!: string;\r\n    onResizeStart!: string;\r\n    onResizeEnd!: string;\r\n    bendingMode!: EdgeBendingMode;\r\n\r\n    get_viewpoint(context: Context): LViewPoint|undefined {\r\n        const viewpoint = context.data.viewpoint;\r\n        if(viewpoint) { return LViewPoint.fromPointer(viewpoint); }\r\n        else { return undefined; }\r\n    }\r\n\r\n    get_subViews(context: Context, key: string): LViewElement[]{\r\n        let subViewsPointers = context.data.subViews;\r\n        let subViews: LViewElement[] = [];\r\n        for(let pointer of subViewsPointers){\r\n            let item: LViewElement = MyProxyHandler.wrap(pointer);\r\n            if(item !== undefined) subViews.push(item);\r\n        }\r\n        return subViews;\r\n    }\r\n    set_generic_entry(context: Context, key: keyof DViewElement, val: any): boolean {\r\n        console.log('set_generic_entry', {context, key, val});\r\n        SetFieldAction.new(context.data, key, val);\r\n        return true;\r\n    }\r\n\r\n    get_children(context: Context): never[] { return []; }\r\n    get_bendingMode(context: Context): D[\"bendingMode\"] { return context.data.bendingMode; }\r\n    set_bendingMode(val: D[\"bendingMode\"], context: Context): boolean {\r\n        return this.set_generic_entry(context, 'bendingMode', val);\r\n    }\r\n\r\n    get_appliableToClasses(context: Context): this[\"appliableToClasses\"] { return context.data.appliableToClasses || []; }\r\n    set_appliableToClasses(val: this[\"appliableToClasses\"], context: Context): boolean {\r\n        if (!val) val = [];\r\n        else if (!Array.isArray(val)) val = [val];\r\n        return this.set_generic_entry(context, \"appliableToClasses\", val); }\r\n\r\n    set_defaultVSize(val: GraphSize, context: Context): boolean {\r\n        console.log('set_defaultVSize', {context, val});\r\n        return this.set_generic_entry(context, 'defaultVSize', val); }\r\n    /*\r\n        get___transient(context: LogicContext<this>): LViewTransientProperties {\r\n            return DPointerTargetable.wrap<DViewTransientProperties, LViewTransientProperties>(context.data.__transient, context.data,\r\n                // @ts-ignore for $ at end of getpath\r\n                'idlookup.' + context.data.id + '.' + (getPath as LViewElement).__transient.$); }*/\r\n}\r\nDPointerTargetable.subclasses.push(DViewElement);\r\nLPointerTargetable.subclasses.push(LViewElement);\r\n\r\nexport type WViewElement = getWParams<LViewElement, DPointerTargetable>;\r\n\r\n@RuntimeAccessible\r\nexport class DViewTransientProperties extends RuntimeAccessibleClass{\r\n    static logic: typeof LPointerTargetable;\r\n    _isDViewTransientProperties!: true;\r\n    // isSelected: Dictionary<DocString<Pointer<DUser>>, boolean> = {};\r\n    // private: DViewPrivateTransientProperties;\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LViewTransientProperties extends LPointerTargetable{\r\n    static structure: typeof DPointerTargetable;\r\n    static singleton: LViewTransientProperties;\r\n    _isLViewTransientProperties!: true;\r\n\r\n    // isSelected: Dictionary<DocString<Pointer<DUser>>, boolean> = {};\r\n    // private!: LViewPrivateTransientProperties;\r\n/*\r\n    get_private(context: LogicContext<DViewTransientProperties>): LViewPrivateTransientProperties {\r\n        return LViewTransientProperties.wrap(context.data.private, context.proxy.baseObjInLookup, context.proxy.additionalPath + '.private'); }*/\r\n/*\r\n    get_isSelected(logicContext: LogicContext<TargetableProxyHandler<DViewTransientProperties>, DViewTransientProperties>): Proxyfied<Dictionary> {\r\n        // @ts-ignore for $ at end of getpath\r\n        console.log('GET_ISSELECTED handler func');\r\n        return TargetableProxyHandler.getMap(logicContext.data.isSelected, logicContext, logicContext.proxy.additionalPath + '.' + (getPath as this).isSelected.$);\r\n    }*/\r\n}\r\n\r\nDPointerTargetable.subclasses.push(DViewTransientProperties);\r\nLPointerTargetable.subclasses.push(LViewTransientProperties);\r\n\r\nexport type WViewTransientProperties = getWParams<LViewTransientProperties, DViewTransientProperties>;\r\n\r\n/*\r\n\r\n@RuntimeAccessible\r\nexport class DViewPrivateTransientProperties extends DPointerTargetable{\r\n    static logic: typeof LViewPrivateTransientProperties;\r\n\r\n    public size: GraphSize\r\n    constructor(size?: GraphSize) {\r\n        super();\r\n        this.size = size || defaultVSize;\r\n    }\r\n}\r\n\r\n@RuntimeAccessible\r\nexport class LViewPrivateTransientProperties extends DViewPrivateTransientProperties{\r\n    static structure: typeof DViewPrivateTransientProperties;\r\n    static singleton: LViewPrivateTransientProperties;\r\n\r\n}*/\r\n// shapeless component, receive jsx from redux\r\n// can access any of the redux state, but will usually access 1-2 var among many,\r\n// how can i dynamically mapStateToProps to map only the required ones?\r\n\r\n","import React from \"react\";\r\nimport type {\r\n    PrimitiveType,\r\n    Pointer, DocString, Dictionary, LReference, ValueDetail\r\n} from \"../../../../joiner\";\r\nimport {\r\n    DAttribute, DClass, DEnumerator, DModelElement,\r\n    DObject, DReference, LAttribute, LClass,\r\n    LEnumerator, LEnumLiteral, LModelElement,\r\n    LObject,\r\n    LPointerTargetable,\r\n    LStructuralFeature,\r\n    LValue, Pointers,\r\n    Selectors, SetFieldAction,\r\n    U\r\n} from \"../../../../joiner\";\r\n\r\n\r\ninterface Props {value: LValue}\r\nfunction Value(props: Props) {\r\n    const lValue = props.value;\r\n    const dValue = lValue.__raw;\r\n    const feature: LStructuralFeature = LStructuralFeature.fromPointer(lValue.instanceof?.id);\r\n    let field = 'text'; let stepSize = 1; let maxLength = 524288;\r\n    let min = -9223372036854775808;\r\n    let max = 9223372036854775807; // for long, todo: aggiusta per tutti gli altri. in switch\r\n    switch(feature?.type.name) {\r\n        default: field=\"text\"; break;\r\n        case 'EChar': maxLength = 1; break;\r\n        case 'EInt':\r\n        case 'ELong':\r\n        case 'EShort':\r\n        case 'Byte': field = 'number'; break;\r\n        case 'EFloat': field = 'number'; stepSize = 0.1; break;\r\n        case 'EDouble': field = 'number'; stepSize = 0.01; break;\r\n        case 'EBoolean': field = 'checkbox'; break;\r\n        case 'EDate': field = 'date'; break;\r\n    }\r\n    let upperBound = feature ? (feature as LReference | LAttribute).__raw.upperBound : -1;\r\n    if (upperBound < 0) upperBound = 999;\r\n    let filteredvalues: ValueDetail[] = lValue.getValues(true, false, false, false, true, true) as any;\r\n\r\n    const add = (event: React.MouseEvent<HTMLButtonElement>) => {\r\n        // SetFieldAction.new(dValue, 'value', U.initializeValue(feature?.type), '+=', false);\r\n        SetFieldAction.new(dValue, 'values', undefined, '+=', false);\r\n    }\r\n    const remove = (index: number, isPointer: boolean | undefined) => {\r\n        if (isPointer === undefined) isPointer = !!(filteredvalues[index].value as any)?.__isProxy; // Pointers.isPointer\r\n        SetFieldAction.new(dValue, 'values', index, '-=', isPointer);\r\n        /*\r\n        let oldValues = filteredvalues.map( v => v.rawValue);\r\n        let newValues = [...oldValues];\r\n        newValues.splice(index, 1); // removes in place\r\n        console.log(\"removing:\", {oldValues, newValues, index});\r\n        SetFieldAction.new(dValue, 'value', newValues, '=', false);*/\r\n    }\r\n    function changeDValue(event: React.ChangeEvent<HTMLInputElement|HTMLSelectElement>, index: number, isPointer: boolean | undefined) {\r\n        let inputvalue: string | boolean = field === 'checkbox' ? (event.target as HTMLInputElement).checked : event.target.value;\r\n        if (inputvalue === \"undefined\") inputvalue = undefined as any;\r\n        let result = lValue.setValueAtPosition(index, inputvalue, {isPtr: isPointer});\r\n        console.log(\"setting DValue\", {inputvalue, result, lValue});\r\n    }\r\n\r\n\r\n    let isattr = false, isenum = false, isref = false, isshapeless = false;\r\n    switch(feature?.className){\r\n        default: isshapeless = true; break;\r\n        case DAttribute.name:\r\n            if (feature.type.className === DClass.name) isattr = true; else\r\n            if (feature.type.className === DEnumerator.name) isenum = true;\r\n            break;\r\n        case DReference.name: isref = true; break;\r\n    }\r\n\r\n    // let pointables: {objects:LObject[], literals: LEnumLiteral[]};\r\n    let select_options: JSX.Element | JSX.Element[] | null;\r\n\r\n\r\n    if (isref) {\r\n        let isContainment: boolean = lValue.containment;\r\n        // todo: move this utility in LClass.instances\r\n        let containerObjectsID: Pointer[] = lValue.fatherList.map( lm => lm.id);\r\n        let validObjects = Selectors.getObjects().filter((obj) => obj.instanceof?.id === feature.type?.id);\r\n        validObjects =  validObjects.filter( obj => !containerObjectsID.includes(obj.id)); // avoiding containment loops damiano todo: put this filter in set_value too\r\n        let freeObjects = [];\r\n        let boundObjects = [];\r\n        for (let o of validObjects) {\r\n            // todo: this check of self contain is too simple does not detect loops, would need to use fatherChain\r\n            if (isContainment && o.id === lValue.father.id) continue; // no self contain\r\n            if (o.isRoot) freeObjects.push(o); else boundObjects.push(o);\r\n        }\r\n        let map = (object: LObject) => <option key={object.id} value={object.id}>{object.name/*.feature('name')*/}</option>;\r\n        select_options = <><optgroup label={\"Free Objects\"}>{freeObjects.map(map)}</optgroup><optgroup label={\"Bound Objects\"}>{boundObjects.map(map)}</optgroup></>; }\r\n    else if (isenum) {\r\n        select_options = <optgroup label={\"Literals of \" + feature.type.name}>{(feature.type as LEnumerator).literals.map((literal, i) => <option key={literal.id} value={literal.id}>{literal.name}</option>)}</optgroup>;\r\n    }\r\n    else if (isshapeless) {\r\n        // damiano todo: rewrite entirely this section to separate bound and free objects, copying from if(isref)\r\n        // pointables = {objects: Selectors.getObjects(), literals: LPointerTargetable.fromArr(Selectors.getAllEnumLiterals())};\r\n        let isContainment: boolean = lValue.containment;\r\n        let enums: LEnumerator[] = LPointerTargetable.fromArr(Selectors.getAllEnumerators())\r\n        let classes: LClass[] = LPointerTargetable.fromArr(Selectors.getAllClasses())\r\n        let shapelessObjects: LObject[] = Selectors.getObjects().filter((o) => !o.instanceof);\r\n        // console.log(\"select_options\", {enums, classes, shapelessObjects});\r\n        let classmap: Dictionary<DocString<\"classname\">, {free:LObject[], bound:LObject[], all: LObject[]}> = {};\r\n        let shapeless: {free:LObject[], bound:LObject[], all: LObject[]} = {free:[], bound:[], all: shapelessObjects};\r\n        for (let c of classes) {\r\n            let row: {free:LObject[], bound:LObject[], all: LObject[]} = {free: [], bound:[], all: c.instances};\r\n            classmap[c.name] = row;\r\n            for (let o of row.all) {\r\n                // todo: this check of self contain is too simple does not detect loops, would need to use fatherChain\r\n                if (isContainment && o.id === lValue.father.id) continue; // no self contain\r\n                if (o.isRoot) row.free.push(o); else row.bound.push(o);\r\n            }\r\n        }\r\n        for (let o of shapelessObjects) { if (o.isRoot) shapeless.free.push(o); else shapeless.bound.push(o); }\r\n\r\n        select_options = <>\r\n            <option value={''} key={0}>--- Not a Reference ---</option>\r\n            { Object.keys(classmap).map((cname) => !classmap[cname].all.length ? null :\r\n                <>\r\n                    {!classmap[cname].free.length ? null :\r\n                        <optgroup label={\"Free    instances of \" + cname} key={\"f-\" + cname}>\r\n                            {classmap[cname].free.map((o) => <option value={o.id} key={o.id}>{o.name}</option>)}\r\n                        </optgroup>\r\n                    }\r\n                    {!classmap[cname].bound.length ? null :\r\n                        <optgroup label={\"Bound instances of \" + cname} key={\"b-\" + cname}>\r\n                            {classmap[cname].bound.map((o) => <option value={o.id} key={o.id}>{o.name}</option>)}\r\n                        </optgroup>\r\n                    }\r\n                </>) }\r\n            { !shapeless.free.length ? null : <optgroup label={\"Free    shapeless objects\"}>{shapeless.free.map( (o) => <option value={o.id} key={o.id}>{o.name}</option>)}</optgroup> }\r\n            { !shapeless.bound.length ? null : <optgroup label={\"Bound shapeless objects\"}>{shapeless.bound.map( (o) => <option value={o.id} key={o.id}>{o.name}</option>)}</optgroup> }\r\n            { enums.map((c) => !c.literals.length ? null : <optgroup label={\"Literals of \" + c.name}>{ c.literals.map((o)=> <option value={o.id} key={o.id}>{o.name}</option>)}</optgroup>) }\r\n        </>\r\n        // console.log(\"select_options post\", {select_options, enums, classes, shapelessObjects});\r\n    }\r\n    else select_options = null;\r\n\r\n    // let rawvalues: any[] = lValue.__raw.value || [];\r\n    console.log(\"filtered values\", {filteredvalues});\r\n    let isPtr = isattr ? false : (isenum || isref ? true : undefined/*for shapeless*/);\r\n    const valueslist = (filteredvalues).map( (val, index) =>\r\n            val.hidden ? null :\r\n            <div className={'mt-1 d-flex ms-4'} key={index}>\r\n                <div className={'border border-dark'}></div>\r\n                { isattr && <input onChange={(evt) => { changeDValue(evt, index, false) }} className={'input ms-1'} value={val.value + ''}\r\n                                   checked={!!val.value} min={min} max={max} type={field} step={stepSize} maxLength={maxLength} placeholder={\"empty\"}/> }\r\n                { isenum && <select onChange={(evt) => {changeDValue(evt, index, true)}} className={'ms-1 select'} value={val.rawValue+''} data-valuedebug={val.rawValue}>\r\n                    {<option key=\"undefined\" value={'undefined'}>-----</option>}\r\n                    { select_options }\r\n                </select>}\r\n                { isref && <select onChange={(evt) => {changeDValue(evt, index, true)}} className={'ms-1 select'} value={val.rawValue+''} data-valuedebug={val.rawValue}>\r\n                    <option value={'undefined'}>-----</option>\r\n                    {select_options}\r\n                </select>}\r\n                { isshapeless && <>\r\n                    { <select key={index} onChange={(evt) => {changeDValue(evt, index, undefined)}} className={'select ms-1'} value={val.rawValue+''}>{select_options}</select> }\r\n                    →\r\n                    { <input key={\"raw\"+index} onChange={(evt) => {changeDValue(evt, index, false)}} className={'input ms-1'} value={val.rawValue+''} list={\"objectdatalist\"} type={\"text\"} placeholder={\"empty\"}/> }\r\n                    { /*(val as LObject)?.id && <span>points to {val}</span> */}\r\n                </>\r\n                }\r\n                <button className={'btn btn-danger ms-2'} onClick={(evt) => {remove(index, isPtr)}}>\r\n                    <i className={'p-1 bi bi-trash3-fill'}></i>\r\n                </button>\r\n        </div>);\r\n\r\n    return(<div>\r\n        <div className={'d-flex'}>\r\n            <label className={'ms-1 my-auto'}>Values</label>\r\n            <button className={'btn btn-primary ms-auto me-1'} disabled={filteredvalues.length >= upperBound} onClick={add}>\r\n                <i className={'p-1 bi bi-plus'}></i>\r\n            </button>\r\n        </div>\r\n        { valueslist }\r\n    </div>)\r\n}\r\n\r\nexport default Value;\r\n","import React, {ReactNode} from \"react\";\r\nimport type {GObject, LModelElement} from \"../../../joiner\";\r\nimport {\r\n    DObject,\r\n    DValue,\r\n    Input,\r\n    LModel,\r\n    LObject,\r\n    LOperation,\r\n    LPointerTargetable,\r\n    LValue,\r\n    Select, Selectors,\r\n    SetFieldAction,\r\n    store\r\n} from \"../../../joiner\";\r\nimport Value from \"./editors/Value\";\r\n\r\nexport default class Structure {\r\n    private static BaseEditor(lModelElement: LModelElement) : ReactNode {\r\n        if(!lModelElement) return(<></>);\r\n        return(<>\r\n            {/*<Input obj={lModelElement} field={\"id\"} label={\"ID\"} type={\"text\"} readonly={true} />*/}\r\n            <Input obj={lModelElement} field={\"name\"} label={\"Name\"} type={\"text\"} tooltip={\"Element name\"} />\r\n        </>);\r\n    }\r\n    public static ModelEditor(lModel: LModelElement): ReactNode {\r\n        if(!lModel) return(<></>);\r\n        return(<>{Structure.BaseEditor(lModel)}</>);\r\n    }\r\n    public static PackageEditor(lPackage: LModelElement): ReactNode {\r\n        if(!lPackage) return(<></>);\r\n        return(<>\r\n            {Structure.BaseEditor(lPackage)}\r\n            <Input obj={lPackage} field={\"uri\"} label={\"NsURI\"} type={\"text\"} tooltip={\"Namespace URI of the package, i.e. the URI that is displayed in the xmlns tag to identify this package in an XMI document\"} />\r\n            <Input obj={lPackage} field={\"prefix\"} label={\"NsPrefix\"} type={\"text\"} tooltip={\"Namespace prefix that is used when references to instances of the classes in this package are serialized\"} />\r\n        </>);\r\n    }\r\n    public static ClassEditor(lClass: LModelElement): ReactNode {\r\n        if(!lClass) return(<></>);\r\n        return(<>\r\n            {Structure.BaseEditor(lClass)}\r\n            <Input obj={lClass} field={\"abstract\"} label={\"IsAbstract\"} type={\"checkbox\"} tooltip={\"If set to True, the generated implementation class will have the abstract keyword\"} />\r\n            <Input obj={lClass} field={\"interface\"} label={\"IsInterface\"} type={\"checkbox\"} tooltip={\"If set to True, only the java interface will be generated. There will be no corresponding implementation class and no create method in the factory\"} />\r\n            <Input obj={lClass} field={\"partial\"} label={\"IsPartial\"} type={\"checkbox\"} tooltip={\"If set to True, the class will be partial.\"} />\r\n        </>);\r\n    }\r\n    private static DataTypeEditor(lDataType: LModelElement): ReactNode {\r\n        if(!lDataType) return(<></>);\r\n        return(<Input obj={lDataType} field={\"serializable\"} label={\"IsSerializable\"} type={\"checkbox\"} tooltip={\"It represents whether values of this type will be serialized\"} />);\r\n    }\r\n    public static EnumEditor(lEnum: LModelElement): ReactNode {\r\n        if(!lEnum) return(<></>);\r\n        return(<>\r\n            {Structure.BaseEditor(lEnum)}\r\n            {Structure.DataTypeEditor(lEnum)}\r\n        </>);\r\n    }\r\n    private static TypedElementEditor(lTypedElement: LModelElement): ReactNode {\r\n        if(!lTypedElement) return(<></>);\r\n        return(<>\r\n            <Select obj={lTypedElement} field={\"type\"} label={\"Type\"} tooltip={\"Element Type\"} />\r\n            <Input obj={lTypedElement} field={\"lowerBound\"} label={\"Lower Bound\"} type={\"number\"} tooltip={\"Determines the setting of the required property. If lowerBound is 0, the required property will be set to False. Otherwise, the required property will be set to True\"} />\r\n            <Input obj={lTypedElement} field={\"upperBound\"} label={\"Upper Bound\"} type={\"number\"} tooltip={\"Determines the setting of the many property. If upperBound is 1, the many property will be set to False. Otherwise, the many property will be set to True\"} />\r\n            <Input obj={lTypedElement} field={\"ordered\"} label={\"IsOrdered\"} type={\"checkbox\"} tooltip={\"It represents whether order is meaningful\"} />\r\n            <Input obj={lTypedElement} field={\"unique\"} label={\"IsUnique\"} type={\"checkbox\"} tooltip={\"Indicates whether a many-valued attribute is allowed to have duplicates\"} />\r\n        </>);\r\n    }\r\n    private static StructuralFeatureEditor(lStructuralFeature: LModelElement): ReactNode {\r\n        if(!lStructuralFeature) return(<></>);\r\n        return(<>\r\n            <Input obj={lStructuralFeature} field={\"defaultValueLiteral\"} label={\"Default Value Literal\"} type={\"text\"} tooltip={\"Determines the value returned by the get method if the feature has never been set\"} />\r\n            <Input obj={lStructuralFeature} field={\"changeable\"} label={\"IsChangeable\"} type={\"checkbox\"} tooltip={\"Indicates whether the reference may be modified. If changeable is set to False, no set() method is generated for the reference\"} />\r\n            <Input obj={lStructuralFeature} field={\"volatile\"} label={\"IsVolatile\"} type={\"checkbox\"} tooltip={\"Indicates whether the reference cannot be cached. If volatile is set to True, the generated class does not contain a field to hold the reference and the generated get() and set() methods for the reference are empty\"} />\r\n            <Input obj={lStructuralFeature} field={\"transient\"} label={\"IsTransient\"} type={\"checkbox\"} tooltip={\"Indicates whether the reference should not be stored\"} />\r\n            <Input obj={lStructuralFeature} field={\"unsettable\"} label={\"IsUnsettable\"} type={\"checkbox\"} tooltip={\"Indicates that the feature may be unset\"} />\r\n            <Input obj={lStructuralFeature} field={\"derived\"} label={\"IsDerived\"} type={\"checkbox\"} tooltip={\"A derived feature typically computes its value from those of other features. It will typically be transient and will often be volatile and not changeable. The default copier won't copy it\"} />\r\n        </>); // damiano: derived description tooltip might be wrong\r\n    }\r\n    public static AttributeEditor(lAttribute: LModelElement): ReactNode {\r\n        if(!lAttribute) return(<></>);\r\n        return(<>\r\n            {Structure.BaseEditor(lAttribute)}\r\n            {Structure.TypedElementEditor(lAttribute)}\r\n            {Structure.StructuralFeatureEditor(lAttribute)}\r\n            <Input obj={lAttribute} field={\"isID\"} label={\"IsID\"} type={\"checkbox\"} tooltip={\"An ID attribute explicitly models the one unique ID of an object\"} />\r\n        </>);\r\n    }\r\n    public static ReferenceEditor(lReference: LModelElement): ReactNode {\r\n        if(!lReference) return(<></>);\r\n        return(<>\r\n            {Structure.BaseEditor(lReference)}\r\n            {Structure.TypedElementEditor(lReference)}\r\n            {Structure.StructuralFeatureEditor(lReference)}\r\n            <Input obj={lReference} field={\"containment\"} label={\"IsContainment\"} type={\"checkbox\"} tooltip={\"Indicates whether the reference is a containment\"} />\r\n            <Input obj={lReference} field={\"container\"} label={\"IsContainer\"} type={\"checkbox\"} tooltip={\"Indicates whether the reference is a container. This is the opposite of a containment EReference. If container is true, the generated accessor methods will have container semantics\"} />\r\n            <Input obj={lReference} field={\"resolveProxies\"} label={\"IsResolveProxies\"} type={\"checkbox\"} tooltip={\"Indicates whether proxy references should be resolved automatically\"} />\r\n        </>);\r\n    }\r\n    public static EnumLiteralEditor(lEnumLiteral: LModelElement): ReactNode {\r\n        if(!lEnumLiteral) return(<></>);\r\n        //vv4\r\n        return(<>\r\n            {Structure.BaseEditor(lEnumLiteral)}\r\n            <Input obj={lEnumLiteral} field={\"value\"} label={\"Ordinal\"} type={\"number\"} tooltip={\"Determines the integer value that is associated with this literal\"} />\r\n        </>);\r\n    }\r\n\r\n    public static OperationEditor(me: LModelElement): ReactNode {\r\n        const operation: LOperation = LOperation.fromPointer(me.id);\r\n        if(!operation) return(<></>);\r\n        return(<>\r\n            {Structure.BaseEditor(operation)}\r\n            <Select obj={operation.id} field={'type'} label={'Return'} tooltip={\"Method return type\"} />\r\n            {operation.parameters.map((parameter, index) => {\r\n                if (index > 0) {\r\n                    return <div key={index}>\r\n                        <label className={'ms-1'}>Parameter</label>\r\n                        <div className={'ms-3'}>\r\n                            <Input obj={parameter.id} field={\"name\"} label={'• Name'} type={\"text\"} tooltip={\"Name of the generated argument\"} />\r\n                            <Select obj={parameter.id} field={\"type\"} label={'• Type'} tooltip={\"Argument type\"} />\r\n                        </div>\r\n                    </div>\r\n                }\r\n            })}\r\n            {operation.exceptions.map((exception, index) => {\r\n                return <div key={index}>\r\n                    <Input obj={exception.id} field={\"name\"} label={\"Exception\"} type={\"text\"} tooltip={\"Exception name\"} />\r\n                </div>\r\n            })}\r\n        </>);\r\n    }\r\n    public static ObjectEditor(me: LModelElement): ReactNode {\r\n        const object: LObject = LObject.fromPointer(me.id);\r\n        if(!object) return(<></>);\r\n        let conform = true;\r\n        // damiano todo: this is redundant because it's always conform, but those kind of checks are\r\n        //                 better be done adding a property like lobject.conformsto(lclass)\r\n        for(let feature of object.features) {\r\n            let upperBound =  feature.instanceof ? feature.instanceof.upperBound : -1;\r\n            upperBound = (upperBound === -1) ? 999 : upperBound;\r\n            const lowerBound =  feature.instanceof ? feature.instanceof.lowerBound : -1;\r\n            const value = feature.values;\r\n            // const length = (Array.isArray(value)) ? value.length : (value === '') ? 0 : 1;\r\n            conform = (value.length >= lowerBound && value.length <= upperBound);\r\n        }\r\n\r\n        return(<div>\r\n            {object.instanceof && conform && <label className={'p-1'}>This instance is <b className={'text-success'}>CONFORM</b> to {object.instanceof.name}</label>}\r\n            {object.instanceof && !conform && <label className={'p-1'}>This instance is <b className={'text-danger'}>NOT CONFORM</b> to {object.instanceof.name}</label>}\r\n            {!object.instanceof && <label className={'p-1'}>This instance is <b className={'text-warning'}>SHAPELESS</b></label>}\r\n            {!object.partial ?\r\n                null :\r\n                <div className={\"d-flex p-1\"}>\r\n                    <label className={'my-auto'}>Features</label>\r\n                    <button className={'btn btn-primary ms-auto'} onClick={()=>{object.addValue()}}>\r\n                        <i className={'p-1 bi bi-plus'}></i>\r\n                    </button>\r\n                </div>\r\n            }\r\n            {this.forceConform(object)}\r\n        </div>);\r\n    }\r\n    public static forceConform(me: LObject) {\r\n        let mm: LModel = Selectors.getLastSelectedModel().m2 as LModel; // LPointerTargetable.fromPointer(store.getState().metamodel as any);\r\n\r\n        return <div className={'d-flex p-1'}>\r\n            <label className={'my-auto'}>Force Type</label>\r\n            <select className={'my-auto ms-auto select'} onChange={ (event)=>{\r\n                (window as any).debugmm = mm;\r\n                (window as any).debugm = me;\r\n                me.instanceof = event.target.value === \"undefined\" ? undefined : event.target.value as any;\r\n            } } value={me.instanceof?.id || \"undefined\"}>\r\n                <optgroup label={mm.name}>\r\n                    {\r\n                        (mm.classes || []).map( c =>\r\n                            <option value={c.id}>{c.name}</option>\r\n                        )\r\n                    }\r\n                    <option value={\"undefined\"}>Object</option>\r\n                </optgroup>\r\n            </select>\r\n        </div>\r\n    }\r\n    public static ValueEditor(me: LModelElement): ReactNode {\r\n        const lValue: LValue = LValue.fromPointer(me.id);\r\n        if(!lValue) return(<></>);\r\n        return(<div>\r\n            <Value value={lValue} />\r\n        </div>);\r\n    }\r\n    public static Editor(lModelElement: LModelElement|undefined) : ReactNode {\r\n        if(lModelElement){\r\n            switch (lModelElement.className){\r\n                default: break;\r\n                case \"DModel\": return Structure.ModelEditor(lModelElement);\r\n                case \"DPackage\": return Structure.PackageEditor(lModelElement);\r\n                case \"DClass\": return Structure.ClassEditor(lModelElement);\r\n                case \"DAttribute\": return Structure.AttributeEditor(lModelElement);\r\n                case \"DReference\": return Structure.ReferenceEditor(lModelElement);\r\n                case \"DEnumerator\": return Structure.EnumEditor(lModelElement);\r\n                case \"DEnumLiteral\": return Structure.EnumLiteralEditor(lModelElement);\r\n                case \"DOperation\": return Structure.OperationEditor(lModelElement);\r\n                case \"DObject\" : return Structure.ObjectEditor(lModelElement);\r\n                case \"DValue\" : return Structure.ValueEditor(lModelElement);\r\n            }\r\n        }\r\n        return <div></div>;\r\n    }\r\n}\r\n\r\n","import React, {Dispatch, PureComponent, ReactElement, ReactNode} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {\r\n    DGraphElement,\r\n    DModelElement,\r\n    DPointerTargetable,\r\n    DViewElement,\r\n    IStore,\r\n    LGraphElement,\r\n    LModelElement,\r\n    LViewElement,\r\n    Pointer, U,\r\n} from \"../../../joiner\";\r\nimport Structure from \"./Structure\";\r\n\r\n\r\ninterface ThisState {}\r\n\r\nclass StructureEditorComponent extends PureComponent<AllProps, ThisState> {\r\n\r\n    constructor(props: AllProps, context: any) {\r\n        super(props, context);\r\n    }\r\n\r\n    render(): ReactNode{\r\n        const lModelElement: LModelElement | undefined = this.props.selected?.modelElement;\r\n        return <div className={\"px-4\"}>\r\n            <div className={\"mt-3\"}>\r\n                {Structure.Editor(lModelElement)}\r\n            </div>\r\n            {/*\r\n            <hr className={'mt-5'} />\r\n            <div>Exportable Json</div>\r\n            <span style={{whiteSpace: \"pre\"}}>{JSON.stringify(lModelElement?.generateEcoreJson(), null, \"\\t\")}</span>\r\n            <hr className={'mt-5'} />\r\n            <div>Internal state</div>\r\n            <span style={{whiteSpace: \"pre\"}}>{JSON.stringify(lModelElement, null, '\\t')}</span>\r\n            */}\r\n        </div>;\r\n    }\r\n}\r\n\r\ninterface OwnProps {}\r\ninterface StateProps {\r\n    selectedid?: { node: Pointer<DGraphElement, 1, 1>; view: Pointer<DViewElement, 1, 1>; modelElement: Pointer<DModelElement, 0, 1> };\r\n    selected?: { node: LGraphElement; view: LViewElement; modelElement?: LModelElement };\r\n}\r\ninterface DispatchProps {}\r\n\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    ret.selectedid = state._lastSelected;\r\n    ret.selected = ret.selectedid && {\r\n        node: DPointerTargetable.wrap(state.idlookup[ret.selectedid.node]) as LGraphElement,\r\n        view: DPointerTargetable.wrap(state.idlookup[ret.selectedid.view]) as LViewElement,\r\n        modelElement: ret.selectedid.modelElement ? DPointerTargetable.wrap<DPointerTargetable, LModelElement>(state.idlookup[ret.selectedid.modelElement]) : undefined };\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {} as any;\r\n    return ret;\r\n}\r\n\r\n\r\nexport const StructureEditorConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(StructureEditorComponent);\r\n\r\nexport const StructureEditor = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <StructureEditorConnected {...{...props, children}} />;\r\n}\r\nexport default StructureEditor;\r\n","import React, {Dispatch, ReactElement, ReactNode} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {IStore} from \"../../../redux/store\";\r\nimport {\r\n    DPointerTargetable,\r\n    DViewElement,\r\n    GObject, Input,\r\n    LModelElement,\r\n    LPointerTargetable,\r\n    LViewElement,\r\n    Pointer, Select, SetRootFieldAction\r\n} from \"../../../joiner\";\r\nimport Editor from \"@monaco-editor/react\";\r\nimport {useStateIfMounted} from \"use-state-if-mounted\";\r\nimport Structure from \"../structureEditor/Structure\";\r\n\r\ninterface Props {data: LModelElement}\r\nfunction Child(props: Props) {\r\n    const data = props.data;\r\n    const classname = data.className.slice(1).toLowerCase();\r\n    const css = classname + '-name';\r\n\r\n    const click = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const selected = { node: undefined, view: undefined, modelElement: data.id };\r\n        SetRootFieldAction.new('_lastSelected', selected);\r\n    }\r\n    // I got problems with operation's exception\r\n    return <div className={'mt-1 ms-3'}>\r\n        <div className={'d-flex'}>\r\n            <button className={'btn'} onClick={click}>\r\n                <i className={'bi bi-eye'}></i>\r\n            </button>\r\n            <label className={css + ' ms-1 text-capitalize my-auto'}>{classname}:</label>\r\n            <label className={'ms-1 my-auto'}>{((data as GObject).name) ? (data as GObject).name : 'unnamed'}</label>\r\n        </div>\r\n        {data.className !== 'DOperation' && data.children.map((child, i) => {\r\n            return <Child key={i} data={child} />\r\n        })}\r\n    </div>\r\n}\r\n\r\nfunction TreeEditorComponent(props: AllProps) {\r\n    const data = props.data;\r\n    if(data) {\r\n        const classname = data.className.slice(1).toLowerCase();\r\n        const css = classname + '-name';\r\n        // I got problems with operation's exception\r\n        return <div className={'p-2'}>\r\n            <div className={'d-flex'}>\r\n                <button className={'btn'}>\r\n                    <i className={'bi bi-eye-slash'}></i>\r\n                </button>\r\n                <label className={css + ' ms-1 text-capitalize my-auto'}>{classname}:</label>\r\n                <label className={'ms-1 my-auto'}>{((data as GObject).name) ? (data as GObject).name : 'unnamed'}</label>\r\n            </div>\r\n            {data.className !== 'DOperation' && data.children.map((child, i) => {\r\n                return <Child key={i} data={child} />\r\n            })}\r\n        </div>\r\n    } else return <></>\r\n}\r\ninterface OwnProps { }\r\ninterface StateProps { data: LModelElement|undefined }\r\ninterface DispatchProps { }\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    const pointer = state._lastSelected?.modelElement;\r\n    if(pointer) ret.data = LModelElement.fromPointer(pointer);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const TreeEditorConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(TreeEditorComponent);\r\n\r\nexport const TreeEditor = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <TreeEditorConnected {...{...props, children}} />;\r\n}\r\nexport default TreeEditor;\r\n","import React from \"react\";\r\nimport type {LViewElement} from \"../../../view/viewElement/view\";\r\nimport {CreateElementAction, DeleteElementAction, SetRootFieldAction} from \"../../../redux/action/action\";\r\nimport {DViewElement} from \"../../../view/viewElement/view\";\r\n\r\ninterface Props { views: LViewElement[] }\r\nfunction ViewsData(props: Props) {\r\n    const views = props.views;\r\n\r\n    const add = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const jsx =`<div className={'root bg-white'}>Hello World!</div>`;\r\n        const dView: DViewElement = DViewElement.new('View', jsx);\r\n        CreateElementAction.new(dView);\r\n        SetRootFieldAction.new('stackViews', dView.id, '+=', true);\r\n    }\r\n    const remove = (evt: React.MouseEvent<HTMLButtonElement>, index:number, value: LViewElement) => {\r\n        DeleteElementAction.new(value.id);\r\n    }\r\n    const select = (evt: React.MouseEvent<HTMLButtonElement>, option: LViewElement) => {\r\n        SetRootFieldAction.new('stackViews', option.id, '+=', true);\r\n    }\r\n\r\n    return(<div>\r\n        <div className={'d-flex p-2'}>\r\n            <b className={'ms-1 my-auto'}>VIEWS</b>\r\n            <button className={'btn btn-primary ms-auto'} onClick={add}>\r\n                <i className={'p-1 bi bi-plus'}></i>\r\n            </button>\r\n        </div>\r\n        {views.map((view, i) => {\r\n            return <div key={i} className={'d-flex p-1 mt-1 border round'}>\r\n                <label className={'my-auto'}>{view?.name}</label>\r\n                <button className={'btn btn-success ms-auto'} onClick={(evt) => {select(evt, view)}}>\r\n                    <i className={'p-1 bi bi-info-lg'}></i>\r\n                </button>\r\n                <button className={'btn btn-danger ms-1'} disabled={true} onClick={(evt) => {remove(evt, i, view)}}>\r\n                    <i className={'p-1 bi bi-trash3-fill'}></i>\r\n                </button>\r\n            </div>\r\n        })}\r\n    </div>);\r\n}\r\n\r\nexport default ViewsData;\r\n","import React, {Dispatch, ReactElement} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {IStore} from \"../../../redux/store\";\r\nimport {DPointerTargetable, DViewElement, GObject, LPointerTargetable, LViewElement, Pointer} from \"../../../joiner\";\r\nimport Editor from \"@monaco-editor/react\";\r\n\r\n\r\nfunction OclEditorComponent(props: AllProps) {\r\n    const view = props.view;\r\n\r\n    const change = (value: string|undefined) => {\r\n        if (value !== undefined) view.query = value;\r\n    }\r\n\r\n    return <div style={{height: '5em'}}>\r\n        <label className={'ms-1'}>OCL Editor</label>\r\n        <Editor className={'mx-1'} onChange={change}\r\n                defaultLanguage={'js'} value={view.query} />\r\n    </div>;\r\n}\r\ninterface OwnProps { viewid: Pointer<DViewElement, 1, 1, LViewElement>; }\r\ninterface StateProps { view: LViewElement }\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    ret.view = LViewElement.fromPointer(ownProps.viewid);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const OclEditorConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(OclEditorComponent);\r\n\r\nexport const OclEditor = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <OclEditorConnected {...{...props, children}} />;\r\n}\r\nexport default OclEditor;\r\n","import React, {Dispatch, ReactElement} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {IStore} from \"../../../redux/store\";\r\nimport {DViewElement, LViewElement, Pointer} from \"../../../joiner\";\r\nimport Editor from \"@monaco-editor/react\";\r\nimport {useStateIfMounted} from \"use-state-if-mounted\";\r\n\r\n\r\nfunction JsxEditorComponent(props: AllProps) {\r\n    const view = props.view;\r\n    const [jsx, setJsx] = useStateIfMounted(view.jsxString);\r\n\r\n    const change = (value: string|undefined) => {\r\n        if(value !== undefined) setJsx(value);\r\n        //if(value !== undefined) view.jsxString = value;\r\n    }\r\n\r\n\r\n    const blur = (evt: React.FocusEvent<HTMLDivElement>) => {\r\n        view.jsxString = jsx;\r\n    }\r\n\r\n    return <div style={{marginTop: '2.5em', height: '10em'}} tabIndex={-1} onBlur={blur}>\r\n        <label className={'ms-1'}>JSX Editor</label>\r\n        <Editor className={'mx-1'} onChange={change}\r\n                defaultLanguage={'html'} defaultValue={view.jsxString} />\r\n    </div>;\r\n}\r\ninterface OwnProps { viewid: Pointer<DViewElement, 1, 1, LViewElement>; }\r\ninterface StateProps { view: LViewElement }\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    ret.view = LViewElement.fromPointer(ownProps.viewid);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const JsxEditorConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(JsxEditorComponent);\r\n\r\nexport const JsxEditor = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <JsxEditorConnected {...{...props, children}} />;\r\n}\r\nexport default JsxEditor;\r\n","import React from \"react\";\r\nimport type {LViewElement} from \"../../../view/viewElement/view\";\r\nimport {SetFieldAction, SetRootFieldAction} from \"../../../redux/action/action\";\r\nimport OclEditor from \"../oclEditor/OclEditor\";\r\nimport JsxEditor from \"../jsxEditor/JsxEditor\";\r\nimport Input from \"../../forEndUser/Input\";\r\nimport type {LViewPoint} from \"../../../view/viewPoint/viewpoint\";\r\nimport {Select, TextArea} from \"../../../joiner\";\r\n\r\ninterface Props { view: LViewElement; viewpoints: LViewPoint[]; }\r\n\r\nconst objectTypes = [\"\", \"DModel\", \"DPackage\", \"DEnumerator\", \"DEnumLiteral\", \"DClass\", \"DAttribute\", \"DReference\", \"DOperation\", \"DParameter\", \"DObject\", \"DValue\", \"DStructuralFeature\"];\r\nlet classesOptions =\r\n    <optgroup label={\"Object type\"}>{objectTypes.map(\r\n        (o)=><option key={o} value={o}>{o.length ? o.substring(1) : \"anything\"}</option>)}\r\n    </optgroup>;\r\n\r\nfunction ViewData(props: Props) {\r\n    const view = props.view;\r\n    const viewpoints = props.viewpoints;\r\n\r\n    const back = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        SetRootFieldAction.new('stackViews', undefined, '-=', true);\r\n    }\r\n    const changeVP = (evt: React.ChangeEvent<HTMLSelectElement>) => {\r\n        const value = evt.target.value;\r\n        if(value !== 'null') SetFieldAction.new(view.id, 'viewpoint', value, '', true);\r\n        else SetFieldAction.new(view.id, 'viewpoint', '', '', false);\r\n    }\r\n\r\n    const changeFN = (evt: React.ChangeEvent<HTMLSelectElement>) => {\r\n        const value = evt.target.value;\r\n        SetFieldAction.new(view.id, 'forceNodeType', value, '', false);\r\n    }\r\n\r\n    return(<div>\r\n        <div className={'d-flex p-2'}>\r\n            <b className={'ms-1 my-auto'}>VIEW</b>\r\n            <button className={'btn btn-danger ms-auto'} onClick={back}>\r\n                <i className={'p-1 bi bi-arrow-left'}></i>\r\n            </button>\r\n        </div>\r\n        <Input obj={view} field={\"name\"} label={\"Name\"} type={\"text\"}/>\r\n        <Input obj={view} field={\"explicitApplicationPriority\"} label={\"Priority\"} type={\"number\"}/>\r\n        <Input obj={view} field={\"width\"} label={\"Width\"} type={\"number\"}/>\r\n        <Input obj={view} field={\"height\"} label={\"Height\"} type={\"number\"}/>\r\n\r\n        <TextArea obj={view} field={\"constants\"} label={\"Constants\"} />\r\n        <TextArea obj={view} field={\"preRenderFunc\"} label={\"PreRender Function\"} />\r\n        <Input obj={view} field={\"scalezoomx\"} label={\"Zoom X\"} type={\"number\"}/>\r\n        <Input obj={view} field={\"scalezoomy\"} label={\"Zoom Y\"} type={\"number\"}/>\r\n        <div className={'d-flex p-1'}>\r\n            <label className={'my-auto'}>Force Node</label>\r\n            <select className={'my-auto ms-auto select'} value={view.forceNodeType} onChange={changeFN}>\r\n                <option value={undefined}>-----</option>\r\n                {['Graph', 'GraphVertex', 'Vertex', 'Field'].map((node, index) => {\r\n                    return(<option key={index} value={node}>{node}</option>);\r\n                })}\r\n            </select>\r\n        </div>\r\n\r\n        <Input obj={view} field={\"adaptWidth\"} label={\"Adapt Width\"} type={\"checkbox\"}/>\r\n        <Input obj={view} field={\"adaptHeight\"} label={\"Adapt Height\"} type={\"checkbox\"}/>\r\n        <Input obj={view} field={\"draggable\"} label={\"Draggable\"} type={\"checkbox\"}/>\r\n        <Input obj={view} field={\"resizable\"} label={\"Resizable\"} type={\"checkbox\"}/>\r\n        <div className={'d-flex p-1'}>\r\n            <label className={'my-auto'}>Viewpoint</label>\r\n            <select className={'my-auto ms-auto select'} value={String(view.viewpoint?.id)} onChange={changeVP}>\r\n                <option value={'null'}>-----</option>\r\n                {viewpoints.map((viewpoint, index) => {\r\n                    return(<option key={index} value={viewpoint.id}>{viewpoint.name}</option>);\r\n                })}\r\n            </select>\r\n        </div>\r\n        <TextArea obj={view} field={'onDragStart'} label={'OnDragStart'} />\r\n        <TextArea obj={view} field={'onDragEnd'} label={'OnDragEnd'} />\r\n        <TextArea obj={view} field={'onResizeStart'} label={'OnResizeStart'} />\r\n        <TextArea obj={view} field={'onResizeEnd'} label={'OnResizeEnd'} />\r\n\r\n        {/* damiano: qui Select avrebbe fatto comodo, ma è troppo poco generica, remove \"data-\" se viene generizzata Select */}\r\n        <div className=\"p-1\" style={{display: \"flex\"}}><label className=\"my-auto\">Appliable to</label>\r\n            <select data-obj={view.id} data-field={'appliableToClasses'} data-label={'Appliable to'} data-options={ classesOptions }\r\n                value={view.appliableToClasses[0] || ''} onChange={(e) => { view.appliableToClasses = e.target.value as any; }}\r\n                className={\"my-auto ms-auto select\"}>\r\n            {classesOptions}\r\n            </select>\r\n        </div>\r\n        <OclEditor viewid={view.id} />\r\n        <JsxEditor viewid={view.id} />\r\n    </div>);\r\n}\r\n\r\nexport default ViewData;\r\n","import React, {Dispatch, ReactElement} from \"react\";\r\nimport {IStore} from \"../../../redux/store\";\r\nimport {connect} from \"react-redux\";\r\nimport {LViewElement} from \"../../../view/viewElement/view\";\r\nimport ViewsData from \"./Views\";\r\nimport ViewData from \"./View\";\r\nimport {LViewPoint} from \"../../../view/viewPoint/viewpoint\";\r\n\r\n\r\nfunction ViewsEditorComponent(props: AllProps) {\r\n\r\n    const views = props.views;\r\n    const stackViews = props.stackViews;\r\n    const viewpoints = props.viewpoints;\r\n\r\n    return(<div>\r\n        {(stackViews.length > 0) ?\r\n            <ViewData view={stackViews[stackViews.length - 1]} viewpoints={viewpoints} /> :\r\n            <ViewsData views={views} />}\r\n    </div>);\r\n}\r\ninterface OwnProps { }\r\ninterface StateProps { views: LViewElement[]; stackViews: LViewElement[]; viewpoints: LViewPoint[] }\r\ninterface DispatchProps { }\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    ret.views = LViewElement.fromPointer(state.viewelements.slice(10));\r\n    ret.stackViews = LViewElement.fromPointer(state.stackViews);\r\n    ret.viewpoints = LViewPoint.fromPointer(state.viewpoints);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const ViewsEditorConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ViewsEditorComponent);\r\n\r\nexport const ViewsEditor = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <ViewsEditorConnected {...{...props, children}} />;\r\n}\r\nexport default ViewsEditor;\r\n","import React, {Dispatch, ReactElement} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {IStore} from \"../../../redux/store\";\r\nimport {LGraphElement} from \"../../../model/dataStructure\";\r\nimport {LViewElement} from \"../../../view/viewElement/view\";\r\nimport {LModelElement} from \"../../../model/logicWrapper\";\r\nimport Input from \"../../forEndUser/Input\";\r\n\r\nfunction StyleEditorComponent(props: AllProps) {\r\n\r\n    const selected = props.selected;\r\n    if(selected) {\r\n        return(<div className={'p-3'}>\r\n            {/*<Input obj={selected.node} field={\"id\"} label={\"ID\"} type={\"text\"} readonly={true}/>*/}\r\n            <Input obj={selected.node} field={\"x\"} label={\"X Position\"} type={\"number\"} readonly={true} />\r\n            <Input obj={selected.node} field={\"y\"} label={\"Y Position\"} type={\"number\"} readonly={true} />\r\n            <Input obj={selected.node} field={\"width\"} label={\"Width\"} type={\"number\"} readonly={true} />\r\n            <Input obj={selected.node} field={\"height\"} label={\"Height\"} type={\"number\"} readonly={true} />\r\n            <Input obj={selected.node} field={\"zIndex\"} label={\"Z Index\"} type={\"number\"} readonly={true} />\r\n        </div>);\r\n    } else {\r\n        return(<></>);\r\n    }\r\n}\r\ninterface OwnProps {}\r\ninterface StateProps {\r\n    selected?: {\r\n        node: LGraphElement;\r\n        view: LViewElement;\r\n        modelElement?: LModelElement\r\n    };\r\n}\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    let ret: StateProps = {};\r\n    const selected = state._lastSelected;\r\n    if(selected) {\r\n        const modelElement = state._lastSelected?.modelElement;\r\n        const node = state._lastSelected?.node;\r\n        const view = state._lastSelected?.view;\r\n        if(node && view) {\r\n            ret.selected = {\r\n                node: LGraphElement.fromPointer(node),\r\n                view: LViewElement.fromPointer(node),\r\n                modelElement: (modelElement) ? LModelElement.fromPointer(modelElement) : undefined\r\n            }\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const StyleEditorConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(StyleEditorComponent);\r\n\r\nexport const StyleEditor = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <StyleEditorConnected {...{...props, children}} />;\r\n}\r\nexport default StyleEditor;\r\n\r\n","import React, {Dispatch, ReactElement} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {IStore} from \"../../../redux/store\";\r\nimport {GObject, SetRootFieldAction} from \"../../../joiner\";\r\n\r\n\r\nfunction EdgeEditorComponent(props: AllProps) {\r\n    const strokeWidth = props.strokeWidth;\r\n    const zIndex = props.zIndex;\r\n    const color = props.color;\r\n    const path = props.path;\r\n    const extend = props.extend;\r\n    const referenceM2 = props.referenceM2;\r\n    const referenceM1 = props.referenceM1;\r\n\r\n    const changeOptions = (evt: React.ChangeEvent<HTMLInputElement|HTMLSelectElement>, field: string) => {\r\n        const value = evt.target.value;\r\n        if(value) {\r\n            const options: GObject = {strokeWidth, zIndex, color, path};\r\n            options[field] = value;\r\n            SetRootFieldAction.new('_edgeSettings', options, '', false);\r\n        }\r\n    }\r\n\r\n    const changeDisplayed = (evt: React.ChangeEvent<HTMLInputElement>, field: string) => {\r\n        const value = evt.target.checked;\r\n        const options: GObject = {extend, referenceM2, referenceM1};\r\n        options[field] = value;\r\n        SetRootFieldAction.new('_edgesDisplayed', options, '', false);\r\n    }\r\n\r\n    return(<div className={\"mt-3\"}>\r\n        <div className={\"d-flex mx-3 mt-1\"}>\r\n            <label>Stroke Width</label>\r\n            <input value={strokeWidth} className={\"input ms-auto\"} type={'number'} step={0.1} min={0}\r\n                   onChange={(evt) => changeOptions(evt, 'strokeWidth')} />\r\n        </div>\r\n        <div className={\"d-flex mx-3 mt-1\"}>\r\n            <label>Z Index</label>\r\n            <input value={zIndex} className={\"input ms-auto\"} type={'number'} step={1}\r\n                   onChange={(evt) => changeOptions(evt, 'zIndex')} />\r\n        </div>\r\n        <div className={\"d-flex mx-3 mt-1\"}>\r\n            <label>Color</label>\r\n            <input value={color} className={\"input ms-auto\"} type={'color'}\r\n                   onChange={(evt) => changeOptions(evt, 'color')} />\r\n        </div>\r\n        <div className={\"d-flex mx-3 mt-1\"}>\r\n            <label>Path</label>\r\n            <select value={path} className={\"select ms-auto\"} onChange={(evt) => changeOptions(evt, 'path')}>\r\n                <option value={'grid'}>Grid</option>\r\n                <option value={'smooth'}>Smooth</option>\r\n                <option value={'straight'}>Straight</option>\r\n            </select>\r\n\r\n        </div>\r\n        <div className={\"d-flex mx-3 mt-1\"}>\r\n            <label>Display Extends</label>\r\n            <input checked={extend} className={\"input ms-auto\"} type={'checkbox'}\r\n                   onChange={(evt) => changeDisplayed(evt, 'extend')} />\r\n        </div>\r\n        <div className={\"d-flex mx-3 mt-1\"}>\r\n            <label>Display References on M2</label>\r\n            <input checked={referenceM2} className={\"input ms-auto\"} type={'checkbox'}\r\n                   onChange={(evt) => changeDisplayed(evt, 'referenceM2')} />\r\n        </div>\r\n        <div className={\"d-flex mx-3 mt-1\"}>\r\n            <label>Display References on M1</label>\r\n            <input checked={referenceM1} className={\"input ms-auto\"} type={'checkbox'}\r\n                   onChange={(evt) => changeDisplayed(evt, 'referenceM1')} />\r\n        </div>\r\n    </div>);\r\n}\r\ninterface OwnProps { }\r\ninterface StateProps {\r\n    strokeWidth: number, zIndex: number, color: string, path: string,\r\n    extend: boolean, referenceM2: boolean, referenceM1: boolean\r\n}\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    const edgeSettings = state._edgeSettings;\r\n    ret.strokeWidth = edgeSettings.strokeWidth;\r\n    ret.zIndex = edgeSettings.zIndex;\r\n    ret.color = edgeSettings.color;\r\n    ret.path = edgeSettings.path;\r\n    const edgesDisplayed = state._edgesDisplayed;\r\n    ret.extend = edgesDisplayed.extend;\r\n    ret.referenceM2 = edgesDisplayed.referenceM2;\r\n    ret.referenceM1 = edgesDisplayed.referenceM1;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const EdgeEditorConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(EdgeEditorComponent);\r\n\r\nexport const EdgeEditor = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <EdgeEditorConnected {...{...props, children}} />;\r\n}\r\nexport default EdgeEditor;\r\n","import React, {Dispatch, ReactElement} from \"react\";\r\nimport {CreateElementAction, SetRootFieldAction} from \"../../../redux/action/action\";\r\nimport {IStore} from \"../../../redux/store\";\r\nimport {connect} from \"react-redux\";\r\nimport {Input, Pointer, U} from \"../../../joiner\";\r\nimport {DViewPoint, LViewPoint} from \"../../../view/viewPoint/viewpoint\";\r\n\r\n\r\nfunction ViewpointsEditorComponent(props: AllProps) {\r\n\r\n    const viewpoints = props.viewpoints;\r\n    const selected = props.selected;\r\n\r\n    const editName = (evt: React.ChangeEvent<HTMLInputElement>, viewpoint: LViewPoint) => {\r\n        viewpoint.name = evt.target.value;\r\n    }\r\n    const add = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const dViewPoint = DViewPoint.new('ViewPoint');\r\n        CreateElementAction.new(dViewPoint);\r\n    }\r\n    const remove = (index: number) => {\r\n        SetRootFieldAction.new('viewpoints', index, '-=', true);\r\n    }\r\n    const select = (viewpoint: LViewPoint) => {\r\n        SetRootFieldAction.new('viewpoint', viewpoint.id, '', true);\r\n    }\r\n\r\n    return(<div>\r\n        <div className={'d-flex p-2'}>\r\n            <b className={'ms-1 my-auto'}>VIEWPOINTS</b>\r\n            <button className={'btn btn-primary ms-auto'} onClick={add}>\r\n                <i className={'p-1 bi bi-plus'}></i>\r\n            </button>\r\n        </div>\r\n        {viewpoints.map((viewpoint, index) => {\r\n            return <div key={index} className={'d-flex p-1 mt-1 border round'}\r\n                        style={{ backgroundColor: (selected.id === viewpoint.id) ? 'white' : 'transparent'}}>\r\n                <input className={'p-0 input hidden-input'} value={viewpoint.name} type={'text'}\r\n                       onChange={(evt) => {editName(evt, viewpoint)}} disabled={index === 0} />\r\n                <button className={'btn btn-success ms-auto'} disabled={selected.id === viewpoint.id}\r\n                        onClick={(evt) => {select(viewpoint)}}>\r\n                    <i className={'p-1 bi bi-check2'}></i>\r\n                </button>\r\n                <button className={'btn btn-danger ms-1'} disabled={index === 0 || selected.id === viewpoint.id}\r\n                        onClick={(evt) => {remove(index)}}>\r\n                    <i className={'p-1 bi bi-trash3-fill'}></i>\r\n                </button>\r\n            </div>\r\n        })}\r\n    </div>);\r\n}\r\ninterface OwnProps { }\r\ninterface StateProps {\r\n    viewpoints: LViewPoint[],\r\n    selected: LViewPoint\r\n}\r\ninterface DispatchProps { }\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    ret.viewpoints = LViewPoint.fromPointer(state.viewpoints);\r\n    ret.selected = LViewPoint.fromPointer(state.viewpoint);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const ViewpointsEditorConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ViewpointsEditorComponent);\r\n\r\nexport const ViewpointsEditor = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <ViewpointsEditorConnected {...{...props, children}} />;\r\n}\r\nexport default ViewpointsEditor;\r\n","import React, {Dispatch, PureComponent, ReactElement, useEffect} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {IStore} from \"../../../redux/store\";\r\nimport {\r\n    Dictionary,\r\n    GObject, Json,\r\n    LGraphElement,\r\n    LModelElement,\r\n    LPointerTargetable,\r\n    LViewElement,\r\n    RuntimeAccessibleClass,\r\n    U\r\n} from \"../../../joiner\";\r\nimport {useStateIfMounted} from \"use-state-if-mounted\";\r\nimport * as util from \"util\";\r\nimport { makeEvalContext } from \"../../../graph/graphElement/graphElement\";\r\n\r\nvar Convert = require('ansi-to-html');\r\nvar ansiConvert = new Convert();\r\n(window as any).ansiconvert = ansiConvert;\r\n\r\nclass ThisState{\r\n    expression!: string;\r\n    output: any;\r\n}\r\n\r\n// trasformato in class component così puoi usare il this nella console. e non usa accidentalmente window come contesto\r\n\r\nlet hiddenkeys = [\"pointedBy\", \"clonedCounter\", \"parent\", \"_subMaps\", \"inspect\", \"__random\"];\r\nfunction fixproxy(output: any/*but not array*/, hideDKeys: boolean = true, addLKeys: boolean = true):\r\n    { output: any, shortcuts?: GObject<'L singleton'>, comments?: Dictionary<string, string | {type:string, txt:string}>, hiddenkeys?: GObject} {\r\n\r\n    let proxy: LPointerTargetable | undefined;\r\n    if (output?.__isProxy) {\r\n        proxy = output;\r\n        output = output.__raw; //Object.fromEntries(Object.getOwnPropertyNames(p).map(k => [k, p[k]]));\r\n    } else proxy = undefined;\r\n\r\n    let ret: ReturnType<typeof fixproxy> = {output};\r\n    switch(typeof output) {\r\n        case \"function\": return {output: U.buildFunctionDocumentation(output)};\r\n        default: return {output};\r\n        case \"object\":\r\n            ret.output = output = {...output};\r\n            if ((addLKeys && proxy)) {\r\n                let Lsingleton: GObject<'L singleton'> = (RuntimeAccessibleClass.get(output.className)!.logic!.singleton);\r\n                let comments: Dictionary<string, string | {type:string, txt:string}> = {};\r\n                ret.shortcuts = {...Lsingleton};\r\n                ret.comments = comments;\r\n                for (let key in output) {\r\n                    if (Lsingleton[\"__info_of__\" + key]) comments[key] = Lsingleton[\"__info_of__\" + key];\r\n                }\r\n                for (let key in Lsingleton) {\r\n                    // todo: might define some func private in L like \"private info_of_fieldname\" where fuction body is comment documentation extracted,\r\n                    //  or actually directly private info_of_id = <a href=\"...\"><span>Unique identifier, and value used to point this object.</span></a>\r\n                    if ((key in output) || (key.indexOf(\"__info_of__\") === 0)) {\r\n                        delete ret.shortcuts[key];\r\n                        continue;\r\n                    } else { if (ret.shortcuts[key] === undefined) ret.shortcuts[key] = ''; }\r\n                    if (Lsingleton[\"__info_of__\" + key]) comments[key] = Lsingleton[\"__info_of__\" + key];\r\n                    if (comments[key]) continue; // if explicitly commented, i will not attempt to generate documentation.\r\n                    let entryvalue = Lsingleton[key];\r\n                    switch (typeof entryvalue) {\r\n                        case \"object\":\r\n                        case \"function\":\r\n                            ret.shortcuts[key] = U.buildFunctionDocumentation(entryvalue);\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n            if (hiddenkeys) {\r\n                ret.hiddenkeys = {};\r\n                for (let key of hiddenkeys) {\r\n                    ret.hiddenkeys[key] = output[key];\r\n                    delete output[key];\r\n                    // delete output.shortcuts[key];\r\n                }\r\n            }\r\n            break;\r\n    }\r\n    return ret; }\r\n\r\nexport class ConsoleComponent extends PureComponent<AllProps, ThisState>{\r\n    constructor(props: AllProps) {\r\n        super(props);\r\n        this.state = {expression:'', output: null};\r\n        this.change(undefined);\r\n    }\r\n    change = (evt?: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        let expression: string | undefined = evt?.target.value.trim() || '';\r\n        let output;\r\n        let context = {...this.props, props: this.props}; // makeEvalContext(this.props as any, {} as any);\r\n        try { output = U.evalInContextAndScope(expression || 'undefined', context, context); }\r\n        catch (e: any) {\r\n            console.error(\"console error\", e);\r\n            output = '<span style=\"color:red\">Invalid Syntax!<br></span>' + e.toString(); }\r\n        this.setState({expression, output});\r\n    }\r\n\r\n    render(){\r\n        const data = this.props.data;/*\r\n        const [expression, setExpression] = useStateIfMounted('data');\r\n        const [output, setOutput] = useStateIfMounted('');*/\r\n\r\n\r\n        if (data) {\r\n            let outstr;\r\n            // try { outstr = U.circularStringify(this.state.output, (key, value)=> { return value.__isProxy ? value.name : value; }, \"\\t\", 1) }\r\n            (window as any).inspect = util.inspect;\r\n            (window as any).tmpp = this.state.output;\r\n            let ashtml: boolean\r\n            let output: any = this.state.output;\r\n            let shortcuts: GObject<'L singleton'> | undefined = undefined;\r\n            let comments: Dictionary<string, string | {type:string, txt:string}> | undefined = undefined;\r\n            let hidden: Dictionary<string, string> | undefined = undefined;\r\n            try {\r\n                let hiddenkeys: GObject | undefined = {};\r\n                if (Array.isArray(output) && output[0]?.__isProxy) {\r\n                    output = output.map(o => fixproxy(o).output);\r\n                    comments = {\"separator\": '<span>Similar to <a href={\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join\"}>Array.join(separator)</a>' +\r\n                            ', but supports array of JSX nodes and JSX as separator argument.</span>'};\r\n                    shortcuts = {\"separator\": \"\"};\r\n                    console.log(\"console result (array):\", {output});\r\n                }\r\n                else {\r\n                    let ret = fixproxy(output);\r\n                    output = ret.output;\r\n                    comments = ret.comments;\r\n                    shortcuts = ret.shortcuts;\r\n                    hidden = ret.hiddenkeys;\r\n                    console.log(\"console result:\", {output, ret});\r\n                }\r\n                let format = (val: GObject) => U.replaceAll(ansiConvert.toHtml(util.inspect(val, true, 2, true)), \"style=\\\"color:#FFF\\\"\", \"style=\\\"color:#000\\\"\");\r\n                outstr = \"<h4>Result:</h4>\" + format(output);\r\n                if (shortcuts || comments){\r\n                    // if(!shortcuts) shortcuts = {};\r\n                    if(!comments) comments = {};\r\n                    if (shortcuts) outstr += \"<br><br><h4>Shortcuts</h4>\" + format(shortcuts);\r\n                    if (hidden) outstr +=\"<br><br><h4>Other less useful properties</h4>\" + format(hidden);\r\n                    for (let commentKey in comments){\r\n                        let commentVal: any = comments[commentKey];\r\n                        if (commentVal?.type) commentVal = \":\" + commentVal?.type + \" ~ \" + commentVal?.txt;\r\n                        let commentKeyEscaped = U.multiReplaceAll(commentKey, [\"$\", \"-\"], [\"\\\\$\", \"\\\\-\"]); // _ should be safe, .-,?^ not happening?\r\n                        let regexp = new RegExp(\"^({?\\\\s*\" +commentKey+\":.*)$\", \"gm\");\r\n                        outstr = outstr.replace(regexp, \"$1 // \" + commentVal);\r\n                    }\r\n                }\r\n                ashtml = true; }\r\n            catch(e: any) {\r\n                console.error(e);\r\n                throw e;\r\n                outstr = \"[circular object]: \" + e.toString();\r\n                ashtml = false;\r\n            }\r\n            console.log(\"console result (string)\", {outstr});\r\n            let contextkeys;\r\n            let objraw = this.state.output?.__raw || (typeof this.state.output === \"object\" ? this.state.output : \"[primitiveValue]\") || {};\r\n            if (this.state.expression.trim() === \"\") contextkeys = [\"data\", \"node\", \"view\"].join(\", \");\r\n            else if (this.state.expression.trim() === \"this\") contextkeys = [\"Warning: \\\"this\\\" will refer to the Console component instead of a GraphElement component.\"].join(\", \");\r\n            else contextkeys = Array.isArray(objraw) ? [\"array[number]\", ...Object.keys(Array.prototype)].join(\"</br>\") : Object.getOwnPropertyNames(objraw).join(\", \");// || []).join(\", \")\r\n            return(<div className={'p-2 w-100 h-100'}>\r\n                <textarea spellCheck={false} className={'p-0 input mb-2 w-100'} onChange={this.change} />\r\n                {/*<label>Query {(this.state.expression)}</label>*/}\r\n                <label>On {(data as GObject).name}</label>\r\n                <hr className={'mt-1 mb-1'} />\r\n                { ashtml && <div style={{whiteSpace:\"pre\"}} dangerouslySetInnerHTML={ashtml ? { __html: outstr as string} : undefined} /> }\r\n                { !ashtml && <div style={{whiteSpace:\"pre\"}}>{ outstr }</div>}\r\n                <label className={\"mt-2\"}>Context keys:</label>\r\n                {\r\n                    contextkeys\r\n                }\r\n            </div>)\r\n        } else { return(<div></div>) }\r\n    }\r\n}\r\ninterface OwnProps {}\r\ninterface StateProps { data: LModelElement|undefined, node: LGraphElement|undefined, view: LViewElement|undefined }\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    let ptr;\r\n    ptr = state._lastSelected?.modelElement;\r\n    ret.data = (ptr) ? LModelElement.fromPointer(ptr) : undefined;\r\n    ptr = state._lastSelected?.node;\r\n    ret.node = (ptr) ? LModelElement.fromPointer(ptr) : undefined;\r\n    ptr = state._lastSelected?.view;\r\n    ret.view = (ptr) ? LModelElement.fromPointer(ptr) : undefined;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const ConsoleConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ConsoleComponent);\r\n\r\nexport const Console = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <ConsoleConnected {...{...props, children}} />;\r\n}\r\nexport default Console;\r\n","import {ReactNode} from \"react\";\r\nimport {LModelElement} from \"../../model/logicWrapper\";\r\n\r\nexport class ToolBarItem {\r\n    public static getItems(data: LModelElement, items: string[]): ReactNode[] {\r\n        const reactNodes: ReactNode[] = [];\r\n        for(let item of items) {\r\n            reactNodes.push(<div className={\"toolbar-item \" + item} key={items.indexOf(item)} onClick={() => data.addChild(item)}>+{item}</div>);\r\n        }\r\n        return reactNodes;\r\n    }\r\n}\r\n","import React, {Dispatch, ReactElement, ReactNode} from \"react\";\r\nimport {IStore} from \"../../redux/store\";\r\n\r\nimport {connect} from \"react-redux\";\r\nimport \"./toolbar.scss\";\r\nimport {\r\n    DGraphElement,\r\n    DModel,\r\n    DModelElement, DNamedElement, DObject,\r\n    DPointerTargetable,\r\n    DViewElement,\r\n    LGraphElement,\r\n    LModel,\r\n    LModelElement,\r\n    LViewElement,\r\n    MyProxyHandler,\r\n    Pointer,\r\n    SetFieldAction\r\n} from \"../../joiner\";\r\nimport {ToolBarItem} from \"./ToolBarItem\";\r\n\r\ninterface ThisState {}\r\nfunction ToolBarComponent(props: AllProps, state: ThisState) {\r\n\r\n    const lModelElement: LModelElement = props.selected?.modelElement ? props.selected?.modelElement : MyProxyHandler.wrap(props.model);\r\n    const isMetamodel: boolean = props.isMetamodel;\r\n    const metamodel: LModel|undefined = props.metamodel;\r\n    const myDictValidator: Map<string, ReactNode[]> = new Map();\r\n    const addChildren = (...items: string[]) => [...ToolBarItem.getItems(lModelElement, items)];\r\n\r\n    myDictValidator.set(\"DModel\", addChildren(\"package\"));\r\n    myDictValidator.set(\"DPackage\", addChildren(\"package\", \"class\", \"enumerator\"));\r\n    myDictValidator.set(\"DClass\", addChildren(\"attribute\", \"reference\", \"operation\"));\r\n    myDictValidator.set(\"DEnumerator\", addChildren(\"literal\"));\r\n    myDictValidator.set(\"DOperation\", addChildren(\"parameter\", \"exception\"));\r\n\r\n    if(isMetamodel) {\r\n        return(<div className={\"toolbar\"}>\r\n            {myDictValidator.get(lModelElement?.className as string)?.map((item) => {\r\n                return item;\r\n            })}\r\n            <div className={\"toolbar-item annotation\"} onClick={() => lModelElement.addChild(\"annotation\")}>+annotation</div>\r\n        </div>);\r\n    }\r\n    else {\r\n        const classes = metamodel?.classes;\r\n        const model: LModel = LModel.fromPointer(props.model);\r\n\r\n        return(<div className={\"toolbar\"}>\r\n            {classes?.filter((lClass) => {return !lClass.abstract && !lClass.interface}).map((lClass, index) => {\r\n                return <div key={lClass.id} className={\"toolbar-item class\"} onClick={() => { model.addObject(lClass.id) }}>\r\n                    +{lClass.name}\r\n                </div>\r\n            })}\r\n            <div key={\"Object\"} className={\"toolbar-item class\"} onClick={() => { model.addObject(); }}>+Object</div>\r\n        </div>);\r\n    }\r\n\r\n}\r\ninterface OwnProps {\r\n    model: Pointer<DModel, 1, 1, LModel>;\r\n    isMetamodel: boolean;\r\n    metamodelId?: Pointer<DModelElement, 1, 1, LModelElement>;\r\n}\r\n\r\ninterface StateProps {\r\n    selectedid?: { node: Pointer<DGraphElement, 1, 1>; view: Pointer<DViewElement, 1, 1>; modelElement: Pointer<DModelElement, 0, 1> };\r\n    selected?: { node: LGraphElement; view: LViewElement; modelElement?: LModelElement };\r\n    metamodel?: LModel;\r\n}\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    ret.selectedid = state._lastSelected;\r\n    ret.selected = ret.selectedid && {\r\n        node: DPointerTargetable.wrap(state.idlookup[ret.selectedid.node]) as LGraphElement,\r\n        view: DPointerTargetable.wrap(state.idlookup[ret.selectedid.view]) as LViewElement,\r\n        modelElement: ret.selectedid.modelElement ? DPointerTargetable.wrap<DPointerTargetable, LModelElement>(state.idlookup[ret.selectedid.modelElement]) : undefined\r\n    };\r\n    if(ownProps.metamodelId) { ret.metamodel = LModel.fromPointer(ownProps.metamodelId); }\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {} as any;\r\n    return ret;\r\n}\r\n\r\n\r\nexport const ToolBarConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ToolBarComponent);\r\n\r\nexport const ToolBar = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <ToolBarConnected {...{...props, children}} />;\r\n}\r\nexport default ToolBar;\r\n\r\n\r\n\r\n\r\n","import {IStore} from \"../../redux/store\";\r\nimport React, {Dispatch, ReactElement, useEffect} from \"react\";\r\nimport {useStateIfMounted} from \"use-state-if-mounted\";\r\nimport {connect} from \"react-redux\";\r\nimport {GObject, LClass, LPointerTargetable, LUser} from \"../../joiner\";\r\nimport \"./edge.scss\";\r\nimport Xarrow, {Xwrapper} from \"react-xarrows\";\r\n\r\nfunction PendingEdgeComponent(props: AllProps) {\r\n\r\n    const source = props.source;\r\n    const [mousePosition, setMousePosition] = useStateIfMounted({x: 0, y: 0});\r\n    const options = props.edgeSettings;\r\n\r\n    useEffect(() => {\r\n        if(source) {\r\n            const updateMousePosition = (ev: MouseEvent) => {setMousePosition({x: ev.clientX, y: ev.clientY});};\r\n            window.addEventListener('mousemove', updateMousePosition);\r\n            return () => {window.removeEventListener('mousemove', updateMousePosition);};\r\n        }\r\n    }, );\r\n\r\n    return <Xwrapper>\r\n        <div style={{top: mousePosition.y - 100, left: mousePosition.x - 10}}\r\n             id={'extend-target'}></div>\r\n        {source && <Xarrow start={source.nodes[0].id} end={'extend-target'} {...options} />}\r\n    </Xwrapper>;\r\n}\r\n\r\ninterface OwnProps { }\r\ninterface StateProps { user?: LUser, source?: LClass, edgeSettings?: GObject }\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = { } as any;\r\n    ret.user = LPointerTargetable.from(state.isEdgePending.user);\r\n    ret.source = LPointerTargetable.from(state.isEdgePending.source);\r\n    ret.edgeSettings = state._edgeSettings;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const PendingEdgeConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(PendingEdgeComponent);\r\n\r\nexport const PendingEdge = (props: AllProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <PendingEdgeConnected {...{...props, children}} />;\r\n}\r\nexport default PendingEdge;\r\n","import {IStore} from \"../../redux/store\";\r\nimport React, {Dispatch, ReactElement, ReactNode} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport \"./style.scss\";\r\nimport {CreateElementAction, SetRootFieldAction} from \"../../redux/action/action\";\r\nimport {DValue, LNamedElement, LValue} from \"../../model/logicWrapper\";\r\nimport {DViewElement, GObject, LGraphElement, LUser} from \"../../joiner\";\r\n\r\nfunction ContextMenuComponent(props: AllProps) {\r\n\r\n    const user = props.user;\r\n    const display = props.display;\r\n    const position = props.position;\r\n    const me = props.me;\r\n    const node = props.node;\r\n    const jsxList: ReactNode[] = [];\r\n\r\n    const close = () => { SetRootFieldAction.new(\"contextMenu\", {display: false, x: 0, y: 0}); }\r\n    const addView = () => {\r\n        if(me) {\r\n            const jsx =`<div className={'root bg-white'}>Hello World!</div>`;\r\n            const dView: DViewElement = DViewElement.new(me.name + 'View', jsx);\r\n            switch(me.className) {\r\n                case 'DClass':\r\n                    dView.query = `context DObject inv: self.instanceof.name = '${me.name}'`;\r\n                    break;\r\n                case 'DAttribute':\r\n                case 'DReference':\r\n                    dView.query = `context DValue inv: self.instanceof.name = '${me.name}'`;\r\n                    break;\r\n                case 'DObject':\r\n                    dView.query = `context DObject inv: self.id = '${me.id}'`;\r\n                    break;\r\n            }\r\n            CreateElementAction.new(dView);\r\n            SetRootFieldAction.new('stackViews', dView.id, '+=', true);\r\n        }\r\n    }\r\n\r\n    if(display && me && node) {\r\n        jsxList.push(<div className={\"col title text-center\"}>{me.className}</div>);\r\n        jsxList.push(<hr />);\r\n        jsxList.push(<div onClick={() => {close(); node.zIndex += 1;}} className={\"col item\"}>Up</div>);\r\n        jsxList.push(<div onClick={() => {close(); node.zIndex -= 1;}} className={\"col item\"}>Down</div>);\r\n        jsxList.push(<div onClick={() => {close(); addView();}} className={\"col item\"}>Add View</div>);\r\n        jsxList.push(<div onClick={() => {close(); me?.delete();}} className={\"col item\"}>Delete</div>);\r\n        switch (me.className) {\r\n            case 'DValue': if ((me as any as LValue).instanceof) jsxList.pop(); break;\r\n            case 'DClass':\r\n                jsxList.push(<div onClick={() => {\r\n                    close();\r\n                    SetRootFieldAction.new('isEdgePending', {user: user.id, source: me.id});\r\n                }} className={\"col item\"}>Extend</div>);\r\n                break;\r\n        }\r\n    }\r\n    return(<>\r\n        <div className={\"context-menu round\"} style={{top: position.y - 100, left: position.x - 10}}>\r\n            {jsxList.map((jsx, index) => { return <div key={index}>{jsx}</div>; })}\r\n        </div>\r\n    </>);\r\n}\r\ninterface OwnProps {}\r\ninterface StateProps {\r\n    user: LUser,\r\n    display: boolean,\r\n    position: {x: number, y: number},\r\n    me?: LNamedElement,\r\n    node?: LGraphElement,\r\n}\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const user = LUser.from(state.currentUser);\r\n    const display = state.contextMenu.display;\r\n    const position = {x: state.contextMenu.x, y: state.contextMenu.y}\r\n    const mePointer = state._lastSelected?.modelElement;\r\n    const me: LNamedElement | undefined = mePointer ? LNamedElement.fromPointer(mePointer) : undefined;\r\n    const nodePointer = state._lastSelected?.node;\r\n    const node: LGraphElement | undefined = nodePointer ? LGraphElement.fromPointer(nodePointer) : undefined;\r\n    const ret: StateProps = { user, display, position, me, node };\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const ContextMenuConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ContextMenuComponent);\r\n\r\nexport const ContextMenu = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <ContextMenuConnected {...{...props, children}} />;\r\n}\r\nexport default ContextMenu;\r\n\r\n","import {IStore} from \"../../redux/store\";\r\nimport React, {Dispatch, ReactElement, useEffect} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {DGraphElement, LGraphElement} from \"../../model/dataStructure\";\r\nimport {GObject, Pointer, SetRootFieldAction} from \"../../joiner\";\r\nimport Xarrow from \"react-xarrows\";\r\nimport {useStateIfMounted} from \"use-state-if-mounted\";\r\nimport {useEffectOnce} from \"usehooks-ts\";\r\nimport crypto from \"crypto\";\r\nimport $ from \"jquery\";\r\n\r\nfunction ReferenceEdgeComponent(props: AllProps) {\r\n    const source = props.source;\r\n    const target = props.target;\r\n    const containment = props.containment;\r\n    let options = props.options;\r\n    if(containment) {\r\n        options = {\r\n            ...options,\r\n            showTail: true,\r\n            tailSize: 15,\r\n            tailShape: {svgElem: <rect style={{\r\n                    rotate: '45deg', fill: 'white', strokeWidth: '0.1', stroke: options.color,\r\n                }} width='.5pt' height='.5pt' />, offsetForward: 1}\r\n        }\r\n    }\r\n\r\n    const [middleAnchor, setMiddleAnchor] = useStateIfMounted('');\r\n    useEffectOnce(() => {\r\n        setMiddleAnchor(crypto.randomBytes(20).toString('hex'));\r\n    });\r\n    useEffect(() => {\r\n        const middleware: GObject = $('[id=\"' + middleAnchor + '\"]');\r\n        if(middleware) {\r\n            middleware.draggable({\r\n                cursor: \"grabbing\",\r\n                containment: \"window\",\r\n                drag: function (event: GObject, obj: GObject) {\r\n                    SetRootFieldAction.new(\"dragging\", {})\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n    if(props.display) {\r\n        return(<>\r\n            <div style={{borderColor: options.color}} id={middleAnchor} className={'middle-anchor'}></div>\r\n            <Xarrow start={source.id} end={middleAnchor} {...options} showHead={false} />\r\n            <Xarrow start={middleAnchor} end={target.id} {...options} />\r\n        </>);\r\n    } else { return(<></>); }\r\n\r\n}\r\ninterface OwnProps {\r\n    sourceID: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    targetID: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    containment: boolean;\r\n}\r\ninterface StateProps { source: LGraphElement, target: LGraphElement, options: GObject, display: boolean }\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = { } as any;\r\n    ret.source = LGraphElement.fromPointer(ownProps.sourceID);\r\n    ret.target = LGraphElement.fromPointer(ownProps.targetID);\r\n    ret.options = state._edgeSettings;\r\n    ret.display = state._edgesDisplayed.referenceM2;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const ReferenceEdgeConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ReferenceEdgeComponent);\r\n\r\nexport const ReferenceEdge = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <ReferenceEdgeConnected {...{...props, children}} />;\r\n}\r\nexport default ReferenceEdge;\r\n","import {IStore} from \"../../redux/store\";\r\nimport React, {Dispatch, ReactElement, useEffect} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {DGraphElement, LGraphElement} from \"../../model/dataStructure\";\r\nimport {GObject, Pointer, SetRootFieldAction} from \"../../joiner\";\r\nimport Xarrow from \"react-xarrows\";\r\nimport {useStateIfMounted} from \"use-state-if-mounted\";\r\nimport {useEffectOnce} from \"usehooks-ts\";\r\nimport crypto from \"crypto\";\r\nimport $ from \"jquery\";\r\n\r\nfunction ExtendEdgeComponent(props: AllProps) {\r\n    const source = props.source;\r\n    const target = props.target;\r\n    let options = props.options;\r\n    options = {\r\n        ...options,\r\n        showHead: true,\r\n        headSize: 15,\r\n        headColor: 'white',\r\n        headShape: {svgElem:<svg><path strokeWidth={0.1} stroke={options.color} d={'M 0 0 L 1 0.5 L 0 1 L 0 0 z'} /></svg>}\r\n    }\r\n\r\n    const [middleAnchor, setMiddleAnchor] = useStateIfMounted('');\r\n    useEffectOnce(() => {\r\n        setMiddleAnchor(crypto.randomBytes(20).toString('hex'));\r\n    });\r\n    useEffect(() => {\r\n        const middleware: GObject = $('[id=\"' + middleAnchor + '\"]');\r\n        if(middleware) {\r\n            middleware.draggable({\r\n                cursor: \"grabbing\",\r\n                containment: \"window\",\r\n                drag: function (event: GObject, obj: GObject) {\r\n                    SetRootFieldAction.new(\"dragging\", {})\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n    if(props.display) {\r\n        return(<>\r\n            <div style={{borderColor: options.color}} id={middleAnchor} className={'middle-anchor'}></div>\r\n            <Xarrow start={source.id} end={middleAnchor} {...options} showHead={false} />\r\n            <Xarrow start={middleAnchor} end={target.id} {...options} />\r\n        </>);\r\n    } else { return(<></>); }\r\n\r\n}\r\ninterface OwnProps {\r\n    sourceID: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    targetID: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n}\r\ninterface StateProps { source: LGraphElement, target: LGraphElement, options: GObject, display: boolean }\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = { } as any;\r\n    ret.source = LGraphElement.fromPointer(ownProps.sourceID);\r\n    ret.target = LGraphElement.fromPointer(ownProps.targetID);\r\n    ret.options = state._edgeSettings;\r\n    ret.display = state._edgesDisplayed.extend;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const ExtendEdgeConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ExtendEdgeComponent);\r\n\r\nexport const ExtendEdge = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <ExtendEdgeConnected {...{...props, children}} />;\r\n}\r\nexport default ExtendEdge;\r\n","import {IStore} from \"../../redux/store\";\r\nimport React, {Dispatch, ReactElement, useEffect} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {DGraphElement, LGraphElement} from \"../../model/dataStructure\";\r\nimport {GObject, Pointer, SetRootFieldAction} from \"../../joiner\";\r\nimport Xarrow from \"react-xarrows\";\r\nimport {useStateIfMounted} from \"use-state-if-mounted\";\r\nimport {useEffectOnce} from \"usehooks-ts\";\r\nimport crypto from \"crypto\";\r\nimport \"./style.scss\";\r\nimport $ from \"jquery\";\r\n\r\nfunction ValueEdgeComponent(props: AllProps) {\r\n    const source = props.source;\r\n    const target = props.target;\r\n    let options = props.options;\r\n    options = {\r\n        ...options,\r\n        showHead: false\r\n    }\r\n\r\n    const [middleAnchor, setMiddleAnchor] = useStateIfMounted('');\r\n    useEffectOnce(() => {\r\n        setMiddleAnchor(crypto.randomBytes(20).toString('hex'));\r\n    });\r\n    useEffect(() => {\r\n        const middleware: GObject = $('[id=\"' + middleAnchor + '\"]');\r\n        if(middleware) {\r\n            middleware.draggable({\r\n                cursor: \"grabbing\",\r\n                containment: \"window\",\r\n                drag: function (event: GObject, obj: GObject) {\r\n                    SetRootFieldAction.new(\"dragging\", {})\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n    if(props.display) {\r\n        return(<>\r\n            <div style={{borderColor: options.color}} id={middleAnchor} className={'middle-anchor'}></div>\r\n            <Xarrow start={source.id} end={middleAnchor} showHead={false} {...options} />\r\n            <Xarrow start={middleAnchor} end={target.id} {...options} />\r\n        </>);\r\n    } else { return(<></>); }\r\n\r\n}\r\ninterface OwnProps {\r\n    sourceID: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n    targetID: Pointer<DGraphElement, 1, 1, LGraphElement>;\r\n}\r\ninterface StateProps { source: LGraphElement, target: LGraphElement, options: GObject, display: boolean }\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = { } as any;\r\n    ret.source = LGraphElement.fromPointer(ownProps.sourceID);\r\n    ret.target = LGraphElement.fromPointer(ownProps.targetID);\r\n    ret.options = state._edgeSettings;\r\n    ret.display = state._edgesDisplayed.referenceM1;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const ValueEdgeConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ValueEdgeComponent);\r\n\r\nexport const ValueEdge = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <ValueEdgeConnected {...{...props, children}} />;\r\n}\r\nexport default ValueEdge;\r\n","import {IStore} from \"../../redux/store\";\r\nimport React, {Dispatch, ReactElement} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport type {DModel, Pointer} from \"../../joiner\";\r\nimport {LClass, LClassifier, LModel, LObject} from \"../../joiner\";\r\nimport ReferenceEdge from \"./ReferenceEdge\";\r\nimport ExtendEdge from \"./ExtendEdge\";\r\nimport ValueEdge from \"./ValueEdge\";\r\n\r\ninterface IReferenceEdge { source: LClass, target: LClassifier, containment: boolean }\r\ninterface IExtendEdge { source: LClass, target: LClass }\r\ninterface IValueEdge { source: LObject, target: LObject }\r\nfunction EdgesManagerComponent(props: AllProps) {\r\n    const model = props.model;\r\n\r\n    const classes = model.classes ? [...model.classes] : [];\r\n    const _references: IReferenceEdge[] = [];\r\n    const _extends: IExtendEdge[] = [];\r\n    for(let classifier of classes) {\r\n        for(let reference of classifier.references) {\r\n            _references.push({source: reference.father, target: reference.type, containment: reference.containment});\r\n        }\r\n        for(let father of classifier.extends) {\r\n            _extends.push({source: classifier, target: father});\r\n        }\r\n    }\r\n\r\n    const objects = model.objects;\r\n    const _values: IValueEdge[] = [];\r\n    for(let object of objects) {\r\n        for(let feature of object.features) {\r\n            const instanceOf = feature.instanceof;\r\n            if(instanceOf?.className === 'DReference') {\r\n                const valuePointers = feature.__raw.values;\r\n                for(let pointer of valuePointers) {\r\n                    _values.push({source: object, target: LObject.fromPointer(pointer as Pointer)});\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // return <div> to rework </div>\r\n    return <div>\r\n        {_references.map((referenceEdge, index) => {\r\n            const source = referenceEdge.source.node;\r\n            const target = referenceEdge.target.node;\r\n            const containment = referenceEdge.containment;\r\n            if(source && target) {\r\n                return(<ReferenceEdge key={index} sourceID={source.id} targetID={target.id} containment={containment} />);\r\n            }\r\n        })}\r\n        {_extends.map((extendEdge, index) => {\r\n            const source = extendEdge.source?.node;\r\n            const target = extendEdge.target?.node;\r\n            if(source && target) {\r\n                return(<ExtendEdge key={index} sourceID={source.id} targetID={target.id} />);\r\n            }\r\n        })}\r\n        {_values.map((valueEdge, index) => {\r\n            const source = valueEdge.source?.node;\r\n            const target = valueEdge.target?.node;\r\n            if(source && target) {\r\n                return(<ValueEdge key={index} sourceID={source.id} targetID={target.id} />);\r\n            }\r\n        })}\r\n    </div>\r\n}\r\ninterface OwnProps { modelid: Pointer<DModel, 1, 1, LModel> }\r\ninterface StateProps { model: LModel }\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = { } as any;\r\n    ret.model = LModel.fromPointer(ownProps.modelid);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const EdgesManagerConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(EdgesManagerComponent);\r\n\r\nexport const EdgesManager = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <EdgesManagerConnected {...{...props, children}} />;\r\n}\r\nexport default EdgesManager;\r\n","import React, {Dispatch, ReactElement} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {IStore} from \"../../../redux/store\";\r\nimport type {DModel, Pointer} from \"../../../joiner\";\r\nimport {CreateElementAction, DGraph, LGraph, LModel} from \"../../../joiner\";\r\nimport {DefaultNode} from \"../../../joiner/components\";\r\nimport ToolBar from \"../../toolbar/ToolBar\";\r\nimport PendingEdge from \"../../../graph/edge/PendingEdge\";\r\nimport ContextMenu from \"../../toolbar/ContextMenu\";\r\nimport EdgesManager from \"../../../graph/edges/EdgesManager\";\r\n\r\nfunction MetamodelTabComponent(props: AllProps) {\r\n    const model = props.model;\r\n    const graph = props.graph;\r\n\r\n    if (!model) return(<>closed tab</>);\r\n    if (!graph) {\r\n        CreateElementAction.new(DGraph.new(model.id));\r\n        return(<div style={{width: \"100%\", height: \"100%\", display: \"flex\"}}>\r\n            <span style={{margin: \"auto\"}}>Building the Graph...</span>\r\n        </div>);\r\n    }\r\n\r\n    return(<div className={'w-100 h-100'}>\r\n        <ContextMenu />\r\n        <PendingEdge />\r\n        <div className={'d-flex'}>\r\n            <ToolBar model={model.id} isMetamodel={model.isMetamodel} />\r\n            <div style={{marginLeft: '6.55em'}}>\r\n                {graph && <DefaultNode data={model.id} nodeid={graph.id} graphid={graph.id}/> || <div>Error: missing DGraph prop</div> }\r\n                <EdgesManager modelid={model.id} />\r\n            </div>\r\n        </div>\r\n    </div>);\r\n\r\n}\r\ninterface OwnProps { modelid: Pointer<DModel, 1, 1, LModel> }\r\ninterface StateProps { model: LModel, graph: LGraph }\r\ninterface DispatchProps { }\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    ret.model = LModel.fromPointer(ownProps.modelid);\r\n    const graphs: DGraph[] = DGraph.fromPointer(state.graphs);\r\n    const pointers = graphs.filter((graph) => { return graph.model === ret.model?.id });\r\n    if(pointers.length > 0) ret.graph = LGraph.fromPointer(pointers[0].id);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const MetamodelTabConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(MetamodelTabComponent);\r\n\r\nexport const MetamodelTab = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <MetamodelTabConnected {...{...props, children}} />;\r\n}\r\nexport default MetamodelTab;\r\n","import React, {Dispatch, ReactElement} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {IStore} from \"../../../redux/store\";\r\nimport type {Pointer, DModel} from \"../../../joiner\";\r\nimport {LGraph, LModel, DGraph, DModelElement, LModelElement, CreateElementAction} from \"../../../joiner\";\r\nimport {DefaultNode} from \"../../../joiner/components\";\r\nimport ToolBar from \"../../toolbar/ToolBar\";\r\nimport PendingEdge from \"../../../graph/edge/PendingEdge\";\r\nimport ContextMenu from \"../../toolbar/ContextMenu\";\r\nimport EdgesManager from \"../../../graph/edges/EdgesManager\";\r\n\r\n\r\nfunction ModelTabComponent(props: AllProps) {\r\n    const model = props.model;\r\n    const graph = props.graph;\r\n\r\n    if (!model) return(<>closed tab</>);\r\n    if (!graph) {\r\n        CreateElementAction.new(DGraph.new(model.id));\r\n        return(<div style={{width: \"100%\", height: \"100%\", display: \"flex\"}}>\r\n            <span style={{margin: \"auto\"}}>Building the Graph...</span>\r\n        </div>);\r\n    }\r\n\r\n    return(<div className={'w-100 h-100'}>\r\n        <ContextMenu />\r\n        <PendingEdge />\r\n        <div className={'d-flex'}>\r\n            <ToolBar model={model.id} isMetamodel={model.isMetamodel} metamodelId={props.metamodelid} />\r\n            <div style={{marginLeft: '6.55em'}}>\r\n                {graph && <DefaultNode data={model.id} nodeid={graph.id} graphid={graph.id} />}\r\n                <EdgesManager modelid={model.id} />\r\n            </div>\r\n        </div>\r\n    </div>);\r\n}\r\ninterface OwnProps {\r\n    modelid: Pointer<DModel, 1, 1, LModel>,\r\n    metamodelid?: Pointer<DModelElement, 1, 1, LModelElement>,\r\n}\r\ninterface StateProps { model: LModel, graph?: LGraph }\r\ninterface DispatchProps { }\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    ret.model = LModel.fromPointer(ownProps.modelid);\r\n    const graphs: DGraph[] = DGraph.fromPointer(state.graphs);\r\n    const pointers = graphs.filter((graph) => { return graph.model === ownProps.modelid });\r\n    if(pointers.length > 0) ret.graph = LGraph.fromPointer(pointers[0].id);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const ModelTabConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ModelTabComponent);\r\n\r\nexport const ModelTab = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <ModelTabConnected {...{...props, children}} />;\r\n}\r\nexport default ModelTab;\r\n","import React, {Dispatch, ReactElement} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {IStore} from \"../../../redux/store\";\r\nimport type {Pointer, DModel} from \"../../../joiner\";\r\nimport {LGraph, LModel, DGraph, DModelElement, LModelElement} from \"../../../joiner\";\r\nimport {DefaultNode} from \"../../../joiner/components\";\r\nimport ToolBar from \"../../toolbar/ToolBar\";\r\nimport PendingEdge from \"../../../graph/edge/PendingEdge\";\r\nimport ContextMenu from \"../../toolbar/ContextMenu\";\r\nimport EdgesManager from \"../../../graph/edges/EdgesManager\";\r\n\r\n\r\nfunction InfoTabComponent(props: AllProps) {\r\n    const metamodels = props.metamodels;\r\n    const models = props.models;\r\n\r\n    return(<div className={'p-1'}>\r\n        <b><label className={'ms-1 text-primary'}>Metamodels ({metamodels.length}):</label></b>\r\n        <br />\r\n        {metamodels.map((model, index) => {\r\n            return(<>\r\n                <label className={'ms-3'} key={index}>-{model.name}</label>\r\n                <br />\r\n            </>);\r\n        })}\r\n        <b><label className={'ms-1 text-primary'}>Models ({models.length}):</label></b><br />\r\n        {models.map((model, index) => {\r\n            return(<>\r\n                <label className={'ms-3'} key={index}>\r\n                    -{model.name} <b className={'text-success'}>{model.instanceof ? \"conforms to\" : \"is shapeless\"}</b> {model.instanceof?.name}\r\n                </label>\r\n                <br />\r\n            </>);\r\n        })}\r\n    </div>);\r\n}\r\ninterface OwnProps {}\r\ninterface StateProps {models: LModel[], metamodels: LModel[]}\r\ninterface DispatchProps { }\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    // ret.metamodels = LModel.fromPointer(state.m2models);\r\n    // ret.models = LModel.fromPointer(state.m1models);\r\n    const models: LModel[] = LModel.fromPointer(state.models);\r\n    ret.metamodels = models.filter((m) => {return m.isMetamodel});\r\n    ret.models = models.filter((m) => {return !m.isMetamodel});\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const InfoTabConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(InfoTabComponent);\r\n\r\nexport const InfoTab = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <InfoTabConnected {...{...props, children}} />;\r\n}\r\nexport default InfoTab;\r\n","import axios from 'axios';\r\n\r\nexport default class API {\r\n    static post() {\r\n        console.clear();\r\n        axios.post('http://172.20.0.102:8000/api/v1/user/', {\r\n            username: \"test\",\r\n            password: \"Password123!\",\r\n            name: \"test\",\r\n            mail: \"test@mail.it\"\r\n        })\r\n            .then(function (response) {\r\n                console.log(response);\r\n            })\r\n            .catch(function (error) {\r\n                console.log(error);\r\n            });\r\n    }\r\n}\r\n","import React, {Dispatch, ReactElement} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {IStore} from \"../../../redux/store\";\r\nimport API from \"../../../api/api\";\r\n\r\n\r\nfunction PersistanceTabComponent(props: AllProps) {\r\n    return(<div>\r\n        <button className={'btn btn-primary'} onClick={() => API.post()}>click</button>\r\n    </div>);\r\n}\r\ninterface OwnProps {}\r\ninterface StateProps {}\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const PersistanceTabConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(PersistanceTabComponent);\r\n\r\nexport const PersistanceTab = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <PersistanceTabConnected {...{...props, children}} />;\r\n}\r\nexport default PersistanceTab;\r\n","import React, {Dispatch, PureComponent, ReactElement, ReactNode} from 'react';\r\nimport {connect} from 'react-redux';\r\nimport {IStore} from '../../redux/store';\r\nimport {\r\n    BEGIN,\r\n    CreateElementAction,\r\n    DGraph,\r\n    DModel,\r\n    DModelElement, END,\r\n    LModel,\r\n    LModelElement, LPointerTargetable,\r\n    Pointer,\r\n    Selectors,\r\n    SetFieldAction,\r\n    U\r\n} from '../../joiner';\r\nimport './style.scss';\r\nimport {DockContext, DockLayout, PanelData, TabData} from \"rc-dock\";\r\nimport {LayoutData} from \"rc-dock/lib/DockData\";\r\nimport StructureEditor from \"../rightbar/structureEditor/StructureEditor\";\r\nimport TreeEditor from \"../rightbar/treeEditor/treeEditor\";\r\nimport ViewsEditor from \"../rightbar/viewsEditor/ViewsEditor\";\r\nimport StyleEditor from \"../rightbar/styleEditor/StyleEditor\";\r\nimport EdgeEditor from \"../rightbar/edgeEditor/EdgeEditor\";\r\nimport ViewpointEditor from \"../rightbar/viewpointsEditor/ViewpointsEditor\";\r\nimport Console from \"../rightbar/console/Console\";\r\nimport Swal from 'sweetalert2'\r\nimport MetamodelTab from \"./tabs/MetamodelTab\";\r\nimport ModelTab from \"./tabs/ModelTab\";\r\nimport InfoTab from \"./tabs/InfoTab\";\r\nimport PersistanceTab from \"./tabs/PersistanceTab\";\r\n\r\n\r\nexport class TabDataMaker {\r\n    static metamodel (model: LModel | DModel): TabData {\r\n        if (model.isMetamodel) return { id: model.id, title: model.name, group: 'group1', closable: true, content: <MetamodelTab modelid={model.id} /> };\r\n        return {} as any;\r\n    }\r\n    static model(model: LModel | DModel): TabData {\r\n        return { id: model.id, title: model.name, group: 'group1', closable: true, content:\r\n            <ModelTab modelid={model.id} metamodelid={(model.instanceof as any)?.id || model.instanceof} />\r\n        };\r\n    }\r\n\r\n}\r\n\r\n\r\ninterface ThisState {}\r\nclass DockLayoutComponent extends PureComponent<AllProps, ThisState>{\r\n    private dock: DockLayout|null;\r\n    private dockPanel!: PanelData;\r\n    private dockContext!: DockContext;\r\n\r\n    private groups = {\r\n        'group1': {\r\n            floatable: true,\r\n            maximizable: true,\r\n            panelExtra: (panelData: PanelData, context: DockContext) => {\r\n                this.dockPanel = panelData;\r\n                this.dockContext = context;\r\n                return (<div className={'my-auto'}>\r\n                    <button className={'btn btn-primary me-1'}\r\n                                onClick={(evt) => this.open(evt, context, panelData)}>\r\n                        <i className={'p-1 bi bi-search'}></i>\r\n                    </button>\r\n                    <button className={'btn btn-primary me-1'}\r\n                            onClick={(evt) => this.addMetamodel(evt, context, panelData)}>\r\n                        <i className={'p-1 bi bi-chevron-double-up'}></i>\r\n                    </button>\r\n                    <button className={'btn btn-primary me-1'}\r\n                            onClick={(evt) => this.addModel(evt, context, panelData)}>\r\n                        <i className={'p-1 bi bi-chevron-up'}></i>\r\n                    </button>\r\n                </div>);\r\n            }\r\n        },\r\n        'group2': {\r\n            floatable: true,\r\n            maximizable: true,\r\n        }\r\n    };\r\n\r\n    private persistance = { title: \"Persistance\", group: \"2\", closable: false, content: <PersistanceTab /> };\r\n    private structureEditor = { id: '1', title: 'Structure', group: 'group2', closable: false, content: <StructureEditor /> };\r\n    private treeEditor = { id: '2', title: 'Tree View', group: 'group2', closable: false, content: <TreeEditor /> };\r\n    private viewsEditor = { id: '3', title: 'Views', group: 'group2', closable: false, content: <ViewsEditor /> };\r\n    private styleEditor = { id: '4', title: 'Node', group: 'group2', closable: false, content: <StyleEditor /> };\r\n    private edgeEditor = { id: '5', title: 'Edges', group: 'group2', closable: false, content: <EdgeEditor /> };\r\n    private viewpointEditor = { id: '6', title: 'Viewpoints', group: 'group2', closable: false, content: <ViewpointEditor /> };\r\n    private console = { id: '7', title: 'Console', group: 'group2', closable: false, content: <Console /> };\r\n\r\n    private selected = this.props.selected;\r\n    private views = this.props.views;\r\n    private moveOnStructure = false;\r\n    private moveOnViews = false;\r\n\r\n    constructor(props: AllProps, context: any) {\r\n        super(props, context);\r\n        this.dock = null;\r\n    }\r\n\r\n    OPEN(model: DModel|LModel): void {\r\n        new Promise(resolve => setTimeout(resolve, 100)).then(() => {\r\n            let tab: TabData;\r\n            if(model.isMetamodel) tab = TabDataMaker.metamodel(model);\r\n            else tab = TabDataMaker.model(model);\r\n            this.dockContext.dockMove(tab, this.dockPanel, 'middle');\r\n        });\r\n    }\r\n\r\n    CLOSE(pointer: Pointer<DModel, 1, 1, LModel>): void {\r\n        new Promise(resolve => setTimeout(resolve, 50)).then(() => {\r\n            this.dockPanel.tabs = this.dockPanel.tabs.filter(tab => tab.id !== pointer);\r\n        });\r\n    }\r\n\r\n    shouldComponentUpdate(newProps: Readonly<AllProps>, newState: Readonly<ThisState>, newContext: any): boolean {\r\n        const oldProps = this.props;\r\n        // if(oldProps.selected !== newProps.selected) { this.moveOnStructure = true; return true; }\r\n        if (oldProps.views !== newProps.views) { this.moveOnViews = true; return true; }\r\n\r\n        const deltaM2 = U.arrayDifference(oldProps.m2, newProps.m2);\r\n        const addedM2: LModel[] = LModel.wrapAll(deltaM2.added);\r\n        const removedM2: Pointer<DModel, 0, 'N', LModel> = deltaM2.removed;\r\n        for(let model of addedM2) this.OPEN(model);\r\n        for(let pointer of removedM2) this.CLOSE(pointer);\r\n\r\n        const deltaM1 = U.arrayDifference(oldProps.m1, newProps.m1);\r\n        const addedM1: LModel[] = LModel.wrapAll(deltaM1.added);\r\n        const removedM1: Pointer<DModel, 0, 'N', LModel> = deltaM1.removed;\r\n        for(let model of addedM1) this.OPEN(model);\r\n        for(let pointer of removedM1) this.CLOSE(pointer);\r\n\r\n        return !!(deltaM2.added.length || deltaM1.added.length);\r\n\r\n    }\r\n\r\n    componentDidUpdate(prevProps: Readonly<AllProps>, prevState: Readonly<ThisState>, snapshot?: any) {\r\n        if(this.dock) {\r\n            if(this.moveOnViews) {\r\n                this.dock.dockMove(this.viewsEditor, this.dock.find('3'), 'middle');\r\n                this.moveOnViews = false;\r\n            }\r\n            if(this.moveOnStructure) {\r\n                this.dock.dockMove(this.structureEditor, this.dock.find('1'), 'middle');\r\n                this.moveOnStructure = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    open(evt: React.MouseEvent<HTMLButtonElement>, context: DockContext, panelData: PanelData) {\r\n        let html = '<style>body.swal2-no-backdrop .swal2-container {background-color: rgb(0 0 0 / 60%) !important}</style>';\r\n        html += `<div><b><label class='text-primary'>OPEN AN EXISTING MODEL</label></b><br/>`;\r\n        html += `<select class='mt-2 select' id='select-open-model'>`;\r\n        html += `<optgroup label='Metamodels'>`;\r\n        for(let metamodel of Selectors.getAllMetamodels()) {\r\n            html += `<option value=${metamodel.id}>${metamodel.name}</option>`;\r\n        }\r\n        html += '</optgroup>';\r\n        html += `<optgroup label='Models'>`;\r\n        for(let model of Selectors.getAllModels()) {\r\n            html += `<option value=${model.id}>${model.name}</option>`;\r\n        }\r\n        html += '</optgroup>';\r\n        html += '</select></div>';\r\n        const result = Swal.fire({\r\n            html: html, showCloseButton: true, confirmButtonText: 'OPEN',\r\n            preConfirm: () => {\r\n                const model: HTMLElement|null = document.getElementById('select-open-model');\r\n                return (model) ? (model as HTMLSelectElement).value : null;\r\n            },\r\n            backdrop: false\r\n        });\r\n        result.then((data) => {\r\n            if(data.isConfirmed && data.value) {\r\n                const model: LModel = LModel.fromPointer(data.value);\r\n                this.OPEN(model);\r\n            }\r\n        });\r\n    }\r\n\r\n    addMetamodel(evt: undefined|React.MouseEvent<HTMLButtonElement>, context: DockContext, panelData: PanelData, model?: DModel) {\r\n        let name = 'metamodel_' + 0;\r\n        let names: (string)[] = Selectors.getAllMetamodels().map(m => m.name);\r\n        name = U.increaseEndingNumber(name, false, false, (newName) => names.indexOf(newName) >= 0)\r\n        model = model || DModel.new(name, undefined, true);\r\n        DGraph.new(model.id);\r\n        this.OPEN(model);\r\n    }\r\n    addModel(evt: React.MouseEvent<HTMLButtonElement>, context: DockContext, panelData: PanelData) {\r\n        let html = '<style>body.swal2-no-backdrop .swal2-container {background-color: rgb(0 0 0 / 60%) !important}</style>';\r\n        html += `<div><b><label class='text-primary'>CREATE A MODEL</label></b><br/>`;\r\n        html += `<label>The model will be conform to:</label><br/>`;\r\n        html += `<select class='mt-2 select' id='select-add-model'>`;\r\n        html += `<optgroup label='Metamodels'>`;\r\n        for(let metamodel of Selectors.getAllMetamodels()) {\r\n            html += `<option value=${metamodel.id}>${metamodel.name}</option>`;\r\n        }\r\n        html += '</optgroup>';\r\n        html += '</select></div>';\r\n        const result = Swal.fire({\r\n            html: html, showCloseButton: true, confirmButtonText: 'CREATE',\r\n            preConfirm: () => {\r\n                const metamodel: HTMLElement|null = document.getElementById('select-add-model');\r\n                return (metamodel) ? (metamodel as HTMLSelectElement).value : null;\r\n            },\r\n            backdrop: false\r\n        });\r\n        result.then((data) => {\r\n            if(data.isConfirmed && data.value) {\r\n                let mmid: Pointer<DModel> = data.value;\r\n                const metamodel: LModel = LModel.fromPointer(mmid);\r\n                let name = 'model_' + 0;\r\n                let modelNames: (string)[] = metamodel.models.map(m => m.name);\r\n                name = U.increaseEndingNumber(name, false, false, (newName) => modelNames.indexOf(newName) >= 0)\r\n                BEGIN()\r\n                const model: DModel = DModel.new(name, mmid, false, true);\r\n                DGraph.new(model.id);\r\n                END()\r\n                this.OPEN(model);\r\n            }\r\n        });\r\n    }\r\n\r\n    render(): ReactNode {\r\n        const layout: LayoutData = { dockbox: { mode: 'horizontal', children: [] }};\r\n        const infoTab = { id: 'info', title: 'Info', group: 'group1', closable: false, content:\r\n            <InfoTab />\r\n        };\r\n        layout.dockbox.children.push({tabs: [infoTab]});\r\n        layout.dockbox.children.push({\r\n            tabs: [\r\n                // this.persistance,\r\n                this.structureEditor,\r\n                this.treeEditor,\r\n                this.viewsEditor,\r\n                this.viewpointEditor,\r\n                this.styleEditor,\r\n                this.edgeEditor,\r\n                this.console\r\n            ]\r\n        });\r\n\r\n        return (<DockLayout ref={(dockRef) => { this.dock = dockRef }} defaultLayout={layout}\r\n                            groups={this.groups} />);\r\n    }\r\n}\r\n\r\ninterface OwnProps { }\r\ninterface StateProps {\r\n    selected: Pointer<DModelElement, 0, 1, LModelElement>;\r\n    views: number;\r\n    m2: Pointer<DModel, 0, 'N', LModel>;\r\n    m1: Pointer<DModel, 0, 'N', LModel>;\r\n}\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    const selected = state._lastSelected?.modelElement;\r\n    if(selected) ret.selected = selected;\r\n    ret.views = state.viewelements.length;\r\n    ret.m2 = state.m2models;\r\n    ret.m1 = state.m1models;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const DockLayoutConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(DockLayoutComponent);\r\n\r\nexport const Dock = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <DockLayoutConnected {...{...props, children}} />;\r\n}\r\nexport default Dock;\r\n","export default __webpack_public_path__ + \"static/media/splash.70a592ca.png\";","import {\r\n    Dictionary, DUser,\r\n    EcoreParser, GObject, IStore,\r\n    Json,\r\n    LModel,\r\n    LoadAction,\r\n    Log, U,\r\n    LPointerTargetable, prjson2xml, prxml2json,\r\n    store, RuntimeAccessible, DModelElement, SetRootFieldAction, Selectors\r\n} from '../../joiner';\r\n\r\n@RuntimeAccessible\r\nexport class SaveManager {\r\n    private static tmpsave: IStore;\r\n\r\n    static save(): void {\r\n        SaveManager.tmpsave = store.getState();\r\n        localStorage.setItem(\"tmpsave\", JSON.stringify(SaveManager.tmpsave));\r\n    }\r\n\r\n    static load(fullstatestr?: string): void {\r\n        if (!fullstatestr && SaveManager.tmpsave) { LoadAction.new(SaveManager.tmpsave); return; }\r\n        fullstatestr = fullstatestr || localStorage.getItem(\"tmpsave\") || 'null'; // priorities: 1) argument from file 2) state variable cached 3) localstorage 4) null prevent crash\r\n        SaveManager.tmpsave = JSON.parse(fullstatestr);\r\n        LoadAction.new(SaveManager.tmpsave);\r\n        // SetRootFieldAction.new('metamodel', Selectors.getActiveModel()?.id, '', true); already set by loadaction in batch\r\n    }\r\n\r\n    public static exportEcore_click(toXML: boolean = false, toFile: boolean = true): void { // e: React.MouseEvent,\r\n        let lmodel: null|LModel = Selectors.getActiveModel();\r\n        if (!lmodel) return;\r\n        let json = SaveManager.exportEcore(lmodel);\r\n        let str = JSON.stringify(json, null, \"\\t\");\r\n        if (toXML) {\r\n            str = prjson2xml.json2xml(json, '\\t');\r\n            str = U.formatXml(str);\r\n        }\r\n\r\n        if (!toFile) {\r\n            // (document.querySelector(\"#export-tmp\") as any).innerText = str;\r\n            localStorage.setItem(\"import\", str);\r\n            return;\r\n        }\r\n        let ism2 = (lmodel as LModel).isMetamodel;\r\n        let name = (lmodel.name || (ism2 ? 'M2' : 'M1') + '_unnamed')  + (toXML ? \".xml\" : '.json') + \".\"+ (ism2 ? \"ecore\" : lmodel.instanceof?.name || \"shapeless\");\r\n        console.log(\"download file:\", {name, ism2, toXML, lmodel, instanceof:lmodel.instanceof});\r\n        U.download(name, str);\r\n    }\r\n\r\n    public static importEcore_click(fromXML: boolean = false, fromfile: boolean = true): void {\r\n        try { this.importEcore_click0(fromXML, fromfile); } catch (e: any) {\r\n            let str = e?.message?.substring?.(0, 1000) || 'some error';\r\n            console.trace(str, e);\r\n            // throw new Error(str);\r\n        }\r\n    }\r\n    public static importEcore_click0(fromXML: boolean = false, fromfile: boolean = true): void {\r\n        const extensions: string[] = [(fromXML ? \"*.xml.*\" : \"*.json.*\")]; // [\".ecore\"]; // Selectors.getActiveModel().isM1() ? '.' + Selectors.getActiveModel().metamodel.fullname() : '.ecore';\r\n        let filestring: string, jsonstring: string, jsonobj: GObject = undefined as any;\r\n        console.log(\"importEcore: prefromfile\");\r\n        if (!fromfile) {\r\n            filestring = localStorage.getItem(\"import\") || 'null';\r\n            if (fromXML) {\r\n                const xmlDoc = new DOMParser().parseFromString(filestring,\"text/xml\");\r\n                jsonobj = prxml2json.xml2jsonobj(xmlDoc, ' ');\r\n            }\r\n            //if (filestring.includes(\"\\n\")) throw new Error(filestring.substring(0, 1000));\r\n            SaveManager.importEcore(jsonobj || filestring, true, undefined, true); // todo: trova il modo di determinare se è m1 o m2 senza filename\r\n            return; }\r\n\r\n        console.log(\"importEcore: pre file read\");\r\n        let filename;\r\n        U.fileRead((e: Event, files?: FileList | null, fileContents?: string[]) => {\r\n            Log.ex(!fileContents || !files || fileContents.length !== files.length, 'Failed to get file contents:', files, fileContents);\r\n            Log.ex(fileContents && fileContents.length > 1, 'Should not be possible to input multiple files yet.');\r\n            if (!fileContents) return;\r\n            if (fileContents.length == 0) return;\r\n            // @ts-ignore\r\n            filename = e.target.files?.[0].name;\r\n            console.log(\"file read\", {e, fileContents, files, filename});\r\n            filestring = fileContents[0];\r\n            console.log('importEcore filestring input: ', filestring);\r\n            if (fromXML) {\r\n                let windoww = window as any;\r\n                windoww.file = filestring;\r\n                windoww.todoc = (str: any) => new DOMParser().parseFromString(str,\"text/xml\");\r\n                windoww.doctojson = (doc: any) => prxml2json.xml2jsonobj(doc, ' ');\r\n                // problemi doctojson or xmi parser: \\n replacemet causa crash per stringa in posizione invalida. \\\" anche per attributi inline che iniiano con \\\\\"\r\n                // filestring = U.multiReplaceAll(filestring, [\"\\t\", \"\\r\", \"\\n\", '&amp;', '&#38;', '&quot;', '&', '\\'', '\"'], [\"\\\\t\", \"\\\\r\", \"\\\\n\", '\\\\&', \"\\\\'\", '\\\\\"', '\\\\&', \"\\\\'\", '\\\\\"']);//,  \"\\\\t\"), \"\\r\", \"\\\\r\"), \"\\n\", \"\\\\n\");\r\n\r\n                const xmlDoc = new DOMParser().parseFromString(filestring,\"text/xml\");\r\n                console.log('importEcore xml:', xmlDoc);\r\n                let jsonstring0 = '';\r\n                jsonobj = prxml2json.xml2jsonobj(xmlDoc, ' ');//doto: non devo wrappare con \\\" i nomi di chiavi o valori ma solo i contenuti\r\n                /*jsonstring = jsonstring0;\r\n                //jsonstring = U.multiReplaceAll(jsonstring0, [\"\\t\", \"\\r\", \"\\n\", '&amp;', '&#38;', '&quot;', '&', '\\'', '\"'], [\"\\\\t\", \"\\\\r\", \"\\\\n\", '\\\\&', \"\\\\'\", '\\\\\"', '\\\\&', \"\\\\'\", '\\\\\"']);//,  \"\\\\t\"), \"\\r\", \"\\\\r\"), \"\\n\", \"\\\\n\");\r\n                *///jsonstring = jsonstring.replaceAll(/(\\{|\\,)\\\\n\\s*/gm, \"\")\r\n                /*if (jsonstring.includes(\"\\n\")) throw new Error(jsonstring0.substring(0, 1000)+\"\\n\\n\\n\\n\" + jsonstring.substring(0, 1000));\r\n                */\r\n                // jsonstring = JSON.stringify(jsonobj);\r\n                console.log('importEcore jsonstr input: ', jsonobj);\r\n            }\r\n            else jsonstring = filestring;\r\n            let isMetamodel = filename.indexOf(\".ecore\") === filename.length - \".ecore\".length;\r\n            console.log(\"ismetamodel\", {filename, isMetamodel});\r\n            let end = SaveManager.importEcore(jsonobj || jsonstring || 'null', isMetamodel,filename, true);\r\n            console.error({end});\r\n        }, extensions, true);\r\n    }\r\n\r\n    public static exportEcore(model: LModel): Json {\r\n        let loopobj = {};\r\n        try { return model.generateEcoreJson(loopobj); }\r\n        catch(e) { Log.exx(\"possible loop in model:\\t\\n\" + (e as Error).message, {loopobj, e}); }\r\n        return {\"error\": true, loopobj};\r\n    }\r\n    public static importEcore(jsonstr: GObject | string | null, isMetamodel: boolean, filename: string | undefined, loadOnModel: boolean = true): DModelElement[] {\r\n        return EcoreParser.parse(jsonstr, isMetamodel, filename, loadOnModel);\r\n    }\r\n\r\n    static exportLayout_click(toFile: boolean) {\r\n        let lmodel: LModel = (LPointerTargetable.wrap(store.getState().models[0]) as LModel);\r\n        // lmodel.node?.allSubNodes\r\n\r\n    }\r\n    static importLayout_click(fromFile: boolean) {\r\n\r\n    }\r\n}\r\n\r\n","import React, {Dispatch, ReactElement, ReactNode} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {\r\n    DEdge,\r\n    DGraph,\r\n    DGraphElement,\r\n    DGraphVertex, Dictionary,\r\n    DVoidVertex, EdgeBendingMode,\r\n    GraphElementComponent,\r\n    GraphElementDispatchProps,\r\n    GraphElementOwnProps,\r\n    GraphElementReduxStateProps,\r\n    GraphElementStatee, GraphPoint,\r\n    IStore,\r\n    LClass, LEdge,\r\n    LModelElement,\r\n    LPointerTargetable,\r\n    LUser,\r\n    LVoidVertex, Overlap,\r\n    RuntimeAccessibleClass,\r\n    U,\r\n} from \"../../joiner\";\r\nimport {LViewPoint} from \"../../view/viewPoint/viewpoint\";\r\nlet groupingsize: Dictionary<EdgeBendingMode, number> = {} as any;\r\ngroupingsize[EdgeBendingMode.Line] = 1;\r\ngroupingsize[EdgeBendingMode.Bezier_quadratic] = 2;\r\ngroupingsize[EdgeBendingMode.Bezier_cubic] = 3;\r\ngroupingsize[EdgeBendingMode.Bezier_quadratic_mirrored] = 1;\r\ngroupingsize[EdgeBendingMode.Bezier_cubic_mirrored] = 2;\r\ngroupingsize[EdgeBendingMode.Elliptical_arc] = 2; // (1_coord), (rotation), (sweep    arc), (1_coord)\r\n\r\nconst superclassGraphElementComponent: typeof GraphElementComponent = RuntimeAccessibleClass.classes.GraphElementComponent as any as typeof GraphElementComponent;\r\nconst superclassGraphElementComponentuntyped: any = RuntimeAccessibleClass.classes.GraphElementComponent as any;\r\nclass ThisStatee extends GraphElementStatee {}\r\n\r\nexport class EdgeComponent<AllProps extends AllPropss = AllPropss, ThisState extends ThisStatee = ThisStatee>\r\n    extends superclassGraphElementComponent<AllProps, ThisState> {\r\n\r\n    constructor(props: AllProps, context: any) {\r\n        super(props, context);\r\n    }\r\n    render(): ReactNode {\r\n       return super.render();\r\n    }\r\n\r\n}\r\n\r\nclass OwnProps extends GraphElementOwnProps {\r\n    onclick?: (e: React.MouseEvent<HTMLDivElement>) => void;\r\n    onmousedown?: (e: React.MouseEvent<HTMLDivElement>) => void;\r\n    isGraph?: boolean = false;\r\n    isVertex?: boolean = true;\r\n}\r\n\r\nclass StateProps extends GraphElementReduxStateProps {\r\n    node!: LEdge;\r\n    lastSelected!: LModelElement | null;\r\n    isEdgePending!: { user: LUser, source: LClass };\r\n    viewpoint!: LViewPoint;\r\n    path!: () => string; // svg path builder\r\n}\r\n\r\nclass DispatchProps extends GraphElementDispatchProps {\r\n}\r\n\r\ntype AllPropss = Overlap<Overlap<OwnProps, StateProps>, DispatchProps>;\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = new StateProps();\r\n    // superret.lastSelected = state._lastSelected ? LPointerTargetable.from(state._lastSelected.modelElement) : null;\r\n    ret.isEdgePending = {\r\n        user: LPointerTargetable.from(state.isEdgePending.user),\r\n        source: LPointerTargetable.from(state.isEdgePending.source)\r\n    };\r\n    ret.viewpoint = LViewPoint.fromPointer(state.viewpoint);\r\n    ret.path = () => {\r\n        let s = '';\r\n        // @ts-ignore\r\n        console.log(\"path:\", this, ret, s);\r\n        let svgletter: EdgeBendingMode = (ret).view.bendingMode;\r\n        if(!ret.node) return \"node missing\";\r\n        let coords = ret.node.midnodes.map( (mn) => mn.x+\" \"+mn.y);\r\n        if (!coords) coords = [];\r\n        let grouping = groupingsize[svgletter];\r\n        let scoord: GraphPoint = ret.node.start?.size.tl() || new GraphPoint(50, 50);\r\n        let ecoord: GraphPoint = ret.node.end?.size.tl() || new GraphPoint(500, 150);\r\n        s+= \"M \" + scoord.x + \" \" + scoord.y + svgletter + \" \" + coords.join(\", \") + \", \" + ecoord.x+\" \"+ecoord.y;\r\n        /*for (let i = 0; i < coords.length + 1; i++) {\r\n            if (i-1 % grouping === 0) s+= \" \" + svgletter + \" \"\r\n            else s+=\", \";\r\n            s += (i === coords.length ? ecoord.x + \" \" + ecoord.y : coords[i]);\r\n        }*/\r\n        // if (U.isNumber(s[0])) s = \"M \" + s; else s = \"M \" + s.substring(1);\r\n        return s; }\r\n\r\n    const superret: StateProps = GraphElementComponent.mapStateToProps(state, ownProps, DEdge, ret) as StateProps;\r\n    // U.objectMergeInPlace(superret, ret);\r\n    // U.removeEmptyObjectKeys(superret);\r\n    // console.error(superret, ret); throw Error(\"aaa\");\r\n    return superret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const superret: GraphElementDispatchProps = GraphElementComponent.mapDispatchToProps(dispatch);\r\n    const ret: GraphElementDispatchProps = new GraphElementDispatchProps();\r\n    U.objectMergeInPlace(superret, ret);\r\n    U.removeEmptyObjectKeys(superret);\r\n    return superret;\r\n}\r\n\r\n\r\nexport const EdgeConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(EdgeComponent as any);\r\n\r\nexport const DamEdge = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <EdgeConnected {...{...props, children}} isGraph={false} isVertex={true} />;\r\n}\r\n","import React, {Dispatch, ReactElement} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {IStore} from \"../../redux/store\";\r\nimport './style.scss';\r\nimport {\r\n    CreateElementAction,\r\n    DEdgePoint,\r\n    DViewElement,\r\n    DVoidEdge,\r\n    EdgeBendingMode, GObject,\r\n    GraphSize,\r\n    Selectors,\r\n    store\r\n} from \"../../joiner\";\r\nimport {SaveManager} from \"./SaveManager\";\r\nimport {DamEdge} from \"../../graph/damedges/damedge\";\r\nimport toast from \"react-hot-toast\";\r\n\r\nfunction Topbar(props: AllProps) {\r\n\r\n    const notify = (text: string) => toast((t: GObject) => (\r\n        <div onClick={() => toast.dismiss(t.id)}>\r\n            <label className={'ms-1'}>{text}</label>\r\n        </div>\r\n    ));\r\n\r\n    const save = (evt: React.MouseEvent<HTMLLabelElement>) => {\r\n        SaveManager.save();\r\n        notify('Saved');\r\n    }\r\n    const load = (evt: React.MouseEvent<HTMLLabelElement>) => {\r\n        SaveManager.load();\r\n    }\r\n\r\n    const importJson = (evt: React.MouseEvent<HTMLLabelElement>) => {\r\n        SaveManager.importEcore_click(false, true);\r\n    }\r\n    const exportJson = (evt: React.MouseEvent<HTMLLabelElement>) => {\r\n        SaveManager.exportEcore_click(false, true);\r\n    }\r\n\r\n    const importXml = (evt: React.MouseEvent<HTMLLabelElement>) => {\r\n        SaveManager.importEcore_click(true, true);\r\n    }\r\n    const exportXml = (evt: React.MouseEvent<HTMLLabelElement>) => {\r\n        SaveManager.exportEcore_click(true, true);\r\n    }\r\n\r\n\r\n    return(<div className={'topbar d-flex'}>\r\n        <div className={'ms-1'}>\r\n            {/*\r\n            <Undoredocomponent />\r\n\r\n            <label className={'item border round ms-1'} onClick={exportXml}>Export XML</label>\r\n            <label className={'item border round ms-1'} onClick={importXml}>Import XML</label>\r\n\r\n            <div className={'ms-auto me-1'}>\r\n                <label className={'item border round ms-1'} onClick={ () => SaveManager.exportLayout_click(false) }>Export Layout</label>\r\n                <label className={'item border round ms-1'} onClick={ () => SaveManager.importLayout_click(false) }>Import Layout</label>\r\n                <label className={'item border round ms-1'} onClick={ () => edgetest() }>Edge test</label>\r\n            </div>\r\n            */}\r\n\r\n            <label className={'item border round ms-1'} onClick={save}>Save</label>\r\n            <label className={'item border round ms-1'} onClick={load}>Load</label>\r\n\r\n            <label className={'item border round ms-1'} onClick={exportJson}>Export JSON</label>\r\n            <label className={'item border round ms-1'} onClick={importJson}>Import JSON</label>\r\n        </div>\r\n    </div>);\r\n}\r\ninterface OwnProps {}\r\ninterface StateProps { }\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: IStore, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const TopBarConnected = connect<StateProps, DispatchProps, OwnProps, IStore>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(Topbar);\r\n\r\nexport const TopBar = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <TopBarConnected {...{...props, children}} />;\r\n}\r\n\r\n\r\n\r\n\r\n\r\nlet edgetestvar: JSX.Element = <></>;\r\n//             <ellipse stroke={\"black\"} fill={\"red\"} cx={this.props.node.end.x} cy={this.props.node.end.y}\r\n//                         rx={this.props.node.end.w} ry={this.props.node.end.h} />\r\n//             <ellipse stroke={\"black\"} fill={\"red\"} cx={this.props.node.start.x} cy={this.props.node.start.y}\r\n//                         rx={this.props.node.start.w} ry={this.props.node.start.h} />\r\nfunction edgetest(){\r\n    let jsx =\r\n        `<svg>\r\n            <path stroke={\"black\"} fill={\"none\"} d={this.path()}></path>\r\n            {this.props.node.midnodes.map(mn => <ellipse stroke={\"black\"} fill={\"red\"} cx={mn.x} cy={mn.y} rx={mn.w} ry={mn.h} />)}\r\n        </svg>`\r\n    let view = DViewElement.new2(\"edge view\", jsx, (d)=> { d.bendingMode = EdgeBendingMode.Line});\r\n    let midnodejsx = `<div style={{position:\"absolute\", top: this.data.x+\"px\", left: this.data.y+\"px\"}}>midnode</div>`;\r\n    let midnodeview = DViewElement.new(\"edgepoint view\", midnodejsx);\r\n    let node: DVoidEdge = DVoidEdge.new();\r\n    function makeep(x:number, y:number, w=5, h=5) {\r\n        let e = DEdgePoint.new(undefined, node.id, undefined, undefined, new GraphSize(x, y, w, h));\r\n        return e.id;\r\n    }\r\n    node.midnodes = [makeep(50, 100), makeep(80, 100), makeep(120, 120), makeep(150,120), makeep(150, 80)];\r\n    CreateElementAction.new(view);\r\n    CreateElementAction.new(midnodeview);\r\n    CreateElementAction.new(node);\r\n    let graphid = store.getState().graphs[0];\r\n    edgetestvar = <div style={{position:\"absolute\", zIndex:1000, top:\"50px\", left:\"50px\", width:\"500px\", height:\"500px\", background:\"white\", border:\"4px solid black\"}}>\r\n        <div style={{height:\"100%\", width:\"100%\", position:\"relative\"}}>\r\n            <DamEdge view={view.id} graphid={graphid} nodeid={node.id}></DamEdge>\r\n        </div>\r\n    </div>\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport default TopBar;\r\n","import React from 'react';\r\nimport './App.scss';\r\nimport './styles/view.scss';\r\nimport './styles/style.scss';\r\n//import Dock from \"./components/abstract/DockComponent\";\r\nimport Dock from \"./components/abstract/DockLayout\";\r\nimport {statehistory} from \"./joiner\";\r\nimport {useStateIfMounted} from \"use-state-if-mounted\";\r\nimport {useEffectOnce} from \"usehooks-ts\";\r\nimport SplashImage from './static/img/splash.png';\r\nimport {Oval} from \"react-loader-spinner\";\r\nimport TopBar from \"./components/topbar/Topbar\";\r\n\r\ninterface Props {}\r\nfunction App(props: Props) {\r\n    const [splash, setSplash] = useStateIfMounted(false);\r\n\r\n    useEffectOnce(() => {\r\n        const promise = new Promise((resolve) => {setTimeout(resolve, 4 * 1000)});\r\n        promise.then(() => {setSplash(false)});\r\n    });\r\n\r\n    if(splash) {\r\n        return(<div className={'w-100 h-100 text-center bg-smoke'}>\r\n            <img className={'mt-3 rounded shadow'} src={SplashImage}></img>\r\n            <Oval height={80} width={80} wrapperStyle={{justifyContent: 'center'}} wrapperClass={'mt-3'}\r\n                  color={'#475e6c'} secondaryColor={'#ff8811'} />\r\n        </div>);\r\n    } else {\r\n        return(<div className={'d-flex flex-column h-100 p-1'} onClick={() => {statehistory.globalcanundostate = true;} } >\r\n            <TopBar />\r\n            <Dock />\r\n        </div>);\r\n    }\r\n\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport 'bootstrap/dist/css/bootstrap.min.css';\r\nimport 'bootstrap-icons/font/bootstrap-icons.css';\r\nimport 'bootstrap/dist/js/bootstrap.bundle.min';\r\nimport App from './App';\r\nimport {Provider} from \"react-redux\";\r\nimport {jodelInit, store} from \"./joiner\";\r\n\r\nfunction start() {\r\n    jodelInit();\r\n    ReactDOM.render(\r\n        <Provider store={store}>\r\n            <App/>\r\n        </Provider>,\r\n        document.getElementById('root')\r\n    );\r\n}\r\nsetTimeout(start, 10);\r\n\r\n"],"sourceRoot":""}